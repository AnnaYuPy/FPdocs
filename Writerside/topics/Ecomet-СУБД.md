# Ecomet (СУБД)

Ecomet - это СУБД для real-time приложений.

Ecomet предлагает встроенную модель управления правами пользователей и поддержку защищенных подключений через Secure WebSocket, что позволяет обеспечить безопасную работу с данными из браузера с использованием JavaScript. Для упрощения задач интеграции в Ecomet реализованы библиотеки на языке JavaScript.

## Логическая организация данных

- ![](Aspose.Words.7ab25b03-c1da-422c-8229-366aad17399d.024.jpeg)Данные представлены в виде*объектов*. Полезная информация хранится в *полях* объектов.
- Состав и тип допустимых полей объекта определяется *шаблоном*объекта. Шаблон - аналог определения таблицы в реляционных СУБД (*схема*).
- Шаблоны объектов поддерживают *наследование*. Наследник получает наборполейродительскогошаблона,атакженаследуетего*поведение*.
- Поведение объектов определяется подключаемыми программными модулями.
- Цепочка наследования каждого шаблона всегда заканчивается шаблоном .object, который определяет набор системных полей объекта,атакжеопределяетегоповедениекакобъектабазыданных.
- Объекты хранятся в *папках*, аналогично файлам в файловой системе. Каждая папка - объект, который также расположен в одной из папок и имеет поля.

## Схема хранения. Структура

Разные поля одного объекта могут принадлежать разным хранилищам. Тип хранилища определяется в шаблоне объекта отдельно для каждого поля(свойство storage).

Хранилища состоят из физических фрагментов. Фрагменты группируются в спейсы. Спейсы распределяются по узлам. Каждый space может иметь копии на нескольких узлах. Конфигурирование выполняется без останова узлов. Папка “/root/.storage”.

![](Aspose.Words.7ab25b03-c1da-422c-8229-366aad17399d.025.png){width=400 thumbnail="true"}{border-effect=line}

## Шаблоны объектов

Шаблоны являются служебными объектами, которые определяют структуру, способ хранения и поведение хранимых в базе объектов. Объект шаблона может быть создан, отредактирован или удален таким же способом как и любой другой объект.

- Объекты шаблонов хранятся в папке “/root/.patterns/”.
- Как и другие объекты БД, шаблоны имеют схему, которая определена шаблоном .pattern.
- Шаблон.pattern является наследником шаблона .folder. Это означает, что объект	шаблона	является	*папкой*.	Папка содержит объекты - *поля*.
- Объект шаблона определяет:
    - *storage* - тип хранилища (ram,ramdisc,disc),
    - *parent\_pattern* - родительский шаблон,
    - *handler\_module* - программный модуль, определяющий поведение объектов данного шаблона.

![](Aspose.Words.7ab25b03-c1da-422c-8229-366aad17399d.026.jpeg)

***O***-поля, унаследованные из .object ***F***-поля,унаследованные из.folder ***P*** - поля, определенные в .pattern

### Поля

Поля - служебные объекты, хранящиеся в папках шаблонов. Объекты полей выполняют функции аналогичные определениям столбцов таблицы в реляционных СУБД и имеют следующие свойства:

- *.name* - имя поля
- *type* - тип поля,(string,integer,binary и т.д.)
- *subtype* - тип элементов массива для полей типа *list*
- *index* - список формируемых на поле типов индексов
- *storage* - тип хранилища: ram, ramdisc, disc. Поля одного объекта могут иметь разный тип хранения. Формируемые на поле индексы имеют одинаковый с полем тип хранения.
- *required* - флаг-обязательное поле
- *default\_value* - значение по умолчанию
- *autoincrement* - флаг-значение поля формируется автоматически. Гарантируется уникальность значения в рамках множества объектов принадлежащих шаблону.

### Типы индексов

Индексы представляют собой оптимизированные под поисковые алгоритмы структуры данных. Использование индексов позволяет значительно повысить производительность поисковых запросов. Ecomet поддерживает следующие типы индексов:

- simple - 2-х уровневый*сжатый битовый*индекс. Тип используется*алгоритмом нисходящего поиска*\*.Сжатие*пузырьковым алгоритмом*\*решает проблему разреженности битового индекса при его высокой селективности.
- n-gram -тип представляет собой адаптацию simple индекса для использования алгоритмом полнотекстового поиска по n-граммам\*.
- bitslice - тип служит для оптимизации агрегирующих операций (sum, average) по числовым полям\*\*,
- sorted - разновидность b-tree индекса. В сочетании с simple индексом используется *алгоритмом трапецеидального поиска*\*для оптимизации поиска по интервалу значений и/или сортировки вывода результатов поиска \*\*.

\*-*инновационныерешения,*\*\*-*неподдержановтекущейверсии,этапреализации*

### Поведение объектов

- Объекты хранимые в базе могут иметь определяемую пользователем *реакцию* на их создание, изменение и удаление- *поведение*.
- Реакция на события определяется в подключаемых программных модулях. Модули должны быть реализованы на языке*Erlang*и обязательно содержать определение внешних callback-функций: on\_create/1, on\_edit/1, on\_delete/1. Модуль поведения для объектов задается через поле handler\_module в их шаблоне.
- На вход callback-функций подается*проект объекта*, из которого можно получить информацию о текущем состоянии объекта и вносимых в него изменениях.
- Код модуля исполняется процессом, обслуживающим текущее подключение к базе, и имеет контекст авторизованного пользователя. Callback всегда выполняется в рамках транзакции. В случае возврата ошибки изменение не будет применено.
- Модуль поведения может взаимодействовать с СУБД Ecomet как с Erlang/OTP приложением через нативный программный интерфейс. Имеется возможность работы с другими доступными библиотеками и приложениями Erlang.
- Если родительский шаблон также определяет некоторое поведение для объекта, то оно *наследуется*. Это означает, что callback-функции родителя также будут выполнены. Порядок вызова - *от потомка к родителю*.

## Схема хранения. Типы хранилищ данных

В системе используются различные типы хранилищ данных. Каждый из них имеет свои особенности и назначение:
- <b>ram</b>
  - <b>Описание</b>: Данные хранятся исключительно в оперативной памяти.
  - <b>Преимущества</b>: Обеспечивает высокую скорость доступа к данным.
  - <b>Недостатки</b>: Требует большого объема доступной оперативной памяти. Данные могут быть утеряны при рестарте системы, если нет копии на других узлах (кластер).
- <b>ramdisc</b>
  - <b>Описание</b>: Данные хранятся в оперативной памяти, а также имеется копия на жестком диске.
  - <b>Преимущества</b>: Высокая скорость доступа к данным и возможность восстановления данных при рестарте независимо от наличия копий на других узлах.
  - <b>Механизм</b>: На диске ведется секвентальный лог изменений, который периодически сбрасывается в дамп.
- <b>disc</b>
  - <b>Описание</b>: Данные хранятся только на жестком диске.
  - <b>Преимущества</b>: Позволяет хранить большие объемы информации, которые не умещаются в оперативной памяти.
  - <b>Недостатки</b>: Скорость чтения ниже, чем у ram или ramdisc.
  - <b>Производительность операций</b>:  
    - <b>Запись</b>: Ведется в промежуточный буфер ramdisc, который при переполнении асинхронно сбрасывает излишки на диск. Скорость записи равна скорости ramdisc.
    - <b>Чтение</b>: Результаты операций сохраняются в кэш, обеспечивая скорость доступа к наиболее востребованным данным на уровне ram.
Эти хранилища обеспечивают баланс между скоростью доступа, объемом памяти и надежностью данных в зависимости от потребностей системы.

## Мульти-кластер и домены данных
В типичном сценарии Ecomet представляет собой распределенную систему, состоящую из одного или более кластеров. Каждый кластер включает как минимум один узел. При подключении к одному из узлов системы пользователь получает доступ ко всему информационному фонду, при этом доступ к данным ограничен только правами пользователя.

Предполагается, что каналы связи между кластерами обладают меньшей пропускной способностью по сравнению с каналами между узлами внутри одного кластера. Это может приводить к задержкам при работе пользователя с данными, физически хранящимися в другом кластере. Для решения этой проблемы введено понятие домена данных. Домен позволяет сгруппировать логически связанные данные в пределах одного кластера.

Каждый домен имеет собственный набор хранилищ (ram, ramdisc, disc) и привязан к конкретному кластеру. Хранилища домена распределены по узлам кластера.

Логически домен представляет собой папку (объект Ecomet). Объекты, создаваемые в этой папке, физически хранятся в хранилищах данного домена.

Если запрос пользователя охватывает данные из удаленных доменов, задача делится на домены и подзадачи и делегируются соответствующим кластерам. Кластеры, работая с локальными хранилищами, эффективно выполняют работу и отправляют готовый результат узлу-заказчику. Узел-заказчик выполняет свертку и отправляет ответ клиенту, используя механизм MapReduce.

## Скорость

На больших объемах данных наиболее ресурсоемкими являются операции поиска, группировки и сортировки.

Ecomet для эффективного решения этих проблем использует индексы и оптимизированные для них алгоритмы в сочетании с технологией распределенного поиска:

- <b>Послойная индексация с алгоритмом нисходящего поиска </b> повышает производительность более чем в 20 раз;
  ![](Ecomet.1.png){width=300 thumbnail="true"}{border-effect=line}
- <b>Подписка на поисковой запрос</b> позволяет получать данные в режиме реального времени;
- <b>Технология кэширования с возможностью явного определения способа хранения до уровня отдельных полей объекта</b> минимизирует количество обращений к внешней памяти.

## Управление правами пользователей

Механизмы разграничения прав пользователей в СУБД Ecomet схожи с системой прав доступа в ОС Linux:

- каждое подключение к базе требует авторизации; каждый процесс,обслуживающий подключение, работает в контексте конкретного пользователя;
- пользователи объединяются в группы;
- каждый пользователь может быть участником нескольких групп;
- каждый объект базы данных имеет системные поля:
  - ```.readgroups``` - список групп, имеющих право на чтение объекта;
  - ```.writegroups``` - список групп, имеющих право на изменение объекта;
- каждый объект при создании наследует конфигурацию прав из папки, в которой он создается, если права не определены явно.

![](Ecomet.2.png){width=400 thumbnail="true"}{border-effect=line}

## Единый информационный фонд

![](Aspose.Words.7ab25b03-c1da-422c-8229-366aad17399d.027.png){width=400 thumbnail="true"}{border-effect=line}

- <b>Актуальные данные</b>: Независимо от точки подключения, пользователь работает с актуальными данными.
- <b>Отказоустойчивость</b>: В системе отсутствует единая точка отказа. При выходе из строя одного узла нагрузка перераспределяется между рабочими узлами. Максимальное количество рабочих узлов — 65 536.
- <b>Логическая организация данных</b>: Пользователь взаимодействует только с логической организацией данных, при этом физическое размещение данных остается скрытым.
- <b>Простота работы с данными</b>: Работа с данными максимально упрощена и прозрачна для пользователя.
- <b>Гибкость конфигурации</b>: Добавление и удаление узлов, доменов и конфигурирование хранилищ выполняется динамически, без необходимости остановки системы.