# API СУБД

Класс Ecomet предоставляет интерфейс на JavaScript для взаимодействия с СУБД Ecomet через WebSocket. Ниже приведен подробный список функций, включая описание их параметров и возвращаемых значений.

**Конструктор**

- **constructor()** Инициализирует экземпляр класса Ecomet с начальными свойствами.

**Методы**

## connect()
: метод для подключения к серверу Ecomet, используя указанные IP, порт и протокол.

Синтаксис:

```shell
connect(IP, Port, Protocol, OnOk, OnError, OnClose)
```

Параметры:

IP (string)
: IP-адрес сервера.

Port (number)
: Номер порта сервера.

Protocol (string)
: Протокол (например, "http", "https").

OnOk (function)
: Callback-функция при успешном подключении.

OnError (function)
: Callback-функция при ошибке подключения.

OnClose (function)
: Callback-функция при закрытии соединения.

Возвращаемое значение:

: нет.

Примеры:

```shell

```

**forkConnection()** Создает форк (ответвление) подключения к серверу Ecomet.
    **Параметры:** Нет
    **Возвращаемое значение:** Promise<Ecomet>: Обещание, которое разрешается в новый экземпляр Ecomet с активным форкнутым подключением.

connectUrl(URL, OnOk, OnError, OnClose)** Подключается к серверу Ecomet, используя указанный URL.
    **Параметры:**
        URL (string): WebSocket URL сервера.
        OnOk (function): Callback-функция при успешном подключении.
        OnError (function): Callback-функция при ошибке подключения.
        OnClose (function): Callback-функция при закрытии соединения.
    **Возвращаемое значение:** Нет

**close()** Закрывает WebSocket соединение.
    **Параметры:** Нет
    **Возвращаемое значение:** Нет

**is\_ok()** Проверяет, открыто ли WebSocket соединение.
    **Параметры:** Нет
    **Возвращаемое значение:** boolean: Возвращает true, если соединение открыто, иначе false.

**login(login, pass, OnOk, OnError, Timeout)** Выполняет вход в систему с указанными логином и паролем.
    **Параметры:**
        login (string): Логин пользователя.
        pass (string): Пароль пользователя.
        OnOk (function): Callback-функция при успешном входе.
        OnError (function): Callback-функция при ошибке входа.
        Timeout (number): Время ожидания в миллисекундах.
    **Возвращаемое значение:** Идентификатор действия.

**debug\_applyTo(fields, oid)** Асинхронно применяет отладочные параметры к объекту.
    **Параметры:**
        fields (object): Поля объекта.
        oid (string): Идентификатор объекта.
    **Возвращаемое значение:** Promise<object>: Обещание, которое разрешается в обновленные поля объекта.
1. **create\_object(fields, OnOk, OnError, Timeout)** Создает новый объект с указанными полями.
    1. **Параметры:**
        1. fields (object): Поля нового объекта.
        1. OnOk (function): Функция обратного вызова при успешном создании.
        1. OnError (function): Функция обратного вызова при ошибке создания.
        1. Timeout (number): Время ожидания в миллисекундах.
    1. **Возвращает:** Идентификатор действия.
1. **edit\_or\_create\_object(fields, OnOk, OnError, Timeout)** Редактирует существующий или создает новый объект с указанными полями.
    1. **Параметры:**
        1. fields (object): Поля объекта.
        1. OnOk (function): Функция обратного вызова при успешной операции.
        1. OnError (function): Функция обратного вызова при ошибке операции.
        1. Timeout (number): Время ожидания в миллисекундах.
    1. **Возвращает:** Идентификатор действия.
1. **edit\_object(oid, fields, OnOk, OnError, Timeout)** Редактирует существующий объект с указанными полями.
    1. **Параметры:**
        1. oid (string): Идентификатор объекта.
        1. fields (object): Новые поля объекта.
        1. OnOk (function): Функция обратного вызова при успешной операции.
        1. OnError (function): Функция обратного вызова при ошибке операции.
        1. Timeout (number): Время ожидания в миллисекундах.
    1. **Возвращает:** Идентификатор действия.
1. **delete\_object(oid, OnOk, OnError, Timeout)** Удаляет объект с указанным идентификатором.
    1. **Параметры:**
        1. oid (string): Идентификатор объекта.
        1. OnOk (function): Функция обратного вызова при успешной операции.
        1. OnError (function): Функция обратного вызова при ошибке операции.
        1. Timeout (number): Время ожидания в миллисекундах.
    1. **Возвращает:** Идентификатор действия.
1. **find(statement, OnOk, OnError, Timeout)** Выполняет поиск объектов по указанному SQL-запросу.
    1. **Параметры:**
        1. statement (string): SQL-запрос для поиска.
        1. OnOk (function): Функция обратного вызова при успешном выполнении запроса.
        1. OnError (function): Функция обратного вызова при ошибке выполнения запроса.
        1. Timeout (number): Время ожидания в миллисекундах.
    1. **Возвращает:** Идентификатор действия.
1. **query(statement, OnOk, OnError, Timeout)** Выполняет произвольный SQL-запрос.
    1. **Параметры:**
        1. statement (string): SQL-запрос.
        1. OnOk (function): Функция обратного вызова при успешном выполнении запроса.
        1. OnError (function): Функция обратного вызова при ошибке выполнения запроса.
        1. Timeout (number): Время ожидания в миллисекундах.
    1. **Возвращает:** Идентификатор действия.
1. **get(statement, OnOk, OnError, Timeout)** Выполняет запрос и возвращает результат в удобном формате.
    1. **Параметры:**
        1. statement (string): SQL-запрос.
        1. OnOk (function): Функция обратного вызова при успешном выполнении запроса.
        1. OnError (function): Функция обратного вызова при ошибке выполнения запроса.
        1. Timeout (number): Время ожидания в миллисекундах.
    1. **Возвращает:** Идентификатор действия.
1. **subscribe(statement, OnCreate, OnUpdate, OnDelete, OnError)** Подписывается на изменения объектов, соответствующих указанному SQL-запросу.
    1. **Параметры:**
        1. statement (string): SQL-запрос.
        1. OnCreate (function): Функция обратного вызова при создании объекта.
        1. OnUpdate (function): Функция обратного вызова при обновлении объекта.
        1. OnDelete (function): Функция обратного вызова при удалении объекта.
        1. OnError (function): Функция обратного вызова при ошибке выполнения запроса.
    1. **Возвращает:** Идентификатор действия.
1. **unsubscribe(id, OnOk, OnError)** Отписывается от изменений объектов.
    1. **Параметры:**
        1. id (number): Идентификатор подписки.
        1. OnOk (function): Функция обратного вызова при успешной отписке.
        1. OnError (function): Функция обратного вызова при ошибке отписки.
    1. **Возвращает:** Идентификатор действия.
1. **application(module, method, params, OnOk, OnError, Timeout)** Выполняет вызов функции приложения на сервере.
    1. **Параметры:**
        1. module (string): Название модуля.
        1. method (string): Название метода.
        1. params (object): Параметры метода.
        1. OnOk (function): Функция обратного вызова при успешном выполнении.
        1. OnError (function): Функция обратного вызова при ошибке выполнения.
        1. Timeout (number): Время ожидания в миллисекундах.
    1. **Возвращает:** Идентификатор действия.

**Внутренние методы**

1. **\_action(Type, Params, OnOk, OnError, Timeout, Id)** Отправляет запрос на сервер.
    1. **Параметры:**
        1. Type (string): Тип действия.
        1. Params (object): Параметры действия.
        1. OnOk (function): Функция обратного вызова при успешном выполнении действия.
        1. OnError (function): Функция обратного вызова при ошибке выполнения действия.
        1. Timeout (number): Время ожидания в миллисекундах.
        1. Id (number): Идентификатор действия.
    1. **Возвращает:** Идентификатор действия.
1. **\_on\_receive(response)** Обрабатывает ответ от сервера.
    1. **Параметры:**
        1. response (object): Ответ от сервера.
    1. **Возвращает:** Нет

**Статические методы**

1. **static to\_ecomet1([Header, ...Rows], all)** Преобразует результаты запроса в формат Ecomet.
    1. **Параметры:**
        1. Header (array): Заголовки полей.
        1. Rows (array): Строки данных.
        1. all (boolean): Флаг, указывающий, следует ли включать все поля.
    1. **Возвращает:** array: Преобразованные данные.
