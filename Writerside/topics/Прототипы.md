# Прототипы


Понятие прототипов в IoT-платформах, таких как Faceplate, схоже с концепцией классов в объектно-ориентированном программировании. Другими словами они представляют собой шаблоны или формы для создания конкретных экземпляров объектов или устройств, определяя их структуру, свойства, содержимое и поведение. Это означает, что прототип включает в себя определение полей, их типы данных, методы и функции для работы с этими полями, а также логику для обработки событий и состояний объекта.

Прототип является основой для создания конкретных экземпляров объектов или устройств в системе. Каждый экземпляр прототипа наследует его свойства и методы, а также может иметь собственные уникальные значения для полей.

<p text-align="justify">
Прототип позволяет стандартизировать создание и управление объектами в IoT-платформе, обеспечивая повторное использование кода и упрощая разработку и сопровождение системы. Он также определяет интерфейс для взаимодействия с объектами и устройствами, что упрощает интеграцию и расширение функциональности системы.
</p>

## Как просто представить себе прототип
Вот несколько вариантов понимания концепции прототипов:
<p align="justify">
Это <b><i>ключ к созданию</i></b>: Прототипы подобны образцам или черновикам, которые облегчают создание новых объектов или устройств. Они предоставляют основу, на которой можно основываться при создании новых экземпляров, помогая избежать повторения кода и ускоряя процесс разработки.

Это <b><i>модель для копирования</i></b>: Прототипы можно рассматривать как модели, которые можно копировать для создания новых объектов с аналогичными характеристиками. Подобно тому, как можно использовать форму для создания нескольких копий одного документа, прототипы позволяют создавать множество экземпляров объектов, сохраняя их общие свойства и функциональность.

Это <b><i>стандартизация и единообразие</i></b>: Прототипы помогают стандартизировать создание и управление объектами в системе, обеспечивая единообразие в структуре и поведении. Подобно тому, как шаблоны помогают сохранить единообразие дизайна в различных документах, прототипы обеспечивают согласованность в представлении и функциональности объектов в системе.

Это <b><i>упрощение изменений и обновлений</i></b>: Поскольку прототипы определяют общие характеристики объектов, изменения, внесенные в прототип, автоматически распространяются на все его экземпляры. Это облегчает внесение изменений и обновлений в систему, так же как изменения в шаблоне документа могут быть применены ко всем его копиям.
</p>

## Чем прототипы могут быть полезны в IoT-платформах
Вот несколько базовых причин, по которым прототипы используются в IoT-платформах:

- <b><i>Ускорение разработки:</i></b> Создание прототипов позволяет быстро оценить функциональность системы и визуализировать её работу. Это помогает разработчикам быстрее перейти к созданию рабочих версий системы.
- <b><i>Гибкость и масштабируемость:</i></b> Использование прототипов обеспечивает гибкость при добавлении новых функций или изменении существующих. Это позволяет быстро адаптировать систему к изменяющимся требованиям.
- <b><i>Уменьшение рисков:</i></b> Прототипирование позволяет выявить потенциальные проблемы или недочеты в дизайне системы на ранних этапах разработки. Это позволяет снизить риски и улучшить качество конечного продукта.
- <b><i>Разделение ответственности:</i></b> Использование прототипов может помочь разделить функциональность системы на более мелкие компоненты, каждый из которых может быть разработан и тестирован независимо. Это способствует более эффективному управлению проектом.
- <b><i>Повышение понимания:</i></b> Создание прототипов помогает участникам проекта лучше понять требования и ожидания от системы. Визуализация работы системы на ранних этапах разработки может привести к более точному пониманию её функциональности.

## Примеры использования прототипов
Рассмотрим несколько простых примеров использования прототипов в IoT-платформах с определением поведения с помощью скриптов:

<b>Пример 1.</b> <i>Прототип объекта устройства:</i>

Предположим, что в IoT-платформе необходимо работать с различными типами устройств, такими как насосы, клапаны, датчики и т.д. Создание прототипа класса устройства позволит определить общие характеристики и функциональность для всех типов устройств. С использованием скриптов, например, на основе JavaScript или Erlang, можно создать экземпляры этих устройств и определить их поведение в зависимости от различных условий (например, управление насосом в зависимости от уровня жидкости).

<b>Пример 2.</b> <i>Прототип объекта сети:</i>

В IoT-платформах часто необходимо взаимодействовать с различными сетевыми устройствами, такими как контроллеры, коммутаторы и т.д. Создание прототипа класса сетевого устройства позволяет определить общие методы и свойства для работы с такими устройствами. С помощью скриптов можно автоматизировать задачи связи с этими устройствами, например, сбор данных о состоянии и управление ими.

<b>Пример 3.</b> <i>Прототип объекта события:</i>

В IoT-платформах события играют важную роль, например, предупреждения о проблемах в работе оборудования или изменениях в процессах. Создание прототипа класса события позволяет определить общие характеристики и методы обработки событий. С помощью скриптов можно определить поведение системы при возникновении определенных событий, например, отправку уведомлений администратору или запуск аварийных процедур.

<b>Пример 4.</b> <i>Прототип объекта данных:</i>

В IoT-платформах данные играют ключевую роль, так как они представляют информацию о состоянии оборудования, процессов и событий. Создание прототипа класса данных позволяет определить общие методы и свойства для работы с данными. С использованием скриптов можно выполнять различные операции с данными, например, фильтрацию, агрегацию или анализ.

## Создание прототипа
Чтобы создать прототип нужно открыть вкладку Прототипы на панели с левой стороны. Открывшаяся вкладка имеет следующий вид:

![](Proto.1.png){width=700 thumbnail="true"}{border-effect=line}

В верхней части вкладки находится панель управления, чуть ниже представлен список уже созданных прототипов.

На панели управления сверху есть несколько кнопок:

| Кнопка         | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Proto.1.1.png  | Кнопка обновления списка прототипов для получения актуальной информации, в том случае, когда с одним проектом работает несколько клиентов.                                                                                                                                                                                                                                                                                                         |
| Proto.1.2.png  | Кнопка создания прототипа. При создании прототипа открывается новое окно: <br/> ![](Proto.2.png){width=200 thumbnail="true"}{border-effect=line}  <br/> где можно дать имя новому прототипу, определить группы пользователей (поставить ссылку на параграф Группа при создании прототипа!!!!!!!!!!!!), выбрать иконку и прокомментировать.                                                                                                         |
| Proto.1.3.png  | Кнопка редактирования прототипа. Для того чтобы отредактировать уже созданный прототип, нужно выбрать его в списке (одним кликом), затем нажать на эту кнопку, после чего появится тоже окно, что и при создании прототипа, где можно изменить установленные ранее значения. Тоже самое можно сделать, кликнув мышкой 2 раза на имени этого прототипа в списке.                                                                                    |
| Proto.1.4.png  | Кнопка удаления прототипа. Для удаления прототипа необходимо его сначала выбрать в списке (одним кликом), затем нажать кнопку Удалить и в появившемся окне подтвердить или отменить это действие.                                                                                                                                                                                                                                                  |
| Proto.1.5.png  | Кнопка копирования прототипа. Сначала нужно выбрать прототип в списке, затем нажать на кнопку Копировать. Выбранный прототип будет скопирован в буфер сервера. При этом кнопка Вставить станет активной.                                                                                                                                                                                                                                           |
| Proto.1.6.png  | Кнопка вставки прототипа. Если перед этим была операция копирования прототипа, то эта кнопка будет активна. И при нажатии на неё появится окно: <br/> ![](Proto.3.png){width=200 thumbnail="true"}{border-effect=line} <br/> где можно выбрать, что нужно сделать с сохраненной ранее копией, скопировать сюда же (copy) или переместить (move). Здесь же можно задать количество копий. Копия получит имя <имя_скопированного_прототипа>_<#копии> |
| Proto.1.7.png  | Кнопка редактора прототипа. Для редактирования прототипа нужно сначала его выбрать нужный прототип в списке, затем нажать кнопку Редактора, откроется вкладка редактора прототипа (поставить ссылку на след. параграф)                                                                                                                                                                                                                             |
| Proto.1.8.png  | Кнопка экспорта в базу в формате .xlsx файла.                                                                                                                                                                                                                                                                                                                                                                                                      |
| Proto.1.9.png  | Кнопка импорта из базы в формате .xlsx файла.                                                                                                                                                                                                                                                                                                                                                                                                      |
| Proto.1.10.png | Кнопка экспорта проекта в файл.                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Proto.1.11.png | Кнопка импорта проекта из файла.                                                                                                                                                                                                                                                                                                                                                                                                                   |

> **ВНИМАНИЕ!**
>
> Имя прототипа не должно содержать пробелов и прочих символов-разделителей.
>
{style="note"}

## Редактор прототипа

При открытии редактора прототипа появляется следующая вкладка:

![](Proto.4.png){width=700 thumbnail="true"}{border-effect=line}

где можно определить поля (Fields), их содержимое (Content) и поведение (Behavior).

### Поля прототипов

В контексте IoT-платформы, объекты, которые будут создаваться и разрабатываться на основе прототипов, представляют собой различные элементы системы, такие как устройства, датчики, контроллеры, агрегаты и т. д. Каждый объект имеет свои характеристики и параметры, которые определяют его поведение, функциональность и свойства.

Поля в объектах и прототипах - это и будут атрибуты или свойства, которые определяют основные характеристики и параметры объекта или прототипа. Эти поля содержат информацию о различных аспектах объекта, таких как его имя, местоположение, настройки доступа, внешние зависимости и многое другое.

### Примеры использования полей

<b>Пример 5.</b> <i>Датчики мониторинга движения:</i>

Представим, что есть система умного дома, в которой используются различные датчики IoT для мониторинга окружающей среды и управления различными устройствами.

Рассмотрим конкретный датчик движения. Это будет объект, его полями могут быть следующие свойства: местоположение, тип, диапазон, чувствительность, статус и т.д. Какие именно свойства объекта рассматриваются, зависит от цели решаемой задачи.

Таким образом ,при заполнении значений этих полей, можно получить, например, что-то вроде этого:

```bash
    Местоположение: Гостиная <br/>
    Тип: Пассивный инфракрасный (PIR) <br/>
    Диапазон обнаружения: 5 метров <br/>
    Чувствительность: Высокая <br/>
    Статус: Активен <br/>
```

Теперь предположим, что в доме есть несколько комнат, и в каждой комнате есть датчик движения. Вместо того чтобы создавать отдельное описание для каждого датчика движения, можно использовать прототип.

Прототип Датчика движения может содержать поля: местоположение, тип, диапазон обнаружения, чувствительность, статус. Эти поля будут общими для всех датчиков движения, а содержимое полей каждого объекта, созданного на основе этого прототипа, будет для конкретного датчика.

Теперь, когда будет добавляться новый датчик движения в другую комнату, можно будет использовать этот прототип, чтобы быстро создать новый объект с общими характеристиками. Это упрощает процесс управления и поддержки IoT-устройств, а также обеспечивает единообразие в настройках и свойствах датчиков движения по всему дому.

### Создание полей прототипа
#### Системные поля

При создании прототипа у него уже есть несколько системных полей, которые позволяют управлять и обеспечить правильную работу прототипа, а также объектов, созданных на его основе:

| Имя                   | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|-----------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| .contentreadgroups    | Содержит список идентификаторов групп пользователей, которым разрешено читать содержимое объектов, созданных на основе данного прототипа.                                                                                                                                                                                                                                                                                                               |
| .contentwritegroups   | Содержит список идентификаторов групп пользователей, которым разрешено записывать информацию в объекты, созданные на основе данного прототипа.                                                                                                                                                                                                                                                                                                          |
| .dependencies         | Содержит список связанных объектов или ресурсов, которые прототип использует или от которых он зависит.                                                                                                                                                                                                                                                                                                                                                 |
| .folder               | Определяет папку (ссылка), в которой находится прототип или объект, созданный на его основе.                                                                                                                                                                                                                                                                                                                                                            |
| .invalid_dependencies | Определяет отсутствуют или недействительны объекты или ресурсы, от которых зависит прототип.                                                                                                                                                                                                                                                                                                                                                            |
| .name                 | Определяет имя прототипа.                                                                                                                                                                                                                                                                                                                                                                                                                               |
| .pattern              | Содержит ссылку на шаблон для создания других объектов (????????????????).                                                                                                                                                                                                                                                                                                                                                                              |
| .readgroups           | Список идентификаторов групп пользователей, которые имеют право на чтение прототипа.                                                                                                                                                                                                                                                                                                                                                                    |
| .ts                   | Определяет временную метку (timestamp), когда прототип был создан или изменен в последний раз.                                                                                                                                                                                                                                                                                                                                                          |
| .writegroups          | Список идентификаторов групп пользователей, которым разрешено вносить изменения в прототип.                                                                                                                                                                                                                                                                                                                                                             |
| alias                 | Устанавливает альтернативное название или псевдоним для прототипа.                                                                                                                                                                                                                                                                                                                                                                                      |
| comment               | Позволяет добавлять комментарии или заметки к прототипу.                                                                                                                                                                                                                                                                                                                                                                                                |
| database              | Ссылка на базу данных, используемую для хранения данных прототипа.                                                                                                                                                                                                                                                                                                                                                                                      |
| disabled              | Определяет, отключен ли данный прототип или он активен.                                                                                                                                                                                                                                                                                                                                                                                                 |
| ext_readgroups        | Позволяет определить пользователей из внешних систем или ресурсов, которые имеют право на чтение прототипа.                                                                                                                                                                                                                                                                                                                                             |
| ext_writegroups       | Позволяет определить пользователей из внешних систем или ресурсов, которые имеют право на запись прототипа.                                                                                                                                                                                                                                                                                                                                             |
| favorite              | Может принимать значение (true/false), указывающее, является ли прототип избранным для данного пользователя. Обычно используется для создания персонализированных списков или каталогов объектов, удобных для пользователя.                                                                                                                                                                                                                             |
| groups                | Список идентификаторов групп пользователей, имеющих доступ к прототипу.                                                                                                                                                                                                                                                                                                                                                                                 |
| icon                  | Путь к изображению, которое используется в качестве иконки прототипа.                                                                                                                                                                                                                                                                                                                                                                                   |
| is_prototype          | Определяет, является ли данный объект прототипом или нет.                                                                                                                                                                                                                                                                                                                                                                                               |
| is_screen             | Указывает, является ли данный объект экраном (???????????) или нет. Экраны в IoT-платформах представляют собой интерфейсы пользователя, которые отображают информацию о процессах, устройствах или других объектах в системе. Если объект является экраном, это означает, что его основная цель - предоставить пользователю информацию в удобной и понятной форме. Это может быть, например, графическое отображение данных, диаграммы, таблицы и т. д. |
| nodes                 | Список идентификаторов узлов или элементов, связанных с данным прототипом.                                                                                                                                                                                                                                                                                                                                                                              |
| prototype             | Определяет ссылку на прототип                                                                                                                                                                                                                                                                                                                                                                                                                           |
| recursive_rights      | Указывает, применяются ли права доступа к прототипу рекурсивно к объектам, созданным на его основе.                                                                                                                                                                                                                                                                                                                                                     |
| screen                | Содержит название экрана, к которому относится объект. То есть, если объект является частью какого-то экрана или связан с определенным экраном, то это поле будет хранить название этого экрана.                                                                                                                                                                                                                                                        |
| settings              | Содержит данные о настройках прототипа, которые могут влиять на его функционирование.                                                                                                                                                                                                                                                                                                                                                                   |
| title                 | Устанавливает заголовок или название для прототипа.                                                                                                                                                                                                                                                                                                                                                                                                     |
| view1-15              | Содержит данные о различных визуальных представлениях объекта в зависимости от контекста или потребностей пользователей.                                                                                                                                                                                                                                                                                                                                |
| view_info             | Содержит дополнительные данные о представлениях объекта, такие как описания или параметры.                                                                                                                                                                                                                                                                                                                                                              |

Каждое поле имеет несколько параметров:

◦ <i> name (название):</i> Это имя поля в прототипе объекта.

◦ <i> type (тип):</i> Определяет тип данных, которые могут храниться в этом параметре. Например, это может быть строка (string), целый числовой тип (integer), вещественный числовой тип (float), логический (bool), ссылка или указатель на другой объект или ресурс (link), уникальная символьная константа (atom), составной объект (term), список (list).

◦ <i> subtype (подтип):</i> Уточняет тип данных для определенных типов. Например, если тип данных - list, то подтип может указать на тип элементов списка (string, integer, float, bool, link, atom. term).

◦ <i> •	storage (хранение):</i>  Определяет, как будет храниться значение параметра. Например, значение может храниться на диске, в оперативной памяти, или на диске и в оперативной памяти одновременно. (disc, ram, ramdisc)

• <i> index (индекс):</i> Указывает, является ли параметр индексируемым для быстрого доступа к данным. Индексы могут использоваться для ускорения операций поиска и сортировки. В Faceplate для прототипа возможны 3 варианта: 3gram (анализирует текстовые данные на основе троек символов (триграмм)), simple (представляет собой базовый индекс, который обрабатывает данные без дополнительного анализа или преобразований), datetime (предназначен для работы с датами и временем, обеспечивает эффективную индексацию данных, связанных с датами, что позволяет быстро выполнять операции поиска и сортировки на основе временных параметров). Индекс datetime особенно полезен в системах, где важна временная составляющая данных, например, в мониторинге и управлении процессами.

◦ <i> default (значение по умолчанию):</i> Это значение, которое будет установлено для параметра, если оно не было явно задано при создании объекта.

◦ <i> prototype (прототип):</i> Указывает, является ли параметр частью прототипа объекта. Если значение true, то параметр наследуется объектами, созданными на основе этого прототипа.

◦ <i> run-time (время выполнения):</i> Определяет, будет ли параметр доступен и изменяем во время выполнения программы или системы.

◦ <i> export (экспорт):</i> Указывает, должен ли параметр быть доступен для экспорта или передачи в другие системы или компоненты.

#### Пользоватеслькие поля

Для создания пользовательских полей нужно нажать на кнопку Создать на вкладке Fields. Появится следующее окно:

![](Proto.5.png){width=200 thumbnail="true"}{border-effect=line}

где в поле Name нужно указать имя прототипа;

в поле Type выбрать один из вариантов:

◦ string (строка): Этот тип данных представляет собой последовательность символов, таких как буквы, цифры и символы пунктуации. Строки обычно используются для хранения текстовой информации, такой как имена, описания и сообщения.

◦ integer (целое число): Целочисленный тип данных представляет собой числа без дробной части. Он используется для хранения целых чисел, таких как количество, порядковый номер и идентификаторы.

◦ float (вещественное число): Этот тип данных представляет собой числа с плавающей точкой, то есть числа с дробной частью. Он используется для хранения дробных чисел, таких как доли, координаты и денежные суммы.

◦ bool (логическое значение): Логический тип данных может иметь только два значения: истина (true) или ложь (false). Он используется для хранения булевых значений, таких как состояния (вкл/выкл), флаги и условия.

◦ link (ссылка): Тип данных ссылки представляет собой ссылку или указатель на другой объект или ресурс. Он используется для создания связей между объектами или для представления отношений между данными.

◦ atom (атом): Атом - это уникальная символьная константа, которая представляет собой неизменяемое значение. Он используется для обозначения константных идентификаторов или имен в системе.

◦ term (терм): Тип данных терма представляет собой составной объект, который может содержать различные типы данных, включая другие термы. Он используется для представления структурированных данных или составных объектов.

◦ list (список): Список - это упорядоченная коллекция элементов, которая может содержать элементы различных типов данных. Список используется для хранения последовательностей данных, таких как массивы, наборы и стеки.

в поле Subtype (доступно только для типа list) нужно выбрать один из вариантов для типа элементов списка: строка (string), целый числовой тип (integer), вещественный числовой тип (float), логический (bool), ссылка или указатель на другой объект или ресурс (link), уникальная символьная константа (atom), составной объект (term).

в поле Index нужно выбрать тип индексирования. Тип simple можно выбрать для всех типов данных, за исключением типа float; тип datetime можно выбрать только для типа integer; тип 3gram можно выбрать только для типа string.

### Содержимое полей прототипа

### Поведение прототипа

Behavior - это скрипт, который отрабатывается при изменении (создание, редактирование, удаление) Прототипа. 

Пример вывода:

Пример вывода:


Образец скрипта:
```shell
%%-----------------------------------------------------------------
%% This script is executed at the server side. The programming language
%% is Erlang.
%% The module MUST export next 3 methods:
%% * on_create/1 - this method is called when a new instance of the prototype is created.
%% * on_edit/1 - this method is called when own fields of an instance of the prototype are edited
%% * on_delete/1 - this method is called when an instance of the prototype is deleted
%% All this methods accept an Object of the instance and can edit or perform any other allowed code.
%% If any of the methods throw or crash the whole transaction will rollback.
%% If there are any warnings or not critical errors it is recommended to log them with available macros, examples:
%% ?LOGWARNING( "my warning text: ~p", [Warning] )
%% ?LOGERROR( "my error text: ~p", [Error] )
%% If the methods performs well it should return atom 'ok'.
%% For more info please refer to the documentation
%%-----------------------------------------------------------------
-module(fp_prototype_MyProto1).

-include("fp_struct.hrl").

-export([
    on_create/1,
    on_delete/1,
    on_edit/1
]).

on_create(_Object)->
    ok.

on_edit(_Object)->
    ok.

on_delete( Object )->
    ok.
```
Рассмотрим примеры создания скриптов, определяющих поведение прототипа на языке Erlang.

Пример 1:
```shell
%%-----------------------------------------------------------------
%% This script is executed at the server side. The programming language
%% is Erlang.
%% The module MUST export next 3 methods:
%% * on_create/1 - this method is called when a new instance of the prototype is created.
%% * on_edit/1 - this method is called when own fields of an instance of the prototype are edited
%% * on_delete/1 - this method is called when an instance of the prototype is deleted
%% All these methods accept an Object of the instance and can edit or perform any other allowed code.
%% If any of the methods throw or crash, the whole transaction will rollback.
%% If there are any warnings or non-critical errors, it is recommended to log them with available macros, examples:
%% ?LOGWARNING( "my warning text: ~p", [Warning] )
%% ?LOGERROR( "my error text: ~p", [Error] )
%% If the methods perform well, they should return the atom 'ok'.
%% For more info, please refer to the documentation
%%-----------------------------------------------------------------
-module(fp_prototype_MyProto1).

-include("fp_struct.hrl").

-export([
    on_create/1,
    on_delete/1,
    on_edit/1
]).

on_create(Object) ->
    io:format("Instance of MyProto1 created: ~p~n", [Object]),
    ok.

on_edit(Object) ->
    io:format("Fields of MyProto1 instance edited: ~p~n", [Object]),
    ok.

on_delete(Object) ->
    io:format("Instance of MyProto1 deleted: ~p~n", [Object]),
    ok.
```

Этот скрипт реализует три метода: on_create, on_edit и on_delete, которые вызываются при создании, изменении и удалении экземпляра прототипа соответственно. В данном примере эти методы просто выводят сообщение в консоль, указывая на то, что произошло с экземпляром. Вы можете дополнить их логикой, соответствующей вашим требованиям.

Пример 2.

Давайте расширим последний скрипт для работы с прототипом, представляющим конкретное устройство. Для примера давайте предположим, что у нас есть прототип устройства, представляющего насос, и мы хотим, чтобы наш скрипт выполнял определенные действия в зависимости от состояния этого насоса.

```shell
%%-----------------------------------------------------------------
%% This script is executed at the server side. The programming language
%% is Erlang.
%% The module MUST export next 3 methods:
%% * on_create/1 - this method is called when a new instance of the prototype is created.
%% * on_edit/1 - this method is called when own fields of an instance of the prototype are edited
%% * on_delete/1 - this method is called when an instance of the prototype is deleted
%% All these methods accept an Object of the instance and can edit or perform any other allowed code.
%% If any of the methods throw or crash, the whole transaction will rollback.
%% If there are any warnings or non-critical errors, it is recommended to log them with available macros, examples:
%% ?LOGWARNING( "my warning text: ~p", [Warning] )
%% ?LOGERROR( "my error text: ~p", [Error] )
%% If the methods perform well, they should return the atom 'ok'.
%% For more info, please refer to the documentation
%%-----------------------------------------------------------------
-module(fp_prototype_Pump).

-include("fp_struct.hrl").

-export([
    on_create/1,
    on_delete/1,
    on_edit/1
]).

-define(PUMP_STATE_NORMAL, 0).
-define(PUMP_STATE_WARNING, 1).
-define(PUMP_STATE_ERROR, 2).

on_create(Object) ->
    io:format("Pump instance created: ~p~n", [Object]),
    ok.
on_edit(Object) ->
% Проверяем состояние насоса и выполняем соответствующие действия
    case Object#pump.state of
        ?PUMP_STATE_NORMAL ->
            io:format("Pump is in normal state: ~p~n", [Object]),
            ok;
        ?PUMP_STATE_WARNING ->
            io:format("Pump is in warning state: ~p~n", [Object]),
            ok;
        ?PUMP_STATE_ERROR ->
            io:format("Pump is in error state: ~p~n", [Object]),
            ok
end.

on_delete(Object) ->
    io:format("Pump instance deleted: ~p~n", [Object]),
    ok.
```

Этот скрипт добавляет обработку состояния насоса в методе on_edit. В зависимости от состояния насоса он выводит соответствующее сообщение в консоль. Вы можете дополнить скрипт логикой обработки состояний насоса, включая отправку уведомлений, запись в журнал или выполнение дополнительных действий.

Пример 3.

Прототипы в SCADA-системах часто имеют набор полей, которые определяют их свойства и характеристики. Для дать определение прототипа на основании этого, мы можем добавить определение полей в Erlang-модуль прототипа. Вот пример определения прототипа на основании всего выше перечисленного:
```shell
%%-----------------------------------------------------------------
%% This script is executed at the server side. The programming language
%% is Erlang.
%% The module MUST export next 3 methods:
%% * on_create/1 - this method is called when a new instance of the prototype is created.
%% * on_edit/1 - this method is called when own fields of an instance of the prototype are edited
%% * on_delete/1 - this method is called when an instance of the prototype is deleted
%% All these methods accept an Object of the instance and can edit or perform any other allowed code.
%% If any of the methods throw or crash, the whole transaction will rollback.
%% If there are any warnings or non-critical errors, it is recommended to log them with available macros, examples:
%% ?LOGWARNING( "my warning text: ~p", [Warning] )
%% ?LOGERROR( "my error text: ~p", [Error] )
%% If the methods perform well, they should return the atom 'ok'.
%% For more info, please refer to the documentation
%%-----------------------------------------------------------------
-module(fp_prototype_Pump).

-include("fp_struct.hrl").

-export([
    on_create/1,
    on_delete/1,
    on_edit/1
]).

-record(pump, {
    id :: string(),
    name :: string(),
    type :: string(),
    state :: integer()
}).

-define(PUMP_STATE_NORMAL, 0).
-define(PUMP_STATE_WARNING, 1).
-define(PUMP_STATE_ERROR, 2).

on_create(Object) ->
    io:format("Pump instance created: ~p~n", [Object]),
    ok.

on_edit(Object) ->
% Проверяем состояние насоса и выполняем соответствующие действия
    case Object#pump.state of
        ?PUMP_STATE_NORMAL ->
            io:format("Pump is in normal state: ~p~n", [Object]),
            ok;
        ?PUMP_STATE_WARNING ->
            io:format("Pump is in warning state: ~p~n", [Object]),
            ok;
        ?PUMP_STATE_ERROR ->
            io:format("Pump is in error state: ~p~n", [Object]),
            ok
end.

on_delete(Object) ->
    io:format("Pump instance deleted: ~p~n", [Object]),
    ok.
```
В этом примере добавлено определение полей прототипа pump, включая id, name, type и state. Для каждого поля указан тип данных. Теперь прототип насоса имеет определенную структуру данных, которая позволяет представлять его свойства и характеристики.

### Группа при создании прототипа (???????????????????????)

Указание группы при создании прототипа в IoT-платформе может иметь несколько значений и целей, в зависимости от контекста и специфики системы. Вот несколько возможных интерпретаций значения указания группы:

1. Организация и классификация: Группа может служить для организации и классификации прототипов по их функциональному или логическому назначению. Например, прототипы устройств могут быть сгруппированы по типу (например, датчики, актуаторы, контроллеры), а прототипы событий - по категориям (например, предупреждения, аварии, информационные сообщения).

2. Управление доступом и правами: Группировка прототипов может использоваться для управления доступом и правами пользователей. Например, администраторы могут иметь доступ к прототипам всех групп, в то время как обычные пользователи могут иметь доступ только к определенным группам, связанным с их функциональными обязанностями.

3. Контроль версий и жизненного цикла: Группы могут также использоваться для контроля версий и управления жизненным циклом прототипов. Например, прототипы одной группы могут быть связаны с конкретной версией проекта или продукта, а другие - с тестовыми или экспериментальными версиями.

4. Организация процесса разработки и управления проектами: Группы могут помочь организовать процесс разработки и управления проектами, разделяя прототипы на логические блоки или модули, которые могут быть разработаны и тестированы независимо друг от друга.
