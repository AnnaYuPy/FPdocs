<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2024-07-10T16:36:21.47567376"><title>Faceplate Prophet | Faceplate docs</title><script type="application/json" id="virtual-toc-data">[{"id":"m1oxct_1576","level":0,"title":"Настройка сервиса Моделирование","anchor":"#m1oxct_1576"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b267/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Faceplate Prophet | Faceplate docs"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Faceplate docs Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/faceplate-prophet.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Faceplate Prophet | Faceplate docs"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/faceplate-prophet.html#webpage",
    "url": "writerside-documentation/faceplate-prophet.html",
    "name": "Faceplate Prophet | Faceplate docs",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Faceplate docs Help"
}</script><!-- End Schema.org --></head><body data-id="Faceplate-Prophet" data-main-title="Faceplate Prophet" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs=""><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Faceplate docs  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Faceplate-Prophet" id="Faceplate-Prophet.md">Faceplate Prophet</h1><section class="chapter"><h2 id="m1oxct_1576" data-toc="m1oxct_1576">Настройка сервиса Моделирование</h2><p id="m1oxct_1577">В файле fp_modeling в 731 строке нужно изменить путь следующим образом:</p><div class="code-block" data-lang="none">
%Cmd=code:priv_dir(fp)++&quot;/models/&quot; ++ Model ++ &quot;/&quot; ++ Model,
Cmd = &quot;/home/fp/.ssh/faceplate/apps/fp/priv/models/prophet/prophet.py&quot;,
</div><p id="m1oxct_1579">Далее нужно:</p><ol class="list _decimal" id="m1oxct_1580" type="1"><li class="list__item" id="m1oxct_1581"><p>создать файл faceplate/apps/fp/priv/models/prophet/prophet.py, где prophet.py это пример файла, который принимает моделирование;</p></li><li class="list__item" id="m1oxct_1582"><p>json-файл должен принимать metadata, prediction, anomalies(может быть пустым).</p></li></ol><section class="chapter"><h3 id="m1oxct_1583" data-toc="m1oxct_1583">Основные определения:</h3><p id="m1oxct_1584">Целевой архив - данные, которые читает модель.</p><p id="m1oxct_1585">Конечный архив - архив куда будет выгружаться архив.</p><p id="m1oxct_1586">Шаблон аларма - если придет поле аномалии, то формируем сообщение на основе этого шаблона</p><p id="m1oxct_1587">Регрессоры - дополнительный архив исторических данных, который можно отправить с целевым архивом. Например, нагрузка потребления электроэнергии это целевой архив, а температура в те же дни это регрессор. (Не обязательный параметр)</p><p id="m1oxct_1588">Время отсчета - время начала моделирования.</p><p id="m1oxct_1589">Глубина истории - с какого времени хотим видеть данные. Допустим если время отсчета 13:30, а глубина истории 30 минут, то график мы видим с 13:00.</p><p id="m1oxct_1590">Дискретность - частота.</p><p id="m1oxct_1591">Прогноз - прогнозируемое время. Допустим если прогноз 10 минут, то мы получим данные до 13:40.</p><p id="m1oxct_1592">Метаданные - произвольный json который пользователь может разрабатывать.</p><p id="m1oxct_1593">Запуск - триггер.</p><p id="m1oxct_1594">Если будет аномалия, то будет нарисована точка.</p><div class="code-block" data-lang="none">
JSON FILE
#!/usr/bin/python3

import json
import os
JSON = &quot;{
   &quot;metadata&quot;: {
      &quot;containerId&quot;: &quot;16354ed4eeaa5eb42169c153b731a56eea09dc450476ef101c57090fcb3afe7d&quot;,
      &quot;point&quot;: &quot;shym-2&quot;,
      &quot;start_time&quot;: &quot;2021-10-20 10:38:37.518264&quot;,
   &quot;finish_time&quot;: &quot;2021-10-20 10:39:22.661520&quot;
   },
   &quot;prediction&quot;: [
      26.440550333303296,
      27.934360447781003,
      21.55088396636851
   ]
}&quot;
JSON = JSON.replace(&quot;\n&quot;, &quot;&quot;) + &quot;\n&quot;
data = os.read(3, 10000)

print('pytho_script: '+ str(json.loads(data)))
os.write(4, bytes(JSON, &quot;utf-8&quot;))

#print(JSON)
#obj = json.loads(JSON)
#print(obj)
</div><p id="m1oxct_1596">Вывод в консоли:</p><div class="code-block" data-lang="none">
(fp@master.fp)1&gt; 15:32:03.276 [info] fp_modeling:733 Command &quot;/home/fp/.ssh/faceplate/apps/fp/priv/models/prophet/prophet.py&quot;
15:32:03.339 [info] fp_modeling:770 pred points 10 history length 30 future length 10
pytho_script: {'future': [[1681975860000], [1681975920000], [1681975980000], [1681976040000], [1681976100000], [1681976160000], [1681976220000], [1681976280000], [1681976340000], [1681976400000]], 'history': [[1681974060000, 4.53255], [1681974120000, 5.68345], [1681974180000, 5.2502], [1681974240000, 4.88345], [1681974300000, 5.633233333333333], [1681974360000, 5.050516666666667], [1681974420000, 5.666566666666666], [1681974480000, 5.78315], [1681974540000, 5.232583333333333], [1681974600000, 5.600216666666666], [1681974660000, 5.366483333333333], [1681974720000, 5.36685], [1681974780000, 5.833916666666667], [1681974840000, 5.283183333333334], [1681974900000, 5.983333333333333], [1681974960000, 5.7668333333333335], [1681975020000, 5.466966666666667], [1681975080000, 6.3], [1681975140000, 5.18335], [1681975200000, 5.433416666666667], [1681975260000, 5.316566666666667], [1681975320000, 5.366733333333333], [1681975380000, 5.73315], [1681975440000, 6.266666666666667], [1681975500000, 5.49965], [1681975560000, 5.466933333333333], [1681975620000, 5.3326], [1681975680000, 5.600366666666667], [1681975740000, 5.000116666666667], [1681975800000, 5.533766666666667]], 'history_future': [[1681975860000, 4.732983333333333], [1681975920000, 5.2665], [1681975980000, 5.03305], [1681976040000, 5.216733333333333], [1681976100000, 5.883366666666666], [1681976160000, 6.1002], [1681976220000, 5.650016666666667], [1681976280000, 5.6997], [1681976340000, 5.516466666666667], [1681976400000, 5.400483333333334]], 'metadata': {'settings': {'changepoint_prior_scale': 30, 'daily_seasonality': False, 'growth': 'linear', 'interval_width': 0.98, 'seasonality': [{'fourier_order': 5, 'name': 'hour', 'period': 0.0417}], 'seasonality_prior_scale': 35, 'weekly_seasonality': False, 'yearly_seasonality': False}}}
15:32:03.341 [info] fp_modeling:781 received result #{&lt;&lt;&quot;metadata&quot;&gt;&gt; =&gt; #{&lt;&lt;&quot;containerId&quot;&gt;&gt; =&gt; &lt;&lt;&quot;16354ed4eeaa5eb42169c153b731a56eea09dc450476ef101c57090fcb3afe7d&quot;&gt;&gt;,&lt;&lt;&quot;finish_time&quot;&gt;&gt; =&gt; &lt;&lt;&quot;2021-10-20 10:39:22.661520&quot;&gt;&gt;,&lt;&lt;&quot;point&quot;&gt;&gt; =&gt; &lt;&lt;&quot;shym-2&quot;&gt;&gt;,&lt;&lt;&quot;start_time&quot;&gt;&gt; =&gt; &lt;&lt;&quot;2021-10-20 10:38:37.518264&quot;&gt;&gt;},&lt;&lt;&quot;prediction&quot;&gt;&gt; =&gt; [26.440550333303296,27.934360447781003,21.55088396636851]}
</div></section></section><div class="last-modified">Last modified: 10 July 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="faceplate-edge.html" class="navigation-links__prev">Faceplate Edge</a><a href="механизмы-синхронизации.html" class="navigation-links__next">Механизмы синхронизации</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b267/app.js"></script></body></html>