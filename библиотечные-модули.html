<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-07-25T12:53:49.056847341"><title>Библиотечные модули | Faceplate docs</title><script type="application/json" id="virtual-toc-data">[{"id":"system-utils-v1","level":0,"title":"Модуль system_utils (v1)","anchor":"#system-utils-v1"},{"id":"weather-service","level":0,"title":"Модуль weather_service","anchor":"#weather-service"},{"id":"fp-userlib-archive","level":0,"title":"Модуль fp_userlib_archive","anchor":"#fp-userlib-archive"},{"id":"fp-pf-utils","level":0,"title":"Модуль fp_pf_utils","anchor":"#fp-pf-utils"},{"id":"bms-service","level":0,"title":"Модуль bms_service","anchor":"#bms-service"},{"id":"calculation-v2","level":0,"title":"Модуль calculation (v2)","anchor":"#calculation-v2"},{"id":"docker-client-v0-1","level":0,"title":"Модуль docker_client (v0.1)","anchor":"#docker-client-v0-1"},{"id":"fp-powerfactory-service","level":0,"title":"Модуль fp_powerfactory_service","anchor":"#fp-powerfactory-service"},{"id":"fp-state-estimation-service","level":0,"title":"Модуль fp_state_estimation_service","anchor":"#fp-state-estimation-service"},{"id":"string-replace","level":0,"title":"Модуль string_replace","anchor":"#string-replace"},{"id":"model-service-v2","level":0,"title":"Модуль model_service_v2","anchor":"#model-service-v2"},{"id":"rest-api-client-v1-0","level":0,"title":"Модуль rest_api_client (v1.0)","anchor":"#rest-api-client-v1-0"},{"id":"state-graph-v1","level":0,"title":"Модуль state_graph (v1)","anchor":"#state-graph-v1"},{"id":"ems","level":0,"title":"Подсистема EMS","anchor":"#ems"},{"id":"javascript-fp-api-js-md","level":0,"title":"Модуль функций JavaScript (fp_api_js.md)","anchor":"#javascript-fp-api-js-md"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Библиотечные модули | Faceplate docs"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Faceplate docs Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/библиотечные-модули.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Библиотечные модули | Faceplate docs"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/библиотечные-модули.html#webpage",
    "url": "writerside-documentation/библиотечные-модули.html",
    "name": "Библиотечные модули | Faceplate docs",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Faceplate docs Help"
}</script><!-- End Schema.org --></head><body data-id="Библиотечные-модули" data-main-title="Библиотечные модули" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Справочник-Reference.md|Справочник (Reference)"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Faceplate docs  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Библиотечные-модули" id="Библиотечные-модули.md">Библиотечные модули</h1><p id="z3ehbu9_3"><span class="control" id="z3ehbu9_20">Подсистема SCADA</span></p><section class="chapter"><h2 id="system-utils-v1" data-toc="system-utils-v1"><a name=""></a><span class="control" id="z3ehbu9_28">Модуль system_utils (v1)</span></h2><p id="z3ehbu9_22">Модуль с набором вспомогательных функций, предназначенных для поиска и обработки системных объектов. Применяется для оптимизации работы с объектами в системе.</p><p id="z3ehbu9_23"><span class="control" id="z3ehbu9_29">Общая информация</span></p><p id="z3ehbu9_24">Модуль system_utils предоставляет функции для управления объектами системы и обработки данных. Код написан на языке программирования Erlang. Если функция выбрасывает исключение или происходит сбой, транзакция будет отменена. При успешном выполнении функции возвращают атом ok. Для логирования рекомендуется использовать макросы:</p><ul class="list _bullet" id="z3ehbu9_25"><li class="list__item" id="z3ehbu9_30"><p id="z3ehbu9_33">?LOGINFO( &quot;my info text: ~p&quot;, [Info] )</p></li><li class="list__item" id="z3ehbu9_31"><p id="z3ehbu9_34">?LOGWARNING( &quot;my warning text: ~p&quot;, [Warning] )</p></li><li class="list__item" id="z3ehbu9_32"><p id="z3ehbu9_35">?LOGERROR( &quot;my error text: ~p&quot;, [Error] )</p></li></ul><div class="table-wrapper"><table class="wide" id="z3ehbu9_26"><thead><tr class="ijRowHead" id="z3ehbu9_36"><th id="z3ehbu9_44"><p><span class="control" id="z3ehbu9_46">Функция</span></p></th><th id="z3ehbu9_45"><p><span class="control" id="z3ehbu9_47">Описание</span></p></th></tr></thead><tbody><tr id="z3ehbu9_37"><td id="z3ehbu9_48"><p>find_by_pattern/2</p></td><td id="z3ehbu9_49"><p id="z3ehbu9_50">: Ищет объекты в хранилище данных, соответствующие заданному шаблону.</p><p id="z3ehbu9_51"><span class="control" id="z3ehbu9_58">Параметры</span>:</p><p id="z3ehbu9_52">- Root (binary): Корневой путь проекта.</p><p id="z3ehbu9_53">- Pattern (binary): Шаблон для поиска.</p><p id="z3ehbu9_54"><span class="control" id="z3ehbu9_59">Возвращает</span>: Список путей к объектам.</p><p id="z3ehbu9_55"><span class="control" id="z3ehbu9_60">Пример использования</span>:</p><p id="z3ehbu9_56">system_utils:find_by_pattern(&lt;&lt;&quot;KAZ/UZHNIY&quot;&gt;&gt;, &lt;&lt;&quot;/root/FP/prototypes/telemetry/fields&quot;&gt;&gt;).</p><p id="z3ehbu9_57"></p></td></tr><tr id="z3ehbu9_38"><td id="z3ehbu9_61"><p>csv_to_archive/2</p></td><td id="z3ehbu9_62"><p id="z3ehbu9_63">: Загружает данные из CSV-файла и сохраняет их в архив.</p><p id="z3ehbu9_64"><span class="control" id="z3ehbu9_70">Параметры</span>:</p><p id="z3ehbu9_65">- Archive (binary): Архив для сохранения данных.</p><p id="z3ehbu9_66">- CSVFile (binary): Путь к CSV-файлу.</p><p id="z3ehbu9_67"><span class="control" id="z3ehbu9_71">Возвращает</span>: Атом ok в случае успеха или {error, Reason} в случае ошибки.</p><p id="z3ehbu9_68"><span class="control" id="z3ehbu9_72">Пример использования</span>:</p><p id="z3ehbu9_69">system_utils:csv_to_archive(&lt;&lt;&quot;my_archive&quot;&gt;&gt;, &lt;&lt;&quot;/path/to/file.csv&quot;&gt;&gt;).</p></td></tr><tr id="z3ehbu9_39"><td id="z3ehbu9_73"><p>vclass_from_object/1</p></td><td id="z3ehbu9_74"><p id="z3ehbu9_75">: Определяет класс объекта по его пути.</p><p id="z3ehbu9_76"><span class="control" id="z3ehbu9_82">Параметры</span>:</p><p id="z3ehbu9_77">- Object (binary): Объект, для которого необходимо определить класс.</p><p id="z3ehbu9_78"><span class="control" id="z3ehbu9_83">Возвращает</span>: Целое число, представляющее класс объекта, или 0, если совпадение не найдено.</p><p id="z3ehbu9_79"><span class="control" id="z3ehbu9_84">Пример использования</span>:</p><p id="z3ehbu9_80">system_utils:vclass_from_object(Object).</p><p id="z3ehbu9_81"></p></td></tr><tr id="z3ehbu9_40"><td id="z3ehbu9_85"><p>utc_time/0</p></td><td id="z3ehbu9_86"><p id="z3ehbu9_87">: Возвращает текущие дату и время в формате UTC.</p><p id="z3ehbu9_88"><span class="control" id="z3ehbu9_93">Параметры</span>: Нет.</p><p id="z3ehbu9_89"><span class="control" id="z3ehbu9_94">Возвращает</span>: Строку с отформатированной датой и временем.</p><p id="z3ehbu9_90"><span class="control" id="z3ehbu9_95">Пример использования</span>:</p><p id="z3ehbu9_91">system_utils:utc_time().</p><p id="z3ehbu9_92"></p></td></tr><tr id="z3ehbu9_41"><td id="z3ehbu9_96"><p>create_csv/2</p></td><td id="z3ehbu9_97"><p id="z3ehbu9_98">: Создает CSV-файл с данными, извлеченными из хранилища данных.</p><p id="z3ehbu9_99"><span class="control" id="z3ehbu9_105">Параметры</span>:</p><p id="z3ehbu9_100">- Path (binary): Путь для выборки данных.</p><p id="z3ehbu9_101">- File (binary): Имя файла для сохранения.</p><p id="z3ehbu9_102"><span class="control" id="z3ehbu9_106">Возвращает</span>: Атом ok в случае успеха.</p><p id="z3ehbu9_103"><span class="control" id="z3ehbu9_107">Пример использования</span>:</p><p id="z3ehbu9_104">system_utils:create_csv(&lt;&lt;&quot;/data/path&quot;&gt;&gt;, &lt;&lt;&quot;output.csv&quot;&gt;&gt;).</p></td></tr><tr id="z3ehbu9_42"><td id="z3ehbu9_108"><p>delete_elements/4</p></td><td id="z3ehbu9_109"><p id="z3ehbu9_110">: Удаляет элементы из хранилища данных, соответствующие заданным критериям.</p><p id="z3ehbu9_111"><span class="control" id="z3ehbu9_120">Параметры</span>:</p><p id="z3ehbu9_112">- Root (binary): Корневой путь проекта.</p><p id="z3ehbu9_113">- Folder (binary): Папка для выборки.</p><p id="z3ehbu9_114">- Pattern (binary): Шаблон для поиска.</p><p id="z3ehbu9_115">- Name (binary): Имя элемента для удаления.</p><p id="z3ehbu9_116"><span class="control" id="z3ehbu9_121">Возвращает</span>: Атом ok в случае успеха.</p><p id="z3ehbu9_117"><span class="control" id="z3ehbu9_122">Пример использования</span>:</p><p id="z3ehbu9_118">system_utils:delete_elements(&lt;&lt;&quot;UZHNIY&quot;&gt;&gt;, &lt;&lt;&quot;@models&quot;&gt;&gt;, &lt;&lt;&quot;/root/FP/prototypes/telemetry/fields&quot;&gt;&gt;, &lt;&lt;&quot;Uac&quot;&gt;&gt;).</p><p id="z3ehbu9_119"></p></td></tr><tr id="z3ehbu9_43"><td id="z3ehbu9_123"><p>set_state_value/4</p></td><td id="z3ehbu9_124"><p id="z3ehbu9_125">: Устанавливает значение полей объектов state, вложенных в объекты, соответствующие заданным прототипам и находящиеся в заданном контексте.</p><p id="z3ehbu9_126"><span class="control" id="z3ehbu9_135">Параметры</span>:</p><p id="z3ehbu9_127">- Context (binary): Контекст, в котором будет установлено значение.</p><p id="z3ehbu9_128">- EdgePrototypes (list): Список прототипов.</p><p id="z3ehbu9_129">- Path (binary): Относительный путь к объекту состояния</p><p id="z3ehbu9_130">- FieldMap (map): Карта полей для обновления.</p><p id="z3ehbu9_131"><span class="control" id="z3ehbu9_136">Возвращает</span>: Атом ok в случае успеха.</p><p id="z3ehbu9_132"><span class="control" id="z3ehbu9_137">Пример использования</span>:</p><p id="z3ehbu9_133">system_utils:set_state_value(&lt;&lt;&quot;/root/FP/PROJECT/KAZ/UZHNIY/Kyzylorda&quot;&gt;&gt;, [&lt;&lt;&quot;isolator&quot;&gt;&gt;, &lt;&lt;&quot;earth_isolator&quot;&gt;&gt;], &lt;&lt;&quot;/state&quot;&gt;&gt;, #{&lt;&lt;&quot;in_value&quot;&gt;&gt; =&gt; 1}).</p><p id="z3ehbu9_134"></p></td></tr></tbody></table></div></section><section class="chapter"><h2 id="weather-service" data-toc="weather-service"><a name=""></a><span class="control" id="z3ehbu9_146">Модуль weather_service</span></h2><p id="z3ehbu9_139">Служба интеграции прогноза погоды. Этот модуль взаимодействует с внешним API для получения данных о погоде, которые могут использоваться для анализа и прогноза производительности системы, учитывая метеоусловия.</p><p id="z3ehbu9_140"><span class="control" id="z3ehbu9_147">Общая информация</span></p><p id="z3ehbu9_141">Модуль weather_service предназначен для получения информации о текущей погоде и прогноза на 24 часа. Модуль разработан на языке Erlang. Для логирования сообщений предлагается использовать макросы: ?LOGINFO, ?LOGWARNING, ?LOGERROR и обеспечивать откат транзакций при ошибках. При успешном оформлении возвращается атом ok.</p><div class="table-wrapper"><table class="wide" id="z3ehbu9_142"><thead><tr class="ijRowHead" id="z3ehbu9_148"><th id="z3ehbu9_151"><p><span class="control" id="z3ehbu9_153">Функция</span></p></th><th id="z3ehbu9_152"><p><span class="control" id="z3ehbu9_154">Описание</span></p></th></tr></thead><tbody><tr id="z3ehbu9_149"><td id="z3ehbu9_155"><p>forecast24/1</p></td><td id="z3ehbu9_156"><p id="z3ehbu9_157">: Получает прогноз погоды на 24 часа через API OpenWeatherMap.</p><p id="z3ehbu9_158"><span class="control" id="z3ehbu9_169">Параметры</span>:</p><p id="z3ehbu9_159">- Obj (map): Объект, содержащий координаты (широта lat и долгота lon).</p><p id="z3ehbu9_160"><span class="control" id="z3ehbu9_170">Возвращает</span>: Обработанные данные о прогнозе, включая массивы температуры, давления, влажности, скорости и направления ветра.</p><p id="z3ehbu9_161"><span class="control" id="z3ehbu9_171">Пример использования</span>:</p><p id="z3ehbu9_162">weather_service:forecast24(Object).</p><p id="z3ehbu9_163"><span class="control" id="z3ehbu9_172">Детали реализации</span>:</p><p id="z3ehbu9_164">- Чтение координат из объекта с использованием fp_db:read_fields.</p><p id="z3ehbu9_165">- Формирование URL для запроса к API.</p><p id="z3ehbu9_166">- Выполнение HTTP-запроса с использованием модуля httpc.</p><p id="z3ehbu9_167">- Парсинг ответа JSON с помощью библиотеки jsx.</p><p id="z3ehbu9_168">- Обработка данных прогноза для температуры, давления, влажности, скорости и направления ветра.</p></td></tr><tr id="z3ehbu9_150"><td id="z3ehbu9_173"><p>current/1</p></td><td id="z3ehbu9_174"><p id="z3ehbu9_175">: Получает текущую погоду через API OpenWeatherMap.</p><p id="z3ehbu9_176"><span class="control" id="z3ehbu9_194">Параметры</span>:</p><p id="z3ehbu9_177">- Obj (map): Объект, содержащий координаты (широта lat и долгота lon).</p><p id="z3ehbu9_178"><span class="control" id="z3ehbu9_195">Возвращает</span>: Карта значений с текущими погодными данными:</p><p id="z3ehbu9_179">- ts: Временная метка.</p><p id="z3ehbu9_180">- pressure: Давление (гПа).</p><p id="z3ehbu9_181">- temperature: Температура (&deg;C).</p><p id="z3ehbu9_182">- humidity: Влажность (%).</p><p id="z3ehbu9_183">- wind_speed: Скорость ветра (м/с).</p><p id="z3ehbu9_184">- wind_direction: Направление ветра (градусы).</p><p id="z3ehbu9_185"><span class="control" id="z3ehbu9_196">Пример использования</span>:</p><p id="z3ehbu9_186">weather_service:current(Object).</p><p id="z3ehbu9_187"><span class="control" id="z3ehbu9_197">Детали реализации</span>:</p><p id="z3ehbu9_188">- Чтение координат из объекта с использованием fp_db:read_fields.</p><p id="z3ehbu9_189">- Формирование URL для запроса к API.</p><p id="z3ehbu9_190">- Выполнение HTTP-запроса с использованием модуля httpc.</p><p id="z3ehbu9_191">- Парсинг ответа JSON с помощью библиотеки jsx.</p><p id="z3ehbu9_192">- Извлечение значений давления, температуры, влажности, скорости и направления ветра.</p><p id="z3ehbu9_193"></p></td></tr></tbody></table></div><p id="z3ehbu9_143"><span class="control" id="z3ehbu9_198">Примечания</span></p><ul class="list _bullet" id="z3ehbu9_144"><li class="list__item" id="z3ehbu9_199"><p id="z3ehbu9_201">Убедитесь, что у вас есть действительный ключ API OpenWeatherMap.</p></li><li class="list__item" id="z3ehbu9_200"><p id="z3ehbu9_202">Для повышения производительности рекомендуется кешировать результаты запросов.</p></li></ul></section><section class="chapter"><h2 id="fp-userlib-archive" data-toc="fp-userlib-archive"><a name=""></a><span class="control" id="z3ehbu9_212">Модуль fp_userlib_archive</span></h2><p id="z3ehbu9_204">Модуль для работы с архивами. Предназначен для управления архивированием данных и взаимодействия с базой архивов, включая создание, удаление и обновление записей.</p><p id="z3ehbu9_205"><span class="control" id="z3ehbu9_213">Общая информация</span></p><p id="z3ehbu9_206">Модуль fp_userlib_archive предоставляет функцию для сохранения данных из CSV-файла в архив. Код написан на языке программирования Erlang. При возникновении ошибок транзакция будет отменена. Рекомендуется логировать информацию о процессе выполнения с использованием макросов:</p><ul class="list _bullet" id="z3ehbu9_207"><li class="list__item" id="z3ehbu9_214"><p id="z3ehbu9_217">?LOGINFO</p></li><li class="list__item" id="z3ehbu9_215"><p id="z3ehbu9_218">?LOGWARNING</p></li><li class="list__item" id="z3ehbu9_216"><p id="z3ehbu9_219">?LOGERROR</p></li></ul><div class="table-wrapper"><table class="wide" id="z3ehbu9_208"><thead><tr class="ijRowHead" id="z3ehbu9_220"><th id="z3ehbu9_222"><p><span class="control" id="z3ehbu9_224">Функция</span></p></th><th id="z3ehbu9_223"><p><span class="control" id="z3ehbu9_225">Описание</span></p></th></tr></thead><tbody><tr id="z3ehbu9_221"><td id="z3ehbu9_226"><p>csv_to_archive/1</p></td><td id="z3ehbu9_227"><p id="z3ehbu9_228">: Сохраняет данные из CSV-файла, переданного в виде строки в формате Base64, в архив.</p><p id="z3ehbu9_229"><span class="control" id="z3ehbu9_247">Параметры</span>:</p><p id="z3ehbu9_230">- Args (map): Словарь с ключами:</p><p id="z3ehbu9_231">- archive_path (binary): Путь к архиву, куда будут записаны данные.</p><p id="z3ehbu9_232">- content (binary): Содержимое CSV-файла в формате Base64.</p><p id="z3ehbu9_233"><span class="control" id="z3ehbu9_248">Возвращает</span>: Атом ok в случае успешного выполнения или выбрасывает исключение в случае ошибки.</p><p id="z3ehbu9_234"><span class="control" id="z3ehbu9_249">Пример использования</span>:</p><p id="z3ehbu9_235">Args = #{</p><p id="z3ehbu9_236"><code class="code" id="z3ehbu9_250"></code> &lt;&lt;&quot;archive_path&quot;&gt;&gt; =&gt; &lt;&lt;&quot;/path/to/archive&quot;&gt;&gt;,</p><p id="z3ehbu9_237"><code class="code" id="z3ehbu9_251"></code> &lt;&lt;&quot;content&quot;&gt;&gt; =&gt; &lt;&lt;&quot;VGltZXN0YW1wLFZhbHVlCjE2NzMwMjUwMDAsMTIzLjQ1Cg==&quot;&gt;&gt; %% Base64-encoded CSV</p><p id="z3ehbu9_238">}.</p><p id="z3ehbu9_239">fp_userlib_archive:csv_to_archive(Args).</p><p id="z3ehbu9_240"><span class="control" id="z3ehbu9_252">Детали реализации</span>:</p><p id="z3ehbu9_241">- Декодирует содержимое CSV-файла из Base64 в бинарный формат.</p><p id="z3ehbu9_242">- Разделяет данные на строки и колонки.</p><p id="z3ehbu9_243">- Конвертирует данные времени (timestamp) и значений (value) в подходящие типы.</p><p id="z3ehbu9_244">- Пытается записать обработанные данные в указанный архив с помощью функции fp_archive:insert_values.</p><p id="z3ehbu9_245">- В случае ошибки записывает информацию в лог.</p><p id="z3ehbu9_246"></p></td></tr></tbody></table></div><p id="z3ehbu9_209"><span class="control" id="z3ehbu9_253">Примечания</span></p><ul class="list _bullet" id="z3ehbu9_210"><li class="list__item" id="z3ehbu9_254"><p id="z3ehbu9_257">Данные CSV-файла должны быть корректно закодированы в Base64.</p></li><li class="list__item" id="z3ehbu9_255"><p id="z3ehbu9_258">Архив, указанный в archive_path, должен существовать и быть доступным для записи.</p></li><li class="list__item" id="z3ehbu9_256"><p id="z3ehbu9_259">В случае возникновения исключений данные не будут записаны.</p></li></ul></section><section class="chapter"><h2 id="fp-pf-utils" data-toc="fp-pf-utils"><a name=""></a><span class="control" id="z3ehbu9_270">Модуль fp_pf_utils</span></h2><p id="z3ehbu9_261">Вспомогательные функции для интеграции с PowerFactory (PF). Этот модуль помогает в управлении и мониторинге сетевых моделей, позволяя обмениваться данными между SCADA-системой и PF.</p><p id="z3ehbu9_262"><span class="control" id="z3ehbu9_271">Общая информация</span></p><p id="z3ehbu9_263">Модуль fp_pf_utils предоставляет функции для взаимодействия с PowerFactory Service. Основные функции включают операции для получения данных, выполнения расчётов и запуска динамических сценариев. Код написан на языке программирования Erlang. Все транзакции откатываются в случае ошибок, а успешное выполнение возвращает атом ok.</p><p id="z3ehbu9_264">Рекомендуется использовать следующие макросы для логирования:</p><ul class="list _bullet" id="z3ehbu9_265"><li class="list__item" id="z3ehbu9_272"><p id="z3ehbu9_275">?LOGINFO</p></li><li class="list__item" id="z3ehbu9_273"><p id="z3ehbu9_276">?LOGWARNING</p></li><li class="list__item" id="z3ehbu9_274"><p id="z3ehbu9_277">?LOGERROR</p></li></ul><div class="table-wrapper"><table class="wide" id="z3ehbu9_266"><thead><tr class="ijRowHead" id="z3ehbu9_278"><th id="z3ehbu9_282"><p><span class="control" id="z3ehbu9_284">Функция</span></p></th><th id="z3ehbu9_283"><p><span class="control" id="z3ehbu9_285">Описание</span></p></th></tr></thead><tbody><tr id="z3ehbu9_279"><td id="z3ehbu9_286"><p>pf_get/0</p></td><td id="z3ehbu9_287"><p id="z3ehbu9_288">: Получает данные из PowerFactory на основе заданных параметров проекта.</p><p id="z3ehbu9_289"><span class="control" id="z3ehbu9_296">Параметры</span>: Нет.</p><p id="z3ehbu9_290"><span class="control" id="z3ehbu9_297">Возвращает</span>: Результат выполнения запроса к PowerFactory Service.</p><p id="z3ehbu9_291"><span class="control" id="z3ehbu9_298">Пример использования</span>:</p><p id="z3ehbu9_292">fp_pf_utils:pf_get().</p><p id="z3ehbu9_293"><span class="control" id="z3ehbu9_299">Детали реализации</span>:</p><p id="z3ehbu9_294">- Формирует параметры проекта, включая имя сетки, имя проекта, имя сценария и тип сессии.</p><p id="z3ehbu9_295">- Выполняет запрос через fp_powerfactory_service:pf_service_update с использованием хоста и порта.</p></td></tr><tr id="z3ehbu9_280"><td id="z3ehbu9_300"><p>pf_execute/0</p></td><td id="z3ehbu9_301"><p id="z3ehbu9_302">: Выполняет расчёт на основе заданных параметров проекта и указания идентификатора LDF.</p><p id="z3ehbu9_303"><span class="control" id="z3ehbu9_312">Параметры</span>: Нет.</p><p id="z3ehbu9_304"><span class="control" id="z3ehbu9_313">Возвращает</span>: Результат выполнения запроса к PowerFactory Service.</p><p id="z3ehbu9_305"><span class="control" id="z3ehbu9_314">Пример использования</span>:</p><p id="z3ehbu9_306">fp_pf_utils:pf_execute().</p><p id="z3ehbu9_307"><span class="control" id="z3ehbu9_315">Детали реализации</span>:</p><p id="z3ehbu9_308">- Формирует параметры проекта, включая имя сетки, имя проекта, имя сценария и тип сессии.</p><p id="z3ehbu9_309">- Определяет идентификатор объекта ComLdfOID для выполнения расчёта.</p><p id="z3ehbu9_310">- Выполняет запрос через fp_powerfactory_service:pf_service_update с использованием хоста и порта.</p><p id="z3ehbu9_311"></p></td></tr><tr id="z3ehbu9_281"><td id="z3ehbu9_316"><p>pf_dynamics/0</p></td><td id="z3ehbu9_317"><p id="z3ehbu9_318">: Запускает динамический сценарий расчёта на основе заданных параметров проекта.</p><p id="z3ehbu9_319"><span class="control" id="z3ehbu9_326">Параметры</span>: Нет.</p><p id="z3ehbu9_320"><span class="control" id="z3ehbu9_327">Возвращает</span>: Результат выполнения запроса к PowerFactory Service.</p><p id="z3ehbu9_321"><span class="control" id="z3ehbu9_328">Пример использования</span>:</p><p id="z3ehbu9_322">fp_pf_utils:pf_dynamics().</p><p id="z3ehbu9_323"><span class="control" id="z3ehbu9_329">Детали реализации</span>:</p><p id="z3ehbu9_324">- Формирует параметры проекта, включая имя сетки, имя проекта, имя сценария и тип сессии.</p><p id="z3ehbu9_325">- Выполняет запрос через fp_powerfactory_service:pf_service_update с использованием хоста и порта.</p></td></tr></tbody></table></div><p id="z3ehbu9_267"><span class="control" id="z3ehbu9_330">Примечания</span></p><ul class="list _bullet" id="z3ehbu9_268"><li class="list__item" id="z3ehbu9_331"><p id="z3ehbu9_333">Хост и порт для запросов определены через макросы ?HOST и ?PORT.</p></li><li class="list__item" id="z3ehbu9_332"><p id="z3ehbu9_334">Перед использованием функций убедитесь, что PowerFactory Service доступен по указанным параметрам.</p></li></ul></section><section class="chapter"><h2 id="bms-service" data-toc="bms-service"><a name=""></a><span class="control" id="z3ehbu9_343">Модуль bms_service</span></h2><p id="z3ehbu9_336">Логика сервиса для системы рынка баланса. Этот модуль управляет обменом данными с балансирующим рынком, обрабатывая данные о спросе и предложении.</p><p id="z3ehbu9_337"><span class="control" id="z3ehbu9_344">Общая информация</span></p><p id="z3ehbu9_338">Модуль bms_service предоставляет функции для интеграции с REST API и обработки данных из внешних систем. Код написан на языке Erlang. Все методы модуля работают с объектами, позволяют редактировать их и обеспечивают откат транзакций в случае ошибок. Логирование рекомендуется выполнять с использованием макросов ?LOGINFO, ?LOGWARNING и ?LOGERROR.</p><div class="table-wrapper"><table class="wide" id="z3ehbu9_339"><thead><tr class="ijRowHead" id="z3ehbu9_345"><th id="z3ehbu9_350"><p><span class="control" id="z3ehbu9_352">Функция</span></p></th><th id="z3ehbu9_351"><p><span class="control" id="z3ehbu9_353">Описание</span></p></th></tr></thead><tbody><tr id="z3ehbu9_346"><td id="z3ehbu9_354"><p>find_objects/1</p></td><td id="z3ehbu9_355"><p id="z3ehbu9_356">: Ищет объекты в хранилище данных на основе переданных фильтров.</p><p id="z3ehbu9_357"><span class="control" id="z3ehbu9_371">Параметры</span>:</p><p id="z3ehbu9_358">- Filter (map): Словарь, содержащий ключи:</p><p id="z3ehbu9_359">- &lt;&lt;&quot;.path&quot;&gt;&gt;: Корневой путь объекта.</p><p id="z3ehbu9_360">- &lt;&lt;&quot;.name&quot;&gt;&gt;: Имя объекта.</p><p id="z3ehbu9_361">- &lt;&lt;&quot;.prototype&quot;&gt;&gt;: Прототип объекта.</p><p id="z3ehbu9_362"><span class="control" id="z3ehbu9_372">Возвращает</span>: Список объектов, соответствующих заданным фильтрам, либо {error, [[], []]} в случае ошибки.</p><p id="z3ehbu9_363"><span class="control" id="z3ehbu9_373">Пример использования</span>:</p><p id="z3ehbu9_364">Filter = #{</p><p id="z3ehbu9_365"><code class="code" id="z3ehbu9_374"></code> &lt;&lt;&quot;.path&quot;&gt;&gt; =&gt; &lt;&lt;&quot;/root/PROJECT/&quot;&gt;&gt;,</p><p id="z3ehbu9_366"><code class="code" id="z3ehbu9_375"></code> &lt;&lt;&quot;.name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;subject&quot;&gt;&gt;,</p><p id="z3ehbu9_367"><code class="code" id="z3ehbu9_376"></code> &lt;&lt;&quot;.prototype&quot;&gt;&gt; =&gt; &lt;&lt;&quot;/root/FP/prototypes/subject/fields&quot;&gt;&gt;</p><p id="z3ehbu9_368">}.</p><p id="z3ehbu9_369">bms_service:find_objects(Filter).</p><p id="z3ehbu9_370"></p></td></tr><tr id="z3ehbu9_347"><td id="z3ehbu9_377"><p>run/0</p></td><td id="z3ehbu9_378"><p id="z3ehbu9_379">: Основная функция для выполнения задачи. Осуществляет получение объектов, авторизацию через REST API, запрос данных и запись их в архивы.</p><p id="z3ehbu9_380"><span class="control" id="z3ehbu9_390">Параметры</span>: Нет.</p><p id="z3ehbu9_381"><span class="control" id="z3ehbu9_391">Возвращает</span>: Атом ok при успешном выполнении, либо описание ошибки.</p><p id="z3ehbu9_382"><span class="control" id="z3ehbu9_392">Пример использования</span>:</p><p id="z3ehbu9_383">bms_service:run().</p><p id="z3ehbu9_384"><span class="control" id="z3ehbu9_393">Детали реализации</span>:</p><p id="z3ehbu9_385">- Формирует фильтры для поиска объектов.</p><p id="z3ehbu9_386">- Выполняет запрос для получения токена авторизации через REST API.</p><p id="z3ehbu9_387">- Осуществляет запрос данных по объектам с использованием токена.</p><p id="z3ehbu9_388">- Преобразует полученные данные и записывает их в архивы.</p><p id="z3ehbu9_389"></p></td></tr><tr id="z3ehbu9_348"><td id="z3ehbu9_394"><p>write_to_db/2</p></td><td id="z3ehbu9_395"><p id="z3ehbu9_396">: Записывает данные в хранилище данных, удаляя старые записи в указанном диапазоне.</p><p id="z3ehbu9_397"><span class="control" id="z3ehbu9_404">Параметры</span>:</p><p id="z3ehbu9_398">- Data (list): Список данных для записи.</p><p id="z3ehbu9_399">- Archive (binary): Путь к архиву.</p><p id="z3ehbu9_400"><span class="control" id="z3ehbu9_405">Возвращает</span>: {ok, written_to_db} при успешной записи либо {error, {write_failure, Reason}} при ошибке.</p><p id="z3ehbu9_401"><span class="control" id="z3ehbu9_406">Пример использования</span>:</p><p id="z3ehbu9_402">bms_service:write_to_db(Data, Archive).</p><p id="z3ehbu9_403"></p></td></tr><tr id="z3ehbu9_349"><td id="z3ehbu9_407"><p>extract_data/2</p></td><td id="z3ehbu9_408"><p id="z3ehbu9_409">: Извлекает и преобразует данные из ответа API для последующей обработки.</p><p id="z3ehbu9_410"><span class="control" id="z3ehbu9_416">Параметры</span>:</p><p id="z3ehbu9_411">- Objects (list): Список объектов для обработки.</p><p id="z3ehbu9_412">- Response (map): Ответ от REST API.</p><p id="z3ehbu9_413"><span class="control" id="z3ehbu9_417">Возвращает</span>: Преобразованные данные или ok, если дата не соответствует требованиям.</p><p id="z3ehbu9_414"><span class="control" id="z3ehbu9_418">Пример использования</span>:</p><p id="z3ehbu9_415">bms_service:extract_data(Objects, Response).</p></td></tr></tbody></table></div><p id="z3ehbu9_340"><span class="control" id="z3ehbu9_419">Примечания</span></p><ul class="list _bullet" id="z3ehbu9_341"><li class="list__item" id="z3ehbu9_420"><p id="z3ehbu9_424">Функции transform_purchases/2 и transform_sales/2 используются для преобразования данных покупок и продаж в формате {Timestamp, Value}.</p></li><li class="list__item" id="z3ehbu9_421"><p id="z3ehbu9_425">Убедитесь, что REST API доступен и корректно настроен для выполнения запросов.</p></li><li class="list__item" id="z3ehbu9_422"><p id="z3ehbu9_426">Все временные метки преобразуются в миллисекунды для использования в архивах.</p></li><li class="list__item" id="z3ehbu9_423"><p id="z3ehbu9_427">При работе с датами используются вспомогательные функции is_today/1 и is_tomorrow/1 для определения актуальности данных.</p></li></ul></section><section class="chapter"><h2 id="calculation-v2" data-toc="calculation-v2"><a name=""></a><span class="control" id="z3ehbu9_436">Модуль calculation (v2)</span></h2><p id="z3ehbu9_429">Модуль для выполнения различных вычислений. Поддерживает более сложные операции, включая обработку данных в режиме реального времени.</p><p id="z3ehbu9_430"><span class="control" id="z3ehbu9_437">Общая информация</span></p><p id="z3ehbu9_431">Модуль calculation предоставляет функцию для вычисления значений на основе строки, содержащей арифметические операции, такие как сложение и вычитание. Код написан на языке Erlang и включает обработку ошибок и логирование. Основная цель &mdash; обработка строк с числами и получение вычисленного результата.</p><div class="table-wrapper"><table class="wide" id="z3ehbu9_432"><thead><tr class="ijRowHead" id="z3ehbu9_438"><th id="z3ehbu9_448"><p><span class="control" id="z3ehbu9_450">Функция</span></p></th><th id="z3ehbu9_449"><p><span class="control" id="z3ehbu9_451">Описание</span></p></th></tr></thead><tbody><tr id="z3ehbu9_439"><td id="z3ehbu9_452"><p>evaluate/2</p></td><td id="z3ehbu9_453"><p id="z3ehbu9_454">: Выполняет вычисление на основе переданной строки с арифметическими операциями.</p><p id="z3ehbu9_455"><span class="control" id="z3ehbu9_466">Параметры</span>:</p><p id="z3ehbu9_456">- Name (binary): Имя объекта, которое используется для получения дополнительных значений.</p><p id="z3ehbu9_457">- String (binary): Строка с числами и арифметическими операциями (+ и -).</p><p id="z3ehbu9_458"><span class="control" id="z3ehbu9_467">Возвращает</span>: Вычисленное числовое значение или {error, Reason} в случае ошибки.</p><p id="z3ehbu9_459"><span class="control" id="z3ehbu9_468">Пример использования</span>:</p><p id="z3ehbu9_460">calculation:evaluate(&lt;&lt;&quot;example&quot;&gt;&gt;, &lt;&lt;&quot;10+20-5&quot;&gt;&gt;).</p><p id="z3ehbu9_461"><span class="control" id="z3ehbu9_469">Детали реализации</span>:</p><p id="z3ehbu9_462">- Проверяет, является ли String бинарной строкой.</p><p id="z3ehbu9_463">- Разбивает строку на токены с помощью функции tokenize/1.</p><p id="z3ehbu9_464">- Передаёт токены в функцию evaluate_tokens/2 для выполнения вычислений.</p><p id="z3ehbu9_465">- Логирует ошибки, если они возникают.</p></td></tr><tr id="z3ehbu9_440"><td id="z3ehbu9_470"><p>tokenize/1</p></td><td id="z3ehbu9_471"><p id="z3ehbu9_472">: Разбивает строку на токены по операторам + и -.</p><p id="z3ehbu9_473"><span class="control" id="z3ehbu9_479">Параметры</span>:</p><p id="z3ehbu9_474">- String (binary): Входная строка.</p><p id="z3ehbu9_475"><span class="control" id="z3ehbu9_480">Возвращает</span>: Список токенов в виде бинарных строк.</p><p id="z3ehbu9_476"><span class="control" id="z3ehbu9_481">Пример использования</span>:</p><p id="z3ehbu9_477">calculation:tokenize(&lt;&lt;&quot;10+20-5&quot;&gt;&gt;).</p><p id="z3ehbu9_478"></p></td></tr><tr id="z3ehbu9_441"><td id="z3ehbu9_482"><p>evaluate_tokens/2</p></td><td id="z3ehbu9_483"><p id="z3ehbu9_484">: Выполняет вычисление на основе списка токенов.</p><p id="z3ehbu9_485"><span class="control" id="z3ehbu9_492">Параметры</span>:</p><p id="z3ehbu9_486">- Name (binary): Имя объекта.</p><p id="z3ehbu9_487">- Tokens (list): Список токенов (числа, операторы + и -).</p><p id="z3ehbu9_488"><span class="control" id="z3ehbu9_493">Возвращает</span>: Результат вычисления.</p><p id="z3ehbu9_489"><span class="control" id="z3ehbu9_494">Пример использования</span>:</p><p id="z3ehbu9_490">calculation:evaluate_tokens(&lt;&lt;&quot;example&quot;&gt;&gt;, [&lt;&lt;&quot;10&quot;&gt;&gt;, &lt;&lt;&quot;+&quot;&gt;&gt;, &lt;&lt;&quot;20&quot;&gt;&gt;, &lt;&lt;&quot;-&quot;&gt;&gt;, &lt;&lt;&quot;5&quot;&gt;&gt;]).</p><p id="z3ehbu9_491"></p></td></tr><tr id="z3ehbu9_442"><td id="z3ehbu9_495"><p>get_value/1</p></td><td id="z3ehbu9_496"><p id="z3ehbu9_497">: Получает значение поля out_value из объекта в хранилище данных.</p><p id="z3ehbu9_498"><span class="control" id="z3ehbu9_504">Параметры</span>:</p><p id="z3ehbu9_499">Token (binary): Путь к объекту в виде строки.</p><p id="z3ehbu9_500"><span class="control" id="z3ehbu9_505">Возвращает</span>: Значение поля out_value или вызывает исключение в случае ошибки.</p><p id="z3ehbu9_501"><span class="control" id="z3ehbu9_506">Пример использования</span>:</p><p id="z3ehbu9_502">calculation:get_value(&lt;&lt;&quot;/root/FP/PROJECT/example&quot;&gt;&gt;).</p><p id="z3ehbu9_503"></p></td></tr><tr id="z3ehbu9_443"><td id="z3ehbu9_507"><p>get_catalog/2</p></td><td id="z3ehbu9_508"><p id="z3ehbu9_509">: Получает значение из каталога формул и вычисляет его, если оно содержит арифметическое выражение.</p><p id="z3ehbu9_510"><span class="control" id="z3ehbu9_517">Параметры</span>:</p><p id="z3ehbu9_511">- Name (binary): Имя объекта.</p><p id="z3ehbu9_512">- Token (binary): Идентификатор формулы.</p><p id="z3ehbu9_513"><span class="control" id="z3ehbu9_518">Возвращает</span>: Числовое значение или результат вычисления.</p><p id="z3ehbu9_514"><span class="control" id="z3ehbu9_519">Пример использования</span>:</p><p id="z3ehbu9_515">calculation:get_catalog(&lt;&lt;&quot;example&quot;&gt;&gt;, &lt;&lt;&quot;formula_1&quot;&gt;&gt;).</p><p id="z3ehbu9_516"></p></td></tr><tr id="z3ehbu9_444"><td id="z3ehbu9_520"><p>split_path/1</p></td><td id="z3ehbu9_521"><p id="z3ehbu9_522">: Разделяет путь на папку и имя объекта.</p><p id="z3ehbu9_523"><span class="control" id="z3ehbu9_529">Параметры</span>:</p><p id="z3ehbu9_524">- Bin (binary): Полный путь к объекту.</p><p id="z3ehbu9_525"><span class="control" id="z3ehbu9_530">Возвращает</span>: Кортеж {Folder, Name}.</p><p id="z3ehbu9_526"><span class="control" id="z3ehbu9_531">Пример использования</span>:</p><p id="z3ehbu9_527">calculation:split_path(&lt;&lt;&quot;/root/FP/PROJECT/example&quot;&gt;&gt;).</p><p id="z3ehbu9_528"></p></td></tr><tr id="z3ehbu9_445"><td id="z3ehbu9_532"><p>strings_to_binaries/1</p></td><td id="z3ehbu9_533"><p id="z3ehbu9_534">: Преобразует список строк в список бинарных строк.</p><p id="z3ehbu9_535"><span class="control" id="z3ehbu9_540">Параметры</span>:</p><p id="z3ehbu9_536">- Strings (list): Список строк.</p><p id="z3ehbu9_537"><span class="control" id="z3ehbu9_541">Возвращает</span>: Список бинарных строк.</p><p id="z3ehbu9_538"><span class="control" id="z3ehbu9_542">Пример использования</span>:</p><p id="z3ehbu9_539">calculation:strings_to_binaries([&quot;10&quot;, &quot;+&quot;, &quot;20&quot;, &quot;-&quot;, &quot;5&quot;]).</p></td></tr><tr id="z3ehbu9_446"><td id="z3ehbu9_543"><p>token_is_docker/1</p></td><td id="z3ehbu9_544"><p id="z3ehbu9_545">: Проверяет, является ли токен идентификатором объекта в системе Docker.</p><p id="z3ehbu9_546"><span class="control" id="z3ehbu9_551">Параметры</span>:</p><p id="z3ehbu9_547">- Token (binary): Токен для проверки.</p><p id="z3ehbu9_548"><span class="control" id="z3ehbu9_552">Возвращает</span>: true или false.</p><p id="z3ehbu9_549"><span class="control" id="z3ehbu9_553">Пример использования</span>:</p><p id="z3ehbu9_550">calculation:token_is_docker(&lt;&lt;&quot;/docker/object&quot;&gt;&gt;).</p></td></tr><tr id="z3ehbu9_447"><td id="z3ehbu9_554"><p>token_type/1</p></td><td id="z3ehbu9_555"><p id="z3ehbu9_556">: Определяет тип токена (целое число, число с плавающей точкой или неизвестный тип).</p><p id="z3ehbu9_557"><span class="control" id="z3ehbu9_563">Параметры</span>:</p><p id="z3ehbu9_558">- Token (binary): Токен для анализа.</p><p id="z3ehbu9_559"><span class="control" id="z3ehbu9_564">Возвращает</span>: int, float или false.</p><p id="z3ehbu9_560"><span class="control" id="z3ehbu9_565">Пример использования</span>:</p><p id="z3ehbu9_561">calculation:token_type(&lt;&lt;&quot;10.5&quot;&gt;&gt;).</p><p id="z3ehbu9_562"></p></td></tr></tbody></table></div><p id="z3ehbu9_433"><span class="control" id="z3ehbu9_566">Примечания</span></p><ul class="list _bullet" id="z3ehbu9_434"><li class="list__item" id="z3ehbu9_567"><p id="z3ehbu9_570">Убедитесь, что входная строка корректно сформирована и содержит только поддерживаемые операторы и числа.</p></li><li class="list__item" id="z3ehbu9_568"><p id="z3ehbu9_571">В случае ошибок вызовите логирование для диагностики причин.</p></li><li class="list__item" id="z3ehbu9_569"><p id="z3ehbu9_572">Функции работают с бинарными строками, поэтому при вводе данных убедитесь, что строки находятся в правильном формате.</p></li></ul></section><section class="chapter"><h2 id="docker-client-v0-1" data-toc="docker-client-v0-1"><a name=""></a><span class="control" id="z3ehbu9_583">Модуль docker_client (v0.1)</span></h2><p id="z3ehbu9_574">Клиент для взаимодействия с Docker. Используется для управления контейнерами Docker из среды Faceplate Studio, что удобно для разворачивания и мониторинга приложений в контейнерах.</p><p id="z3ehbu9_575"><span class="control" id="z3ehbu9_584">Общая информация</span></p><p id="z3ehbu9_576">Модуль docker_client предоставляет интерфейс для взаимодействия с Docker Engine через API. Функции модуля позволяют получать список контейнеров, создавать и запускать контейнеры. Код написан на языке Erlang.</p><div class="table-wrapper"><table class="wide" id="z3ehbu9_577"><thead><tr class="ijRowHead" id="z3ehbu9_585"><th id="z3ehbu9_589"><p><span class="control" id="z3ehbu9_591">Функция</span></p></th><th id="z3ehbu9_590"><p><span class="control" id="z3ehbu9_592">Описание</span></p></th></tr></thead><tbody><tr id="z3ehbu9_586"><td id="z3ehbu9_593"><p>list_containers/0</p></td><td id="z3ehbu9_594"><p id="z3ehbu9_595">: Возвращает список контейнеров, запущенных в Docker Engine.</p><p id="z3ehbu9_596"><span class="control" id="z3ehbu9_607">Параметры</span>: Нет.</p><p id="z3ehbu9_597"><span class="control" id="z3ehbu9_608">Возвращает</span>:</p><p id="z3ehbu9_598">- {ok, Containers}: Список контейнеров в формате JSON.</p><p id="z3ehbu9_599">- {error, {unexpected_status, StatusCode}}: Неожиданный HTTP-код ответа.</p><p id="z3ehbu9_600">- {error, Reason}: Причина ошибки при выполнении запроса.</p><p id="z3ehbu9_601"><span class="control" id="z3ehbu9_609">Пример использования</span>:</p><p id="z3ehbu9_602">docker_client:list_containers().</p><p id="z3ehbu9_603"><span class="control" id="z3ehbu9_610">Детали реализации</span>:</p><p id="z3ehbu9_604">- Формирует URL для запроса /containers/json.</p><p id="z3ehbu9_605">- Выполняет HTTP GET-запрос.</p><p id="z3ehbu9_606">- Декодирует ответ JSON или возвращает ошибку при некорректном статусе.</p></td></tr><tr id="z3ehbu9_587"><td id="z3ehbu9_611"><p>create_container/1</p></td><td id="z3ehbu9_612"><p id="z3ehbu9_613">: Создаёт новый контейнер на основе указанного образа.</p><p id="z3ehbu9_614"><span class="control" id="z3ehbu9_627">Параметры</span>:</p><p id="z3ehbu9_615">- Image (binary): Имя образа Docker.</p><p id="z3ehbu9_616"><span class="control" id="z3ehbu9_628">Возвращает</span>:</p><p id="z3ehbu9_617">- {ok, ContainerInfo}: Информация о созданном контейнере.</p><p id="z3ehbu9_618">- {error, {unexpected_status, StatusCode}}: Неожиданный HTTP-код ответа.</p><p id="z3ehbu9_619">- {error, Reason}: Причина ошибки при выполнении запроса.</p><p id="z3ehbu9_620"><span class="control" id="z3ehbu9_629">Пример использования</span>:</p><p id="z3ehbu9_621">docker_client:create_container(&lt;&lt;&quot;nginx&quot;&gt;&gt;).</p><p id="z3ehbu9_622"><span class="control" id="z3ehbu9_630">Детали реализации</span>:</p><p id="z3ehbu9_623">- Формирует URL для запроса /containers/create.</p><p id="z3ehbu9_624">- Кодирует тело запроса в формате JSON, включая имя образа и команду.</p><p id="z3ehbu9_625">- Выполняет HTTP POST-запрос.</p><p id="z3ehbu9_626">- Декодирует ответ JSON или возвращает ошибку при некорректном статусе.</p></td></tr><tr id="z3ehbu9_588"><td id="z3ehbu9_631"><p>start_container/1</p></td><td id="z3ehbu9_632"><p id="z3ehbu9_633">: Запускает контейнер с указанным идентификатором.</p><p id="z3ehbu9_634"><span class="control" id="z3ehbu9_646">Параметры</span>:</p><p id="z3ehbu9_635">- ContainerId (binary): Идентификатор контейнера.</p><p id="z3ehbu9_636"><span class="control" id="z3ehbu9_647">Возвращает</span>:</p><p id="z3ehbu9_637">- {ok, &lt;&lt;&quot;Container started successfully&quot;&gt;&gt;}: Контейнер успешно запущен.</p><p id="z3ehbu9_638">- {error, {unexpected_status, StatusCode}}: Неожиданный HTTP-код ответа.</p><p id="z3ehbu9_639">- {error, Reason}: Причина ошибки при выполнении запроса.</p><p id="z3ehbu9_640"><span class="control" id="z3ehbu9_648">Пример использования</span>:</p><p id="z3ehbu9_641">docker_client:start_container(&lt;&lt;&quot;e90e34656806&quot;&gt;&gt;).</p><p id="z3ehbu9_642"><span class="control" id="z3ehbu9_649">Детали реализации</span>:</p><p id="z3ehbu9_643">- Формирует URL для запроса /containers//start.</p><p id="z3ehbu9_644">- Выполняет HTTP POST-запрос.</p><p id="z3ehbu9_645">- Возвращает сообщение об успешном запуске или ошибку при некорректном статусе.</p></td></tr></tbody></table></div><p id="z3ehbu9_578"><span class="control" id="z3ehbu9_650">Конфигурация</span></p><p id="z3ehbu9_579"><span class="control" id="z3ehbu9_651">Базовый URL</span>: Определён через макрос ?DOCKER_URL и по умолчанию равен http://localhost:2375.</p><p id="z3ehbu9_580"><span class="control" id="z3ehbu9_652">Примечания</span></p><ul class="list _bullet" id="z3ehbu9_581"><li class="list__item" id="z3ehbu9_653"><p id="z3ehbu9_656">Для работы функций требуется, чтобы Docker API был доступен по указанному адресу.</p></li><li class="list__item" id="z3ehbu9_654"><p id="z3ehbu9_657">Функции используют библиотеку HTTP клиента httpc и JSON-парсер jsx.</p></li><li class="list__item" id="z3ehbu9_655"><p id="z3ehbu9_658">В случае ошибок рекомендуется использовать логирование с помощью макросов ?LOGINFO, ?LOGWARNING, ?LOGERROR.</p></li></ul></section><section class="chapter"><h2 id="fp-powerfactory-service" data-toc="fp-powerfactory-service"><a name=""></a><span class="control" id="z3ehbu9_670">Модуль fp_powerfactory_service</span></h2><p id="z3ehbu9_660">Модуль для интеграции с PowerFactory (PF).</p><p id="z3ehbu9_661"><span class="control" id="z3ehbu9_671">Общая информация</span></p><p id="z3ehbu9_662">Модуль fp_powerfactory_service предназначен для интеграции SCADA-системы Faceplate с расчетным ПО PowerFactory. Он обеспечивает обмен данными между этими системами посредством формирования, отправки и обработки JSON-запросов через промежуточный сервер server.py.</p><div class="table-wrapper"><table class="wide" id="z3ehbu9_663"><thead><tr class="ijRowHead" id="z3ehbu9_672"><th id="z3ehbu9_676"><p><span class="control" id="z3ehbu9_678">Функция</span></p></th><th id="z3ehbu9_677"><p><span class="control" id="z3ehbu9_679">Описание</span></p></th></tr></thead><tbody><tr id="z3ehbu9_673"><td id="z3ehbu9_680"><p>pf_service_update(Params, [OID], Host, Port)</p></td><td id="z3ehbu9_681"><p id="z3ehbu9_682"><span class="control" id="z3ehbu9_707">Параметры:</span></p><p id="z3ehbu9_683">Params: Должен содержать структуру следующего вида:</p><p id="z3ehbu9_684">#{</p><p id="z3ehbu9_685"><code class="code" id="z3ehbu9_708"></code> &lt;&lt;&quot;study_case_name&quot;&gt;&gt; =&gt;</p><p id="z3ehbu9_686">&lt;&lt;&quot;Study Case&quot;&gt;&gt;,</p><p id="z3ehbu9_687"><code class="code" id="z3ehbu9_709"></code> &lt;&lt;&quot;session_type&quot;&gt;&gt;</p><p id="z3ehbu9_688">=&gt; &lt;&lt;&quot;calculation&quot;&gt;&gt;,</p><p id="z3ehbu9_689"><code class="code" id="z3ehbu9_710"></code> &lt;&lt;&quot;project_name&quot;&gt;&gt;</p><p id="z3ehbu9_690">=&gt; &lt;&lt;&quot;.MODEL_SCADA_V1107___DEMO(1)&quot;&gt;&gt;,</p><p id="z3ehbu9_691"><code class="code" id="z3ehbu9_711"></code> &lt;&lt;&quot;operation_scenario_name&quot;&gt;&gt;</p><p id="z3ehbu9_692">=&gt; &lt;&lt;&quot;dyn&quot;&gt;&gt;,</p><p id="z3ehbu9_693"><code class="code" id="z3ehbu9_712"></code> &lt;&lt;&quot;id&quot;&gt;&gt; =&gt; 1,</p><p id="z3ehbu9_694"><code class="code" id="z3ehbu9_713"></code> &lt;&lt;&quot;grid_name&quot;&gt;&gt;</p><p id="z3ehbu9_695">=&gt; &quot;Grid&quot;,</p><p id="z3ehbu9_696"><code class="code" id="z3ehbu9_714"></code> &lt;&lt;&quot;func_name&quot;&gt;&gt;</p><p id="z3ehbu9_697">=&gt; &quot;get&quot;</p><p id="z3ehbu9_698">},</p><p id="z3ehbu9_699">где &quot;func_name&quot; должно содержать имя функции, которая используется для формирования json, поле &quot;id&quot; должно содержать идентификатор текущего экземпляра faceplate, остальные поля должны содержать параметры проекта PowerFactory, который будет использоваться для расчетов.</p><p id="z3ehbu9_700">[OID]: Может содержать либо пустой erlang лист, либо OID передаваемого объекта.</p><p id="z3ehbu9_701">Host и Port: адрес и порт сервера, на котором должен быть запущен server.py.</p><p id="z3ehbu9_702"><span class="control" id="z3ehbu9_715">Возвращает</span>: Json-результат выполнения запроса.</p><p id="z3ehbu9_703"><span class="control" id="z3ehbu9_716">Пример использования:</span></p><p id="z3ehbu9_704">fp_powerfactory_service:pf_service_update(Params, [], &quot;127.0.0.1&quot;, 8080).</p><p id="z3ehbu9_705"><span class="control" id="z3ehbu9_717">Детали реализации</span>:</p><p id="z3ehbu9_706">Данная функция не создает новые объекты в хранилище данных Faceplate, если объекты в принятом от PowerFactory json не найдены в базе данных Faceplate.</p></td></tr><tr id="z3ehbu9_674"><td id="z3ehbu9_718"><p>pf_service_create_update(Params, [OID], Host, Port)</p></td><td id="z3ehbu9_719"><p id="z3ehbu9_720">: Создает новые объекты в хранилище данных Faceplate, если объекты в принятом от PowerFactory json не найдены в хранилище данных Faceplate.</p><p id="z3ehbu9_721"><span class="control" id="z3ehbu9_746">Параметры:</span></p><p id="z3ehbu9_722">Params: Должен содержать структуру следующего вида:</p><p id="z3ehbu9_723">#{</p><p id="z3ehbu9_724"><code class="code" id="z3ehbu9_747"></code> &lt;&lt;&quot;study_case_name&quot;&gt;&gt; =&gt;</p><p id="z3ehbu9_725">&lt;&lt;&quot;Study Case&quot;&gt;&gt;,</p><p id="z3ehbu9_726"><code class="code" id="z3ehbu9_748"></code> &lt;&lt;&quot;session_type&quot;&gt;&gt;</p><p id="z3ehbu9_727">=&gt; &lt;&lt;&quot;calculation&quot;&gt;&gt;,</p><p id="z3ehbu9_728"><code class="code" id="z3ehbu9_749"></code> &lt;&lt;&quot;project_name&quot;&gt;&gt;</p><p id="z3ehbu9_729">=&gt; &lt;&lt;&quot;.MODEL_SCADA_V1107___DEMO(1)&quot;&gt;&gt;,</p><p id="z3ehbu9_730"><code class="code" id="z3ehbu9_750"></code> &lt;&lt;&quot;operation_scenario_name&quot;&gt;&gt;</p><p id="z3ehbu9_731">=&gt; &lt;&lt;&quot;dyn&quot;&gt;&gt;,</p><p id="z3ehbu9_732"><code class="code" id="z3ehbu9_751"></code> &lt;&lt;&quot;id&quot;&gt;&gt; =&gt; 1,</p><p id="z3ehbu9_733"><code class="code" id="z3ehbu9_752"></code> &lt;&lt;&quot;grid_name&quot;&gt;&gt;</p><p id="z3ehbu9_734">=&gt; &quot;Grid&quot;,</p><p id="z3ehbu9_735"><code class="code" id="z3ehbu9_753"></code> &lt;&lt;&quot;func_name&quot;&gt;&gt;</p><p id="z3ehbu9_736">=&gt; &quot;get&quot;</p><p id="z3ehbu9_737">},</p><p id="z3ehbu9_738">где &quot;func_name&quot; должно содержать имя функции, которая используется для формирования json, поле &quot;id&quot; должно содержать идентификатор текущего экземпляра faceplate, остальные поля должны содержать параметры проекта PowerFactory, который будет использоваться для расчетов.</p><p id="z3ehbu9_739">[OID]: Может содержать либо пустой erlang лист, либо OID передаваемого объекта.</p><p id="z3ehbu9_740">Host и Port: адрес и порт сервера, на котором должен быть запущен server.py.</p><p id="z3ehbu9_741"><span class="control" id="z3ehbu9_754">Возвращает</span>: Json-результат выполнения запроса.</p><p id="z3ehbu9_742"><span class="control" id="z3ehbu9_755">Пример использования:</span></p><p id="z3ehbu9_743">fp_powerfactory_service:pf_service_create_update(Params, [], &quot;127.0.0.1&quot;, 8080).</p><p id="z3ehbu9_744"><span class="control" id="z3ehbu9_756">Детали реализации</span>:</p><p id="z3ehbu9_745">Может использоваться для создания объектов в каталогах (например, для загрузки библиотеки базовых типов из PowerFactory).</p></td></tr><tr id="z3ehbu9_675"><td id="z3ehbu9_757"><p>pf_service_get_section(ts, funct)</p></td><td id="z3ehbu9_758"><p id="z3ehbu9_759">: предназначена для формирования так называемого &quot;среза&quot; данных. Срез данных представляет собой json, сформированный по принципам, описанным в п.6.1.</p><p id="z3ehbu9_760">Отличия заключается в том, что данные для формирования json извлекаются не из полей объектов Faceplate, а из соответствующих этим полям архивов.</p><p id="z3ehbu9_761"><span class="control" id="z3ehbu9_769">Параметры:</span></p><p id="z3ehbu9_762">ts: Определяет момент времени, для которого нужно получить данные.</p><p id="z3ehbu9_763">funct: Содержит название функции, которая используется для формирования json (см. п 6.1).</p><p id="z3ehbu9_764"><span class="control" id="z3ehbu9_770">Возвращает:</span><br> Json-объект с данными за указанный момент времени.</p><p id="z3ehbu9_765"><span class="control" id="z3ehbu9_772">Пример использования:</span></p><p id="z3ehbu9_766">fp_powerfactory_service:pf_service_get_section(1669387200, &quot;get_section&quot;).</p><p id="z3ehbu9_767"><span class="control" id="z3ehbu9_773">Детали реализации:</span></p><p id="z3ehbu9_768">Принципы формирования Json соответствуют описанию в п. 6.1, с той разницей, что данные извлекаются не из полей объектов Faceplate, а из архивов.</p></td></tr></tbody></table></div><p id="z3ehbu9_664"><span class="control" id="z3ehbu9_774">Общая информация</span></p><p id="z3ehbu9_665">Модуль fp_powerfactory_service предоставляет API для интеграции с PowerFactory. Его функциональность включает управление каталогами оборудования, вызов функций PowerFactory и обработку связанных данных. Код написан на языке Erlang и включает механизмы логирования и обработки ошибок.</p><div class="table-wrapper"><table class="wide" id="z3ehbu9_666"><thead><tr class="ijRowHead" id="z3ehbu9_775"><th id="z3ehbu9_785"><p><span class="control" id="z3ehbu9_787">Функция</span></p></th><th id="z3ehbu9_786"><p><span class="control" id="z3ehbu9_788">Описание</span></p></th></tr></thead><tbody><tr id="z3ehbu9_776"><td id="z3ehbu9_789"><p>on_init/0</p></td><td id="z3ehbu9_790"><p id="z3ehbu9_791">: Инициализирует модуль, добавляя JSON-API для взаимодействия с PowerFactory.</p><p id="z3ehbu9_792"><span class="control" id="z3ehbu9_796">Параметры</span>: Нет.</p><p id="z3ehbu9_793"><span class="control" id="z3ehbu9_797">Возвращает</span>: Атом ok при успешной инициализации.</p><p id="z3ehbu9_794"><span class="control" id="z3ehbu9_798">Пример использования</span>:</p><p id="z3ehbu9_795">fp_powerfactory_service_old:on_init().</p></td></tr><tr id="z3ehbu9_777"><td id="z3ehbu9_799"><p>power_factory_import_equipment_library/1</p></td><td id="z3ehbu9_800"><p id="z3ehbu9_801">: Импортирует библиотеку оборудования в PowerFactory.</p><p id="z3ehbu9_802"><span class="control" id="z3ehbu9_807">Параметры</span>:</p><p id="z3ehbu9_803">- {CatalogName, PFProjectParamsPath}: Кортеж, содержащий имя каталога и путь к параметрам проекта PowerFactory.</p><p id="z3ehbu9_804"><span class="control" id="z3ehbu9_808">Возвращает</span>: Результат выполнения функции.</p><p id="z3ehbu9_805"><span class="control" id="z3ehbu9_809">Пример использования</span>:</p><p id="z3ehbu9_806">fp_powerfactory_service_old:power_factory_import_equipment_library({&lt;&lt;&quot;CatalogName&quot;&gt;&gt;, &lt;&lt;&quot;/path/to/project/params&quot;&gt;&gt;}).</p></td></tr><tr id="z3ehbu9_778"><td id="z3ehbu9_810"><p>get_equipment_library_catalog/1</p></td><td id="z3ehbu9_811"><p id="z3ehbu9_812">: Возвращает идентификаторы содержимого и полей каталога оборудования.</p><p id="z3ehbu9_813"><span class="control" id="z3ehbu9_820">Параметры</span>:</p><p id="z3ehbu9_814">- CatalogName (binary): Имя каталога.</p><p id="z3ehbu9_815"><span class="control" id="z3ehbu9_821">Возвращает</span>:</p><p id="z3ehbu9_816">- {ContentOID, FieldsOID}: Кортеж с идентификаторами содержимого и полей каталога.</p><p id="z3ehbu9_817">- Выбрасывает исключение, если каталог не найден.</p><p id="z3ehbu9_818"><span class="control" id="z3ehbu9_822">Пример использования</span>:</p><p id="z3ehbu9_819">fp_powerfactory_service_old:get_equipment_library_catalog(&lt;&lt;&quot;CatalogName&quot;&gt;&gt;).</p></td></tr><tr id="z3ehbu9_779"><td id="z3ehbu9_823"><p>power_factory_call_function/1</p></td><td id="z3ehbu9_824"><p id="z3ehbu9_825">: Выполняет вызов функции PowerFactory.</p><p id="z3ehbu9_826"><span class="control" id="z3ehbu9_831">Параметры</span>:</p><p id="z3ehbu9_827">- {Context, PFProjectParamsPath, FunctionName}: Кортеж, содержащий контекст, путь к параметрам проекта и имя функции.</p><p id="z3ehbu9_828"><span class="control" id="z3ehbu9_832">Возвращает</span>: Результат вызова функции в формате HTTP-ответа.</p><p id="z3ehbu9_829"><span class="control" id="z3ehbu9_833">Пример использования</span>:</p><p id="z3ehbu9_830">fp_powerfactory_service_old:power_factory_call_function({Context, &lt;&lt;&quot;/path/to/params&quot;&gt;&gt;, &lt;&lt;&quot;function_name&quot;&gt;&gt;}).</p></td></tr><tr id="z3ehbu9_780"><td id="z3ehbu9_834"><p>power_factory_call_function_old/1</p></td><td id="z3ehbu9_835"><p id="z3ehbu9_836">: Устаревший метод вызова функции PowerFactory с дополнительным логированием.</p><p id="z3ehbu9_837"><span class="control" id="z3ehbu9_842">Параметры</span>:</p><p id="z3ehbu9_838">- {Context, PFProjectParamsPath, FunctionName}: Кортеж, содержащий контекст, путь к параметрам проекта и имя функции.</p><p id="z3ehbu9_839"><span class="control" id="z3ehbu9_843">Возвращает</span>: Результат вызова функции в формате HTTP-ответа.</p><p id="z3ehbu9_840"><span class="control" id="z3ehbu9_844">Пример использования</span>:</p><p id="z3ehbu9_841">fp_powerfactory_service_old:power_factory_call_function_old({Context, &lt;&lt;&quot;/path/to/params&quot;&gt;&gt;, &lt;&lt;&quot;function_name&quot;&gt;&gt;}).</p></td></tr><tr id="z3ehbu9_781"><td id="z3ehbu9_845"><p>get_pf_project_params/1</p></td><td id="z3ehbu9_846"><p id="z3ehbu9_847">: Возвращает параметры проекта PowerFactory.</p><p id="z3ehbu9_848"><span class="control" id="z3ehbu9_853">Параметры</span>:</p><p id="z3ehbu9_849">- PFProjectParamsPath (binary): Путь к параметрам проекта.</p><p id="z3ehbu9_850"><span class="control" id="z3ehbu9_854">Возвращает</span>: Словарь с параметрами проекта.</p><p id="z3ehbu9_851"><span class="control" id="z3ehbu9_855">Пример использования</span>:</p><p id="z3ehbu9_852">fp_powerfactory_service_old:get_pf_project_params(&lt;&lt;&quot;/path/to/project/params&quot;&gt;&gt;).</p></td></tr><tr id="z3ehbu9_782"><td id="z3ehbu9_856"><p>load_config/0</p></td><td id="z3ehbu9_857"><p id="z3ehbu9_858">: Загружает конфигурацию модуля из файла.</p><p id="z3ehbu9_859"><span class="control" id="z3ehbu9_864">Параметры</span>: Нет.</p><p id="z3ehbu9_860"><span class="control" id="z3ehbu9_865">Возвращает</span>: Словарь с конфигурацией.</p><p id="z3ehbu9_861"><span class="control" id="z3ehbu9_866">Пример использования</span>:</p><p id="z3ehbu9_862">Config = fp_powerfactory_service_old:load_config().</p><p id="z3ehbu9_863"></p></td></tr><tr id="z3ehbu9_783"><td id="z3ehbu9_867"><p>get_json/4</p></td><td id="z3ehbu9_868"><p id="z3ehbu9_869">: Формирует JSON-объект для передачи в PowerFactory.</p><p id="z3ehbu9_870"><span class="control" id="z3ehbu9_878">Параметры</span>:</p><p id="z3ehbu9_871">- Config (map): Конфигурация.</p><p id="z3ehbu9_872">- OIDsByElement (map): Сопоставление элементов и их идентификаторов.</p><p id="z3ehbu9_873">- PFFunc (binary): Имя функции PowerFactory.</p><p id="z3ehbu9_874">- PFProjectParams (map): Параметры проекта.</p><p id="z3ehbu9_875"><span class="control" id="z3ehbu9_879">Возвращает</span>: JSON-объект.</p><p id="z3ehbu9_876"><span class="control" id="z3ehbu9_880">Пример использования</span>:</p><p id="z3ehbu9_877">JSON = fp_powerfactory_service_old:get_json(Config, OIDsByElement, &lt;&lt;&quot;function_name&quot;&gt;&gt;, PFProjectParams).</p></td></tr><tr id="z3ehbu9_784"><td id="z3ehbu9_881"><p>http_send/4</p></td><td id="z3ehbu9_882"><p id="z3ehbu9_883">: Отправляет HTTP-запрос на сервер PowerFactory.</p><p id="z3ehbu9_884"><span class="control" id="z3ehbu9_892">Параметры</span>:</p><p id="z3ehbu9_885">- RemoteServiceParams (map): Параметры удалённого сервиса.</p><p id="z3ehbu9_886">- Path (binary): Путь запроса.</p><p id="z3ehbu9_887">- Data (binary): Тело запроса в формате JSON.</p><p id="z3ehbu9_888">- ResponseFun (fun): Функция для обработки ответа.</p><p id="z3ehbu9_889"><span class="control" id="z3ehbu9_893">Возвращает</span>: Результат выполнения запроса.</p><p id="z3ehbu9_890"><span class="control" id="z3ehbu9_894">Пример использования</span>:</p><p id="z3ehbu9_891">fp_powerfactory_service_old:http_send(RemoteServiceParams, &lt;&lt;&quot;api/path&quot;&gt;&gt;, Data, fun(Response) -&gt; io:format(&quot;~p&quot;, [Response]) end).</p></td></tr></tbody></table></div><p id="z3ehbu9_667"><span class="control" id="z3ehbu9_895">Примечания</span></p><ul class="list _bullet" id="z3ehbu9_668"><li class="list__item" id="z3ehbu9_896"><p id="z3ehbu9_899">Для корректной работы модуля необходимо наличие конфигурационного файла fp2pf_mapping.json.</p></li><li class="list__item" id="z3ehbu9_897"><p id="z3ehbu9_900">Все функции обеспечивают обработку ошибок и логирование через макросы ?LOGINFO, ?LOGWARNING и ?LOGERROR.</p></li><li class="list__item" id="z3ehbu9_898"><p id="z3ehbu9_901">Методы HTTP-запросов используют библиотеку httpc для взаимодействия с удалёнными сервисами.</p></li></ul></section><section class="chapter"><h2 id="fp-state-estimation-service" data-toc="fp-state-estimation-service"><a name=""></a><span class="control" id="z3ehbu9_911">Модуль fp_state_estimation_service</span></h2><p id="z3ehbu9_903">Сервис для оценки состояния (State Estimation, SE). Используется для вычисления текущего состояния системы, позволяя определять узкие места и потенциальные сбои в сети.</p><p id="z3ehbu9_904"><span class="control" id="z3ehbu9_912">Общая информация</span></p><p id="z3ehbu9_905">Модуль fp_state_estimation_service предназначен для управления процессом оценивания состояния (state estimation) в системе. Он реализует экспорт и импорт данных в формате JSON, настройку и запуск вспомогательных утилит, а также предоставляет функции взаимодействия с хранилищами данных.</p><p id="z3ehbu9_906">Этот модуль используется для интеграции системы управления с процессами анализа данных, включая передачу и обработку информации о параметрах узлов и линий, а также получение статистики работы системы.</p><div class="table-wrapper"><table class="wide" id="z3ehbu9_907"><thead><tr class="ijRowHead" id="z3ehbu9_913"><th id="z3ehbu9_922"><p><span class="control" id="z3ehbu9_924">Функция</span></p></th><th id="z3ehbu9_923"><p><span class="control" id="z3ehbu9_925">Описание</span></p></th></tr></thead><tbody><tr id="z3ehbu9_914"><td id="z3ehbu9_926"><p><span class="control" id="z3ehbu9_928">on_init/0</span></p></td><td id="z3ehbu9_927"><p id="z3ehbu9_929">: Инициализирует API для вызова функций модуля через JSON-запросы. Функция должна быть вызвана при запуске системы.</p><p id="z3ehbu9_930"><span class="control" id="z3ehbu9_935">Параметры</span>: Нет.</p><p id="z3ehbu9_931"><span class="control" id="z3ehbu9_936">Возвращает</span>:</p><p id="z3ehbu9_932">- ok &mdash; если инициализация завершилась успешно.</p><p id="z3ehbu9_933"><span class="control" id="z3ehbu9_937">Пример использования</span>:</p><p id="z3ehbu9_934">fp_state_estimation_service:on_init().</p></td></tr><tr id="z3ehbu9_915"><td id="z3ehbu9_938"><p><span class="control" id="z3ehbu9_940">export_json/1</span></p></td><td id="z3ehbu9_939"><p id="z3ehbu9_941">: Экспортирует данные системы в формате JSON, создавая файл для последующего анализа или передачи в другие модули.</p><p id="z3ehbu9_942"><span class="control" id="z3ehbu9_958">Параметры</span>:</p><p id="z3ehbu9_943">- {StartParams, AParams, CommonSettingsPath, SSEStatPath}:</p><p id="z3ehbu9_944">- StartParams &mdash; карта начальных параметров (например, временные диапазоны).</p><p id="z3ehbu9_945">- AParams &mdash; дополнительные параметры (например, настройки фильтров).</p><p id="z3ehbu9_946">- CommonSettingsPath &mdash; путь к объекту общих настроек.</p><p id="z3ehbu9_947">- SSEStatPath &mdash; путь к объекту статистики.</p><p id="z3ehbu9_948"><span class="control" id="z3ehbu9_959">Возвращает</span>:</p><p id="z3ehbu9_949">- ok &mdash; если экспорт выполнен успешно.</p><p id="z3ehbu9_950">- Логирует ошибку в случае сбоя при записи файла или при некорректных параметрах.</p><p id="z3ehbu9_951"><span class="control" id="z3ehbu9_960">Пример использования</span>:</p><p id="z3ehbu9_952">StartParams = #{&lt;&lt;&quot;start_time&quot;&gt;&gt; =&gt; &lt;&lt;&quot;2024-01-01T00:00:00&quot;&gt;&gt;, &lt;&lt;&quot;end_time&quot;&gt;&gt; =&gt; &lt;&lt;&quot;2024-01-01T12:00:00&quot;&gt;&gt;},</p><p id="z3ehbu9_953">AParams = #{&lt;&lt;&quot;region&quot;&gt;&gt; =&gt; &lt;&lt;&quot;North&quot;&gt;&gt;},</p><p id="z3ehbu9_954">CommonSettingsPath = &lt;&lt;&quot;/root/FP/PROJECT/settings/common&quot;&gt;&gt;,</p><p id="z3ehbu9_955">SSEStatPath = &lt;&lt;&quot;/root/FP/PROJECT/statistics/se_stats&quot;&gt;&gt;,</p><p id="z3ehbu9_956"></p><p id="z3ehbu9_957">fp_state_estimation_service:export_json({StartParams, AParams, CommonSettingsPath, SSEStatPath}).</p></td></tr><tr id="z3ehbu9_916"><td id="z3ehbu9_961"><p><span class="control" id="z3ehbu9_963">import_json/1</span></p></td><td id="z3ehbu9_962"><p id="z3ehbu9_964">: Импортирует данные из JSON-файла в храниище данных системы. Используется для обновления информации о параметрах узлов, линий и статистики.</p><p id="z3ehbu9_965"><span class="control" id="z3ehbu9_973">Параметры</span>:</p><p id="z3ehbu9_966">- SSEStatPath &mdash; путь к объекту статистики.</p><p id="z3ehbu9_967"><span class="control" id="z3ehbu9_974">Возвращает</span>:</p><p id="z3ehbu9_968">- ok &mdash; если импорт завершен успешно.</p><p id="z3ehbu9_969">- Логирует ошибки при сбоях.</p><p id="z3ehbu9_970"><span class="control" id="z3ehbu9_975">Пример использования</span>:</p><p id="z3ehbu9_971">SSEStatPath = &lt;&lt;&quot;/root/FP/PROJECT/statistics/se_stats&quot;&gt;&gt;,</p><p id="z3ehbu9_972">fp_state_estimation_service:import_json(SSEStatPath).</p></td></tr><tr id="z3ehbu9_917"><td id="z3ehbu9_976"><p><span class="control" id="z3ehbu9_978">run_se_util/1</span></p></td><td id="z3ehbu9_977"><p id="z3ehbu9_979">: Запускает утилиту для выполнения процессов state estimation.</p><p id="z3ehbu9_980"><span class="control" id="z3ehbu9_987">Параметры</span>:</p><p id="z3ehbu9_981">- _Arg &mdash; аргумент, зарезервированный для будущих реализаций (на текущий момент игнорируется).</p><p id="z3ehbu9_982"><span class="control" id="z3ehbu9_988">Возвращает</span>:</p><p id="z3ehbu9_983">- ok &mdash; если утилита выполнена успешно.</p><p id="z3ehbu9_984">- Логирует предупреждение, если путь к утилите не указан.</p><p id="z3ehbu9_985"><span class="control" id="z3ehbu9_989">Пример использования</span>:</p><p id="z3ehbu9_986">fp_state_estimation_service:run_se_util({}).</p></td></tr><tr id="z3ehbu9_918"><td id="z3ehbu9_990"><p><span class="control" id="z3ehbu9_992">run_se/1</span></p></td><td id="z3ehbu9_991"><p id="z3ehbu9_993">: Оркестрирует полный процесс запуска state estimation. Включает экспорт данных, запуск утилиты и последующий импорт результатов.</p><p id="z3ehbu9_994"><span class="control" id="z3ehbu9_1012">Параметры</span>:</p><p id="z3ehbu9_995">- {Path, StartParams, AParams, CommonSettingsPath, SSEStatPath}:</p><p id="z3ehbu9_996">- Path &mdash; путь к рабочему каталогу.</p><p id="z3ehbu9_997">- StartParams &mdash; начальные параметры.</p><p id="z3ehbu9_998">- AParams &mdash; дополнительные параметры.</p><p id="z3ehbu9_999">- CommonSettingsPath &mdash; путь к объекту настроек.</p><p id="z3ehbu9_1000">- SSEStatPath &mdash; путь к статистике.</p><p id="z3ehbu9_1001"><span class="control" id="z3ehbu9_1013">Возвращает</span>:</p><p id="z3ehbu9_1002">- ok &mdash; если весь процесс завершен успешно.</p><p id="z3ehbu9_1003">- Логирует ошибки при сбоях.</p><p id="z3ehbu9_1004"><span class="control" id="z3ehbu9_1014">Пример использования</span>:</p><p id="z3ehbu9_1005">Path = &lt;&lt;&quot;/home/master/forSE&quot;&gt;&gt;,</p><p id="z3ehbu9_1006">StartParams = #{&lt;&lt;&quot;start_time&quot;&gt;&gt; =&gt; &lt;&lt;&quot;2024-01-01T00:00:00&quot;&gt;&gt;},</p><p id="z3ehbu9_1007">AParams = #{&lt;&lt;&quot;region&quot;&gt;&gt; =&gt; &lt;&lt;&quot;East&quot;&gt;&gt;},</p><p id="z3ehbu9_1008">CommonSettingsPath = &lt;&lt;&quot;/root/FP/PROJECT/settings/common&quot;&gt;&gt;,</p><p id="z3ehbu9_1009">SSEStatPath = &lt;&lt;&quot;/root/FP/PROJECT/statistics/se_stats&quot;&gt;&gt;,</p><p id="z3ehbu9_1010"></p><p id="z3ehbu9_1011">fp_state_estimation_service:run_se({Path, StartParams, AParams, CommonSettingsPath, SSEStatPath}).</p></td></tr><tr id="z3ehbu9_919"><td id="z3ehbu9_1015"><p><span class="control" id="z3ehbu9_1017">load_config/0</span></p></td><td id="z3ehbu9_1016"><p id="z3ehbu9_1018">: Загружает конфигурацию из JSON-файла state_estimation_settings.jsonc.</p><p id="z3ehbu9_1019"><span class="control" id="z3ehbu9_1021">Пример использования</span>:</p><p id="z3ehbu9_1020">Config = fp_state_estimation_service:load_config().</p></td></tr><tr id="z3ehbu9_920"><td id="z3ehbu9_1022"><p><span class="control" id="z3ehbu9_1024">get_absolute_path/1</span></p></td><td id="z3ehbu9_1023"><p id="z3ehbu9_1025">: Возвращает абсолютный путь к указанному файлу.</p><p id="z3ehbu9_1026"><span class="control" id="z3ehbu9_1028">Пример использования</span>:</p><p id="z3ehbu9_1027">AbsPath = fp_state_estimation_service:get_absolute_path(&lt;&lt;&quot;settings.jsonc&quot;&gt;&gt;).</p></td></tr><tr id="z3ehbu9_921"><td id="z3ehbu9_1029"><p><span class="control" id="z3ehbu9_1031">load_mapping/1</span></p></td><td id="z3ehbu9_1030"><p id="z3ehbu9_1032">: Загружает настройки маппинга из файла.</p><p id="z3ehbu9_1033"><span class="control" id="z3ehbu9_1036">Пример использования</span>:</p><p id="z3ehbu9_1034">Mapping = fp_state_estimation_service:load_mapping(&lt;&lt;&quot;mapping.jsonc&quot;&gt;&gt;).</p><p id="z3ehbu9_1035"></p></td></tr></tbody></table></div><p id="z3ehbu9_908"><span class="control" id="z3ehbu9_1037">Примечания</span></p><ul class="list _bullet" id="z3ehbu9_909"><li class="list__item" id="z3ehbu9_1038"><p id="z3ehbu9_1042">Модуль интегрируется с внутренним хранилищем данных через протоколы, реализованные в платформе Faceplate.</p></li><li class="list__item" id="z3ehbu9_1039"><p id="z3ehbu9_1043">Все операции, связанные с чтением и записью, происходят транзакционно. В случае ошибки или сбоя транзакция откатывается.</p></li><li class="list__item" id="z3ehbu9_1040"><p id="z3ehbu9_1044">Для экспорта и импорта данных используются маппинг-файлы, описывающие соответствие структур данных системы и JSON.</p></li><li class="list__item" id="z3ehbu9_1041"><p id="z3ehbu9_1045">Перед использованием функций run_se или run_se_util необходимо убедиться, что конфигурационные файлы и утилиты доступны.</p></li></ul></section><section class="chapter"><h2 id="string-replace" data-toc="string-replace"><a name=""></a><span class="control" id="z3ehbu9_1063">Модуль string_replace</span></h2><p id="z3ehbu9_1047">Модуль для работы с текстовыми данными. Включает функции поиска и замены текста, что полезно для обработки текстовой информации в системе.</p><p id="z3ehbu9_1048"><span class="control" id="z3ehbu9_1064">Общая информация</span></p><p id="z3ehbu9_1049">Модуль string_replace предназначен для выполнения замены подстрок в строках объектов хранилища данных. Замена производится рекурсивно по заданным шаблонам и паттернам. Основная цель модуля &mdash; автоматизация обновления строк с использованием хранилища данных fp_db.</p><div class="table-wrapper"><table class="wide" id="z3ehbu9_1050"><thead><tr class="ijRowHead" id="z3ehbu9_1065"><th id="z3ehbu9_1069"><p><span class="control" id="z3ehbu9_1071">Функция</span></p></th><th id="z3ehbu9_1070"><p><span class="control" id="z3ehbu9_1072">Описание</span></p></th></tr></thead><tbody><tr id="z3ehbu9_1066"><td id="z3ehbu9_1073"><p><span class="control" id="z3ehbu9_1075">replace_in_strings/2</span></p></td><td id="z3ehbu9_1074"><p id="z3ehbu9_1076">: Производит замену всех вхождений строки ?SEARCH_STR на ?REPLACE_STR для объектов, соответствующих заданным корню и паттерну.</p><p id="z3ehbu9_1077"><span class="control" id="z3ehbu9_1092">Параметры</span>:</p><p id="z3ehbu9_1078">- Root (binary) &mdash; корневая папка, в пределах которой ищутся объекты для обработки.</p><p id="z3ehbu9_1079">- Pattern (binary) &mdash; паттерн объектов, указывающий на их прототип.</p><p id="z3ehbu9_1080"><span class="control" id="z3ehbu9_1093">Возвращает</span>:</p><p id="z3ehbu9_1081">- NewContent (list) &mdash; список объектов с обновленными строками.</p><p id="z3ehbu9_1082"><span class="control" id="z3ehbu9_1094">Детали реализации</span>:</p><p id="z3ehbu9_1083">- Из хранилища данных fp_db выбираются объекты, соответствующие указанным Root и Pattern.</p><p id="z3ehbu9_1084">- Для каждого объекта производится проверка наличия строки ?SEARCH_STR в поле screen.</p><p id="z3ehbu9_1085">- Если строка найдена, она заменяется на ?REPLACE_STR. Изменение сохраняется в хранилище данных.</p><p id="z3ehbu9_1086">- Если строка не содержит ?SEARCH_STR, объект остается неизменным.</p><p id="z3ehbu9_1087"><span class="control" id="z3ehbu9_1095">Пример использования</span>:</p><p id="z3ehbu9_1088">% Выполнение замены строк в объектах с прототипом &quot;/root/FP/prototypes/substation/fields&quot; в папке &quot;KAZ/UZHNIY&quot;.</p><p id="z3ehbu9_1089">Root = &lt;&lt;&quot;KAZ/UZHNIY&quot;&gt;&gt;,</p><p id="z3ehbu9_1090">Pattern = &lt;&lt;&quot;/root/FP/prototypes/substation/fields&quot;&gt;&gt;,</p><p id="z3ehbu9_1091">string_replace:replace_in_strings(Root, Pattern).</p></td></tr><tr id="z3ehbu9_1067"><td id="z3ehbu9_1096"><p><span class="control" id="z3ehbu9_1098">replace/2</span></p></td><td id="z3ehbu9_1097"><p id="z3ehbu9_1099">: Выполняет замену строки ?SEARCH_STR на ?REPLACE_STR в заданном объекте.</p><p id="z3ehbu9_1100"><span class="control" id="z3ehbu9_1116">Параметры</span>:</p><p id="z3ehbu9_1101">- OID &mdash; идентификатор объекта.</p><p id="z3ehbu9_1102">- String &mdash; строка, в которой выполняется поиск и замена.</p><p id="z3ehbu9_1103"><span class="control" id="z3ehbu9_1117">Возвращает</span>:</p><p id="z3ehbu9_1104">- Если замена произведена, функция возвращает новую строку с замененными подстроками.</p><p id="z3ehbu9_1105">- Если строка не содержит ?SEARCH_STR, возвращается исходная строка.</p><p id="z3ehbu9_1106"><span class="control" id="z3ehbu9_1118">Детали реализации</span>:</p><p id="z3ehbu9_1107">- Проверяется, содержит ли строка ?SEARCH_STR с помощью binary:matches.</p><p id="z3ehbu9_1108">- Если вхождение найдено:</p><p id="z3ehbu9_1109">1) Производится замена всех вхождений на ?REPLACE_STR с помощью binary:replace\.</p><p id="z3ehbu9_1110">2) Обновленная строка записывается обратно в объект через fp_db:edit_object\.</p><p id="z3ehbu9_1111">- Если вхождений нет, строка остается без изменений.</p><p id="z3ehbu9_1112"><span class="control" id="z3ehbu9_1119">Пример использования</span>:</p><p id="z3ehbu9_1113">OID = fp_db:to_oid(&lt;&lt;&quot;example_oid&quot;&gt;&gt;),</p><p id="z3ehbu9_1114">String = &lt;&lt;&quot;This is a lib.update_line example&quot;&gt;&gt;,</p><p id="z3ehbu9_1115">string_replace:replace(OID, String).</p></td></tr><tr id="z3ehbu9_1068"><td id="z3ehbu9_1120"><p><span class="control" id="z3ehbu9_1122">replace_in_string/1</span></p></td><td id="z3ehbu9_1121"><p id="z3ehbu9_1123">: Обрабатывает строки, проверяя их на наличие подстроки ?SEARCH_STR. В случае наличия выполняет замену, используя функцию replace/2.</p><p id="z3ehbu9_1124"><span class="control" id="z3ehbu9_1130">Параметры</span>:</p><p id="z3ehbu9_1125">- [OID, String] &mdash; список, содержащий идентификатор объекта и строку для обработки.</p><p id="z3ehbu9_1126"><span class="control" id="z3ehbu9_1131">Возвращает</span>:</p><p id="z3ehbu9_1127">- Обновленный список [OID, NewString], где NewString &mdash; результат замены.</p><p id="z3ehbu9_1128"><span class="control" id="z3ehbu9_1132">Пример использования</span>:</p><p id="z3ehbu9_1129">replace_in_string([OID, &lt;&lt;&quot;lib.update_line example&quot;&gt;&gt;]).</p></td></tr></tbody></table></div><p id="z3ehbu9_1051"><span class="control" id="z3ehbu9_1133">Пример использования модуля:</span></p><p id="z3ehbu9_1052">% Устанавливаем константы для поиска и замены</p><p id="z3ehbu9_1053">-define(SEARCH_STR, &quot;lib.update_line&quot;).</p><p id="z3ehbu9_1054">-define(REPLACE_STR, &quot;lib.updateNode&quot;).</p><p id="z3ehbu9_1055">% Задаем корень и паттерн</p><p id="z3ehbu9_1056">Root = &lt;&lt;&quot;KAZ/UZHNIY&quot;&gt;&gt;,</p><p id="z3ehbu9_1057">Pattern = &lt;&lt;&quot;/root/FP/prototypes/substation/fields&quot;&gt;&gt;,</p><p id="z3ehbu9_1058">% Запускаем процесс замены</p><p id="z3ehbu9_1059">string_replace:replace_in_strings(Root, Pattern).</p><p id="z3ehbu9_1060"><span class="control" id="z3ehbu9_1134">Вывод:</span></p><ul class="list _bullet" id="z3ehbu9_1061"><li class="list__item" id="z3ehbu9_1135"><p id="z3ehbu9_1140">Если совпадение найдено:</p><p id="z3ehbu9_1141">Замена произведена: /path/to/object</p></li><li class="list__item" id="z3ehbu9_1136"><p id="z3ehbu9_1142">Если совпадений не найдено:</p><p id="z3ehbu9_1143">Совпадение не найдено в строке объекта /path/to/object</p><p id="z3ehbu9_1144"><span class="control" id="z3ehbu9_1145">Примечания</span></p></li><li class="list__item" id="z3ehbu9_1137"><p id="z3ehbu9_1146">Константы:</p><ol class="list _decimal" id="z3ehbu9_1147" type="1"><li class="list__item" id="z3ehbu9_1148"><p id="z3ehbu9_1150">?SEARCH_STR &mdash; строка, которую необходимо заменить\.</p></li><li class="list__item" id="z3ehbu9_1149"><p id="z3ehbu9_1151">?REPLACE_STR &mdash; строка, на которую выполняется замена\.</p></li></ol></li><li class="list__item" id="z3ehbu9_1138"><p id="z3ehbu9_1152">Поддерживается обработка строк, заданных в бинарном формате.</p></li><li class="list__item" id="z3ehbu9_1139"><p id="z3ehbu9_1153">Логирование результатов замены осуществляется через io:format.</p></li></ul></section><section class="chapter"><h2 id="model-service-v2" data-toc="model-service-v2"><a name=""></a><span class="control" id="z3ehbu9_1170">Модуль model_service_v2</span></h2><p id="z3ehbu9_1155">Новая версия сервиса для работы с моделями. Поддерживает управление несколькими архивами, а также интеграцию данных о погоде, предоставляя более широкие аналитические возможности.</p><p id="z3ehbu9_1156"><span class="control" id="z3ehbu9_1171">Общая информация</span></p><p id="z3ehbu9_1157">Модуль model_service_v2 предназначен для выполнения заданий, связанных с обработкой данных моделей. Он предоставляет функционал для:</p><ul class="list _bullet" id="z3ehbu9_1158"><li class="list__item" id="z3ehbu9_1172"><p id="z3ehbu9_1175">Чтения данных из хранилища.</p></li><li class="list__item" id="z3ehbu9_1173"><p id="z3ehbu9_1176">Обработки данных с использованием внешних сервисов.</p></li><li class="list__item" id="z3ehbu9_1174"><p id="z3ehbu9_1177">Записи обработанных данных обратно в хранилище.</p><p id="z3ehbu9_1178">Основной поток выполнения состоит из:</p></li></ul><ol class="list _decimal" id="z3ehbu9_1159" type="1"><li class="list__item" id="z3ehbu9_1179"><p id="z3ehbu9_1183">Подготовки данных для задачи.</p></li><li class="list__item" id="z3ehbu9_1180"><p id="z3ehbu9_1184">Отправки данных на удалённый сервис.</p></li><li class="list__item" id="z3ehbu9_1181"><p id="z3ehbu9_1185">Обработки ответа от сервиса.</p></li><li class="list__item" id="z3ehbu9_1182"><p id="z3ehbu9_1186">Записи результата в хранилище данных.</p></li></ol><div class="table-wrapper"><table class="wide" id="z3ehbu9_1160"><thead><tr class="ijRowHead" id="z3ehbu9_1187"><th id="z3ehbu9_1193"><p><span class="control" id="z3ehbu9_1195">Функция</span></p></th><th id="z3ehbu9_1194"><p><span class="control" id="z3ehbu9_1196">Описание</span></p></th></tr></thead><tbody><tr id="z3ehbu9_1188"><td id="z3ehbu9_1197"><p><span class="control" id="z3ehbu9_1199">run_task/1</span></p></td><td id="z3ehbu9_1198"><p id="z3ehbu9_1200">: Основная функция, запускающая выполнение задачи для указанного объекта. Производит полный цикл обработки: чтение, вызов внешнего сервиса и запись результата.</p><p id="z3ehbu9_1201"><span class="control" id="z3ehbu9_1216">Параметры</span>:</p><p id="z3ehbu9_1202">- Obj (OID объекта) &mdash; объект, для которого выполняется задача.</p><p id="z3ehbu9_1203"><span class="control" id="z3ehbu9_1217">Возвращает</span>:</p><p id="z3ehbu9_1204">- ok &mdash; при успешном выполнении.</p><p id="z3ehbu9_1205">- {error, Reason} &mdash; при возникновении ошибки.</p><p id="z3ehbu9_1206"><span class="control" id="z3ehbu9_1218">Детали реализации</span>:</p><p id="z3ehbu9_1207">- Считываются поля объекта, необходимые для выполнения задачи.</p><p id="z3ehbu9_1208">- Формируется набор временных меток для чтения данных из архива.</p><p id="z3ehbu9_1209">- Собирается JSON-запрос для внешнего сервиса.</p><p id="z3ehbu9_1210">- Выполняется HTTP-запрос на внешний сервис с заданными данными.</p><p id="z3ehbu9_1211">- Обрабатывается ответ от сервиса и записывается результат в хранилище данных.</p><p id="z3ehbu9_1212"><span class="control" id="z3ehbu9_1219">Пример использования</span>:</p><p id="z3ehbu9_1213">Obj = fp_db:to_oid(&lt;&lt;&quot;object_path&quot;&gt;&gt;),</p><p id="z3ehbu9_1214">model_service_v2:run_task(Obj).</p><p id="z3ehbu9_1215"></p></td></tr><tr id="z3ehbu9_1189"><td id="z3ehbu9_1220"><p><span class="control" id="z3ehbu9_1222">call/2</span></p></td><td id="z3ehbu9_1221"><p id="z3ehbu9_1223">: Функция для выполнения HTTP-запроса на внешний сервис.</p><p id="z3ehbu9_1224"><span class="control" id="z3ehbu9_1234">Параметры</span>:</p><p id="z3ehbu9_1225">- Url (binary) &mdash; URL сервиса.</p><p id="z3ehbu9_1226">- DataMap (map) &mdash; данные, отправляемые в теле запроса.</p><p id="z3ehbu9_1227"><span class="control" id="z3ehbu9_1235">Возвращает</span>:</p><p id="z3ehbu9_1228">- {ok, Response} &mdash; успешный ответ от сервиса.</p><p id="z3ehbu9_1229">- {error, Reason} &mdash; ошибка при выполнении запроса.</p><p id="z3ehbu9_1230"><span class="control" id="z3ehbu9_1236">Пример использования</span>:</p><p id="z3ehbu9_1231">Url = &lt;&lt;&quot;http://127.0.0.1:8000/predict&quot;&gt;&gt;,</p><p id="z3ehbu9_1232">Data = #{&lt;&lt;&quot;task_id&quot;&gt;&gt; =&gt; &lt;&lt;&quot;123&quot;&gt;&gt;, &lt;&lt;&quot;task_input&quot;&gt;&gt; =&gt; Dataset},</p><p id="z3ehbu9_1233">model_service_v2:call(Url, Data).</p></td></tr><tr id="z3ehbu9_1190"><td id="z3ehbu9_1237"><p><span class="control" id="z3ehbu9_1239">read_from_db/3</span></p></td><td id="z3ehbu9_1238"><p id="z3ehbu9_1240">: Считывает данные из архива за указанный временной диапазон.</p><p id="z3ehbu9_1241"><span class="control" id="z3ehbu9_1253">Параметры</span>:</p><p id="z3ehbu9_1242">- InputWindow (integer) &mdash; количество временных меток для чтения.</p><p id="z3ehbu9_1243">- Step (integer) &mdash; шаг между временными метками (в миллисекундах).</p><p id="z3ehbu9_1244">- Archive (OID) &mdash; архив, из которого считываются данные.</p><p id="z3ehbu9_1245"><span class="control" id="z3ehbu9_1254">Возвращает</span>:</p><p id="z3ehbu9_1246">- Data (list) &mdash; список считанных данных.</p><p id="z3ehbu9_1247">- {error, Reason} &mdash; в случае ошибки.</p><p id="z3ehbu9_1248"><span class="control" id="z3ehbu9_1255">Пример использования</span>:</p><p id="z3ehbu9_1249">InputWindow = 24,</p><p id="z3ehbu9_1250">Step = 3600000, % 1 час</p><p id="z3ehbu9_1251">Archive = fp_db:to_oid(&lt;&lt;&quot;archive_path&quot;&gt;&gt;),</p><p id="z3ehbu9_1252">model_service_v2:read_from_db(InputWindow, Step, Archive).</p></td></tr><tr id="z3ehbu9_1191"><td id="z3ehbu9_1256"><p><span class="control" id="z3ehbu9_1258">write_to_db/2</span></p></td><td id="z3ehbu9_1257"><p id="z3ehbu9_1259">: Записывает данные в архив.</p><p id="z3ehbu9_1260"><span class="control" id="z3ehbu9_1270">Параметры</span>:</p><p id="z3ehbu9_1261">- Data (list) &mdash; данные для записи.</p><p id="z3ehbu9_1262">- Archive (OID) &mdash; архив для записи данных.</p><p id="z3ehbu9_1263"><span class="control" id="z3ehbu9_1271">Возвращает</span>:</p><p id="z3ehbu9_1264">- {ok, From, To} &mdash; диапазон временных меток записанных данных.</p><p id="z3ehbu9_1265">- {error, Reason} &mdash; ошибка при записи данных.</p><p id="z3ehbu9_1266"><span class="control" id="z3ehbu9_1272">Пример использования</span>:</p><p id="z3ehbu9_1267">Data = [{1669905600000, 1.23}, {1669909200000, 1.45}],</p><p id="z3ehbu9_1268">Archive = fp_db:to_oid(&lt;&lt;&quot;archive_path&quot;&gt;&gt;),</p><p id="z3ehbu9_1269">model_service_v2:write_to_db(Data, Archive).</p></td></tr><tr id="z3ehbu9_1192"><td id="z3ehbu9_1273"><p><span class="control" id="z3ehbu9_1275">transform/1</span></p></td><td id="z3ehbu9_1274"><p id="z3ehbu9_1276">: Трансформирует данные в формат, подходящий для записи.</p><p id="z3ehbu9_1277"><span class="control" id="z3ehbu9_1285">Параметры</span>:</p><p id="z3ehbu9_1278">- Data (list) &mdash; входные данные.</p><p id="z3ehbu9_1279"><span class="control" id="z3ehbu9_1286">Возвращает</span>:</p><p id="z3ehbu9_1280">- {ok, TransformedData} &mdash; успешная трансформация.</p><p id="z3ehbu9_1281">- {error, Reason} &mdash; ошибка трансформации.</p><p id="z3ehbu9_1282"><span class="control" id="z3ehbu9_1287">Пример использования</span>:</p><p id="z3ehbu9_1283">Data = [[1669905600, 1.23], [1669909200, 1.45]],</p><p id="z3ehbu9_1284">model_service_v2:transform(Data).</p></td></tr></tbody></table></div><p id="z3ehbu9_1161"><span class="control" id="z3ehbu9_1288">Пример использования модуля:</span></p><p id="z3ehbu9_1162">% Устанавливаем объект</p><p id="z3ehbu9_1163">Obj = fp_db:to_oid(&lt;&lt;&quot;object_path&quot;&gt;&gt;),</p><p id="z3ehbu9_1164">% Запускаем выполнение задачи</p><p id="z3ehbu9_1165">model_service_v2:run_task(Obj).</p><p id="z3ehbu9_1166"><span class="control" id="z3ehbu9_1289">Ожидаемый вывод в логах:</span></p><ol class="list _decimal" id="z3ehbu9_1167" type="1"><li class="list__item" id="z3ehbu9_1290"><p id="z3ehbu9_1294">Информация о начале задачи:</p><p id="z3ehbu9_1295">model_service: Run the task...</p></li><li class="list__item" id="z3ehbu9_1291"><p id="z3ehbu9_1296">Успешное чтение данных:</p><p id="z3ehbu9_1297">model_service: read the object: #{&lt;&lt;&quot;model_state&quot;&gt;&gt; =&gt; &lt;&lt;&quot;active&quot;&gt;&gt;, ...}</p></li><li class="list__item" id="z3ehbu9_1292"><p id="z3ehbu9_1298">Успешный вызов внешнего сервиса:</p><p id="z3ehbu9_1299">Response #{&lt;&lt;&quot;task_output&quot;&gt;&gt; =&gt; [[1669905600, 1.23], [1669909200, 1.45]]}</p></li><li class="list__item" id="z3ehbu9_1293"><p id="z3ehbu9_1300">Успешная запись данных:</p><p id="z3ehbu9_1301">Data successfully written to archive: &lt;&lt;&quot;archive_path&quot;&gt;&gt;</p><p id="z3ehbu9_1302"><span class="control" id="z3ehbu9_1303">Примечания</span></p></li></ol><ul class="list _bullet" id="z3ehbu9_1168"><li class="list__item" id="z3ehbu9_1304"><p id="z3ehbu9_1307">Взаимодействие с внешним сервисом:</p><ol class="list _decimal" id="z3ehbu9_1308" type="1"><li class="list__item" id="z3ehbu9_1309"><p id="z3ehbu9_1311">URL сервиса формируется на основе хоста и порта\.</p></li><li class="list__item" id="z3ehbu9_1310"><p id="z3ehbu9_1312">Отправка данных осуществляется через HTTP POST запрос с JSON-телом\.</p></li></ol></li><li class="list__item" id="z3ehbu9_1305"><p id="z3ehbu9_1313">Логирование:</p><ol class="list _decimal" id="z3ehbu9_1314" type="1"><li class="list__item" id="z3ehbu9_1315"><p id="z3ehbu9_1316">Все ключевые шаги процесса логируются с использованием макросов ?LOGINFO, ?LOGWARNING и ?LOGERROR\.</p></li></ol></li><li class="list__item" id="z3ehbu9_1306"><p id="z3ehbu9_1317">Обработка ошибок:</p><p id="z3ehbu9_1318">1)Если выполнение задачи прерывается на любом этапе, функция возвращает описание ошибки.</p></li></ul></section><section class="chapter"><h2 id="rest-api-client-v1-0" data-toc="rest-api-client-v1-0"><a name=""></a><span class="control" id="z3ehbu9_1351">Модуль rest_api_client (v1.0)</span></h2><p id="z3ehbu9_1320">Клиент REST API для обмена данными с системой рынка баланса. Поддерживает запросы на сервер по протоколу REST и позволяет интегрировать данные с внешними REST API.</p><p id="z3ehbu9_1321"><span class="control" id="z3ehbu9_1352">Общая информация</span></p><p id="z3ehbu9_1322">Модуль rest_api_client предназначен для выполнения HTTP-запросов к REST API, включая:</p><ol class="list _decimal" id="z3ehbu9_1323" type="1"><li class="list__item" id="z3ehbu9_1353"><p id="z3ehbu9_1355">Получение токена для авторизации.</p></li><li class="list__item" id="z3ehbu9_1354"><p id="z3ehbu9_1356">Выполнение запросов с использованием токена.</p></li></ol><div class="table-wrapper"><table class="wide" id="z3ehbu9_1324"><thead><tr class="ijRowHead" id="z3ehbu9_1357"><th id="z3ehbu9_1361"><p><span class="control" id="z3ehbu9_1363">Функция</span></p></th><th id="z3ehbu9_1362"><p><span class="control" id="z3ehbu9_1364">Описание</span></p></th></tr></thead><tbody><tr id="z3ehbu9_1358"><td id="z3ehbu9_1365"><p><span class="control" id="z3ehbu9_1367">get_token/2</span></p></td><td id="z3ehbu9_1366"><p id="z3ehbu9_1368">: Получает токен для авторизации по указанному URL и телу запроса.</p><p id="z3ehbu9_1369"><span class="control" id="z3ehbu9_1384">Параметры</span>:</p><p id="z3ehbu9_1370">- TokenUrl (binary) &mdash; URL для получения токена.</p><p id="z3ehbu9_1371">- RequestBody (map) &mdash; тело запроса с данными для авторизации.</p><p id="z3ehbu9_1372"><span class="control" id="z3ehbu9_1385">Возвращает</span>:</p><p id="z3ehbu9_1373">- {ok, Token} &mdash; если токен успешно получен.</p><p id="z3ehbu9_1374">- {error, no_token_in_response} &mdash; если токен отсутствует в ответе.</p><p id="z3ehbu9_1375">- {error, Reason} &mdash; если произошла ошибка во время выполнения запроса.</p><p id="z3ehbu9_1376"><span class="control" id="z3ehbu9_1386">Детали реализации</span>:</p><p id="z3ehbu9_1377">- Формирует тело запроса в формате JSON.</p><p id="z3ehbu9_1378">- Выполняет POST-запрос на указанный URL.</p><p id="z3ehbu9_1379">- Декодирует ответ и извлекает токен.</p><p id="z3ehbu9_1380"><span class="control" id="z3ehbu9_1387">Пример использования</span>:</p><p id="z3ehbu9_1381">TokenUrl = &lt;&lt;&quot;http://api.example.com/auth/token&quot;&gt;&gt;,</p><p id="z3ehbu9_1382">RequestBody = #{&lt;&lt;&quot;username&quot;&gt;&gt; =&gt; &lt;&lt;&quot;user&quot;&gt;&gt;, &lt;&lt;&quot;password&quot;&gt;&gt; =&gt; &lt;&lt;&quot;pass&quot;&gt;&gt;},</p><p id="z3ehbu9_1383">rest_api_client:get_token(TokenUrl, RequestBody).</p></td></tr><tr id="z3ehbu9_1359"><td id="z3ehbu9_1388"><p><span class="control" id="z3ehbu9_1390">make_request/4</span></p></td><td id="z3ehbu9_1389"><p id="z3ehbu9_1391">: Выполняет HTTP-запрос с использованием токена авторизации.</p><p id="z3ehbu9_1392"><span class="control" id="z3ehbu9_1411">Параметры</span>:</p><p id="z3ehbu9_1393">- Token (binary) &mdash; токен для авторизации.</p><p id="z3ehbu9_1394">- Method (atom) &mdash; HTTP-метод (get, post, put, delete).</p><p id="z3ehbu9_1395">- Url (binary) &mdash; URL для выполнения запроса.</p><p id="z3ehbu9_1396">- Body (map) &mdash; тело запроса.</p><p id="z3ehbu9_1397"><span class="control" id="z3ehbu9_1412">Возвращает</span>:</p><p id="z3ehbu9_1398">- {ok, Response} &mdash; успешный ответ с декодированными данными.</p><p id="z3ehbu9_1399">- {error, {unexpected_status, Code}} &mdash; неожиданный статус-код.</p><p id="z3ehbu9_1400">- {error, Reason} &mdash; ошибка при выполнении запроса.</p><p id="z3ehbu9_1401"><span class="control" id="z3ehbu9_1413">Детали реализации</span>:</p><p id="z3ehbu9_1402">- Кодирует тело запроса в формат JSON.</p><p id="z3ehbu9_1403">- Формирует HTTP-запрос с заголовками, включая Authorization.</p><p id="z3ehbu9_1404">- Выполняет запрос и обрабатывает результат.</p><p id="z3ehbu9_1405"><span class="control" id="z3ehbu9_1414">Пример использования</span>:</p><p id="z3ehbu9_1406">Token = &lt;&lt;&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9&quot;&gt;&gt;,</p><p id="z3ehbu9_1407">Method = post,</p><p id="z3ehbu9_1408">Url = &lt;&lt;&quot;http://api.example.com/data&quot;&gt;&gt;,</p><p id="z3ehbu9_1409">Body = #{&lt;&lt;&quot;key&quot;&gt;&gt; =&gt; &lt;&lt;&quot;value&quot;&gt;&gt;},</p><p id="z3ehbu9_1410">rest_api_client:make_request(Token, Method, Url, Body).</p></td></tr><tr id="z3ehbu9_1360"><td id="z3ehbu9_1415"><p><span class="control" id="z3ehbu9_1417">get_url/3</span></p></td><td id="z3ehbu9_1416"><p id="z3ehbu9_1418">: Формирует URL для выполнения запросов.</p><p id="z3ehbu9_1419"><span class="control" id="z3ehbu9_1430">Параметры</span>:</p><p id="z3ehbu9_1420">- Host (binary) &mdash; адрес хоста.</p><p id="z3ehbu9_1421">- Port (binary) &mdash; порт хоста.</p><p id="z3ehbu9_1422">- URL (binary) &mdash; конечная точка.</p><p id="z3ehbu9_1423"><span class="control" id="z3ehbu9_1431">Возвращает</span>:</p><p id="z3ehbu9_1424">- Сформированный URL (binary).</p><p id="z3ehbu9_1425"><span class="control" id="z3ehbu9_1432">Пример использования</span>:</p><p id="z3ehbu9_1426">Host = &lt;&lt;&quot;127.0.0.1&quot;&gt;&gt;,</p><p id="z3ehbu9_1427">Port = &lt;&lt;&quot;8080&quot;&gt;&gt;,</p><p id="z3ehbu9_1428">Path = &lt;&lt;&quot;api/resource&quot;&gt;&gt;,</p><p id="z3ehbu9_1429">rest_api_client:get_url(Host, Port, Path).</p></td></tr></tbody></table></div><p id="z3ehbu9_1325"><span class="control" id="z3ehbu9_1433">Примеры использования модуля.</span></p><p id="z3ehbu9_1326"><span class="control" id="z3ehbu9_1434">Пример 1: Получение токена</span></p><p id="z3ehbu9_1327">TokenUrl = &lt;&lt;&quot;http://auth.example.com/token&quot;&gt;&gt;,</p><p id="z3ehbu9_1328">RequestBody = #{&lt;&lt;&quot;username&quot;&gt;&gt; =&gt; &lt;&lt;&quot;admin&quot;&gt;&gt;, &lt;&lt;&quot;password&quot;&gt;&gt; =&gt; &lt;&lt;&quot;secret&quot;&gt;&gt;},</p><p id="z3ehbu9_1329">case rest_api_client:get_token(TokenUrl, RequestBody) of</p><p id="z3ehbu9_1330"><code class="code" id="z3ehbu9_1435"></code> {ok, Token} -&gt; io:format(&quot;Token received: <span id="z3ehbu9_1436"><sub class="subscript">p</sub></span>n&quot;, [Token]);</p><p id="z3ehbu9_1331"><code class="code" id="z3ehbu9_1437"></code> {error, Reason} -&gt; io:format(&quot;Failed to get token: <span id="z3ehbu9_1438"><sub class="subscript">p</sub></span>n&quot;, [Reason])</p><p id="z3ehbu9_1332">end.</p><p id="z3ehbu9_1333"><span class="control" id="z3ehbu9_1439">Пример 2: Выполнение запроса с токеном</span></p><p id="z3ehbu9_1334">Token = &lt;&lt;&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9&quot;&gt;&gt;,</p><p id="z3ehbu9_1335">Method = post,</p><p id="z3ehbu9_1336">Url = &lt;&lt;&quot;http://api.example.com/resource&quot;&gt;&gt;,</p><p id="z3ehbu9_1337">Body = #{&lt;&lt;&quot;param1&quot;&gt;&gt; =&gt; &lt;&lt;&quot;value1&quot;&gt;&gt;, &lt;&lt;&quot;param2&quot;&gt;&gt; =&gt; &lt;&lt;&quot;value2&quot;&gt;&gt;},</p><p id="z3ehbu9_1338">case rest_api_client:make_request(Token, Method, Url, Body) of</p><p id="z3ehbu9_1339"><code class="code" id="z3ehbu9_1440"></code> {ok, Response} -&gt; io:format(&quot;Response: <span id="z3ehbu9_1441"><sub class="subscript">p</sub></span>n&quot;, [Response]);</p><p id="z3ehbu9_1340"><code class="code" id="z3ehbu9_1442"></code> {error, Reason} -&gt; io:format(&quot;Request failed: <span id="z3ehbu9_1443"><sub class="subscript">p</sub></span>n&quot;, [Reason])</p><p id="z3ehbu9_1341">end.</p><p id="z3ehbu9_1342"><span class="control" id="z3ehbu9_1444">Пример 3: Формирование URL</span></p><p id="z3ehbu9_1343">Host = &lt;&lt;&quot;127.0.0.1&quot;&gt;&gt;,</p><p id="z3ehbu9_1344">Port = &lt;&lt;&quot;8080&quot;&gt;&gt;,</p><p id="z3ehbu9_1345">Path = &lt;&lt;&quot;api/v1/resource&quot;&gt;&gt;,</p><p id="z3ehbu9_1346">Url = rest_api_client:get_url(Host, Port, Path),</p><p id="z3ehbu9_1347">io:format(&quot;Generated URL: <span id="z3ehbu9_1445"><sub class="subscript">p</sub></span>n&quot;, [Url]).</p><p id="z3ehbu9_1348"><span class="control" id="z3ehbu9_1446">Ожидаемые сценарии работы</span></p><ul class="list _bullet" id="z3ehbu9_1349"><li class="list__item" id="z3ehbu9_1447"><p id="z3ehbu9_1453">Успешный запрос:</p><ol class="list _decimal" id="z3ehbu9_1454" type="1"><li class="list__item" id="z3ehbu9_1455"><p id="z3ehbu9_1457">Токен получен и запрос выполнен без ошибок\.</p></li><li class="list__item" id="z3ehbu9_1456"><p id="z3ehbu9_1458">Ответ: {ok, Response}\.</p></li></ol></li><li class="list__item" id="z3ehbu9_1448"><p id="z3ehbu9_1459">Ошибка токена:</p><ol class="list _decimal" id="z3ehbu9_1460" type="1"><li class="list__item" id="z3ehbu9_1461"><p id="z3ehbu9_1463">Сервер не вернул токен\.</p></li><li class="list__item" id="z3ehbu9_1462"><p id="z3ehbu9_1464">Ответ: {error, no_token_in_response}\.</p></li></ol></li><li class="list__item" id="z3ehbu9_1449"><p id="z3ehbu9_1465">Ошибка запроса:</p><ol class="list _decimal" id="z3ehbu9_1466" type="1"><li class="list__item" id="z3ehbu9_1468"><p id="z3ehbu9_1470">Сервер вернул неожиданный статус-код или произошла ошибка подключения\.</p></li><li class="list__item" id="z3ehbu9_1469"><p id="z3ehbu9_1471">Ответ: {error, Reason}\.</p></li></ol><p id="z3ehbu9_1467"><span class="control" id="z3ehbu9_1472">Примечания</span></p></li><li class="list__item" id="z3ehbu9_1450"><p id="z3ehbu9_1473">Формат данных:</p><ol class="list _decimal" id="z3ehbu9_1474" type="1"><li class="list__item" id="z3ehbu9_1475"><p id="z3ehbu9_1476">Данные запросов и ответов кодируются/декодируются в формате JSON с помощью библиотеки jsx\.</p></li></ol></li><li class="list__item" id="z3ehbu9_1451"><p id="z3ehbu9_1477">Авторизация:</p><ol class="list _decimal" id="z3ehbu9_1478" type="1"><li class="list__item" id="z3ehbu9_1479"><p id="z3ehbu9_1480">Используется авторизация с токеном, передаваемым в заголовке Authorization\.</p></li></ol></li><li class="list__item" id="z3ehbu9_1452"><p id="z3ehbu9_1481">Обработка ошибок:</p><ol class="list _decimal" id="z3ehbu9_1482" type="1"><li class="list__item" id="z3ehbu9_1483"><p id="z3ehbu9_1484">Ошибки логируются, и в случае неудачного запроса возвращаются соответствующие коды и описания\.</p></li></ol></li></ul></section><section class="chapter"><h2 id="state-graph-v1" data-toc="state-graph-v1"><a name=""></a><span class="control" id="z3ehbu9_1509">Модуль state_graph (v1)</span></h2><p id="z3ehbu9_1486">Модуль для работы с графическим отображением состояний. Поддерживает функцию голосования (vote), позволяя принимать решения на основе текущих данных о состоянии объектов.</p><p id="z3ehbu9_1487"><span class="control" id="z3ehbu9_1510">Общая информация</span></p><p id="z3ehbu9_1488">Модуль state_graph предоставляет функционал для работы с цветами, связанными с состояниями и классами напряжения, извлечения класса напряжения из строки, а также вычисления среднего значения параметров из списка с учетом отклонений.</p><div class="table-wrapper"><table class="wide" id="z3ehbu9_1489"><thead><tr class="ijRowHead" id="z3ehbu9_1511"><th id="z3ehbu9_1515"><p><span class="control" id="z3ehbu9_1517">Функция</span></p></th><th id="z3ehbu9_1516"><p><span class="control" id="z3ehbu9_1518">Описание</span></p></th></tr></thead><tbody><tr id="z3ehbu9_1512"><td id="z3ehbu9_1519"><p><span class="control" id="z3ehbu9_1521">color/2</span></p></td><td id="z3ehbu9_1520"><p id="z3ehbu9_1522">: Возвращает цвет в зависимости от класса напряжения и состояния.</p><p id="z3ehbu9_1523"><span class="control" id="z3ehbu9_1536">Параметры</span>:</p><p id="z3ehbu9_1524">- Vclass (integer) &mdash; класс напряжения.</p><p id="z3ehbu9_1525">- State (integer) &mdash; состояние.</p><p id="z3ehbu9_1526"><span class="control" id="z3ehbu9_1537">Возвращает</span>:</p><p id="z3ehbu9_1527">- Цвет в виде строки (binary), например: &lt;&lt;&quot;#959595&quot;&gt;&gt;.</p><p id="z3ehbu9_1528"><span class="control" id="z3ehbu9_1538">Детали реализации</span>:</p><p id="z3ehbu9_1529">- Приводит State к числу, если это не так.</p><p id="z3ehbu9_1530">- Определяет цвет для заданного класса напряжения (Vclass) из предопределенной карты цветов.</p><p id="z3ehbu9_1531">- Возвращает цвет в зависимости от значения State.</p><p id="z3ehbu9_1532"><span class="control" id="z3ehbu9_1539">Пример использования</span>:</p><p id="z3ehbu9_1533">Vclass = 65,</p><p id="z3ehbu9_1534">State = 2,</p><p id="z3ehbu9_1535">state_graph:color(Vclass, State).</p></td></tr><tr id="z3ehbu9_1513"><td id="z3ehbu9_1540"><p><span class="control" id="z3ehbu9_1542">get_vclass_from_string/1</span></p></td><td id="z3ehbu9_1541"><p id="z3ehbu9_1543">: Извлекает класс напряжения из строки.</p><p id="z3ehbu9_1544"><span class="control" id="z3ehbu9_1555">Параметры</span>:</p><p id="z3ehbu9_1545">- String (binary) &mdash; строка, содержащая класс напряжения.</p><p id="z3ehbu9_1546"><span class="control" id="z3ehbu9_1556">Возвращает</span>:</p><p id="z3ehbu9_1547">- Класс напряжения (integer).</p><p id="z3ehbu9_1548">- 0, если класс напряжения не найден.</p><p id="z3ehbu9_1549"><span class="control" id="z3ehbu9_1557">Детали реализации</span>:</p><p id="z3ehbu9_1550">1 Использует регулярное выражение для поиска чисел в строке.</p><p id="z3ehbu9_1551">2 Если совпадение найдено, преобразует его в число, иначе возвращает 0.</p><p id="z3ehbu9_1552"><span class="control" id="z3ehbu9_1558">Пример использования</span>:</p><p id="z3ehbu9_1553">String = &lt;&lt;&quot;Voltage class: 110 kV&quot;&gt;&gt;,</p><p id="z3ehbu9_1554">state_graph:get_vclass_from_string(String).</p></td></tr><tr id="z3ehbu9_1514"><td id="z3ehbu9_1559"><p><span class="control" id="z3ehbu9_1561">vote/3</span></p></td><td id="z3ehbu9_1560"><p id="z3ehbu9_1562">: Вычисляет среднее значение параметров из списка, удовлетворяющих условию минимального отклонения от целевого значения.</p><p id="z3ehbu9_1563"><span class="control" id="z3ehbu9_1580">Параметры</span>:</p><p id="z3ehbu9_1564">- Values (list) &mdash; список чисел.</p><p id="z3ehbu9_1565">- Deviation (integer) &mdash; допустимое отклонение.</p><p id="z3ehbu9_1566">- TargetValue (integer) &mdash; целевое значение.</p><p id="z3ehbu9_1567"><span class="control" id="z3ehbu9_1581">Возвращает</span>:</p><p id="z3ehbu9_1568">- Среднее значение (float) из фильтрованных значений.</p><p id="z3ehbu9_1569">- none, если подходящие значения отсутствуют.</p><p id="z3ehbu9_1570"><span class="control" id="z3ehbu9_1582">Детали реализации</span>:</p><p id="z3ehbu9_1571">- Фильтрует значения, которые находятся в пределах Deviation от TargetValue.</p><p id="z3ehbu9_1572">- Если подходящих значений нет, возвращает none.</p><p id="z3ehbu9_1573">- Если одно значение удовлетворяет условию, возвращает его.</p><p id="z3ehbu9_1574">- Если несколько значений удовлетворяют условию, возвращает их среднее.</p><p id="z3ehbu9_1575"><span class="control" id="z3ehbu9_1583">Пример использования</span>:</p><p id="z3ehbu9_1576">Values = [110, 115, 120, 130],</p><p id="z3ehbu9_1577">Deviation = 10,</p><p id="z3ehbu9_1578">TargetValue = 115,</p><p id="z3ehbu9_1579">state_graph:vote(Values, Deviation, TargetValue).</p></td></tr></tbody></table></div><p id="z3ehbu9_1490"><span class="control" id="z3ehbu9_1584">Примеры использования модуля</span></p><p id="z3ehbu9_1491"><span class="control" id="z3ehbu9_1585">Пример 1: Определение цвета</span></p><p id="z3ehbu9_1492">Vclass = 110,</p><p id="z3ehbu9_1493">State = 1,</p><p id="z3ehbu9_1494">Color = state_graph:color(Vclass, State),</p><p id="z3ehbu9_1495">io:format(&quot;Цвет для класса напряжения ~p в состоянии ~p: <span id="z3ehbu9_1586"><sub class="subscript">p</sub></span>n&quot;, [Vclass, State, Color]).</p><p id="z3ehbu9_1496"><span class="control" id="z3ehbu9_1587">Пример 2: Извлечение класса напряжения из строки</span></p><p id="z3ehbu9_1497">String = &lt;&lt;&quot;This is a voltage class: 220&quot;&gt;&gt;,</p><p id="z3ehbu9_1498">Vclass = state_graph:get_vclass_from_string(String),</p><p id="z3ehbu9_1499">io:format(&quot;Извлеченный класс напряжения: <span id="z3ehbu9_1588"><sub class="subscript">p</sub></span>n&quot;, [Vclass]).</p><p id="z3ehbu9_1500"><span class="control" id="z3ehbu9_1589">Пример 3: Расчет среднего значения с учетом отклонений</span></p><p id="z3ehbu9_1501">Values = [100, 105, 115, 130],</p><p id="z3ehbu9_1502">Deviation = 10,</p><p id="z3ehbu9_1503">TargetValue = 110,</p><p id="z3ehbu9_1504">Result = state_graph:vote(Values, Deviation, TargetValue),</p><p id="z3ehbu9_1505">io:format(&quot;Среднее значение: <span id="z3ehbu9_1590"><sub class="subscript">p</sub></span>n&quot;, [Result]).</p><p id="z3ehbu9_1506"><span class="control" id="z3ehbu9_1591">Ожидаемые сценарии работы</span></p><ul class="list _bullet" id="z3ehbu9_1507"><li class="list__item" id="z3ehbu9_1592"><p id="z3ehbu9_1598"><span class="control" id="z3ehbu9_1599">Обработка цветов</span>: Если класс напряжения не найден в предопределенных значениях, возвращается цвет &lt;&lt;&quot;#000000&quot;&gt;&gt; (черный). При некорректном состоянии (State) по умолчанию используется 0.</p></li><li class="list__item" id="z3ehbu9_1593"><p id="z3ehbu9_1600"><span class="control" id="z3ehbu9_1601">Извлечение данных из строки</span>: Если строка не содержит числовых данных, возвращается 0.</p></li><li class="list__item" id="z3ehbu9_1594"><p id="z3ehbu9_1602"><span class="control" id="z3ehbu9_1604">Фильтрация значений</span>: Если список значений пуст или не содержит подходящих элементов, возвращается none. При одном подходящем значении оно возвращается без изменений.</p><p id="z3ehbu9_1603"><span class="control" id="z3ehbu9_1605">Примечания</span></p></li><li class="list__item" id="z3ehbu9_1595"><p id="z3ehbu9_1606"><span class="control" id="z3ehbu9_1607">Обработка цветов</span>: Цвета ассоциируются с классами напряжения и состояниями, а если значения отсутствуют, используются цвета по умолчанию.</p></li><li class="list__item" id="z3ehbu9_1596"><p id="z3ehbu9_1608"><span class="control" id="z3ehbu9_1609">Работа со строками</span>: Класс напряжения извлекается из строки с помощью регулярных выражений.</p></li><li class="list__item" id="z3ehbu9_1597"><p id="z3ehbu9_1610"><span class="control" id="z3ehbu9_1611">Расчет среднего</span>: Фильтрация значений осуществляется на основе заданного допустимого отклонения.</p></li></ul></section><section class="chapter"><h2 id="ems" data-toc="ems"><a name=""></a><span class="control" id="z3ehbu9_1622">Подсистема EMS</span></h2><p id="z3ehbu9_1613">Эта документация поможет эффективно использовать API для работы с объектами, архивами и хранилищем данных в SCADA/EMS.</p><ol class="list _decimal" id="z3ehbu9_1614" type="1"><li class="list__item" id="z3ehbu9_1623"><section class="chapter"><h3 id="fp-fp-db-fp-api-erlang-md" data-toc="fp-fp-db-fp-api-erlang-md"><a name=""></a><span class="control" id="z3ehbu9_1627">Модули fp и fp_db (fp_api_erlang.md)</span></h3></section></li></ol><p id="z3ehbu9_1615"><span class="control" id="z3ehbu9_1628">Общая информация</span></p><p id="z3ehbu9_1616">Модули fp и fp_db предназначены для работы с объектами, архивами и хранилищем данных в среде SCADA/EMS. API предоставляет методы для преобразования данных, работы с объектами, чтения и изменения полей, а также выполнения запросов.</p><p id="z3ehbu9_1617">Функции модуля оптимизированы для использования в RunTime и могут работать быстрее за счет кеширования данных.</p><div class="table-wrapper"><table class="wide" id="z3ehbu9_1618"><thead><tr class="ijRowHead" id="z3ehbu9_1629"><th id="z3ehbu9_1647"><p><span class="control" id="z3ehbu9_1649">Функция</span></p></th><th id="z3ehbu9_1648"><p><span class="control" id="z3ehbu9_1650">Описание</span></p></th></tr></thead><tbody><tr id="z3ehbu9_1630"><td id="z3ehbu9_1651"><p>fp:to_json/1</p></td><td id="z3ehbu9_1652"><p id="z3ehbu9_1653"><span class="control" id="z3ehbu9_1657">:</span> Преобразует Erlang-терм (список, map, числа) в JSON.</p><p id="z3ehbu9_1654"><span class="control" id="z3ehbu9_1658">Возвращает:</span> binary в формате JSON.</p><p id="z3ehbu9_1655"><span class="control" id="z3ehbu9_1659">Пример использования:</span></p><p id="z3ehbu9_1656">JSON = fp:to_json(#{key =&gt; &quot;value&quot;}).</p></td></tr><tr id="z3ehbu9_1631"><td id="z3ehbu9_1660"><p>fp:from_json/1</p></td><td id="z3ehbu9_1661"><p id="z3ehbu9_1662"><span class="control" id="z3ehbu9_1665">:</span> Конвертирует JSON (в формате binary) обратно в Erlang-терм. <br><span class="control" id="z3ehbu9_1667">Возвращает:</span> Термин (например, список, map, числа).</p><p id="z3ehbu9_1663"><span class="control" id="z3ehbu9_1668">Пример использования:</span></p><p id="z3ehbu9_1664">Term = fp:from_json(&lt;&lt;&quot;{\&quot;key\&quot;:\&quot;value\&quot;}&quot;&gt;&gt;).</p></td></tr><tr id="z3ehbu9_1632"><td id="z3ehbu9_1669"><p>fp:open_tag/1</p></td><td id="z3ehbu9_1670"><p id="z3ehbu9_1671"><span class="control" id="z3ehbu9_1676">:</span> Открывает объект тега по указанному пути. Работает быстрее fp_db:open/1, благодаря кешированию.</p><p id="z3ehbu9_1672"><span class="control" id="z3ehbu9_1677">Требование:</span> Работает только в режиме RunTime.</p><p id="z3ehbu9_1673"><span class="control" id="z3ehbu9_1678">Возвращает:</span> {ok, Object}.</p><p id="z3ehbu9_1674"><span class="control" id="z3ehbu9_1679">Пример использования:</span></p><p id="z3ehbu9_1675">{ok, Tag} = fp:open_tag(&quot;/path/to/tag&quot;).</p></td></tr><tr id="z3ehbu9_1633"><td id="z3ehbu9_1680"><p>fp:get_value/2</p></td><td id="z3ehbu9_1681"><p id="z3ehbu9_1682"><span class="control" id="z3ehbu9_1687">:</span> Получает значение поля объекта по пути к тегу. Работает быстрее, чем fp_db:read_field.</p><p id="z3ehbu9_1683"><span class="control" id="z3ehbu9_1688">Требование:</span> Работает только в режиме RunTime.</p><p id="z3ehbu9_1684"><span class="control" id="z3ehbu9_1689">Возвращает:</span> {ok, Value}.</p><p id="z3ehbu9_1685"><span class="control" id="z3ehbu9_1690">Пример использования:</span></p><p id="z3ehbu9_1686">{ok, Value} = fp:get_value(Tag, Field).</p></td></tr><tr id="z3ehbu9_1634"><td id="z3ehbu9_1691"><p>fp:get_value/3</p></td><td id="z3ehbu9_1692"><p id="z3ehbu9_1693"><span class="control" id="z3ehbu9_1697">:</span> Аналог fp:get_value/2, но возвращает значение Default, если поле не задано.</p><p id="z3ehbu9_1694"><span class="control" id="z3ehbu9_1698">Возвращает:</span> {ok, Value}.</p><p id="z3ehbu9_1695"><span class="control" id="z3ehbu9_1699">Пример использования:</span></p><p id="z3ehbu9_1696">{ok, Value} = fp:get_value(Tag, Field, DefaultValue).</p></td></tr><tr id="z3ehbu9_1635"><td id="z3ehbu9_1700"><p>fp:set_value/2</p></td><td id="z3ehbu9_1701"><p id="z3ehbu9_1702"><span class="control" id="z3ehbu9_1710">:</span> Изменяет значения полей тега.</p><p id="z3ehbu9_1703"><span class="control" id="z3ehbu9_1711">Требование:</span> Работает только в режиме RunTime.</p><p id="z3ehbu9_1704"><span class="control" id="z3ehbu9_1712">Принимает:</span></p><p id="z3ehbu9_1705">- TagPath &mdash; путь к тегу.</p><p id="z3ehbu9_1706">- Changes &mdash; список пар {Field, Value}.</p><p id="z3ehbu9_1707"><span class="control" id="z3ehbu9_1713">Возвращает:</span> ok.</p><p id="z3ehbu9_1708"><span class="control" id="z3ehbu9_1714">Пример использования:</span></p><p id="z3ehbu9_1709">ok = fp:set_value(&quot;/path/to/tag&quot;, [{field1, value1}, {field2, value2}]).</p></td></tr><tr id="z3ehbu9_1636"><td id="z3ehbu9_1715"><p>fp:set_value/3</p></td><td id="z3ehbu9_1716"><p id="z3ehbu9_1717"><span class="control" id="z3ehbu9_1722">:</span> Присваивает конкретное значение полю объекта.</p><p id="z3ehbu9_1718"><span class="control" id="z3ehbu9_1723">Требование:</span> Работает только в режиме RunTime.</p><p id="z3ehbu9_1719"><span class="control" id="z3ehbu9_1724">Возвращает:</span> ok.</p><p id="z3ehbu9_1720"><span class="control" id="z3ehbu9_1725">Пример использования:</span></p><p id="z3ehbu9_1721">ok = fp:set_value(&quot;/path/to/tag&quot;, field, value).</p></td></tr><tr id="z3ehbu9_1637"><td id="z3ehbu9_1726"><p>fp:archives_get/2</p></td><td id="z3ehbu9_1727"><p id="z3ehbu9_1728"><span class="control" id="z3ehbu9_1733">:</span> Возвращает значения архивов для указанных точек в заданных моментах времени.</p><p id="z3ehbu9_1729"><span class="control" id="z3ehbu9_1734">Возвращает:</span> Список списков формата:</p><p id="z3ehbu9_1730"><code class="code" id="z3ehbu9_1735"></code> [[TS1, A1_value, A2_value, ...], ...].</p><p id="z3ehbu9_1731"><span class="control" id="z3ehbu9_1736">Пример использования:</span></p><p id="z3ehbu9_1732">Data = fp:archives_get(Points, Archives).</p></td></tr><tr id="z3ehbu9_1638"><td id="z3ehbu9_1737"><p>fp:archive_get_point/2</p></td><td id="z3ehbu9_1738"><p id="z3ehbu9_1739"><span class="control" id="z3ehbu9_1743">:</span> Получает значение из архива в заданный момент времени.</p><p id="z3ehbu9_1740"><span class="control" id="z3ehbu9_1744">Возвращает:</span> {TS, Value}.</p><p id="z3ehbu9_1741"><span class="control" id="z3ehbu9_1745">Пример использования:</span></p><p id="z3ehbu9_1742">{Timestamp, Value} = fp:archive_get_point(Archive, Timestamp).</p></td></tr><tr id="z3ehbu9_1639"><td id="z3ehbu9_1746"><p>fp:archives_get_periods/2</p></td><td id="z3ehbu9_1747"><p id="z3ehbu9_1748"><span class="control" id="z3ehbu9_1753">:</span> Возвращает значения архивов за периоды, настроенные через Params.</p><p id="z3ehbu9_1749"><span class="control" id="z3ehbu9_1754">Возвращает:</span> Список списков формата:</p><p id="z3ehbu9_1750"><code class="code" id="z3ehbu9_1755"></code> [[TS1, A1_value, A2_value, ...], ...].</p><p id="z3ehbu9_1751"><span class="control" id="z3ehbu9_1756">Пример использования:</span></p><p id="z3ehbu9_1752">Data = fp:archives_get_periods(Params, Archives).</p></td></tr><tr id="z3ehbu9_1640"><td id="z3ehbu9_1757"><p>fp:version/0</p></td><td id="z3ehbu9_1758"><p id="z3ehbu9_1759"><span class="control" id="z3ehbu9_1763">:</span> Возвращает текущую версию API.</p><p id="z3ehbu9_1760"><span class="control" id="z3ehbu9_1764">Возвращает:</span> Версию в формате Version.</p><p id="z3ehbu9_1761"><span class="control" id="z3ehbu9_1765">Пример использования:</span></p><p id="z3ehbu9_1762">Version = fp:version().</p></td></tr><tr id="z3ehbu9_1641"><td id="z3ehbu9_1766"><p>fp_db:create_object/1</p></td><td id="z3ehbu9_1767"><p id="z3ehbu9_1768"><span class="control" id="z3ehbu9_1772">:</span> Создаёт объект с заданными полями.</p><p id="z3ehbu9_1769"><span class="control" id="z3ehbu9_1773">Возвращает:</span> Объект.</p><p id="z3ehbu9_1770"><span class="control" id="z3ehbu9_1774">Пример использования:</span></p><p id="z3ehbu9_1771">Object = fp_db:create_object(#{field1 =&gt; value1, field2 =&gt; value2}).</p></td></tr><tr id="z3ehbu9_1642"><td id="z3ehbu9_1775"><p>fp_db:read_field/2</p></td><td id="z3ehbu9_1776"><p id="z3ehbu9_1777"><span class="control" id="z3ehbu9_1781">:</span> Читает значение поля объекта.</p><p id="z3ehbu9_1778"><span class="control" id="z3ehbu9_1782">Возвращает:</span> {ok, Value}.</p><p id="z3ehbu9_1779"><span class="control" id="z3ehbu9_1783">Пример использования:</span></p><p id="z3ehbu9_1780">{ok, Value} = fp_db:read_field(Object, Field).</p></td></tr><tr id="z3ehbu9_1643"><td id="z3ehbu9_1784"><p>fp_db:read_field/3</p></td><td id="z3ehbu9_1785"><p id="z3ehbu9_1786"><span class="control" id="z3ehbu9_1790">:</span> Читает значение поля объекта с дополнительными параметрами.</p><p id="z3ehbu9_1787"><span class="control" id="z3ehbu9_1791">Возвращает:</span> {ok, Value}.</p><p id="z3ehbu9_1788"><span class="control" id="z3ehbu9_1792">Пример использования:</span></p><p id="z3ehbu9_1789">{ok, Value} = fp_db:read_field(Object, Field, Params).</p></td></tr><tr id="z3ehbu9_1644"><td id="z3ehbu9_1793"><p>fp_db:read_fields/2</p></td><td id="z3ehbu9_1794"><p id="z3ehbu9_1795"><span class="control" id="z3ehbu9_1799">:</span> Читает сразу несколько полей объекта.</p><p id="z3ehbu9_1796"><span class="control" id="z3ehbu9_1800">Возвращает:</span> Map с парами #{Field =&gt; Value}.</p><p id="z3ehbu9_1797"><span class="control" id="z3ehbu9_1801">Пример использования:</span></p><p id="z3ehbu9_1798">Fields = fp_db:read_fields(Object, [field1, field2]).</p></td></tr><tr id="z3ehbu9_1645"><td id="z3ehbu9_1802"><p>fp_db:edit_object/2</p></td><td id="z3ehbu9_1803"><p id="z3ehbu9_1804"><span class="control" id="z3ehbu9_1808">:</span> Изменяет значения полей объекта.</p><p id="z3ehbu9_1805"><span class="control" id="z3ehbu9_1809">Возвращает:</span> ok.</p><p id="z3ehbu9_1806"><span class="control" id="z3ehbu9_1810">Пример использования:</span></p><p id="z3ehbu9_1807">ok = fp_db:edit_object(Object, #{field =&gt; value}).</p></td></tr><tr id="z3ehbu9_1646"><td id="z3ehbu9_1811"><p>fp_db:query/1</p></td><td id="z3ehbu9_1812"><p id="z3ehbu9_1813"><span class="control" id="z3ehbu9_1817">:</span> Выполняет запрос к хранилищу данных (Ecomet).</p><p id="z3ehbu9_1814"><span class="control" id="z3ehbu9_1818">Возвращает:</span> Результат запроса.</p><p id="z3ehbu9_1815"><span class="control" id="z3ehbu9_1819">Пример использования:</span></p><p id="z3ehbu9_1816">Result = fp_db:query(Query).</p></td></tr></tbody></table></div><p id="z3ehbu9_1619"><span class="control" id="z3ehbu9_1820">Примечания</span></p><ul class="list _bullet" id="z3ehbu9_1620"><li class="list__item" id="z3ehbu9_1821"><p id="z3ehbu9_1824"><span class="control" id="z3ehbu9_1825">RunTime:</span> Некоторые функции (fp:open_tag, fp:get_value, fp:set_value) работают только в режиме RunTime.</p></li><li class="list__item" id="z3ehbu9_1822"><p id="z3ehbu9_1826"><span class="control" id="z3ehbu9_1827">Кеширование:</span> Функции fp оптимизированы за счёт использования кеша, что делает их быстрее аналогов из fp_db.</p></li><li class="list__item" id="z3ehbu9_1823"><p id="z3ehbu9_1828"><span class="control" id="z3ehbu9_1829">Совместимость:</span> Архивные функции (fp:archives_get, fp:archive_get_point) совместимы с функциями из fp_archive.</p></li></ul></section><section class="chapter"><h2 id="javascript-fp-api-js-md" data-toc="javascript-fp-api-js-md"><a name=""></a><span class="control" id="z3ehbu9_1838">Модуль функций JavaScript (fp_api_js.md)</span></h2><p id="z3ehbu9_1831"><span class="control" id="z3ehbu9_1839">Общая информация</span></p><p id="z3ehbu9_1832">fp_api_js предоставляет функции для взаимодействия с объектами SCADA-системы на базе JavaScript. Используйте функции для работы с тегами, хранилищем данных и архивами.</p><p id="z3ehbu9_1833"><span class="control" id="z3ehbu9_1840">Общие рекомендации</span></p><ul class="list _bullet" id="z3ehbu9_1834"><li class="list__item" id="z3ehbu9_1841"><p id="z3ehbu9_1843"><span class="control" id="z3ehbu9_1844">Асинхронность:</span> Все функции API возвращают промисы. Для получения результата используйте await.</p></li><li class="list__item" id="z3ehbu9_1842"><p id="z3ehbu9_1845"><span class="control" id="z3ehbu9_1846">Идентификаторы объектов:</span> Вместо путей к тегам можно использовать идентификаторы объектов, полученные при создании.</p></li></ul><div class="table-wrapper"><table class="wide" id="z3ehbu9_1835"><thead><tr class="ijRowHead" id="z3ehbu9_1847"><th id="z3ehbu9_1855"><p><span class="control" id="z3ehbu9_1857">Функция</span></p></th><th id="z3ehbu9_1856"><p><span class="control" id="z3ehbu9_1858">Описание</span></p></th></tr></thead><tbody><tr id="z3ehbu9_1848"><td id="z3ehbu9_1859" colspan="2"><p><span class="control" id="z3ehbu9_1860">Работа с тегами</span></p></td></tr><tr id="z3ehbu9_1849"><td id="z3ehbu9_1861"><p>fp.api.get_value(path, field)</p></td><td id="z3ehbu9_1862"><p id="z3ehbu9_1863">: Получает значение заданного поля тега.</p><p id="z3ehbu9_1864"><span class="control" id="z3ehbu9_1871">Параметры:</span></p><p id="z3ehbu9_1865">- path (string): Путь к тегу.</p><p id="z3ehbu9_1866">- field (string): Поле тега, значение которого необходимо получить.</p><p id="z3ehbu9_1867"><span class="control" id="z3ehbu9_1872">Возвращает:</span></p><p id="z3ehbu9_1868">- Значение поля.</p><p id="z3ehbu9_1869"><span class="control" id="z3ehbu9_1873">Пример использования:</span></p><p id="z3ehbu9_1870">let value = await fp.api.get_value('/root/PROJECT/TAGS/AI', 'value');</p></td></tr><tr id="z3ehbu9_1850"><td id="z3ehbu9_1874"><p>fp.api.set_value(path, field, value)</p></td><td id="z3ehbu9_1875"><p id="z3ehbu9_1876">: Устанавливает значение поля тега.</p><p id="z3ehbu9_1877"><span class="control" id="z3ehbu9_1884">Параметры:</span></p><p id="z3ehbu9_1878">- path (string): Путь к тегу.</p><p id="z3ehbu9_1879">- field (string): Поле тега.</p><p id="z3ehbu9_1880">- value (any): Значение, которое нужно записать.</p><p id="z3ehbu9_1881"><span class="control" id="z3ehbu9_1885">Возвращает:</span> undefined.</p><p id="z3ehbu9_1882"><span class="control" id="z3ehbu9_1886">Пример использования:</span></p><p id="z3ehbu9_1883">fp.api.set_value('/root/PROJECT/TAGS/AI', 'value', 10.5);</p></td></tr><tr id="z3ehbu9_1851"><td id="z3ehbu9_1887"><p>fp.api.archives_get(timestamps, archives)</p></td><td id="z3ehbu9_1888"><p id="z3ehbu9_1889">: Получает данные из архива для указанных временных точек.</p><p id="z3ehbu9_1890"><span class="control" id="z3ehbu9_1900">Параметры:</span></p><p id="z3ehbu9_1891">- timestamps (array): Массив временных точек.</p><p id="z3ehbu9_1892">- archives (array): Массив массивов, где каждый элемент: [путь к архиву, агрегирующая функция].</p><p id="z3ehbu9_1893"><span class="control" id="z3ehbu9_1901">Возвращает:</span></p><p id="z3ehbu9_1894">- Массив массивов, содержащих временные метки и значения.</p><p id="z3ehbu9_1895"><span class="control" id="z3ehbu9_1902">Пример использования:</span></p><p id="z3ehbu9_1896">let data = await fp.api.archives_get(</p><p id="z3ehbu9_1897"><code class="code" id="z3ehbu9_1903"></code> [TS1, TS2, TS3],</p><p id="z3ehbu9_1898"><code class="code" id="z3ehbu9_1904"></code> [[&quot;/root/PROJECT/TAGS/archive_1&quot;, &quot;avg&quot;]]</p><p id="z3ehbu9_1899">);</p></td></tr><tr id="z3ehbu9_1852"><td id="z3ehbu9_1905" colspan="2"><p><span class="control" id="z3ehbu9_1906">Работа с хранилищем данных</span></p></td></tr><tr id="z3ehbu9_1853"><td id="z3ehbu9_1907"><p>fp.db.create_object(params)</p></td><td id="z3ehbu9_1908"><p id="z3ehbu9_1909">: Создает новый объект.</p><p id="z3ehbu9_1910"><span class="control" id="z3ehbu9_1921">Параметры:</span></p><p id="z3ehbu9_1911">- params (object): Параметры объекта, включая .name, .folder, .pattern и дополнительные поля.</p><p id="z3ehbu9_1912"><span class="control" id="z3ehbu9_1922">Возвращает:</span></p><p id="z3ehbu9_1913">- Идентификатор созданного объекта.</p><p id="z3ehbu9_1914"><span class="control" id="z3ehbu9_1923">Пример использования:</span></p><p id="z3ehbu9_1915">let obj = await fp.db.create_object({</p><p id="z3ehbu9_1916"><code class="code" id="z3ehbu9_1924"></code> &quot;.name&quot;: &quot;mytag&quot;,</p><p id="z3ehbu9_1917"><code class="code" id="z3ehbu9_1925"></code> &quot;.folder&quot;: &quot;/root/PROJECT/TAGS/folder&quot;,</p><p id="z3ehbu9_1918"><code class="code" id="z3ehbu9_1926"></code> &quot;.pattern&quot;: &quot;/root/.patterns/AI&quot;,</p><p id="z3ehbu9_1919"><code class="code" id="z3ehbu9_1927"></code> &quot;value&quot;: 1.0</p><p id="z3ehbu9_1920">});</p></td></tr><tr id="z3ehbu9_1854"><td id="z3ehbu9_1928"><p>fp.db.read_field(object, field)</p></td><td id="z3ehbu9_1929"><p id="z3ehbu9_1936">: Читает значение поля объекта.</p><p id="z3ehbu9_1937"><span class="control" id="z3ehbu9_1939">Параметры:</span></p><p id="z3ehbu9_1938"></p><p> - object (string</p></td><td id="z3ehbu9_1930"><p>ID): Путь или идентификатор объекта.</p></td><p id="z3ehbu9_1931">- field (string): Название поля.</p><p id="z3ehbu9_1932"><span class="control" id="z3ehbu9_1940">Возвращает:</span></p><p id="z3ehbu9_1933">- Значение поля.</p><p id="z3ehbu9_1934"><span class="control" id="z3ehbu9_1941">Пример использования:</span></p><p id="z3ehbu9_1935">let value = await fp.db.read_field('/root/PROJECT/TAGS/AI', 'value');</p></tr></tbody></table></div><tr id="z3ehbu9_1836"><td id="z3ehbu9_1942"><p>fp.db.edit_object(object, changes)</p></td><td id="z3ehbu9_1943"><p id="z3ehbu9_1949">: Редактирует существующий объект.</p><p id="z3ehbu9_1950"><span class="control" id="z3ehbu9_1952">Параметры:</span></p><p id="z3ehbu9_1951"></p><p> - object (string</p></td><td id="z3ehbu9_1944"><p>ID): Путь или идентификатор объекта.</p></td><p id="z3ehbu9_1945">- changes (object): Изменяемые поля и их новые значения.</p><p id="z3ehbu9_1946"><span class="control" id="z3ehbu9_1953">Возвращает:</span> undefined.</p><p id="z3ehbu9_1947"><span class="control" id="z3ehbu9_1954">Пример использования:</span></p><p id="z3ehbu9_1948">fp.db.edit_object('/root/PROJECT/TAGS/AI', { value: 1.0, title: &quot;Updated&quot; });</p></tr></section><tr id="z3ehbu9_19"><td id="z3ehbu9_1955"><p>fp.db.delete_object(object)</p></td><td id="z3ehbu9_1956"><p id="z3ehbu9_1961">: Удаляет объект.</p><p id="z3ehbu9_1962"><span class="control" id="z3ehbu9_1964">Параметры:</span></p><p id="z3ehbu9_1963"></p><p> - object (string</p></td><td id="z3ehbu9_1957"><p>ID): Путь или идентификатор объекта.</p></td><p id="z3ehbu9_1958"><span class="control" id="z3ehbu9_1965">Возвращает:</span> undefined.</p><p id="z3ehbu9_1959"><span class="control" id="z3ehbu9_1966">Пример использования:</span></p><p id="z3ehbu9_1960">fp.db.delete_object('/root/PROJECT/TAGS/AI');</p></tr><div class="last-modified">25 July 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="справочник-reference.html" class="navigation-links__prev">Справочник (Reference)</a><a href="поддержка-жизненного-цикла-программного-обеспечения.html" class="navigation-links__next">Поддержка жизненного цикла программного обеспечения</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>