<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-02-27T17:18:22.595639858"><title>Руководство программиста | Faceplate docs</title><script type="application/json" id="virtual-toc-data">[{"id":"bh6ssn_3","level":0,"title":"Введение","anchor":"#bh6ssn_3"},{"id":"6-1","level":0,"title":"6.1 Файл настроек","anchor":"#6-1"},{"id":"6-2","level":0,"title":"6.2 Использование в прикладном проекте","anchor":"#6-2"},{"id":"7","level":0,"title":"7. Заключение","anchor":"#7"},{"id":"bh6ssn_7","level":0,"title":"Приложение А. Библиотечные скрипты и их функции","anchor":"#bh6ssn_7"},{"id":"1-system-utils-v1","level":0,"title":"А.1 Модуль system_utils (v1)","anchor":"#1-system-utils-v1"},{"id":"2-weather-service","level":0,"title":"А.2 Модуль weather_service","anchor":"#2-weather-service"},{"id":"9-fp-powerfactory-service-old","level":0,"title":"А.9 Модуль fp_powerfactory_service_old","anchor":"#9-fp-powerfactory-service-old"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b575/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Руководство программиста | Faceplate docs"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Faceplate docs Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/руководство-программиста.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Руководство программиста | Faceplate docs"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/руководство-программиста.html#webpage",
    "url": "writerside-documentation/руководство-программиста.html",
    "name": "Руководство программиста | Faceplate docs",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Faceplate docs Help"
}</script><!-- End Schema.org --></head><body data-id="Руководство-программиста" data-main-title="Руководство программиста" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs=""><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Faceplate docs  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Руководство-программиста" id="Руководство-программиста.md">Руководство программиста</h1><section class="chapter"><h2 id="bh6ssn_3" data-toc="bh6ssn_3"><span class="control" id="bh6ssn_426">Введение</span></h2><p id="bh6ssn_13">Faceplate (FP) Studio предоставляет возможности для создания скриптов, которые позволяют добавлять новую функциональность и определять поведение различных компонентов системы, таких как прототипы, архивы, IoT-подключения и другие. Эти скрипты выполняют широкий спектр задач, включая обработку данных, взаимодействие с внешними API, выполнение вычислений, настройку параметров и автоматизацию процессов в SCADA-системе.</p><p id="bh6ssn_14">Для написания скриптов в Faceplate Studio поддерживаются два языка:</p><ul class="list _bullet" id="bh6ssn_15"><li class="list__item" id="bh6ssn_112"><p id="bh6ssn_427"><span class="control" id="bh6ssn_428">Erlang</span> &mdash; используется для выполнения задач на стороне сервера, таких как управление данными, взаимодействие с хранилищами данных и системами архивирования. Описание встроенных функций erlang можно посмотреть https://www.erlang.org/doc/system/reference_manual.html.</p></li><li class="list__item" id="bh6ssn_113"><p id="bh6ssn_429"><span class="control" id="bh6ssn_432">JavaScript</span> &mdash; применяется для выполнения клиентских операций, включая обработку данных и управление интерфейсными элементами. Описание поддерживаемых в FP функций JavaScript можно посмотреть <a href="https://ecma-international.org/publications-and-standards/standards/ecma-262/" id="bh6ssn_433" data-external="true" rel="noopener noreferrer">https://ecma-international.org/publications-and-standards/standards/ecma-262/</a>.</p><p id="bh6ssn_430">Данное руководство содержит основные принципы написания скриптов, объяснение структуры, примеры их применения, а также описание функций библиотечных модулей. Информация, изложенная здесь, поможет разработчикам легко создавать скрипты для решения задач в системе Faceplate, обеспечивая удобство и гибкость в работе с системой.</p><section class="chapter"><h3 id="1-1" data-toc="1-1"><a name=""></a><span class="control" id="bh6ssn_436">1.1 Общие рекомендации по написанию скриптов</span></h3></section></li><li class="list__item" id="bh6ssn_114"><p id="bh6ssn_437"><span class="control" id="bh6ssn_438">Логирование и обработка ошибок</span>: Используйте макросы ?LOGINFO, ?LOGWARNING и ?LOGERROR для логирования информации и обработки ошибок (файл console.log). Для логирования в самом журнале сообщений используйте макросы ? FP_LOGINFO, ? FP_LOGWARNING и ? FP_LOGERROR.</p></li><li class="list__item" id="bh6ssn_115"><p id="bh6ssn_439"><span class="control" id="bh6ssn_440">Отладка и тестирование</span>: После написания скрипта необходимо провести компиляцию. В случае успешного выполнения появится сообщение &ldquo;ok&rdquo;; в противном случае будут указаны ошибки.</p></li><li class="list__item" id="bh6ssn_116"><p id="bh6ssn_441"><span class="control" id="bh6ssn_443">Привязка скриптов</span>: Привязывайте скрипты к конкретным объектам или параметрам для автоматической обработки данных или выполнения операций на основе триггеров.</p><section class="chapter"><h3 id="1-2-faceplate-studio" data-toc="1-2-faceplate-studio"><a name=""></a><span class="control" id="bh6ssn_447">1.2 Основные возможности скриптов в Faceplate Studio</span></h3><p id="bh6ssn_445">Скрипты можно разделить на несколько типов в зависимости от их сложности и области применения:</p></section></li><li class="list__item" id="bh6ssn_117"><p id="bh6ssn_448">Простое поведение объектов (Прототипы)</p></li><li class="list__item" id="bh6ssn_118"><p id="bh6ssn_449">Обработка данных и JSON-шаблонов для IoT-соединений</p></li><li class="list__item" id="bh6ssn_119"><p id="bh6ssn_450">Настройка и работа с архивами</p><p id="bh6ssn_451">Каждая из этих областей требует уникального подхода, который будет рассмотрен далее, начиная с простых сценариев и переходя к более сложным.</p><section class="chapter"><h3 id="2" data-toc="2"><a name=""></a><span class="control" id="bh6ssn_457">2. Поведение прототипа: основные принципы и примеры скриптов</span></h3><p id="bh6ssn_455"><span class="control" id="bh6ssn_458">Behavior</span> &mdash; это скрипт, выполняемый при изменении экземпляра прототипа (например, при создании, редактировании или удалении объекта). Скрипты для прототипов задают поведение объекта в системе и позволяют реализовать базовые автоматические действия.</p></section><section class="chapter"><h3 id="2-1" data-toc="2-1"><a name=""></a><span class="control" id="bh6ssn_462">2.1 Базовая структура скрипта поведения</span></h3><p id="bh6ssn_460">Простейший скрипт для поведения прототипа экспортирует три функции:</p></section></li><li class="list__item" id="bh6ssn_120"><p id="bh6ssn_463"><span class="control" id="bh6ssn_464">on_create/1</span> &mdash; выполняется при создании экземпляра прототипа.</p></li><li class="list__item" id="bh6ssn_121"><p id="bh6ssn_465"><span class="control" id="bh6ssn_466">on_edit/1</span> &mdash; выполняется при редактировании полей экземпляра прототипа.</p></li><li class="list__item" id="bh6ssn_122"><p id="bh6ssn_123"><span class="control" id="bh6ssn_467">on_delete/1</span> &mdash; выполняется при удалении экземпляра прототипа.</p><p id="bh6ssn_124">Образец скрипта:</p><p id="bh6ssn_125">%%-------------------------------------------------------</p><p id="bh6ssn_126">%% This script is executed at the server side. The programming language</p><p id="bh6ssn_127">%% is Erlang.</p><p id="bh6ssn_128">%% The module MUST export next 3 methods:</p><p id="bh6ssn_129">%% * on_create/1 - this method is called when a new instance of the prototype is created.</p><p id="bh6ssn_130">%% * on_edit/1 - this method is called when own fields of an instance of the prototype are edited</p><p id="bh6ssn_131">%% * on_delete/1 - this method is called when an instance of the prototype is deleted</p><p id="bh6ssn_132">%% All this methods accept an Object of the instance and can edit or perform any other allowed code.</p><p id="bh6ssn_133">%% If any of the methods throw or crash the whole transaction will rollback.</p><p id="bh6ssn_134">%% If there are any warnings or not critical errors it is recommended to log them with available macros, examples:</p><p id="bh6ssn_135">%% ?LOGWARNING( &quot;my warning text: ~p&quot;, [Warning] )</p><p id="bh6ssn_136">%% ?LOGERROR( &quot;my error text: ~p&quot;, [Error] )</p><p id="bh6ssn_137">%% If the methods performs well it should return atom 'ok'.</p><p id="bh6ssn_138">%% For more info please refer to the documentation</p><p id="bh6ssn_139">%%-------------------------------------------------------</p><p id="bh6ssn_140">-module(fp_prototype_MyProto1).</p><p id="bh6ssn_141">-include(&quot;fp_struct.hrl&quot;).</p><p id="bh6ssn_142">-export([</p><p id="bh6ssn_143"><code class="code" id="bh6ssn_468"></code> on_create/1,</p><p id="bh6ssn_144"><code class="code" id="bh6ssn_469"></code> on_delete/1,</p><p id="bh6ssn_145"><code class="code" id="bh6ssn_470"></code> on_edit/1</p><p id="bh6ssn_146">]).</p><p id="bh6ssn_147">on_create(_Object)-&gt;</p><p id="bh6ssn_148"><code class="code" id="bh6ssn_471"></code> ok.</p><p id="bh6ssn_149">on_edit(_Object)-&gt;</p><p id="bh6ssn_150"><code class="code" id="bh6ssn_472"></code> ok.</p><p id="bh6ssn_151">on_delete( Object )-&gt;</p><p id="bh6ssn_152"><code class="code" id="bh6ssn_473"></code> ok.</p><p id="bh6ssn_153">Рассмотрим примеры создания скриптов, определяющих поведение прототипа на языке Erlang.</p><p id="bh6ssn_154"><span class="control" id="bh6ssn_474">Пример 1:</span></p><p id="bh6ssn_155">%%-------------------------------------------------------</p><p id="bh6ssn_156">%% This script is executed at the server side. The programming language</p><p id="bh6ssn_157">%% is Erlang.</p><p id="bh6ssn_158">%% The module MUST export next 3 methods:</p><p id="bh6ssn_159">%% * on_create/1 - this method is called when a new instance of the prototype is created.</p><p id="bh6ssn_160">%% * on_edit/1 - this method is called when own fields of an instance of the prototype are edited</p><p id="bh6ssn_161">%% * on_delete/1 - this method is called when an instance of the prototype is deleted</p><p id="bh6ssn_162">%% All these methods accept an Object of the instance and can edit or perform any other allowed code.</p><p id="bh6ssn_163">%% If any of the methods throw or crash, the whole transaction will rollback.</p><p id="bh6ssn_164">%% If there are any warnings or non-critical errors, it is recommended to log them with available macros, examples:</p><p id="bh6ssn_165">%% ?LOGWARNING( &quot;my warning text: ~p&quot;, [Warning] )</p><p id="bh6ssn_166">%% ?LOGERROR( &quot;my error text: ~p&quot;, [Error] )</p><p id="bh6ssn_167">%% If the methods perform well, they should return the atom 'ok'.</p><p id="bh6ssn_168">%% For more info, please refer to the documentation</p><p id="bh6ssn_169">%%-------------------------------------------------------</p><p id="bh6ssn_170">-module(fp_prototype_MyProto1).</p><p id="bh6ssn_171">-include(&quot;fp_struct.hrl&quot;).</p><p id="bh6ssn_172">-export([</p><p id="bh6ssn_173"><code class="code" id="bh6ssn_475"></code> on_create/1,</p><p id="bh6ssn_174"><code class="code" id="bh6ssn_476"></code> on_delete/1,</p><p id="bh6ssn_175"><code class="code" id="bh6ssn_477"></code> on_edit/1</p><p id="bh6ssn_176">]).</p><p id="bh6ssn_177">on_create(Object) -&gt;</p><p id="bh6ssn_178"><code class="code" id="bh6ssn_478"></code> io:format(&quot;Instance of MyProto1 created: <span id="bh6ssn_479"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="bh6ssn_179"><code class="code" id="bh6ssn_480"></code> ok.</p><p id="bh6ssn_180">on_edit(Object) -&gt;</p><p id="bh6ssn_181"><code class="code" id="bh6ssn_481"></code> io:format(&quot;Fields of MyProto1 instance edited: <span id="bh6ssn_482"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="bh6ssn_182"><code class="code" id="bh6ssn_483"></code> ok.</p><p id="bh6ssn_183">on_delete(Object) -&gt;</p><p id="bh6ssn_184"><code class="code" id="bh6ssn_484"></code> io:format(&quot;Instance of MyProto1 deleted: <span id="bh6ssn_485"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="bh6ssn_185"><code class="code" id="bh6ssn_486"></code> ok.</p><p id="bh6ssn_186">Этот скрипт реализует три метода: on_create, on_edit и on_delete, которые вызываются при создании, изменении и удалении экземпляра прототипа соответственно. В данном примере эти методы просто выводят сообщение в консоль, указывая на то, что произошло с экземпляром. Вы можете дополнить их логикой, соответствующей вашим требованиям.</p><p id="bh6ssn_187"><span class="control" id="bh6ssn_487">Пример 2:</span></p><p id="bh6ssn_188">Давайте расширим последний скрипт для работы с прототипом, представляющим конкретное устройство. Для примера давайте предположим, что у нас есть прототип устройства, представляющего насос, и мы хотим, чтобы наш скрипт выполнял определенные действия в зависимости от состояния этого насоса.</p><p id="bh6ssn_189">%%-------------------------------------------------------</p><p id="bh6ssn_190">%% This script is executed at the server side. The programming language</p><p id="bh6ssn_191">%% is Erlang.</p><p id="bh6ssn_192">%% The module MUST export next 3 methods:</p><p id="bh6ssn_193">%% * on_create/1 - this method is called when a new instance of the prototype is created.</p><p id="bh6ssn_194">%% * on_edit/1 - this method is called when own fields of an instance of the prototype are edited</p><p id="bh6ssn_195">%% * on_delete/1 - this method is called when an instance of the prototype is deleted</p><p id="bh6ssn_196">%% All these methods accept an Object of the instance and can edit or perform any other allowed code.</p><p id="bh6ssn_197">%% If any of the methods throw or crash, the whole transaction will rollback.</p><p id="bh6ssn_198">%% If there are any warnings or non-critical errors, it is recommended to log them with available macros, examples:</p><p id="bh6ssn_199">%% ?LOGWARNING( &quot;my warning text: ~p&quot;, [Warning] )</p><p id="bh6ssn_200">%% ?LOGERROR( &quot;my error text: ~p&quot;, [Error] )</p><p id="bh6ssn_201">%% If the methods perform well, they should return the atom 'ok'.</p><p id="bh6ssn_202">%% For more info, please refer to the documentation</p><p id="bh6ssn_203">%%-------------------------------------------------------</p><p id="bh6ssn_204">-module(fp_prototype_Pump).</p><p id="bh6ssn_205">-include(&quot;fp_struct.hrl&quot;).</p><p id="bh6ssn_206">-export([</p><p id="bh6ssn_207"><code class="code" id="bh6ssn_488"></code> on_create/1,</p><p id="bh6ssn_208"><code class="code" id="bh6ssn_489"></code> on_delete/1,</p><p id="bh6ssn_209"><code class="code" id="bh6ssn_490"></code> on_edit/1</p><p id="bh6ssn_210">]).</p><p id="bh6ssn_211">-define(PUMP_STATE_NORMAL, 0).</p><p id="bh6ssn_212">-define(PUMP_STATE_WARNING, 1).</p><p id="bh6ssn_213">-define(PUMP_STATE_ERROR, 2).</p><p id="bh6ssn_214">on_create(Object) -&gt;</p><p id="bh6ssn_215"><code class="code" id="bh6ssn_491"></code> io:format(&quot;Pump instance created: <span id="bh6ssn_492"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="bh6ssn_216"><code class="code" id="bh6ssn_493"></code> ok.</p><p id="bh6ssn_217">on_edit(Object) -&gt;</p><p id="bh6ssn_218">% Проверяем состояние насоса и выполняем соответствующие действия</p><p id="bh6ssn_219"><code class="code" id="bh6ssn_494"></code> case Object#pump.state of</p><p id="bh6ssn_220"><code class="code" id="bh6ssn_495"></code> ?PUMP_STATE_NORMAL -&gt;</p><p id="bh6ssn_221"><code class="code" id="bh6ssn_496"></code> io:format(&quot;Pump is in normal state: <span id="bh6ssn_497"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="bh6ssn_222"><code class="code" id="bh6ssn_498"></code> ok;</p><p id="bh6ssn_223"><code class="code" id="bh6ssn_499"></code> ?PUMP_STATE_WARNING -&gt;</p><p id="bh6ssn_224"><code class="code" id="bh6ssn_500"></code> io:format(&quot;Pump is in warning state: <span id="bh6ssn_501"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="bh6ssn_225"><code class="code" id="bh6ssn_502"></code> ok;</p><p id="bh6ssn_226"><code class="code" id="bh6ssn_503"></code> ?PUMP_STATE_ERROR -&gt;</p><p id="bh6ssn_227"><code class="code" id="bh6ssn_504"></code> io:format(&quot;Pump is in error state: <span id="bh6ssn_505"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="bh6ssn_228"><code class="code" id="bh6ssn_506"></code> ok</p><p id="bh6ssn_229">end.</p><p id="bh6ssn_230">on_delete(Object) -&gt;</p><p id="bh6ssn_231"><code class="code" id="bh6ssn_507"></code> io:format(&quot;Pump instance deleted: <span id="bh6ssn_508"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="bh6ssn_232"><code class="code" id="bh6ssn_509"></code> ok.</p><p id="bh6ssn_233">Этот скрипт добавляет обработку состояния насоса в методе on_edit. В зависимости от состояния насоса он выводит соответствующее сообщение в консоль. Вы можете дополнить скрипт логикой обработки состояний насоса, включая отправку уведомлений, запись в журнал или выполнение дополнительных действий.</p><p id="bh6ssn_234"><span class="control" id="bh6ssn_510">Пример 3:</span></p><p id="bh6ssn_235">Прототипы в SCADA-системах часто имеют набор полей, которые определяют их свойства и характеристики. Для дать определение прототипа на основании этого, мы можем добавить определение полей в Erlang-модуль прототипа. Вот пример определения прототипа на основании всего выше перечисленного:</p><p id="bh6ssn_236">%%--------------------------------------------------------</p><p id="bh6ssn_237">%% This script is executed at the server side. The programming language</p><p id="bh6ssn_238">%% is Erlang.</p><p id="bh6ssn_239">%% The module MUST export next 3 methods:</p><p id="bh6ssn_240">%% * on_create/1 - this method is called when a new instance of the prototype is created.</p><p id="bh6ssn_241">%% * on_edit/1 - this method is called when own fields of an instance of the prototype are edited</p><p id="bh6ssn_242">%% * on_delete/1 - this method is called when an instance of the prototype is deleted</p><p id="bh6ssn_243">%% All these methods accept an Object of the instance and can edit or perform any other allowed code.</p><p id="bh6ssn_244">%% If any of the methods throw or crash, the whole transaction will rollback.</p><p id="bh6ssn_245">%% If there are any warnings or non-critical errors, it is recommended to log them with available macros, examples:</p><p id="bh6ssn_246">%% ?LOGWARNING( &quot;my warning text: ~p&quot;, [Warning] )</p><p id="bh6ssn_247">%% ?LOGERROR( &quot;my error text: ~p&quot;, [Error] )</p><p id="bh6ssn_248">%% If the methods perform well, they should return the atom 'ok'.</p><p id="bh6ssn_249">%% For more info, please refer to the documentation</p><p id="bh6ssn_250">%%--------------------------------------------------------</p><p id="bh6ssn_251">-module(fp_prototype_Pump).</p><p id="bh6ssn_252">-include(&quot;fp_struct.hrl&quot;).</p><p id="bh6ssn_253">-export([</p><p id="bh6ssn_254"><code class="code" id="bh6ssn_511"></code> on_create/1,</p><p id="bh6ssn_255"><code class="code" id="bh6ssn_512"></code> on_delete/1,</p><p id="bh6ssn_256"><code class="code" id="bh6ssn_513"></code> on_edit/1</p><p id="bh6ssn_257">]).</p><p id="bh6ssn_258">-record(pump, {</p><p id="bh6ssn_259"><code class="code" id="bh6ssn_514"></code> id :: string(),</p><p id="bh6ssn_260"><code class="code" id="bh6ssn_515"></code> name :: string(),</p><p id="bh6ssn_261"><code class="code" id="bh6ssn_516"></code> type :: string(),</p><p id="bh6ssn_262"><code class="code" id="bh6ssn_517"></code> state :: integer()</p><p id="bh6ssn_263">}).</p><p id="bh6ssn_264">-define(PUMP_STATE_NORMAL, 0).</p><p id="bh6ssn_265">-define(PUMP_STATE_WARNING, 1).</p><p id="bh6ssn_266">-define(PUMP_STATE_ERROR, 2).</p><p id="bh6ssn_267">on_create(Object) -&gt;</p><p id="bh6ssn_268"><code class="code" id="bh6ssn_518"></code> io:format(&quot;Pump instance created: <span id="bh6ssn_519"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="bh6ssn_269"><code class="code" id="bh6ssn_520"></code> ok.</p><p id="bh6ssn_270">on_edit(Object) -&gt;</p><p id="bh6ssn_271">% Проверяем состояние насоса и выполняем соответствующие действия</p><p id="bh6ssn_272"><code class="code" id="bh6ssn_521"></code> case Object#pump.state of</p><p id="bh6ssn_273"><code class="code" id="bh6ssn_522"></code> ?PUMP_STATE_NORMAL -&gt;</p><p id="bh6ssn_274"><code class="code" id="bh6ssn_523"></code> io:format(&quot;Pump is in normal state: <span id="bh6ssn_524"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="bh6ssn_275"><code class="code" id="bh6ssn_525"></code> ok;</p><p id="bh6ssn_276"><code class="code" id="bh6ssn_526"></code> ?PUMP_STATE_WARNING -&gt;</p><p id="bh6ssn_277"><code class="code" id="bh6ssn_527"></code> io:format(&quot;Pump is in warning state: <span id="bh6ssn_528"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="bh6ssn_278"><code class="code" id="bh6ssn_529"></code> ok;</p><p id="bh6ssn_279"><code class="code" id="bh6ssn_530"></code> ?PUMP_STATE_ERROR -&gt;</p><p id="bh6ssn_280"><code class="code" id="bh6ssn_531"></code> io:format(&quot;Pump is in error state: <span id="bh6ssn_532"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="bh6ssn_281"><code class="code" id="bh6ssn_533"></code> ok</p><p id="bh6ssn_282">end.</p><p id="bh6ssn_283">on_delete(Object) -&gt;</p><p id="bh6ssn_284"><code class="code" id="bh6ssn_534"></code> io:format(&quot;Pump instance deleted: <span id="bh6ssn_535"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="bh6ssn_285"><code class="code" id="bh6ssn_536"></code> ok.</p><p id="bh6ssn_286">В этом примере добавлено определение полей прототипа pump, включая id, name, type и state. Для каждого поля указан тип данных. Теперь прототип насоса имеет определенную структуру данных, которая позволяет представлять его свойства и характеристики.</p><section class="chapter"><h3 id="3-json-iot" data-toc="3-json-iot"><a name=""></a><span class="control" id="bh6ssn_540">3. Обработка валидных JSON-данных для IoT-соединений</span></h3><p id="bh6ssn_538">JSON-шаблоны играют ключевую роль в передаче данных между SCADA-системой и внешними системами в контексте IIoT. С помощью JSON-шаблонов можно получать данные с датчиков, отправлять команды управления и запросы на получение исторических данных.</p></section><section class="chapter"><h3 id="3-1-json" data-toc="3-1-json"><a name=""></a><span class="control" id="bh6ssn_542">3.1 Json-шаблоны</span></h3><p id="bh6ssn_292">JSON (JavaScript Object Notation) - это легкий формат обмена данными, который широко используется для передачи структурированной информации между приложениями. В контексте IIoT-платформы, JSON-шаблоны играют ключевую роль в обмене данными с внешними системами. Вот как их создавать, использовать и примеры их применения:</p><p id="bh6ssn_293"><span class="emphasis" id="bh6ssn_543">Создание JSON-шаблонов:</span></p><p id="bh6ssn_294">&bull; Определите структуру данных: Прежде всего, определите, какие данные вы хотите передавать или получать. Разбейте их на логические блоки или объекты.</p><p id="bh6ssn_295">&bull; Определите ключи и значения: Для каждого блока данных определите ключи и соответствующие значения. Ключи представляют собой названия атрибутов, а значения - сами данные.</p><p id="bh6ssn_296">&bull; Следуйте синтаксису JSON: Убедитесь, что ваш JSON-шаблон соответствует синтаксису JSON. Он должен состоять из пар &quot;ключ: значение&quot;, разделенных запятыми, и ограниченных фигурными скобками для объектов.</p><p id="bh6ssn_297"><span class="emphasis" id="bh6ssn_544">Использование JSON-шаблонов:</span></p><p id="bh6ssn_298">&bull; Прием данных: Для приема данных из внешних систем, IIoT-платформа считывает JSON-шаблон, а затем обрабатывает полученные данные в соответствии с вашей логикой (скриптом).</p><p id="bh6ssn_299">&bull; Отправка данных: Для отправки данных во внешние системы, сначала сформируйте JSON-шаблон в соответствии с требованиями внешней системы, затем отправьте его через соответствующий канал связи.</p><p id="bh6ssn_300"><span class="emphasis" id="bh6ssn_545">Использование различных структур данных в JSON-шаблонах.</span></p><p id="bh6ssn_301">Синтаксис JSON-шаблонов для IIoT-платформ может быть таким же, как и для обычных JSON-данных.</p><p id="bh6ssn_302">В качестве значений в JSON-шаблонах могут передаваться как простые типы данных (переменные), так и массивы, и другие более сложные типы.</p><p id="bh6ssn_303">Примеры типов данных, которые могут быть использованы в JSON-шаблонах IIoT-платформ:</p><p id="bh6ssn_304">a) Массивы (Arrays):</p><p id="bh6ssn_305">{</p><p id="bh6ssn_306"><code class="code" id="bh6ssn_546"></code> &quot;sensorData&quot;: {</p><p id="bh6ssn_307"><code class="code" id="bh6ssn_547"></code> &quot;temperatures&quot;: [25.5, 26.1, 24.8],</p><p id="bh6ssn_308"><code class="code" id="bh6ssn_416"></code> &quot;humidities&quot;: [60, 62, 58]</p><p id="bh6ssn_309"><code class="code" id="bh6ssn_548"></code>}</p><p id="bh6ssn_310">}</p><p id="bh6ssn_311">b) Объекты (Objects):</p><p id="bh6ssn_312">{</p><p id="bh6ssn_313"><code class="code" id="bh6ssn_549"></code> &quot;sensorData&quot;: {</p><p id="bh6ssn_314"><code class="code" id="bh6ssn_550"></code> &quot;location&quot;: {</p><p id="bh6ssn_315"><code class="code" id="bh6ssn_551"></code> &quot;latitude&quot;: 40.7128,</p><p id="bh6ssn_316"><code class="code" id="bh6ssn_552"></code> &quot;longitude&quot;: -74.0060</p><p id="bh6ssn_317"><code class="code" id="bh6ssn_553"></code>}</p><p id="bh6ssn_318"><code class="code" id="bh6ssn_554"></code>}</p><p id="bh6ssn_319">}</p><p id="bh6ssn_320">c) Строки (Strings), Числа (Numbers), Логические значения (Boolean):</p><p id="bh6ssn_321">{</p><p id="bh6ssn_322"><code class="code" id="bh6ssn_555"></code> &quot;equipmentStatus&quot;: {</p><p id="bh6ssn_323"><code class="code" id="bh6ssn_556"></code> &quot;pump1&quot;: true,</p><p id="bh6ssn_324"><code class="code" id="bh6ssn_557"></code> &quot;pump2&quot;: false,</p><p id="bh6ssn_325"><code class="code" id="bh6ssn_558"></code> &quot;errorCode&quot;: 123,</p><p id="bh6ssn_326"><code class="code" id="bh6ssn_559"></code> &quot;message&quot;: &quot;Pump overheating&quot;</p><p id="bh6ssn_327"><code class="code" id="bh6ssn_560"></code>}</p><p id="bh6ssn_328">}</p><p id="bh6ssn_329">d) Null-значения (Null):</p><p id="bh6ssn_330">{</p><p id="bh6ssn_331"><code class="code" id="bh6ssn_561"></code> &quot;configuration&quot;: {</p><p id="bh6ssn_332"><code class="code" id="bh6ssn_562"></code> &quot;timeout&quot;: null</p><p id="bh6ssn_333"><code class="code" id="bh6ssn_563"></code>}</p><p id="bh6ssn_334">}</p><p id="bh6ssn_335">e) Вложенные структуры (Nested Structures):</p><p id="bh6ssn_336">{</p><p id="bh6ssn_337"><code class="code" id="bh6ssn_564"></code> &quot;productionData&quot;: {</p><p id="bh6ssn_338"><code class="code" id="bh6ssn_565"></code> &quot;line1&quot;: {</p><p id="bh6ssn_339"><code class="code" id="bh6ssn_566"></code> &quot;output&quot;: 500,</p><p id="bh6ssn_340"><code class="code" id="bh6ssn_567"></code> &quot;defects&quot;: [&quot;Scratch&quot;, &quot;Crack&quot;]</p><p id="bh6ssn_341"><code class="code" id="bh6ssn_568"></code>},</p><p id="bh6ssn_342"><code class="code" id="bh6ssn_569"></code> &quot;line2&quot;: {</p><p id="bh6ssn_343"><code class="code" id="bh6ssn_570"></code> &quot;output&quot;: 600,</p><p id="bh6ssn_344"><code class="code" id="bh6ssn_571"></code> &quot;defects&quot;: [&quot;Chip&quot;]</p><p id="bh6ssn_345"><code class="code" id="bh6ssn_572"></code>}</p><p id="bh6ssn_346"><code class="code" id="bh6ssn_573"></code>}</p><p id="bh6ssn_347">}</p><p id="bh6ssn_348"><span class="emphasis" id="bh6ssn_574">Примеры использования JSON-шаблонов:</span></p><p id="bh6ssn_349">a) Пример JSON-данных для передачи данных о температуре и влажности с датчиков в IIoT-платформу:</p><p id="bh6ssn_350">{</p><p id="bh6ssn_351"><code class="code" id="bh6ssn_575"></code> &quot;sensorData&quot;: {</p><p id="bh6ssn_352"><code class="code" id="bh6ssn_576"></code> &quot;temperature&quot;: 25.5,</p><p id="bh6ssn_353"><code class="code" id="bh6ssn_577"></code> &quot;humidity&quot;: 60</p><p id="bh6ssn_354"><code class="code" id="bh6ssn_578"></code>}</p><p id="bh6ssn_355">}</p><p id="bh6ssn_356">b) Пример JSON-данных для управления устройством через IIoT-платформу:</p><p id="bh6ssn_357">{</p><p id="bh6ssn_358"><code class="code" id="bh6ssn_579"></code> &quot;deviceControl&quot;: {</p><p id="bh6ssn_359"><code class="code" id="bh6ssn_580"></code> &quot;deviceId&quot;: &quot;123456&quot;,</p><p id="bh6ssn_360"><code class="code" id="bh6ssn_581"></code> &quot;command&quot;: &quot;on&quot;</p><p id="bh6ssn_361"><code class="code" id="bh6ssn_582"></code>}</p><p id="bh6ssn_362">}</p><p id="bh6ssn_363">c) Пример JSON-данных для получения данных о состоянии оборудования из IIoT-платформы:</p><p id="bh6ssn_364">{</p><p id="bh6ssn_365"><code class="code" id="bh6ssn_583"></code> &quot;equipmentStatus&quot;: {</p><p id="bh6ssn_366"><code class="code" id="bh6ssn_417"></code> &quot;pump1&quot;: &quot;running&quot;,</p><p id="bh6ssn_367"><code class="code" id="bh6ssn_584"></code> &quot;pump2&quot;: &quot;stopped&quot;</p><p id="bh6ssn_368"><code class="code" id="bh6ssn_585"></code>}</p><p id="bh6ssn_369">}</p><p id="bh6ssn_370">d) Пример JSON-данных для передачи данных о производственных параметрах:</p><p id="bh6ssn_371">{</p><p id="bh6ssn_372"><code class="code" id="bh6ssn_586"></code> &quot;productionData&quot;: {</p><p id="bh6ssn_373"><code class="code" id="bh6ssn_587"></code> &quot;machineId&quot;: &quot;123&quot;,</p><p id="bh6ssn_374"><code class="code" id="bh6ssn_588"></code> &quot;temperature&quot;: 180,</p><p id="bh6ssn_375"><code class="code" id="bh6ssn_589"></code> &quot;pressure&quot;: 45,</p><p id="bh6ssn_376"><code class="code" id="bh6ssn_590"></code> &quot;output&quot;: 500</p><p id="bh6ssn_377"><code class="code" id="bh6ssn_591"></code>}</p><p id="bh6ssn_378">}</p><p id="bh6ssn_379">e) Пример JSON-данных для управления режимами работы оборудования:</p><p id="bh6ssn_380">{</p><p id="bh6ssn_381"><code class="code" id="bh6ssn_592"></code> &quot;equipmentControl&quot;: {</p><p id="bh6ssn_382"><code class="code" id="bh6ssn_593"></code> &quot;deviceId&quot;: &quot;789&quot;,</p><p id="bh6ssn_383"><code class="code" id="bh6ssn_594"></code> &quot;mode&quot;: &quot;manual&quot;,</p><p id="bh6ssn_384"><code class="code" id="bh6ssn_595"></code> &quot;settings&quot;: {</p><p id="bh6ssn_385"><code class="code" id="bh6ssn_596"></code> &quot;speed&quot;: 50,</p><p id="bh6ssn_386"><code class="code" id="bh6ssn_597"></code> &quot;temperatureSetpoint&quot;: 200</p><p id="bh6ssn_387"><code class="code" id="bh6ssn_598"></code>}</p><p id="bh6ssn_388"><code class="code" id="bh6ssn_599"></code>}</p><p id="bh6ssn_389">}</p><p id="bh6ssn_390">f) Пример JSON-данных для передачи событий и аварий:</p><p id="bh6ssn_391">{</p><p id="bh6ssn_392"><code class="code" id="bh6ssn_600"></code> &quot;alarmData&quot;: {</p><p id="bh6ssn_393"><code class="code" id="bh6ssn_601"></code> &quot;alarmId&quot;: &quot;ABC123&quot;,</p><p id="bh6ssn_394"><code class="code" id="bh6ssn_602"></code> &quot;severity&quot;: &quot;high&quot;,</p><p id="bh6ssn_395"><code class="code" id="bh6ssn_603"></code> &quot;description&quot;: &quot;Critical temperature threshold exceeded&quot;,</p><p id="bh6ssn_396"><code class="code" id="bh6ssn_604"></code> &quot;timestamp&quot;: &quot;2024-05-02T10:30:00&quot;</p><p id="bh6ssn_397"><code class="code" id="bh6ssn_605"></code>}</p><p id="bh6ssn_398">}</p><p id="bh6ssn_399">g) Пример JSON-данных для запроса исторических данных:</p><p id="bh6ssn_400">{</p><p id="bh6ssn_401"><code class="code" id="bh6ssn_606"></code> &quot;historicalDataRequest&quot;: {</p><p id="bh6ssn_402"><code class="code" id="bh6ssn_607"></code> &quot;startDate&quot;: &quot;2024-04-01&quot;,</p><p id="bh6ssn_403"><code class="code" id="bh6ssn_608"></code> &quot;endDate&quot;: &quot;2024-04-30&quot;,</p><p id="bh6ssn_404"><code class="code" id="bh6ssn_609"></code> &quot;parameters&quot;: [&quot;temperature&quot;, &quot;pressure&quot;, &quot;output&quot;]</p><p id="bh6ssn_405"><code class="code" id="bh6ssn_610"></code>}</p><p id="bh6ssn_406">}</p><p id="bh6ssn_407">h) Пример JSON-данных для передачи информации о системных настройках:</p><p id="bh6ssn_408">{</p><p id="bh6ssn_409"><code class="code" id="bh6ssn_611"></code> &quot;systemSettings&quot;: {</p><p id="bh6ssn_410"><code class="code" id="bh6ssn_612"></code> &quot;samplingRate&quot;: 1000,</p><p id="bh6ssn_411"><code class="code" id="bh6ssn_613"></code> &quot;language&quot;: &quot;en&quot;,</p><p id="bh6ssn_412"><code class="code" id="bh6ssn_614"></code> &quot;timezone&quot;: &quot;UTC+3&quot;</p><p id="bh6ssn_413"><code class="code" id="bh6ssn_615"></code>}</p><p id="bh6ssn_414">}</p><section class="chapter"><h4 id="bh6ssn_415" data-toc="bh6ssn_415"></h4></section></section><section class="chapter"><h3 id="4-json" data-toc="4-json"><a name=""></a><span class="control" id="bh6ssn_657">4. Использование скриптов для обработки поступивших Json-данных</span></h3><p id="bh6ssn_617"><span class="emphasis" id="bh6ssn_658">Скрипт Erlang для обработки JSON-данных:</span></p><p id="bh6ssn_618">-module(json_handler).</p><p id="bh6ssn_619">-export([process_json/1]).</p><p id="bh6ssn_620">% Функция для обработки JSON-данных</p><p id="bh6ssn_621">process_json(JsonData) -&gt;</p><p id="bh6ssn_622">% Парсим JSON</p><p id="bh6ssn_623">{ok, Json} = jsx:decode(JsonData),</p><p id="bh6ssn_624"><code class="code" id="bh6ssn_659"></code>% Выполняем операции в зависимости от типа данных</p><p id="bh6ssn_625"><code class="code" id="bh6ssn_660"></code> case proplists:get_value(&lt;&lt;&quot;sensorData&quot;&gt;&gt;, Json) of</p><p id="bh6ssn_626"><code class="code" id="bh6ssn_661"></code> undefined -&gt;</p><p id="bh6ssn_627"><code class="code" id="bh6ssn_662"></code> io:format(&quot;Unknown JSON data: <span id="bh6ssn_663"><sub class="subscript">p</sub></span>n&quot;, [Json]);</p><p id="bh6ssn_628"><code class="code" id="bh6ssn_664"></code> SensorData -&gt;</p><p id="bh6ssn_629"><code class="code" id="bh6ssn_665"></code>% Обрабатываем данные о датчиках</p><p id="bh6ssn_630"><code class="code" id="bh6ssn_666"></code> process_sensor_data(SensorData)</p><p id="bh6ssn_631"><code class="code" id="bh6ssn_667"></code> end.</p><p id="bh6ssn_632">% Функция для обработки данных о датчиках</p><p id="bh6ssn_633">process_sensor_data(SensorData) -&gt;</p><p id="bh6ssn_634">Temperature = proplists:get_value(&lt;&lt;&quot;temperature&quot;&gt;&gt;, SensorData),</p><p id="bh6ssn_635">Humidity = proplists:get_value(&lt;&lt;&quot;humidity&quot;&gt;&gt;, SensorData),</p><p id="bh6ssn_636">io:format(&quot;Received sensor data - Temperature: ~p, Humidity: <span id="bh6ssn_668"><sub class="subscript">p</sub></span>n&quot;, [Temperature, Humidity]).</p><p id="bh6ssn_637"><span class="emphasis" id="bh6ssn_669">Скрипт JavaScript для обработки JSON-данных:</span></p><p id="bh6ssn_638">// Функция для обработки JSON-данных</p><p id="bh6ssn_639">function processJson(jsonData) {</p><p id="bh6ssn_640"><code class="code" id="bh6ssn_670"></code>// Разбираем (&quot;парсим&quot;) JSON</p><p id="bh6ssn_641"><code class="code" id="bh6ssn_671"></code> const json = JSON.parse(jsonData);</p><p id="bh6ssn_642"><code class="code" id="bh6ssn_672"></code>// Выполняем операции в зависимости от типа данных</p><p id="bh6ssn_643"><code class="code" id="bh6ssn_673"></code> if (json.sensorData) {</p><p id="bh6ssn_644"><code class="code" id="bh6ssn_674"></code>// Обрабатываем данные о датчиках</p><p id="bh6ssn_645"><code class="code" id="bh6ssn_675"></code> processSensorData(json.sensorData);</p><p id="bh6ssn_646"><code class="code" id="bh6ssn_676"></code>} else {</p><p id="bh6ssn_647"><code class="code" id="bh6ssn_677"></code> console.log(&quot;Unknown JSON data:&quot;, json);</p><p id="bh6ssn_648"><code class="code" id="bh6ssn_678"></code>}</p><p id="bh6ssn_649">}</p><p id="bh6ssn_650">// Функция для обработки данных о датчиках</p><p id="bh6ssn_651">function processSensorData(sensorData) {</p><p id="bh6ssn_652"><code class="code" id="bh6ssn_679"></code> const temperature = sensorData.temperature;</p><p id="bh6ssn_653"><code class="code" id="bh6ssn_680"></code> const humidity = sensorData.humidity;</p><p id="bh6ssn_654"><code class="code" id="bh6ssn_681"></code> console.log(<code class="code" id="bh6ssn_682">Received sensor data - Temperature: ${temperature}, Humidity: ${humidity}</code>);</p><p id="bh6ssn_655">}</p></section><section class="chapter"><h3 id="5" data-toc="5"><a name=""></a><span class="control" id="bh6ssn_704">5. Создание и настройка архивов</span></h3><p id="bh6ssn_684">Архивы предназначены для долгосрочного хранения данных в SCADA-системе. В каждом архиве можно задавать параметры, такие как периодичность записи, источник данных и глубина хранения.</p><p id="bh6ssn_685">Одним из основных элементов для создания архива является привязка, которую можно определить с помощью скрипта, что позволяет выполнять дополнительную обработку архивируемого значения (например, вычисление среднего по нескольким точкам измерения) и вычислять значения архива по нескольким входным параметрам (например, сумма показаний нескольких расходомеров); возвращаемые из скрипта значения, сохраняются в базе архивов.</p><p id="bh6ssn_686"><span class="control" id="bh6ssn_705">Пример</span> скрипта для обработки данных в архиве:</p><p id="bh6ssn_687">Сначала следует выбрать один из двух языков программирования скрипта - Erlang или Javascript. Затем ввести переменную и выбрать источник значений показателя для скрипта.</p><figure id="bh6ssn_688"><img alt="Aspose words 7e55d7ce c0e4 4a18 9a16 39bde3184163 001" src="${primarySource}" title="Aspose words 7e55d7ce c0e4 4a18 9a16 39bde3184163 001"></figure><p id="bh6ssn_689"><span class="control" id="bh6ssn_706">Пример</span> скрипта для вычисления скользящего среднего по последним 10 значениям для Erlang:</p><p id="bh6ssn_690">%% Script must be an Erlang fun of arity 2.</p><p id="bh6ssn_691">%% - VARS argument is a map that contains</p><p id="bh6ssn_692">%% values for the defined variables.</p><p id="bh6ssn_693">%% Key - variable name, Value - variable value</p><p id="bh6ssn_694">%% - State is an argument that can be used as an accumulator.</p><p id="bh6ssn_695">%% It keeps the value of the accumulator that was returned</p><p id="bh6ssn_696">%% from the previous call</p><p id="bh6ssn_697">%% The function must return a tuple:</p><p id="bh6ssn_698">%% {, }</p><p id="bh6ssn_699">%%</p><p id="bh6ssn_700">fun(VARS,_State)-&gt;</p><p id="bh6ssn_701"><code class="code" id="bh6ssn_709"></code>% Extract the current value from VARS</p><p id="bh6ssn_702"><code class="code" id="bh6ssn_710"></code> CurrentValue = maps:get(&quot;var_1&quot;, VARS, 0),</p></section></li></ul><p id="bh6ssn_16"><code class="code" id="bh6ssn_711"></code>% Initialize or update the list of last 10 values</p><p id="bh6ssn_17"><code class="code" id="bh6ssn_712"></code> ValuesList = case State of</p><p id="bh6ssn_18"><code class="code" id="bh6ssn_713"></code> undefined -&gt;</p><p id="bh6ssn_19"><code class="code" id="bh6ssn_714"></code> [CurrentValue]; % Initialize the state if it is undefined</p><p id="bh6ssn_20"><code class="code" id="bh6ssn_715"></code>_ when is_list(State) -&gt;</p><p id="bh6ssn_21"><code class="code" id="bh6ssn_716"></code> [CurrentValue | State] % Add the new value to the list</p><p id="bh6ssn_22"><code class="code" id="bh6ssn_717"></code> end,</p><p id="bh6ssn_23"><code class="code" id="bh6ssn_718"></code>% Keep only the last 10 values</p><p id="bh6ssn_24"><code class="code" id="bh6ssn_719"></code> TrimmedList = lists:sublist(ValuesList, min(length(ValuesList), 10)),</p><p id="bh6ssn_25"><code class="code" id="bh6ssn_720"></code>% Calculate the moving average</p><p id="bh6ssn_26"><code class="code" id="bh6ssn_721"></code> Avg = case TrimmedList of</p><p id="bh6ssn_27"><code class="code" id="bh6ssn_722"></code> [] -&gt;</p><p id="bh6ssn_28"><code class="code" id="bh6ssn_723"></code> 0; % Avoid division by zero</p><p id="bh6ssn_29"><code class="code" id="bh6ssn_724"></code>_ -&gt;</p><p id="bh6ssn_30"><code class="code" id="bh6ssn_725"></code> lists:sum(TrimmedList) / length(TrimmedList)</p><p id="bh6ssn_31"><code class="code" id="bh6ssn_726"></code> end,</p><p id="bh6ssn_32"><code class="code" id="bh6ssn_727"></code>% Return the calculated average and updated state</p><p id="bh6ssn_33"><code class="code" id="bh6ssn_728"></code> {Avg, TrimmedList}</p><p id="bh6ssn_34">end.</p><p id="bh6ssn_35"><span class="control" id="bh6ssn_729">Пример</span> скрипта для вычисления скользящего среднего по последним 10 значениям для Javascript:</p><p id="bh6ssn_36">// Script must be an Javascript fun of arity 2.</p><p id="bh6ssn_37">// - VARS argument is a map that contains</p><p id="bh6ssn_38">// values for the defined variables.</p><p id="bh6ssn_39">// Key - variable name, Value - variable value</p><p id="bh6ssn_40">// - State is an argument that can be used as an accumulator.</p><p id="bh6ssn_41">// It keeps the value of the accumulator that was returned</p><p id="bh6ssn_42">// from the previous call</p><p id="bh6ssn_43">// The function must return an object:</p><p id="bh6ssn_44">// { value: , state: }</p><p id="bh6ssn_45">//</p><p id="bh6ssn_46">async function(VARS, State) {</p><p id="bh6ssn_47"><code class="code" id="bh6ssn_732"></code>// Extract the current value from VARS</p><p id="bh6ssn_48"><code class="code" id="bh6ssn_733"></code> let currentValue = VARS.var_1 || 0; // Default to 0 if var_1 is undefined</p><p id="bh6ssn_49"><code class="code" id="bh6ssn_734"></code>// Initialize or update the list of the last 10 values</p><p id="bh6ssn_50"><code class="code" id="bh6ssn_735"></code> let valuesList = Array.isArray(State) ? State : []; // Ensure State is an array</p><p id="bh6ssn_51"><code class="code" id="bh6ssn_736"></code> valuesList = [currentValue, ...valuesList]; // Add the current value to the beginning</p><p id="bh6ssn_52"><code class="code" id="bh6ssn_737"></code>// Keep only the last 10 values</p><p id="bh6ssn_53"><code class="code" id="bh6ssn_738"></code> if (valuesList.length &gt; 10) {</p><p id="bh6ssn_54"><code class="code" id="bh6ssn_739"></code> valuesList = valuesList.slice(0, 10);</p><p id="bh6ssn_55"><code class="code" id="bh6ssn_740"></code>}</p><p id="bh6ssn_56"><code class="code" id="bh6ssn_741"></code>// Calculate the moving average</p><p id="bh6ssn_57"><code class="code" id="bh6ssn_742"></code> let avg = valuesList.reduce((sum, val) =&gt; sum + val, 0) / valuesList.length;</p><p id="bh6ssn_58"><code class="code" id="bh6ssn_743"></code>// Return the calculated average and updated state</p><p id="bh6ssn_59"><code class="code" id="bh6ssn_744"></code> return { value: avg, state: valuesList };</p><p id="bh6ssn_60">}</p><p id="bh6ssn_61">Для компиляции скрипта необходимо нажать кнопку <img alt="Aspose words 7e55d7ce c0e4 4a18 9a16 39bde3184163 004" src="${primarySource}" class="inline-icon-" title="Aspose words 7e55d7ce c0e4 4a18 9a16 39bde3184163 004" id="bh6ssn_745"></p><p id="bh6ssn_62">Если компиляция выполнена без ошибок, то напротив кнопки компиляции появится надпись &ldquo;ok&rdquo;, иначе будет выведен список ошибок, например:</p><figure id="bh6ssn_63"><img alt="Aspose words 7e55d7ce c0e4 4a18 9a16 39bde3184163 005" src="${primarySource}" title="Aspose words 7e55d7ce c0e4 4a18 9a16 39bde3184163 005"></figure><p id="bh6ssn_64"><span class="control" id="bh6ssn_746">Общий принцип работы:</span></p><ul class="list _bullet" id="bh6ssn_65"><li class="list__item" id="bh6ssn_747"><p id="bh6ssn_753">Система архивирования считывает значения из полей тегов, к которым привязаны объявленные переменные.</p></li><li class="list__item" id="bh6ssn_748"><p id="bh6ssn_754">Выполняется вызов скрипта с передачей на вход map со значениями переменных.</p></li><li class="list__item" id="bh6ssn_749"><p id="bh6ssn_755">Сохранение в базу архивов значений переменных, возвращаемых из скрипта.</p><section class="chapter"><h3 id="6-power-factory-fp-powerfactory-service" data-toc="6-power-factory-fp-powerfactory-service"><a name=""></a><span class="control" id="bh6ssn_761">6. Интеграция с Power Factory (fp_powerfactory_service)</span></h3><p id="bh6ssn_758">Взаимодействие между Faceplate и PowerFactory организовано через промежуточный сервис <span class="control" id="bh6ssn_762">server.py</span>, который предоставляет необходимый Json API. Передача данных между Faceplate и <span class="control" id="bh6ssn_763">server.py</span> осуществляется с использованием протокола HTTP.</p><p id="bh6ssn_759">Модуль интеграции в Faceplate выполняет следующие задачи:</p></section></li><li class="list__item" id="bh6ssn_750"><p id="bh6ssn_764">формирование и отправка json-данных в сервис <span class="control" id="bh6ssn_765">server.py</span>;</p></li><li class="list__item" id="bh6ssn_751"><p id="bh6ssn_766">обработка результатов запросов;</p></li><li class="list__item" id="bh6ssn_752"><p id="bh6ssn_767">сохранение полученных данных в базу Faceplate.</p></li></ul><p id="bh6ssn_66">Сервис server.py определяет следующие api-функции:</p><p id="bh6ssn_67"><code class="code" id="bh6ssn_768"></code> create</p><p id="bh6ssn_68"><code class="code" id="bh6ssn_769"></code> check</p><p id="bh6ssn_69"><code class="code" id="bh6ssn_770"></code> execute</p><p id="bh6ssn_70"><code class="code" id="bh6ssn_771"></code> dynamics</p><p id="bh6ssn_71"><code class="code" id="bh6ssn_772"></code> get_links</p><p id="bh6ssn_72"><code class="code" id="bh6ssn_773"></code> get_type_library</p><p id="bh6ssn_73"><code class="code" id="bh6ssn_774"></code> get</p><p id="bh6ssn_74"><code class="code" id="bh6ssn_775"></code> update</p><p id="bh6ssn_75"><code class="code" id="bh6ssn_776"></code> weightings.</p><p id="bh6ssn_76">Для каждой из этих функций предусмотрен соответствующий Json-шаблон, обеспечивающий стандартизацию запросов и их обработки.</p><p id="bh6ssn_77">В общем виде, формат отправляемого json:</p><p id="bh6ssn_78">{</p><p id="bh6ssn_79"><code class="code" id="bh6ssn_777"></code> &quot;project_params&quot;: {</p><p id="bh6ssn_80"><code class="code" id="bh6ssn_778"></code> &quot;project_name&quot;: project_name,</p><p id="bh6ssn_81"><code class="code" id="bh6ssn_779"></code> &quot;study_case_name&quot;: study_case_name,</p><p id="bh6ssn_82"><code class="code" id="bh6ssn_780"></code> &quot;operation_scenario_name&quot;: operation_scenario_name,</p><p id="bh6ssn_83"><code class="code" id="bh6ssn_781"></code> &quot;grid_name&quot;: grid_name,</p><p id="bh6ssn_84"><code class="code" id="bh6ssn_782"></code> &quot;func_name&quot;: func_name,</p><p id="bh6ssn_85"><code class="code" id="bh6ssn_783"></code> &quot;id&quot;: user_id</p><p id="bh6ssn_86"><code class="code" id="bh6ssn_784"></code> &quot;session_type&quot;: session_type</p><p id="bh6ssn_87"><code class="code" id="bh6ssn_785"></code>},</p><p id="bh6ssn_88"><code class="code" id="bh6ssn_786"></code> pf_element_1_typename: pf_element_1_params</p><p id="bh6ssn_89"><code class="code" id="bh6ssn_787"></code> pf_element_2_typename: pf_element_2_params</p><p id="bh6ssn_90">...</p><p id="bh6ssn_91"><code class="code" id="bh6ssn_788"></code> pf_element_N_typename: pf_element_N_params</p><p id="bh6ssn_92">}</p><p id="bh6ssn_93">Объект project_params содержит параметры проекта PowerFactory, для которого выполняется запрос, а также название выполняемой функции.</p><p id="bh6ssn_94">Поля pf_element_1_typename, pf_element_2_typename, pf_element_N_typename соответствуют названиям типов элементов в PowerFactory, используемых для расчетов, либо для загрузки/выгрузки данных в PowerFactory.</p><p id="bh6ssn_95">В объектах pf_element_1_params, pf_element_2_params, pf_element_N_params находятся данные самих объектов соответствующих типов, необходимые для соответствующей функции.</p><p id="bh6ssn_96">Например:</p><p id="bh6ssn_97"><code class="code" id="bh6ssn_789"></code> &quot;ElmTr3&quot;: {</p><p id="bh6ssn_98"><code class="code" id="bh6ssn_790"></code> &quot;Grid\KAZ\ZAPAD\Kulsary/220/AT2&quot;: {</p><p id="bh6ssn_99"><code class="code" id="bh6ssn_791"></code> &quot;links&quot;: {</p><p id="bh6ssn_100"><code class="code" id="bh6ssn_792"></code> &quot;busmv&quot;: &quot;none&quot;,</p><p id="bh6ssn_101"><code class="code" id="bh6ssn_418"></code> &quot;buslv&quot;: &quot;Grid\KAZ\ZAPAD\Kulsary/110/AT2 term&quot;,</p><p id="bh6ssn_102"><code class="code" id="bh6ssn_793"></code> &quot;bushv&quot;: &quot;Grid\KAZ\ZAPAD\Kulsary/220/AT2/term&quot;</p><p id="bh6ssn_103"><code class="code" id="bh6ssn_419"></code>}</p><p id="bh6ssn_104"><code class="code" id="bh6ssn_420"></code>},</p><p id="bh6ssn_105"><code class="code" id="bh6ssn_421"></code> &quot;Grid\KAZ\ALMATY\SHU/220/AT1&quot;: {</p><p id="bh6ssn_106"><code class="code" id="bh6ssn_422"></code> &quot;links&quot;: {</p><p id="bh6ssn_107"><code class="code" id="bh6ssn_423"></code> &quot;busmv&quot;: &quot;none&quot;,</p><p id="bh6ssn_108"><code class="code" id="bh6ssn_424"></code> &quot;buslv&quot;: &quot;Grid\KAZ\ALMATY\SHU/110/AT1 term&quot;,</p><p id="bh6ssn_109"><code class="code" id="bh6ssn_425"></code> &quot;bushv&quot;: &quot;Grid\KAZ\ALMATY\SHU/220/AT1/term&quot;</p><p id="bh6ssn_110"><code class="code" id="bh6ssn_794"></code>}</p><p id="bh6ssn_111"><code class="code" id="bh6ssn_795"></code>},</p></section><section class="chapter"><h2 id="6-1" data-toc="6-1"><a name=""></a><span class="control" id="bh6ssn_927">6.1 Файл настроек</span></h2><p id="bh6ssn_797">Для формирования соответствующего json, на стороне fp_powerfactory_service (см. Приложение А.8) используется файл настроек, находящийся в приватной директории модуля:</p><p id="bh6ssn_798">../lib/fp_powerfactory_service/priv/fp2pf_mapping.json.</p><p id="bh6ssn_799">В данном файле определяются функции, типы объектов powerfactory, с которыми работают функции и маппинг полей прототипов faceplate на атрибуты соответствующих классов объектов в PowerFactory:</p><p id="bh6ssn_800">\1) Маппинг полей прототипов faceplate на атрибуты соответствующих классов объектов в PowerFactory определяется в разделе &quot;_elements&quot; настроечного файла\.</p><p id="bh6ssn_801">Пример:</p><p id="bh6ssn_802">&quot;ElmLne&quot;: {</p><p id="bh6ssn_803"><code class="code" id="bh6ssn_928"></code> &quot;_prototype&quot;: &quot;line&quot;,</p><p id="bh6ssn_804"><code class="code" id="bh6ssn_929"></code> &quot;$path&quot;: {</p><p id="bh6ssn_805"><code class="code" id="bh6ssn_930"></code> &quot;pf_attr&quot;: {</p><p id="bh6ssn_806"><code class="code" id="bh6ssn_931"></code> &quot;_field&quot;: &quot;pf_attr&quot;</p><p id="bh6ssn_807"><code class="code" id="bh6ssn_932"></code>},</p><p id="bh6ssn_808"><code class="code" id="bh6ssn_933"></code> &quot;params&quot;: {</p><p id="bh6ssn_809"><code class="code" id="bh6ssn_934"></code> &quot;outserv&quot;: {</p><p id="bh6ssn_810"><code class="code" id="bh6ssn_935"></code> &quot;_field&quot;: &quot;pf_outserv&quot;</p><p id="bh6ssn_811"><code class="code" id="bh6ssn_936"></code>}</p><p id="bh6ssn_812"><code class="code" id="bh6ssn_937"></code>},</p><p id="bh6ssn_813"><code class="code" id="bh6ssn_938"></code> &quot;links&quot;: {</p><p id="bh6ssn_814"><code class="code" id="bh6ssn_939"></code> &quot;bus1&quot;: {</p><p id="bh6ssn_815"><code class="code" id="bh6ssn_940"></code> &quot;_field&quot;: &quot;pole_i&quot;</p><p id="bh6ssn_816"><code class="code" id="bh6ssn_941"></code>},</p><p id="bh6ssn_817"><code class="code" id="bh6ssn_942"></code> &quot;bus2&quot;: {</p><p id="bh6ssn_818"><code class="code" id="bh6ssn_943"></code> &quot;_field&quot;: &quot;pole_j&quot;</p><p id="bh6ssn_819"><code class="code" id="bh6ssn_944"></code>}</p><p id="bh6ssn_820"><code class="code" id="bh6ssn_945"></code>},</p><p id="bh6ssn_821"><code class="code" id="bh6ssn_946"></code> &quot;results&quot;: {</p><p id="bh6ssn_822"><code class="code" id="bh6ssn_947"></code> &quot;m:P:bus1&quot;: {</p><p id="bh6ssn_823"><code class="code" id="bh6ssn_948"></code> &quot;_field&quot;: &quot;pf_m_P_bus1&quot;</p><p id="bh6ssn_824"><code class="code" id="bh6ssn_949"></code>},</p><p id="bh6ssn_825"><code class="code" id="bh6ssn_950"></code> &quot;m:P:bus2&quot;: {</p><p id="bh6ssn_826"><code class="code" id="bh6ssn_951"></code> &quot;_field&quot;: &quot;pf_m_P_bus2&quot;</p><p id="bh6ssn_827"><code class="code" id="bh6ssn_952"></code>},</p><p id="bh6ssn_828"><code class="code" id="bh6ssn_953"></code> &quot;m:Q:bus1&quot;: {</p><p id="bh6ssn_829"><code class="code" id="bh6ssn_954"></code> &quot;_field&quot;: &quot;pf_m_Q_bus1&quot;</p><p id="bh6ssn_830"><code class="code" id="bh6ssn_955"></code>},</p><p id="bh6ssn_831"><code class="code" id="bh6ssn_956"></code> &quot;m:Q:bus2&quot;: {</p><p id="bh6ssn_832"><code class="code" id="bh6ssn_957"></code> &quot;_field&quot;: &quot;pf_m_Q_bus2&quot;</p><p id="bh6ssn_833"><code class="code" id="bh6ssn_958"></code>},</p><p id="bh6ssn_834"><code class="code" id="bh6ssn_959"></code> &quot;c:loading&quot;: {</p><p id="bh6ssn_835"><code class="code" id="bh6ssn_960"></code> &quot;_field&quot;: &quot;pf_c_loading&quot;</p><p id="bh6ssn_836"><code class="code" id="bh6ssn_961"></code>}</p><p id="bh6ssn_837"><code class="code" id="bh6ssn_962"></code>}</p><p id="bh6ssn_838"><code class="code" id="bh6ssn_963"></code>}</p><p id="bh6ssn_839">}</p><p id="bh6ssn_840">....</p><p id="bh6ssn_841">Представленный выше фрагмент настроечного json-файла определяет структуру json и позволяет получить json вида:</p><p id="bh6ssn_842">&quot;ElmLne&quot;: {</p><p id="bh6ssn_843"><code class="code" id="bh6ssn_964"></code> &quot;Grid\KAZ\CENTER\@lines/L2378/lineB&quot;: {</p><p id="bh6ssn_844"><code class="code" id="bh6ssn_965"></code> &quot;pf_attr&quot;: null</p><p id="bh6ssn_845"><code class="code" id="bh6ssn_966"></code> &quot;params&quot;: {</p><p id="bh6ssn_846"><code class="code" id="bh6ssn_967"></code> &quot;outserv&quot;: null</p><p id="bh6ssn_847"><code class="code" id="bh6ssn_968"></code>},</p><p id="bh6ssn_848"><code class="code" id="bh6ssn_969"></code> &quot;links&quot;: {</p><p id="bh6ssn_849"><code class="code" id="bh6ssn_970"></code> &quot;bus1&quot;: &quot;Grid\KAZ\CENTER\Karajal\220/L2378&quot;,</p><p id="bh6ssn_850"><code class="code" id="bh6ssn_971"></code> &quot;bus2&quot;: &quot;Grid\KAZ\CENTER\Jezkaz_TEC\220/L2378&quot;</p><p id="bh6ssn_851"><code class="code" id="bh6ssn_972"></code>},</p><p id="bh6ssn_852"><code class="code" id="bh6ssn_973"></code> &quot;results&quot;: {</p><p id="bh6ssn_853"><code class="code" id="bh6ssn_974"></code> &quot;m:P:bus1&quot;: null,</p><p id="bh6ssn_854"><code class="code" id="bh6ssn_975"></code> &quot;m:P:bus2&quot;: null,</p><p id="bh6ssn_855"><code class="code" id="bh6ssn_976"></code> &quot;m:Q:bus1&quot;: null</p><p id="bh6ssn_856"><code class="code" id="bh6ssn_977"></code> &quot;m:Q:bus2&quot;: null</p><p id="bh6ssn_857"><code class="code" id="bh6ssn_978"></code> &quot;c:loading&quot;: null</p><p id="bh6ssn_858"><code class="code" id="bh6ssn_979"></code>}</p><p id="bh6ssn_859"><code class="code" id="bh6ssn_980"></code>}</p><p id="bh6ssn_860">}</p><p id="bh6ssn_861">Поля с префиксом _ в файле настроек являются служебными и не включаются в результирующую структуру json.</p><p id="bh6ssn_862">Поле &quot;_prototype&quot; в файле настроек определяет прототип faceplate, соответствующий вышестоящему элементу.</p><p id="bh6ssn_863">Поле &quot;_field&quot; в файле настроек, определяет поле прототипа faceplate, значение которого для соответствующего объекта будет записано в результирующий json.</p><p id="bh6ssn_864">Если значение необходимо получить не из самого объекта прототипа, а из вложенного объекта - на одном уровне с служебным полем &quot;_field&quot; следует добавить служебное поле &quot;_path&quot;, значение которого должно содержать относительный путь до вложенного объекта.</p><p id="bh6ssn_865">Поле &quot;$path&quot; в файле настроек, в результирующей структуре заменяется на путь к соответствующему объекту.</p><p id="bh6ssn_866">Для некоторых типов объектов PowerFactory в настроечном файле может быть не указано поле &quot;$path&quot;, например:</p><p id="bh6ssn_867">&quot;ComLdf&quot;: {</p><p id="bh6ssn_868"><code class="code" id="bh6ssn_981"></code> &quot;_prototype&quot;: &quot;PowerFactory_ComLdf&quot;,</p><p id="bh6ssn_869"><code class="code" id="bh6ssn_982"></code> &quot;params&quot;: {</p><p id="bh6ssn_870"><code class="code" id="bh6ssn_983"></code> &quot;_field&quot;: &quot;params&quot;</p><p id="bh6ssn_871"><code class="code" id="bh6ssn_984"></code>},</p><p id="bh6ssn_872"><code class="code" id="bh6ssn_985"></code> &quot;status&quot;: {</p><p id="bh6ssn_873"><code class="code" id="bh6ssn_986"></code> &quot;_field&quot;: &quot;status&quot;</p><p id="bh6ssn_874"><code class="code" id="bh6ssn_987"></code>}</p><p id="bh6ssn_875">},</p><p id="bh6ssn_876">В таком случае, при вызове функции запроса в PowerFactory необходимо указывать OID объекта прототипа (в данном случае, PowerFactory_ComLdf), данные которого нужно передать (см. Приложение А.8).</p><p id="bh6ssn_877">Если требуется сформировать json из данных каталога faceplate, то в файле настроек вместо служебного поля &quot;_prototype&quot;, нужно использовать поле &quot;_catalog&quot;, указав имя каталога, например:</p><p id="bh6ssn_878">&quot;TypLne&quot;: {</p><p id="bh6ssn_879"><code class="code" id="bh6ssn_988"></code> &quot;_catalog&quot;: &quot;equipment_types\TypLne&quot;,</p><p id="bh6ssn_880"><code class="code" id="bh6ssn_989"></code> &quot;$path&quot;: {</p><p id="bh6ssn_881"><code class="code" id="bh6ssn_990"></code> &quot;params&quot;: {</p><p id="bh6ssn_882"><code class="code" id="bh6ssn_991"></code> &quot;name&quot;: {</p><p id="bh6ssn_883"><code class="code" id="bh6ssn_992"></code> &quot;_field&quot;: &quot;.name&quot;</p><p id="bh6ssn_884"><code class="code" id="bh6ssn_993"></code>},</p><p id="bh6ssn_885"><code class="code" id="bh6ssn_994"></code> &quot;json&quot;: {</p><p id="bh6ssn_886"><code class="code" id="bh6ssn_995"></code> &quot;_field&quot;: &quot;json&quot;</p><p id="bh6ssn_887"><code class="code" id="bh6ssn_996"></code>}</p><p id="bh6ssn_888"><code class="code" id="bh6ssn_997"></code>}</p><p id="bh6ssn_889"><code class="code" id="bh6ssn_998"></code>}</p><p id="bh6ssn_890">}</p><p id="bh6ssn_891">\2) Определение функций</p><p id="bh6ssn_892">Функции определяются в разделе &quot;_functions&quot; настроечного файла.</p><p id="bh6ssn_893">Пример:</p><p id="bh6ssn_894"><code class="code" id="bh6ssn_999"></code> &quot;get_in&quot;: {</p><p id="bh6ssn_895"><code class="code" id="bh6ssn_1000"></code> &quot;elements&quot;: [&quot;ElmSite&quot;, &quot;ElmSubstat&quot;, &quot;ElmTerm&quot;, &quot;ElmCoup&quot;, &quot;ElmTr2&quot;, &quot;ElmTr3&quot;, &quot;ElmGenstat&quot;, &quot;ElmSym&quot;, &quot;ElmLod&quot;, &quot;ElmShnt&quot;, &quot;ElmBranch&quot;, &quot;ElmLne&quot;, &quot;ElmLnesec&quot;, &quot;ElmXnet&quot;],</p><p id="bh6ssn_896"><code class="code" id="bh6ssn_1001"></code> &quot;json_fields&quot;: {&quot;$path&quot;: [&quot;parms&quot;]}</p><p id="bh6ssn_897">},</p><p id="bh6ssn_898">&quot;get_out&quot;: {</p><p id="bh6ssn_899"><code class="code" id="bh6ssn_1002"></code> &quot;elements&quot;: [&quot;ElmSite&quot;, &quot;ElmSubstat&quot;, &quot;ElmTerm&quot;, &quot;ElmCoup&quot;, &quot;ElmTr2&quot;, &quot;ElmTr3&quot;, &quot;ElmGenstat&quot;, &quot;ElmSym&quot;, &quot;ElmLod&quot;, &quot;ElmShnt&quot;, &quot;ElmBranch&quot;, &quot;ElmLne&quot;, &quot;ElmLnesec&quot;, &quot;ElmXnet&quot;],</p><p id="bh6ssn_900"><code class="code" id="bh6ssn_1003"></code> &quot;json_fields&quot;: {&quot;$path&quot;: [&quot;results&quot;]}</p><p id="bh6ssn_901"><code class="code" id="bh6ssn_1004"></code>}</p><p id="bh6ssn_902">В данном примере определяется функция get.</p><p id="bh6ssn_903">&quot;get_in&quot; определяет элементы и поля (заданные в разделе маппинга), которые будут использоваться при формировании json, отправляемого в PowerFactory. В данном случае, json отправляемый в PowerFactory, будет содержать в элементах только поле &quot;params&quot;, и не будет включать другие поля (&quot;pf_attr&quot;, &quot;links&quot;, &quot;results&quot;), определенные в разделе маппинга.</p><p id="bh6ssn_904">&quot;get_out&quot; определяет элементы и поля (заданные в разделе маппинга), которые будут загружаться из полученного от PowerFactory json в базу данных faceplate. В данном случае, загружаться будут только данные из раздела &quot;results&quot;.</p><p id="bh6ssn_905">\3) Преобразование путей Faceplate и PowerFactory</p><p id="bh6ssn_906">Путь к объекту Faceplate, как и путь к объекту в PowerFactory, однозначно определяет объект.</p><p id="bh6ssn_907">В faceplate и PowerFactory пути к объектам отличаются. Например путь к объекту трансформатора c именем AT2 в faceplate может быть таким:</p><p id="bh6ssn_908">'/root/FP/PROJECT/KAZ/ZAPAD/Kulsary/220/AT2'. Данному объекту соответствует объект в PowerFactory, у которого путь: 'Grid\KAZ\ZAPAD\Kulsary\220/AT2'.</p><p id="bh6ssn_909">Причем имя объекта в PowerFactory '220/AT2', а часть пути 'Grid\KAZ\ZAPAD\Kulsary' определяет иерархию директорий (папок) для этого объекта. В данном случае, часть пути '/root/FP/PROJECT' соответствует 'Grid' в PowerFactory.</p><p id="bh6ssn_910">Соответствие между путем faceplate и путем PowerFactory определяется в разделе &quot;pf_path_mapping&quot;. Данное соответствие используется при выгрузке данных из faceplate в PowerFactory/</p><p id="bh6ssn_911">Пример:</p><p id="bh6ssn_912">&quot;pf_path_mapping&quot;: {</p><p id="bh6ssn_913"><code class="code" id="bh6ssn_1005"></code> &quot;^/root/FP/PROJECT&quot;: [&quot;Grid&quot;, 4],</p><p id="bh6ssn_914"><code class="code" id="bh6ssn_1006"></code> &quot;^/root/FP/catalogs/equipment_types([\w\W]*)/content&quot;: [&quot;Equipment Type Library&quot;, 1]</p><p id="bh6ssn_915"><code class="code" id="bh6ssn_1007"></code>},</p><p id="bh6ssn_916">В левой части определено регулярное выражение (&quot;^/root/FP/PROJECT&quot;), которое соответствует части пути в faceplate, которое будет заменено на значение первого элемента списка, находящегося в правой части. Второй элемент данного списка является целым числом, которое определяет глубину пути к объекту в PowerFactory. Т.е. 'Grid\KAZ\ZAPAD\Kulsary' имеет глубину 4. Оставшаяся часть пути будет преобразована в имя объекта '220/AT2'.</p><p id="bh6ssn_917">В приведенном примере аналогичным образом определено соответствие между путем к элементу каталога 'equipment_types' в базе faceplate и путем к объекту в библиотеке типов оборудования в PowerFactory.</p><p id="bh6ssn_918"><code class="code" id="bh6ssn_1008"></code> Обратное преобразование путей используется для загрузки данных из PowerFactory в faceplate. Оно определено в разделе &quot;fp_path_mapping&quot;.</p><p id="bh6ssn_919">Пример:</p><p id="bh6ssn_920">&quot;fp_path_mapping&quot;: {</p><p id="bh6ssn_921"><code class="code" id="bh6ssn_1009"></code> &quot;^Grid&quot;: &quot;/root/FP/PROJECT&quot;,</p><p id="bh6ssn_922"><code class="code" id="bh6ssn_1010"></code> &quot;^Equipment Type Library&quot;: &quot;/root/FP/catalogs/equipment_types\\${element_type}/content&quot;,</p><p id="bh6ssn_923">}</p><p id="bh6ssn_924">В левой части определено регулярное выражение, которое соответствует части пути в faceplate, которое будет заменено на значение в правой части.</p><p id="bh6ssn_925">В правой части может использоваться переменная ${element_type}. В этой переменной передается PowerFactory класс обрабатываемого объекта (например, 'TypLne'). В приведенном примере эта переменная используется определения имени каталога. В приведенном примере, результирующее имя каталога будет 'equipment_types\TypLne' (в случае если обрабатываемый PowerFactory объект имеет тип 'TypLne').</p></section><section class="chapter"><h2 id="6-2" data-toc="6-2"><a name=""></a><span class="control" id="bh6ssn_1105">6.2 Использование в прикладном проекте</span></h2><p id="bh6ssn_1012">Несколько последовательных вызовов функции pf_service_update или pf_service_create_update в прикладном проекте выполняются последовательно, т.е. пока не выполнится цикл отправки/получения данных для первого вызова функции, для второго вызова цикла отправки/получения данных не начнется.</p><p id="bh6ssn_1013">В прикладном проекте создана пользовательская библиотека fp_pf_utils, облегчающая использование модуля в прикладных скриптах.</p><p id="bh6ssn_1014">-module(fp_pf_utils).</p><p id="bh6ssn_1015">%%---------------------------------------</p><p id="bh6ssn_1016">-include(&quot;fp.hrl&quot;).</p><p id="bh6ssn_1017">-export([</p><p id="bh6ssn_1018"><code class="code" id="bh6ssn_1106"></code> pf_get/0,</p><p id="bh6ssn_1019"><code class="code" id="bh6ssn_1107"></code> pf_execute/0,</p><p id="bh6ssn_1020"><code class="code" id="bh6ssn_1108"></code> pf_dynamics/0,</p><p id="bh6ssn_1021"><code class="code" id="bh6ssn_1109"></code> pf_update/0,</p><p id="bh6ssn_1022"><code class="code" id="bh6ssn_1110"></code> pf_reset_calc/0</p><p id="bh6ssn_1023"><code class="code" id="bh6ssn_1111"></code>]).</p><p id="bh6ssn_1024">-define(HOST, &quot;10.210.1.25&quot;).</p><p id="bh6ssn_1025">-define(PORT, 80).</p><p id="bh6ssn_1026">-define(PROJECTNAME, &lt;&lt;&quot;.MODEL_SCADA_V1115&quot;&gt;&gt;).</p><p id="bh6ssn_1027">-define(SCENARIO, &lt;&lt;&quot;scenario_dynamics&quot;&gt;&gt;).</p><p id="bh6ssn_1028">pf_get() -&gt;</p><p id="bh6ssn_1029"><code class="code" id="bh6ssn_1112"></code> ProjectParams = #{</p><p id="bh6ssn_1030"><code class="code" id="bh6ssn_1113"></code> &lt;&lt;&quot;func_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;get&quot;&gt;&gt;,</p><p id="bh6ssn_1031"><code class="code" id="bh6ssn_1114"></code> &lt;&lt;&quot;grid_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;Grid&quot;&gt;&gt;,</p><p id="bh6ssn_1032"><code class="code" id="bh6ssn_1115"></code> &lt;&lt;&quot;project_name&quot;&gt;&gt; =&gt; ?PROJECTNAME,</p><p id="bh6ssn_1033"><code class="code" id="bh6ssn_1116"></code> &lt;&lt;&quot;study_case_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;Study Case&quot;&gt;&gt;,</p><p id="bh6ssn_1034"><code class="code" id="bh6ssn_1117"></code> &lt;&lt;&quot;operation_scenario_name&quot;&gt;&gt; =&gt; ?SCENARIO,</p><p id="bh6ssn_1035"><code class="code" id="bh6ssn_1118"></code> &lt;&lt;&quot;session_type&quot;&gt;&gt; =&gt; &lt;&lt;&quot;calculation&quot;&gt;&gt;,</p><p id="bh6ssn_1036"><code class="code" id="bh6ssn_1119"></code> &lt;&lt;&quot;id&quot;&gt;&gt; =&gt; &lt;&lt;&quot;abcd-1234&quot;&gt;&gt;</p><p id="bh6ssn_1037"><code class="code" id="bh6ssn_1120"></code>},</p><p id="bh6ssn_1038"><code class="code" id="bh6ssn_1121"></code> fp_powerfactory_service:pf_service_update(ProjectParams, none, ?HOST, ?PORT).</p><p id="bh6ssn_1039">pf_update() -&gt;</p><p id="bh6ssn_1040"><code class="code" id="bh6ssn_1122"></code> ProjectParams = #{</p><p id="bh6ssn_1041"><code class="code" id="bh6ssn_1123"></code> &lt;&lt;&quot;func_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;update&quot;&gt;&gt;,</p><p id="bh6ssn_1042"><code class="code" id="bh6ssn_1124"></code> &lt;&lt;&quot;grid_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;Grid&quot;&gt;&gt;,</p><p id="bh6ssn_1043"><code class="code" id="bh6ssn_1125"></code> &lt;&lt;&quot;project_name&quot;&gt;&gt; =&gt; ?PROJECTNAME,</p><p id="bh6ssn_1044"><code class="code" id="bh6ssn_1126"></code> &lt;&lt;&quot;study_case_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;Study Case&quot;&gt;&gt;,</p><p id="bh6ssn_1045"><code class="code" id="bh6ssn_1127"></code> &lt;&lt;&quot;operation_scenario_name&quot;&gt;&gt; =&gt; ?SCENARIO,</p><p id="bh6ssn_1046"><code class="code" id="bh6ssn_1128"></code> &lt;&lt;&quot;session_type&quot;&gt;&gt; =&gt; &lt;&lt;&quot;calculation&quot;&gt;&gt;,</p><p id="bh6ssn_1047"><code class="code" id="bh6ssn_1129"></code> &lt;&lt;&quot;id&quot;&gt;&gt; =&gt; &lt;&lt;&quot;abcd-1234&quot;&gt;&gt;</p><p id="bh6ssn_1048"><code class="code" id="bh6ssn_1130"></code>},</p><p id="bh6ssn_1049"><code class="code" id="bh6ssn_1131"></code> fp_powerfactory_service:pf_service_update(ProjectParams, none, ?HOST, ?PORT).</p><p id="bh6ssn_1050">pf_execute() -&gt;</p><p id="bh6ssn_1051"><code class="code" id="bh6ssn_1132"></code> ProjectParams = #{</p><p id="bh6ssn_1052"><code class="code" id="bh6ssn_1133"></code> &lt;&lt;&quot;func_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;execute&quot;&gt;&gt;,</p><p id="bh6ssn_1053"><code class="code" id="bh6ssn_1134"></code> &lt;&lt;&quot;grid_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;Grid&quot;&gt;&gt;,</p><p id="bh6ssn_1054"><code class="code" id="bh6ssn_1135"></code> &lt;&lt;&quot;project_name&quot;&gt;&gt; =&gt; ?PROJECTNAME,</p><p id="bh6ssn_1055"><code class="code" id="bh6ssn_1136"></code> &lt;&lt;&quot;study_case_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;Study Case&quot;&gt;&gt;,</p><p id="bh6ssn_1056"><code class="code" id="bh6ssn_1137"></code> &lt;&lt;&quot;operation_scenario_name&quot;&gt;&gt; =&gt; ?SCENARIO,</p><p id="bh6ssn_1057"><code class="code" id="bh6ssn_1138"></code> &lt;&lt;&quot;session_type&quot;&gt;&gt; =&gt; &lt;&lt;&quot;calculation&quot;&gt;&gt;,</p><p id="bh6ssn_1058"><code class="code" id="bh6ssn_1139"></code> &lt;&lt;&quot;id&quot;&gt;&gt; =&gt; &lt;&lt;&quot;abcd-1234&quot;&gt;&gt;</p><p id="bh6ssn_1059"><code class="code" id="bh6ssn_1140"></code>},</p><p id="bh6ssn_1060"><code class="code" id="bh6ssn_1141"></code> ComLdfOID = ?OID(&lt;&lt;&quot;/root/FP/PROJECT/_GRIDS/forPF/PF_ComLDF&quot;&gt;&gt;),</p><p id="bh6ssn_1061"><code class="code" id="bh6ssn_1142"></code> fp_powerfactory_service:pf_service_update(ProjectParams, [ComLdfOID], ?HOST, ?PORT).</p><p id="bh6ssn_1062">pf_dynamics() -&gt;</p><p id="bh6ssn_1063"><code class="code" id="bh6ssn_1143"></code> ProjectParams = #{</p><p id="bh6ssn_1064"><code class="code" id="bh6ssn_1144"></code> &lt;&lt;&quot;func_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;dynamics&quot;&gt;&gt;,</p><p id="bh6ssn_1065"><code class="code" id="bh6ssn_1145"></code> &lt;&lt;&quot;grid_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;Grid&quot;&gt;&gt;,</p><p id="bh6ssn_1066"><code class="code" id="bh6ssn_1146"></code> &lt;&lt;&quot;project_name&quot;&gt;&gt; =&gt; ?PROJECTNAME,</p><p id="bh6ssn_1067"><code class="code" id="bh6ssn_1147"></code> &lt;&lt;&quot;study_case_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;Study Case&quot;&gt;&gt;,</p><p id="bh6ssn_1068"><code class="code" id="bh6ssn_1148"></code> &lt;&lt;&quot;operation_scenario_name&quot;&gt;&gt; =&gt; ?SCENARIO,</p><p id="bh6ssn_1069"><code class="code" id="bh6ssn_1149"></code> &lt;&lt;&quot;session_type&quot;&gt;&gt; =&gt; &lt;&lt;&quot;calculation&quot;&gt;&gt;,</p><p id="bh6ssn_1070"><code class="code" id="bh6ssn_1150"></code> &lt;&lt;&quot;id&quot;&gt;&gt; =&gt; &lt;&lt;&quot;abcd-1234&quot;&gt;&gt;</p><p id="bh6ssn_1071"><code class="code" id="bh6ssn_1151"></code>},</p><p id="bh6ssn_1072"><code class="code" id="bh6ssn_1152"></code> ComSimOID = ?OID(&lt;&lt;&quot;/root/FP/PROJECT/_GRIDS/forPF/PF_ComSim&quot;&gt;&gt;),</p><p id="bh6ssn_1073"><code class="code" id="bh6ssn_1153"></code> fp_powerfactory_service:pf_service_update(ProjectParams, [ComSimOID], ?HOST, ?PORT).</p><p id="bh6ssn_1074">pf_reset_calc() -&gt;</p><p id="bh6ssn_1075"><code class="code" id="bh6ssn_1154"></code> ProjectParams = #{</p><p id="bh6ssn_1076"><code class="code" id="bh6ssn_1155"></code> &lt;&lt;&quot;func_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;reset_calc&quot;&gt;&gt;,</p><p id="bh6ssn_1077"><code class="code" id="bh6ssn_1156"></code> &lt;&lt;&quot;grid_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;Grid&quot;&gt;&gt;,</p><p id="bh6ssn_1078"><code class="code" id="bh6ssn_1157"></code> &lt;&lt;&quot;project_name&quot;&gt;&gt; =&gt; ?PROJECTNAME,</p><p id="bh6ssn_1079"><code class="code" id="bh6ssn_1158"></code> &lt;&lt;&quot;study_case_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;Study Case&quot;&gt;&gt;,</p><p id="bh6ssn_1080"><code class="code" id="bh6ssn_1159"></code> &lt;&lt;&quot;operation_scenario_name&quot;&gt;&gt; =&gt; ?SCENARIO,</p><p id="bh6ssn_1081"><code class="code" id="bh6ssn_1160"></code> &lt;&lt;&quot;session_type&quot;&gt;&gt; =&gt; &lt;&lt;&quot;calculation&quot;&gt;&gt;,</p><p id="bh6ssn_1082"><code class="code" id="bh6ssn_1161"></code> &lt;&lt;&quot;id&quot;&gt;&gt; =&gt; &lt;&lt;&quot;abcd-1234&quot;&gt;&gt;</p><p id="bh6ssn_1083"><code class="code" id="bh6ssn_1162"></code>},</p><p id="bh6ssn_1084"><code class="code" id="bh6ssn_1163"></code> fp_powerfactory_service:pf_service_update(ProjectParams, none, ?HOST, ?PORT).</p><p id="bh6ssn_1085">Пример использования пользовательской библиотеки fp_pf_utils в пользовательском скрипте, для организации циклического взаимодействия между Faceplate и PowerFactory:</p><p id="bh6ssn_1086"><code class="code" id="bh6ssn_1164"></code> fun(VARS,_State)-&gt;</p><p id="bh6ssn_1087"><code class="code" id="bh6ssn_1165"></code> StatusObject = fp_db:open(fp_db:to_oid(list_to_binary(&quot;/root/FP/PROJECT/@DTS/scripts/status&quot;))),</p><p id="bh6ssn_1088"><code class="code" id="bh6ssn_1166"></code> fp_db:edit_object(StatusObject, #{&lt;&lt;&quot;value_int&quot;&gt;&gt; =&gt; 2}),</p><p id="bh6ssn_1089"><code class="code" id="bh6ssn_1167"></code> While = fun Loop(Status) -&gt;</p><p id="bh6ssn_1090"><code class="code" id="bh6ssn_1168"></code> if</p><p id="bh6ssn_1091"><code class="code" id="bh6ssn_1169"></code> Status == 2 -&gt;</p><p id="bh6ssn_1092"><code class="code" id="bh6ssn_1170"></code> fp_pf_utils:pf_dynamics(),</p><p id="bh6ssn_1093"><code class="code" id="bh6ssn_1171"></code> fp_pf_utils:pf_get(),</p><p id="bh6ssn_1094"><code class="code" id="bh6ssn_1172"></code> {_, StatusNew} = fp_db:read_field(StatusObject, &lt;&lt;&quot;value_int&quot;&gt;&gt;),</p><p id="bh6ssn_1095"><code class="code" id="bh6ssn_1173"></code> Loop(StatusNew);</p><p id="bh6ssn_1096"><code class="code" id="bh6ssn_1174"></code> true -&gt;</p><p id="bh6ssn_1097"><code class="code" id="bh6ssn_1175"></code> fp:log(info, &quot;Dynamics stopped, status ~p&quot;, [Status])</p><p id="bh6ssn_1098"><code class="code" id="bh6ssn_1176"></code> end</p><p id="bh6ssn_1099"><code class="code" id="bh6ssn_1177"></code> end,</p><p id="bh6ssn_1100"><code class="code" id="bh6ssn_1178"></code> While(2),</p><p id="bh6ssn_1101"><code class="code" id="bh6ssn_1179"></code> { none, none }</p><p id="bh6ssn_1102">end.</p><p id="bh6ssn_1103">В данном скрипте циклично вызываются функции fp_pf_utils:pf_dynamics() и fp_pf_utils:pf_get(), пока значение поля &quot;value_int&quot;, объекта &quot;/root/FP/PROJECT/@DTS/scripts/status&quot; равно 2. Для остановки цикла передачи, внешний скрипт должен изменить значение этого поля на другое.</p></section><section class="chapter"><h2 id="7" data-toc="7"><a name=""></a><span class="control" id="bh6ssn_1194">7. Заключение</span></h2><p id="bh6ssn_1181">Настоящее руководство описывает основные скрипты и функции в библиотеке Faceplate, которые позволяют программистам управлять данными, взаимодействовать с API, выполнять вычисления и автоматизировать процессы в SCADA-системе. <span class="emphasis" id="bh6ssn_1195">Изм</span></p><p id="bh6ssn_1182"><span class="emphasis" id="bh6ssn_1196">Лист</span></p><p id="bh6ssn_1183"><span class="emphasis" id="bh6ssn_1197">№ докум</span></p><p id="bh6ssn_1184"><span class="emphasis" id="bh6ssn_1198">Подп.</span></p><p id="bh6ssn_1185"><span class="emphasis" id="bh6ssn_1199">Дата</span></p><p id="bh6ssn_1186"><span class="emphasis" id="bh6ssn_1200">Лист</span></p><p id="bh6ssn_1187"><code class="code" id="bh6ssn_1201"></code><span class="emphasis" id="bh6ssn_1202">PAGE 2</span></p><p id="bh6ssn_1188"><span class="emphasis" id="bh6ssn_1203">Инв. №подл.</span></p><p id="bh6ssn_1189"><span class="emphasis" id="bh6ssn_1204">Подп. и дата</span></p><p id="bh6ssn_1190"><span class="emphasis" id="bh6ssn_1205">Взам. инв. №</span></p><p id="bh6ssn_1191"><span class="emphasis" id="bh6ssn_1206">Инв. № дубл.</span></p><p id="bh6ssn_1192"><span class="emphasis" id="bh6ssn_1207">Подп. и дата</span> <img alt="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 006" src="${primarySource}" class="inline-icon-" title="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 006" id="bh6ssn_1208"><img alt="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 007" src="${primarySource}" class="inline-icon-" title="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 007" id="bh6ssn_1209"><img alt="ref2" src="${primarySource}" class="inline-icon-" title="ref2" id="bh6ssn_1210"><img alt="ref2" src="${primarySource}" class="inline-icon-" title="ref2" id="bh6ssn_1211"><img alt="ref2" src="${primarySource}" class="inline-icon-" title="ref2" id="bh6ssn_1212"><img alt="ref2" src="${primarySource}" class="inline-icon-" title="ref2" id="bh6ssn_1213"><img alt="ref2" src="${primarySource}" class="inline-icon-" title="ref2" id="bh6ssn_1214"><img alt="ref2" src="${primarySource}" class="inline-icon-" title="ref2" id="bh6ssn_1215"><img alt="ref3" src="${primarySource}" class="inline-icon-" title="ref3" id="bh6ssn_1216"><img alt="ref3" src="${primarySource}" class="inline-icon-" title="ref3" id="bh6ssn_1217"><img alt="ref3" src="${primarySource}" class="inline-icon-" title="ref3" id="bh6ssn_1218"><img alt="ref4" src="${primarySource}" class="inline-icon-" title="ref4" id="bh6ssn_1219"><img alt="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 011" src="${primarySource}" class="inline-icon-" title="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 011" id="bh6ssn_1220"><img alt="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 012" src="${primarySource}" class="inline-icon-" title="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 012" id="bh6ssn_1221"><img alt="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 013" src="${primarySource}" class="inline-icon-" title="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 013" id="bh6ssn_1222"><img alt="ref4" src="${primarySource}" class="inline-icon-" title="ref4" id="bh6ssn_1223"><img alt="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 014" src="${primarySource}" class="inline-icon-" title="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 014" id="bh6ssn_1224"><img alt="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 015" src="${primarySource}" class="inline-icon-" title="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 015" id="bh6ssn_1225"><img alt="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 016" src="${primarySource}" class="inline-icon-" title="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 016" id="bh6ssn_1226"><img alt="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 017" src="${primarySource}" class="inline-icon-" title="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 017" id="bh6ssn_1227"><img alt="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 018" src="${primarySource}" class="inline-icon-" title="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 018" id="bh6ssn_1228"><img alt="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 019" src="${primarySource}" class="inline-icon-" title="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 019" id="bh6ssn_1229"></p></section><section class="chapter"><h2 id="bh6ssn_7" data-toc="bh6ssn_7"><a name=""></a><span class="control" id="bh6ssn_1234">Приложение А. Библиотечные скрипты и их функции</span></h2><p id="bh6ssn_1231">В разделе &quot;Библиотечные модули&quot; представлено множество скриптов, каждый из которых реализует определенную функциональность для работы SCADA-системы Faceplate. Эти модули предоставляют программистам гибкие инструменты для автоматизации, анализа данных и интеграции с внешними сервисами.</p><p id="bh6ssn_1232">Ниже приведен перечень доступных библиотечных модулей с пояснениями:</p></section><section class="chapter"><h2 id="1-system-utils-v1" data-toc="1-system-utils-v1"><a name=""></a><span class="control" id="bh6ssn_1242">А.1 Модуль system_utils (v1)</span></h2><p id="bh6ssn_1236">Модуль с набором вспомогательных функций, предназначенных для поиска и обработки системных объектов. Применяется для оптимизации работы с объектами в системе.</p><p id="bh6ssn_1237"><span class="control" id="bh6ssn_1243">Общая информация</span></p><p id="bh6ssn_1238">Модуль system_utils предоставляет функции для управления объектами системы и обработки данных. Код написан на языке программирования Erlang. Если функция выбрасывает исключение или происходит сбой, транзакция будет отменена. При успешном выполнении функции возвращают атом ok. Для логирования рекомендуется использовать макросы:</p><ul class="list _bullet" id="bh6ssn_1239"><li class="list__item" id="bh6ssn_1244"><p>?LOGINFO( &quot;my info text: ~p&quot;, [Info] )</p></li><li class="list__item" id="bh6ssn_1245"><p>?LOGWARNING( &quot;my warning text: ~p&quot;, [Warning] )</p></li><li class="list__item" id="bh6ssn_1246"><p>?LOGERROR( &quot;my error text: ~p&quot;, [Error] )</p></li></ul><div class="table-wrapper"><table class="wide" id="bh6ssn_1240"><thead><tr class="ijRowHead" id="bh6ssn_1247"><th id="bh6ssn_1255"><p><span class="control" id="bh6ssn_1257">Функция</span></p></th><th id="bh6ssn_1256"><p><span class="control" id="bh6ssn_1258">Описание</span></p></th></tr></thead><tbody><tr id="bh6ssn_1248"><td id="bh6ssn_1259"><p>find_by_pattern/2</p></td><td id="bh6ssn_1260"><p id="bh6ssn_1261">: Ищет объекты в хранилище данных, соответствующие заданному шаблону.</p><p id="bh6ssn_1262"><span class="control" id="bh6ssn_1269">Параметры</span>:</p><p id="bh6ssn_1263">- Root (binary): Корневой путь проекта.</p><p id="bh6ssn_1264">- Pattern (binary): Шаблон для поиска.</p><p id="bh6ssn_1265"><span class="control" id="bh6ssn_1270">Возвращает</span>: Список путей к объектам.</p><p id="bh6ssn_1266"><span class="control" id="bh6ssn_1271">Пример использования</span>:</p><p id="bh6ssn_1267">system_utils:find_by_pattern(&lt;&lt;&quot;KAZ/UZHNIY&quot;&gt;&gt;, &lt;&lt;&quot;/root/FP/prototypes/telemetry/fields&quot;&gt;&gt;).</p><p id="bh6ssn_1268"></p></td></tr><tr id="bh6ssn_1249"><td id="bh6ssn_1272"><p>csv_to_archive/2</p></td><td id="bh6ssn_1273"><p id="bh6ssn_1274">: Загружает данные из CSV-файла и сохраняет их в архив.</p><p id="bh6ssn_1275"><span class="control" id="bh6ssn_1281">Параметры</span>:</p><p id="bh6ssn_1276">- Archive (binary): Архив для сохранения данных.</p><p id="bh6ssn_1277">- CSVFile (binary): Путь к CSV-файлу.</p><p id="bh6ssn_1278"><span class="control" id="bh6ssn_1282">Возвращает</span>: Атом ok в случае успеха или {error, Reason} в случае ошибки.</p><p id="bh6ssn_1279"><span class="control" id="bh6ssn_1283">Пример использования</span>:</p><p id="bh6ssn_1280">system_utils:csv_to_archive(&lt;&lt;&quot;my_archive&quot;&gt;&gt;, &lt;&lt;&quot;/path/to/file.csv&quot;&gt;&gt;).</p></td></tr><tr id="bh6ssn_1250"><td id="bh6ssn_1284"><p>vclass_from_object/1</p></td><td id="bh6ssn_1285"><p id="bh6ssn_1286">: Определяет класс объекта по его пути.</p><p id="bh6ssn_1287"><span class="control" id="bh6ssn_1293">Параметры</span>:</p><p id="bh6ssn_1288">- Object (binary): Объект, для которого необходимо определить класс.</p><p id="bh6ssn_1289"><span class="control" id="bh6ssn_1294">Возвращает</span>: Целое число, представляющее класс объекта, или 0, если совпадение не найдено.</p><p id="bh6ssn_1290"><span class="control" id="bh6ssn_1295">Пример использования</span>:</p><p id="bh6ssn_1291">system_utils:vclass_from_object(Object).</p><p id="bh6ssn_1292"></p></td></tr><tr id="bh6ssn_1251"><td id="bh6ssn_1296"><p>utc_time/0</p></td><td id="bh6ssn_1297"><p id="bh6ssn_1298">: Возвращает текущие дату и время в формате UTC.</p><p id="bh6ssn_1299"><span class="control" id="bh6ssn_1304">Параметры</span>: Нет.</p><p id="bh6ssn_1300"><span class="control" id="bh6ssn_1305">Возвращает</span>: Строку с отформатированной датой и временем.</p><p id="bh6ssn_1301"><span class="control" id="bh6ssn_1306">Пример использования</span>:</p><p id="bh6ssn_1302">system_utils:utc_time().</p><p id="bh6ssn_1303"></p></td></tr><tr id="bh6ssn_1252"><td id="bh6ssn_1307"><p>create_csv/2</p></td><td id="bh6ssn_1308"><p id="bh6ssn_1309">: Создает CSV-файл с данными, извлеченными из хранилища данных.</p><p id="bh6ssn_1310"><span class="control" id="bh6ssn_1316">Параметры</span>:</p><p id="bh6ssn_1311">- Path (binary): Путь для выборки данных.</p><p id="bh6ssn_1312">- File (binary): Имя файла для сохранения.</p><p id="bh6ssn_1313"><span class="control" id="bh6ssn_1317">Возвращает</span>: Атом ok в случае успеха.</p><p id="bh6ssn_1314"><span class="control" id="bh6ssn_1318">Пример использования</span>:</p><p id="bh6ssn_1315">system_utils:create_csv(&lt;&lt;&quot;/data/path&quot;&gt;&gt;, &lt;&lt;&quot;output.csv&quot;&gt;&gt;).</p></td></tr><tr id="bh6ssn_1253"><td id="bh6ssn_1319"><p>delete_elements/4</p></td><td id="bh6ssn_1320"><p id="bh6ssn_1321">: Удаляет элементы из хранилища данных, соответствующие заданным критериям.</p><p id="bh6ssn_1322"><span class="control" id="bh6ssn_1331">Параметры</span>:</p><p id="bh6ssn_1323">- Root (binary): Корневой путь проекта.</p><p id="bh6ssn_1324">- Folder (binary): Папка для выборки.</p><p id="bh6ssn_1325">- Pattern (binary): Шаблон для поиска.</p><p id="bh6ssn_1326">- Name (binary): Имя элемента для удаления.</p><p id="bh6ssn_1327"><span class="control" id="bh6ssn_1332">Возвращает</span>: Атом ok в случае успеха.</p><p id="bh6ssn_1328"><span class="control" id="bh6ssn_1333">Пример использования</span>:</p><p id="bh6ssn_1329">system_utils:delete_elements(&lt;&lt;&quot;UZHNIY&quot;&gt;&gt;, &lt;&lt;&quot;@models&quot;&gt;&gt;, &lt;&lt;&quot;/root/FP/prototypes/telemetry/fields&quot;&gt;&gt;, &lt;&lt;&quot;Uac&quot;&gt;&gt;).</p><p id="bh6ssn_1330"></p></td></tr><tr id="bh6ssn_1254"><td id="bh6ssn_1334"><p>set_state_value/4</p></td><td id="bh6ssn_1335"><p id="bh6ssn_1336">: Устанавливает значение полей объектов state, вложенных в объекты, соответствующие заданным прототипам и находящиеся в заданном контексте.</p><p id="bh6ssn_1337"><span class="control" id="bh6ssn_1346">Параметры</span>:</p><p id="bh6ssn_1338">- Context (binary): Контекст, в котором будет установлено значение.</p><p id="bh6ssn_1339">- EdgePrototypes (list): Список прототипов.</p><p id="bh6ssn_1340">- Path (binary): Относительный путь к объекту состояния</p><p id="bh6ssn_1341">- FieldMap (map): Карта полей для обновления.</p><p id="bh6ssn_1342"><span class="control" id="bh6ssn_1347">Возвращает</span>: Атом ok в случае успеха.</p><p id="bh6ssn_1343"><span class="control" id="bh6ssn_1348">Пример использования</span>:</p><p id="bh6ssn_1344">system_utils:set_state_value(&lt;&lt;&quot;/root/FP/PROJECT/KAZ/UZHNIY/Kyzylorda&quot;&gt;&gt;, [&lt;&lt;&quot;isolator&quot;&gt;&gt;, &lt;&lt;&quot;earth_isolator&quot;&gt;&gt;], &lt;&lt;&quot;/state&quot;&gt;&gt;, #{&lt;&lt;&quot;in_value&quot;&gt;&gt; =&gt; 1}).</p><p id="bh6ssn_1345"></p></td></tr></tbody></table></div></section><section class="chapter"><h2 id="2-weather-service" data-toc="2-weather-service"><a name=""></a><span class="control" id="bh6ssn_1375">А.2 Модуль weather_service</span></h2><p id="bh6ssn_1350">Служба интеграции прогноза погоды. Этот модуль взаимодействует с внешним API для получения данных о погоде, которые могут использоваться для анализа и прогноза производительности системы, учитывая метеоусловия.</p><p id="bh6ssn_1351"><span class="control" id="bh6ssn_1376">Общая информация</span></p><p id="bh6ssn_1352">Модуль weather_service предназначен для получения информации о текущей погоде и прогноза на 24 часа. Модуль разработан на языке Erlang. Для логирования сообщений предлагается использовать макросы: ?LOGINFO, ?LOGWARNING, ?LOGERROR и обеспечивать откат транзакций при ошибках. При успешном оформлении возвращается атом ok.</p><div class="table-wrapper"><table class="wide" id="bh6ssn_1353"><thead><tr class="ijRowHead" id="bh6ssn_1377"><th id="bh6ssn_1380"><p><span class="control" id="bh6ssn_1382">Функция</span></p></th><th id="bh6ssn_1381"><p><span class="control" id="bh6ssn_1383">Описание</span></p></th></tr></thead><tbody><tr id="bh6ssn_1378"><td id="bh6ssn_1384"><p>forecast24/1</p></td><td id="bh6ssn_1385"><p id="bh6ssn_1386">: Получает прогноз погоды на 24 часа через API OpenWeatherMap.</p><p id="bh6ssn_1387"><span class="control" id="bh6ssn_1398">Параметры</span>:</p><p id="bh6ssn_1388">- Obj (map): Объект, содержащий координаты (широта lat и долгота lon).</p><p id="bh6ssn_1389"><span class="control" id="bh6ssn_1399">Возвращает</span>: Обработанные данные о прогнозе, включая массивы температуры, давления, влажности, скорости и направления ветра.</p><p id="bh6ssn_1390"><span class="control" id="bh6ssn_1400">Пример использования</span>:</p><p id="bh6ssn_1391">weather_service:forecast24(Object).</p><p id="bh6ssn_1392"><span class="control" id="bh6ssn_1401">Детали реализации</span>:</p><p id="bh6ssn_1393">- Чтение координат из объекта с использованием fp_db:read_fields.</p><p id="bh6ssn_1394">- Формирование URL для запроса к API.</p><p id="bh6ssn_1395">- Выполнение HTTP-запроса с использованием модуля httpc.</p><p id="bh6ssn_1396">- Парсинг ответа JSON с помощью библиотеки jsx.</p><p id="bh6ssn_1397">- Обработка данных прогноза для температуры, давления, влажности, скорости и направления ветра.</p></td></tr><tr id="bh6ssn_1379"><td id="bh6ssn_1402"><p>current/1</p></td><td id="bh6ssn_1403"><p id="bh6ssn_1404">: Получает текущую погоду через API OpenWeatherMap.</p><p id="bh6ssn_1405"><span class="control" id="bh6ssn_1423">Параметры</span>:</p><p id="bh6ssn_1406">- Obj (map): Объект, содержащий координаты (широта lat и долгота lon).</p><p id="bh6ssn_1407"><span class="control" id="bh6ssn_1424">Возвращает</span>: Карта значений с текущими погодными данными:</p><p id="bh6ssn_1408">- ts: Временная метка.</p><p id="bh6ssn_1409">- pressure: Давление (гПа).</p><p id="bh6ssn_1410">- temperature: Температура (&deg;C).</p><p id="bh6ssn_1411">- humidity: Влажность (%).</p><p id="bh6ssn_1412">- wind_speed: Скорость ветра (м/с).</p><p id="bh6ssn_1413">- wind_direction: Направление ветра (градусы).</p><p id="bh6ssn_1414"><span class="control" id="bh6ssn_1425">Пример использования</span>:</p><p id="bh6ssn_1415">weather_service:current(Object).</p><p id="bh6ssn_1416"><span class="control" id="bh6ssn_1426">Детали реализации</span>:</p><p id="bh6ssn_1417">- Чтение координат из объекта с использованием fp_db:read_fields.</p><p id="bh6ssn_1418">- Формирование URL для запроса к API.</p><p id="bh6ssn_1419">- Выполнение HTTP-запроса с использованием модуля httpc.</p><p id="bh6ssn_1420">- Парсинг ответа JSON с помощью библиотеки jsx.</p><p id="bh6ssn_1421">- Извлечение значений давления, температуры, влажности, скорости и направления ветра.</p><p id="bh6ssn_1422"></p></td></tr></tbody></table></div><p id="bh6ssn_1354"><span class="control" id="bh6ssn_1427">Примечания</span></p><ul class="list _bullet" id="bh6ssn_1355"><li class="list__item" id="bh6ssn_1428"><p id="bh6ssn_1433">Убедитесь, что у вас есть действительный ключ API OpenWeatherMap.</p></li><li class="list__item" id="bh6ssn_1429"><p id="bh6ssn_1434">Для повышения производительности рекомендуется кешировать результаты запросов.</p><section class="chapter"><h3 id="3-fp-userlib-archive" data-toc="3-fp-userlib-archive"><a name=""></a><span class="control" id="bh6ssn_1441">А.3 Модуль fp_userlib_archive</span></h3><p id="bh6ssn_1437">Модуль для работы с архивами. Предназначен для управления архивированием данных и взаимодействия с базой архивов, включая создание, удаление и обновление записей.</p><p id="bh6ssn_1438"><span class="control" id="bh6ssn_1442">Общая информация</span></p><p id="bh6ssn_1439">Модуль fp_userlib_archive предоставляет функцию для сохранения данных из CSV-файла в архив. Код написан на языке программирования Erlang. При возникновении ошибок транзакция будет отменена. Рекомендуется логировать информацию о процессе выполнения с использованием макросов:</p></section></li><li class="list__item" id="bh6ssn_1430"><p id="bh6ssn_1443">?LOGINFO</p></li><li class="list__item" id="bh6ssn_1431"><p id="bh6ssn_1444">?LOGWARNING</p></li><li class="list__item" id="bh6ssn_1432"><p id="bh6ssn_1445">?LOGERROR</p></li></ul><div class="table-wrapper"><table class="wide" id="bh6ssn_1356"><thead><tr class="ijRowHead" id="bh6ssn_1446"><th id="bh6ssn_1449"><p><span class="control" id="bh6ssn_1451">Функция</span></p></th><th id="bh6ssn_1450"><p><span class="control" id="bh6ssn_1452">Описание</span></p></th></tr></thead><tbody><tr id="bh6ssn_1447"><td id="bh6ssn_1453"><p>csv_to_archive/1</p></td><td id="bh6ssn_1454"><p id="bh6ssn_1455">: Сохраняет данные из CSV-файла, переданного в виде строки в формате Base64, в архив.</p><p id="bh6ssn_1456"><span class="control" id="bh6ssn_1474">Параметры</span>:</p><p id="bh6ssn_1457">- Args (map): Словарь с ключами:</p><p id="bh6ssn_1458">- archive_path (binary): Путь к архиву, куда будут записаны данные.</p><p id="bh6ssn_1459">- content (binary): Содержимое CSV-файла в формате Base64.</p><p id="bh6ssn_1460"><span class="control" id="bh6ssn_1475">Возвращает</span>: Атом ok в случае успешного выполнения или выбрасывает исключение в случае ошибки.</p><p id="bh6ssn_1461"><span class="control" id="bh6ssn_1476">Пример использования</span>:</p><p id="bh6ssn_1462">Args = #{</p><p id="bh6ssn_1463"><code class="code" id="bh6ssn_1477"></code> &lt;&lt;&quot;archive_path&quot;&gt;&gt; =&gt; &lt;&lt;&quot;/path/to/archive&quot;&gt;&gt;,</p><p id="bh6ssn_1464"><code class="code" id="bh6ssn_1478"></code> &lt;&lt;&quot;content&quot;&gt;&gt; =&gt; &lt;&lt;&quot;VGltZXN0YW1wLFZhbHVlCjE2NzMwMjUwMDAsMTIzLjQ1Cg==&quot;&gt;&gt; %% Base64-encoded CSV</p><p id="bh6ssn_1465">}.</p><p id="bh6ssn_1466">fp_userlib_archive:csv_to_archive(Args).</p><p id="bh6ssn_1467"><span class="control" id="bh6ssn_1479">Детали реализации</span>:</p><p id="bh6ssn_1468">- Декодирует содержимое CSV-файла из Base64 в бинарный формат.</p><p id="bh6ssn_1469">- Разделяет данные на строки и колонки.</p><p id="bh6ssn_1470">- Конвертирует данные времени (timestamp) и значений (value) в подходящие типы.</p><p id="bh6ssn_1471">- Пытается записать обработанные данные в указанный архив с помощью функции fp_archive:insert_values.</p><p id="bh6ssn_1472">- В случае ошибки записывает информацию в лог.</p><p id="bh6ssn_1473"></p></td></tr><tr id="bh6ssn_1448"><td id="bh6ssn_1480" colspan="2"></td></tr></tbody></table></div><p id="bh6ssn_1357"><span class="control" id="bh6ssn_1481">Примечания</span></p><ul class="list _bullet" id="bh6ssn_1358"><li class="list__item" id="bh6ssn_1482"><p id="bh6ssn_1488">Данные CSV-файла должны быть корректно закодированы в Base64.</p></li><li class="list__item" id="bh6ssn_1483"><p id="bh6ssn_1489">Архив, указанный в archive_path, должен существовать и быть доступным для записи.</p></li><li class="list__item" id="bh6ssn_1484"><p id="bh6ssn_1490">В случае возникновения исключений данные не будут записаны.</p><section class="chapter"><h3 id="4-fp-pf-utils" data-toc="4-fp-pf-utils"><a name=""></a><span class="control" id="bh6ssn_1498">А.4 Модуль fp_pf_utils</span></h3><p id="bh6ssn_1493">Вспомогательные функции для интеграции с PowerFactory (PF). Этот модуль помогает в управлении и мониторинге сетевых моделей, позволяя обмениваться данными между SCADA-системой и PF.</p><p id="bh6ssn_1494"><span class="control" id="bh6ssn_1499">Общая информация</span></p><p id="bh6ssn_1495">Модуль fp_pf_utils предоставляет функции для взаимодействия с PowerFactory Service. Основные функции включают операции для получения данных, выполнения расчётов и запуска динамических сценариев. Код написан на языке программирования Erlang. Все транзакции откатываются в случае ошибок, а успешное выполнение возвращает атом ok.</p><p id="bh6ssn_1496">Рекомендуется использовать следующие макросы для логирования:</p></section></li><li class="list__item" id="bh6ssn_1485"><p id="bh6ssn_1500">?LOGINFO</p></li><li class="list__item" id="bh6ssn_1486"><p id="bh6ssn_1501">?LOGWARNING</p></li><li class="list__item" id="bh6ssn_1487"><p id="bh6ssn_1502">?LOGERROR</p></li></ul><div class="table-wrapper"><table class="wide" id="bh6ssn_1359"><thead><tr class="ijRowHead" id="bh6ssn_1503"><th id="bh6ssn_1507"><p><span class="control" id="bh6ssn_1509">Функция</span></p></th><th id="bh6ssn_1508"><p><span class="control" id="bh6ssn_1510">Описание</span></p></th></tr></thead><tbody><tr id="bh6ssn_1504"><td id="bh6ssn_1511"><p>pf_get/0</p></td><td id="bh6ssn_1512"><p id="bh6ssn_1513">: Получает данные из PowerFactory на основе заданных параметров проекта.</p><p id="bh6ssn_1514"><span class="control" id="bh6ssn_1521">Параметры</span>: Нет.</p><p id="bh6ssn_1515"><span class="control" id="bh6ssn_1522">Возвращает</span>: Результат выполнения запроса к PowerFactory Service.</p><p id="bh6ssn_1516"><span class="control" id="bh6ssn_1523">Пример использования</span>:</p><p id="bh6ssn_1517">fp_pf_utils:pf_get().</p><p id="bh6ssn_1518"><span class="control" id="bh6ssn_1524">Детали реализации</span>:</p><p id="bh6ssn_1519">- Формирует параметры проекта, включая имя сетки, имя проекта, имя сценария и тип сессии.</p><p id="bh6ssn_1520">- Выполняет запрос через fp_powerfactory_service:pf_service_update с использованием хоста и порта.</p></td></tr><tr id="bh6ssn_1505"><td id="bh6ssn_1525"><p>pf_execute/0</p></td><td id="bh6ssn_1526"><p id="bh6ssn_1527">: Выполняет расчёт на основе заданных параметров проекта и указания идентификатора LDF.</p><p id="bh6ssn_1528"><span class="control" id="bh6ssn_1537">Параметры</span>: Нет.</p><p id="bh6ssn_1529"><span class="control" id="bh6ssn_1538">Возвращает</span>: Результат выполнения запроса к PowerFactory Service.</p><p id="bh6ssn_1530"><span class="control" id="bh6ssn_1539">Пример использования</span>:</p><p id="bh6ssn_1531">fp_pf_utils:pf_execute().</p><p id="bh6ssn_1532"><span class="control" id="bh6ssn_1540">Детали реализации</span>:</p><p id="bh6ssn_1533">- Формирует параметры проекта, включая имя сетки, имя проекта, имя сценария и тип сессии.</p><p id="bh6ssn_1534">- Определяет идентификатор объекта ComLdfOID для выполнения расчёта.</p><p id="bh6ssn_1535">- Выполняет запрос через fp_powerfactory_service:pf_service_update с использованием хоста и порта.</p><p id="bh6ssn_1536"></p></td></tr><tr id="bh6ssn_1506"><td id="bh6ssn_1541"><p>pf_dynamics/0</p></td><td id="bh6ssn_1542"><p id="bh6ssn_1543">: Запускает динамический сценарий расчёта на основе заданных параметров проекта.</p><p id="bh6ssn_1544"><span class="control" id="bh6ssn_1551">Параметры</span>: Нет.</p><p id="bh6ssn_1545"><span class="control" id="bh6ssn_1552">Возвращает</span>: Результат выполнения запроса к PowerFactory Service.</p><p id="bh6ssn_1546"><span class="control" id="bh6ssn_1553">Пример использования</span>:</p><p id="bh6ssn_1547">fp_pf_utils:pf_dynamics().</p><p id="bh6ssn_1548"><span class="control" id="bh6ssn_1554">Детали реализации</span>:</p><p id="bh6ssn_1549">- Формирует параметры проекта, включая имя сетки, имя проекта, имя сценария и тип сессии.</p><p id="bh6ssn_1550">- Выполняет запрос через fp_powerfactory_service:pf_service_update с использованием хоста и порта.</p></td></tr></tbody></table></div><p id="bh6ssn_1360"><span class="control" id="bh6ssn_1555">Примечания</span></p><ul class="list _bullet" id="bh6ssn_1361"><li class="list__item" id="bh6ssn_1556"><p id="bh6ssn_1558">Хост и порт для запросов определены через макросы ?HOST и ?PORT.</p></li><li class="list__item" id="bh6ssn_1557"><p id="bh6ssn_1559">Перед использованием функций убедитесь, что PowerFactory Service доступен по указанным параметрам.</p><section class="chapter"><h3 id="5-bms-service" data-toc="5-bms-service"><a name=""></a><span class="control" id="bh6ssn_1566">А.5 Модуль bms_service</span></h3><p id="bh6ssn_1562">Логика сервиса для системы рынка баланса. Этот модуль управляет обменом данными с балансирующим рынком, обрабатывая данные о спросе и предложении.</p><p id="bh6ssn_1563"><span class="control" id="bh6ssn_1567">Общая информация</span></p><p id="bh6ssn_1564">Модуль bms_service предоставляет функции для интеграции с REST API и обработки данных из внешних систем. Код написан на языке Erlang. Все методы модуля работают с объектами, позволяют редактировать их и обеспечивают откат транзакций в случае ошибок. Логирование рекомендуется выполнять с использованием макросов ?LOGINFO, ?LOGWARNING и ?LOGERROR.</p></section></li></ul><div class="table-wrapper"><table class="wide" id="bh6ssn_1362"><thead><tr class="ijRowHead" id="bh6ssn_1568"><th id="bh6ssn_1573"><p><span class="control" id="bh6ssn_1575">Функция</span></p></th><th id="bh6ssn_1574"><p><span class="control" id="bh6ssn_1576">Описание</span></p></th></tr></thead><tbody><tr id="bh6ssn_1569"><td id="bh6ssn_1577"><p>find_objects/1</p></td><td id="bh6ssn_1578"><p id="bh6ssn_1579">: Ищет объекты в хранилище данных на основе переданных фильтров.</p><p id="bh6ssn_1580"><span class="control" id="bh6ssn_1594">Параметры</span>:</p><p id="bh6ssn_1581">- Filter (map): Словарь, содержащий ключи:</p><p id="bh6ssn_1582">- &lt;&lt;&quot;.path&quot;&gt;&gt;: Корневой путь объекта.</p><p id="bh6ssn_1583">- &lt;&lt;&quot;.name&quot;&gt;&gt;: Имя объекта.</p><p id="bh6ssn_1584">- &lt;&lt;&quot;.prototype&quot;&gt;&gt;: Прототип объекта.</p><p id="bh6ssn_1585"><span class="control" id="bh6ssn_1595">Возвращает</span>: Список объектов, соответствующих заданным фильтрам, либо {error, [[], []]} в случае ошибки.</p><p id="bh6ssn_1586"><span class="control" id="bh6ssn_1596">Пример использования</span>:</p><p id="bh6ssn_1587">Filter = #{</p><p id="bh6ssn_1588"><code class="code" id="bh6ssn_1597"></code> &lt;&lt;&quot;.path&quot;&gt;&gt; =&gt; &lt;&lt;&quot;/root/PROJECT/&quot;&gt;&gt;,</p><p id="bh6ssn_1589"><code class="code" id="bh6ssn_1598"></code> &lt;&lt;&quot;.name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;subject&quot;&gt;&gt;,</p><p id="bh6ssn_1590"><code class="code" id="bh6ssn_1599"></code> &lt;&lt;&quot;.prototype&quot;&gt;&gt; =&gt; &lt;&lt;&quot;/root/FP/prototypes/subject/fields&quot;&gt;&gt;</p><p id="bh6ssn_1591">}.</p><p id="bh6ssn_1592">bms_service:find_objects(Filter).</p><p id="bh6ssn_1593"></p></td></tr><tr id="bh6ssn_1570"><td id="bh6ssn_1600"><p>run/0</p></td><td id="bh6ssn_1601"><p id="bh6ssn_1602">: Основная функция для выполнения задачи. Осуществляет получение объектов, авторизацию через REST API, запрос данных и запись их в архивы.</p><p id="bh6ssn_1603"><span class="control" id="bh6ssn_1613">Параметры</span>: Нет.</p><p id="bh6ssn_1604"><span class="control" id="bh6ssn_1614">Возвращает</span>: Атом ok при успешном выполнении, либо описание ошибки.</p><p id="bh6ssn_1605"><span class="control" id="bh6ssn_1615">Пример использования</span>:</p><p id="bh6ssn_1606">bms_service:run().</p><p id="bh6ssn_1607"><span class="control" id="bh6ssn_1616">Детали реализации</span>:</p><p id="bh6ssn_1608">- Формирует фильтры для поиска объектов.</p><p id="bh6ssn_1609">- Выполняет запрос для получения токена авторизации через REST API.</p><p id="bh6ssn_1610">- Осуществляет запрос данных по объектам с использованием токена.</p><p id="bh6ssn_1611">- Преобразует полученные данные и записывает их в архивы.</p><p id="bh6ssn_1612"></p></td></tr><tr id="bh6ssn_1571"><td id="bh6ssn_1617"><p>write_to_db/2</p></td><td id="bh6ssn_1618"><p id="bh6ssn_1619">: Записывает данные в хранилище данных, удаляя старые записи в указанном диапазоне.</p><p id="bh6ssn_1620"><span class="control" id="bh6ssn_1627">Параметры</span>:</p><p id="bh6ssn_1621">- Data (list): Список данных для записи.</p><p id="bh6ssn_1622">- Archive (binary): Путь к архиву.</p><p id="bh6ssn_1623"><span class="control" id="bh6ssn_1628">Возвращает</span>: {ok, written_to_db} при успешной записи либо {error, {write_failure, Reason}} при ошибке.</p><p id="bh6ssn_1624"><span class="control" id="bh6ssn_1629">Пример использования</span>:</p><p id="bh6ssn_1625">bms_service:write_to_db(Data, Archive).</p><p id="bh6ssn_1626"></p></td></tr><tr id="bh6ssn_1572"><td id="bh6ssn_1630"><p>extract_data/2</p></td><td id="bh6ssn_1631"><p id="bh6ssn_1632">: Извлекает и преобразует данные из ответа API для последующей обработки.</p><p id="bh6ssn_1633"><span class="control" id="bh6ssn_1639">Параметры</span>:</p><p id="bh6ssn_1634">- Objects (list): Список объектов для обработки.</p><p id="bh6ssn_1635">- Response (map): Ответ от REST API.</p><p id="bh6ssn_1636"><span class="control" id="bh6ssn_1640">Возвращает</span>: Преобразованные данные или ok, если дата не соответствует требованиям.</p><p id="bh6ssn_1637"><span class="control" id="bh6ssn_1641">Пример использования</span>:</p><p id="bh6ssn_1638">bms_service:extract_data(Objects, Response).</p></td></tr></tbody></table></div><p id="bh6ssn_1363"><span class="control" id="bh6ssn_1642">Примечания</span></p><ul class="list _bullet" id="bh6ssn_1364"><li class="list__item" id="bh6ssn_1643"><p id="bh6ssn_1647">Функции transform_purchases/2 и transform_sales/2 используются для преобразования данных покупок и продаж в формате {Timestamp, Value}.</p></li><li class="list__item" id="bh6ssn_1644"><p id="bh6ssn_1648">Убедитесь, что REST API доступен и корректно настроен для выполнения запросов.</p></li><li class="list__item" id="bh6ssn_1645"><p id="bh6ssn_1649">Все временные метки преобразуются в миллисекунды для использования в архивах.</p></li><li class="list__item" id="bh6ssn_1646"><p id="bh6ssn_1650">При работе с датами используются вспомогательные функции is_today/1 и is_tomorrow/1 для определения актуальности данных.</p><section class="chapter"><h3 id="6-calculation-v2" data-toc="6-calculation-v2"><a name=""></a><span class="control" id="bh6ssn_1657">А.6 Модуль calculation (v2)</span></h3><p id="bh6ssn_1653">Модуль для выполнения различных вычислений. Поддерживает более сложные операции, включая обработку данных в режиме реального времени.</p><p id="bh6ssn_1654"><span class="control" id="bh6ssn_1658">Общая информация</span></p><p id="bh6ssn_1655">Модуль calculation предоставляет функцию для вычисления значений на основе строки, содержащей арифметические операции, такие как сложение и вычитание. Код написан на языке Erlang и включает обработку ошибок и логирование. Основная цель &mdash; обработка строк с числами и получение вычисленного результата.</p></section></li></ul><div class="table-wrapper"><table class="wide" id="bh6ssn_1365"><thead><tr class="ijRowHead" id="bh6ssn_1659"><th id="bh6ssn_1669"><p><span class="control" id="bh6ssn_1671">Функция</span></p></th><th id="bh6ssn_1670"><p><span class="control" id="bh6ssn_1672">Описание</span></p></th></tr></thead><tbody><tr id="bh6ssn_1660"><td id="bh6ssn_1673"><p>evaluate/2</p></td><td id="bh6ssn_1674"><p id="bh6ssn_1675">: Выполняет вычисление на основе переданной строки с арифметическими операциями.</p><p id="bh6ssn_1676"><span class="control" id="bh6ssn_1687">Параметры</span>:</p><p id="bh6ssn_1677">- Name (binary): Имя объекта, которое используется для получения дополнительных значений.</p><p id="bh6ssn_1678">- String (binary): Строка с числами и арифметическими операциями (+ и -).</p><p id="bh6ssn_1679"><span class="control" id="bh6ssn_1688">Возвращает</span>: Вычисленное числовое значение или {error, Reason} в случае ошибки.</p><p id="bh6ssn_1680"><span class="control" id="bh6ssn_1689">Пример использования</span>:</p><p id="bh6ssn_1681">calculation:evaluate(&lt;&lt;&quot;example&quot;&gt;&gt;, &lt;&lt;&quot;10+20-5&quot;&gt;&gt;).</p><p id="bh6ssn_1682"><span class="control" id="bh6ssn_1690">Детали реализации</span>:</p><p id="bh6ssn_1683">- Проверяет, является ли String бинарной строкой.</p><p id="bh6ssn_1684">- Разбивает строку на токены с помощью функции tokenize/1.</p><p id="bh6ssn_1685">- Передаёт токены в функцию evaluate_tokens/2 для выполнения вычислений.</p><p id="bh6ssn_1686">- Логирует ошибки, если они возникают.</p></td></tr><tr id="bh6ssn_1661"><td id="bh6ssn_1691"><p>tokenize/1</p></td><td id="bh6ssn_1692"><p id="bh6ssn_1693">: Разбивает строку на токены по операторам + и -.</p><p id="bh6ssn_1694"><span class="control" id="bh6ssn_1700">Параметры</span>:</p><p id="bh6ssn_1695">- String (binary): Входная строка.</p><p id="bh6ssn_1696"><span class="control" id="bh6ssn_1701">Возвращает</span>: Список токенов в виде бинарных строк.</p><p id="bh6ssn_1697"><span class="control" id="bh6ssn_1702">Пример использования</span>:</p><p id="bh6ssn_1698">calculation:tokenize(&lt;&lt;&quot;10+20-5&quot;&gt;&gt;).</p><p id="bh6ssn_1699"></p></td></tr><tr id="bh6ssn_1662"><td id="bh6ssn_1703"><p>evaluate_tokens/2</p></td><td id="bh6ssn_1704"><p id="bh6ssn_1705">: Выполняет вычисление на основе списка токенов.</p><p id="bh6ssn_1706"><span class="control" id="bh6ssn_1713">Параметры</span>:</p><p id="bh6ssn_1707">- Name (binary): Имя объекта.</p><p id="bh6ssn_1708">- Tokens (list): Список токенов (числа, операторы + и -).</p><p id="bh6ssn_1709"><span class="control" id="bh6ssn_1714">Возвращает</span>: Результат вычисления.</p><p id="bh6ssn_1710"><span class="control" id="bh6ssn_1715">Пример использования</span>:</p><p id="bh6ssn_1711">calculation:evaluate_tokens(&lt;&lt;&quot;example&quot;&gt;&gt;, [&lt;&lt;&quot;10&quot;&gt;&gt;, &lt;&lt;&quot;+&quot;&gt;&gt;, &lt;&lt;&quot;20&quot;&gt;&gt;, &lt;&lt;&quot;-&quot;&gt;&gt;, &lt;&lt;&quot;5&quot;&gt;&gt;]).</p><p id="bh6ssn_1712"></p></td></tr><tr id="bh6ssn_1663"><td id="bh6ssn_1716"><p>get_value/1</p></td><td id="bh6ssn_1717"><p id="bh6ssn_1718">: Получает значение поля out_value из объекта в хранилище данных.</p><p id="bh6ssn_1719"><span class="control" id="bh6ssn_1725">Параметры</span>:</p><p id="bh6ssn_1720">Token (binary): Путь к объекту в виде строки.</p><p id="bh6ssn_1721"><span class="control" id="bh6ssn_1726">Возвращает</span>: Значение поля out_value или вызывает исключение в случае ошибки.</p><p id="bh6ssn_1722"><span class="control" id="bh6ssn_1727">Пример использования</span>:</p><p id="bh6ssn_1723">calculation:get_value(&lt;&lt;&quot;/root/FP/PROJECT/example&quot;&gt;&gt;).</p><p id="bh6ssn_1724"></p></td></tr><tr id="bh6ssn_1664"><td id="bh6ssn_1728"><p>get_catalog/2</p></td><td id="bh6ssn_1729"><p id="bh6ssn_1730">: Получает значение из каталога формул и вычисляет его, если оно содержит арифметическое выражение.</p><p id="bh6ssn_1731"><span class="control" id="bh6ssn_1738">Параметры</span>:</p><p id="bh6ssn_1732">- Name (binary): Имя объекта.</p><p id="bh6ssn_1733">- Token (binary): Идентификатор формулы.</p><p id="bh6ssn_1734"><span class="control" id="bh6ssn_1739">Возвращает</span>: Числовое значение или результат вычисления.</p><p id="bh6ssn_1735"><span class="control" id="bh6ssn_1740">Пример использования</span>:</p><p id="bh6ssn_1736">calculation:get_catalog(&lt;&lt;&quot;example&quot;&gt;&gt;, &lt;&lt;&quot;formula_1&quot;&gt;&gt;).</p><p id="bh6ssn_1737"></p></td></tr><tr id="bh6ssn_1665"><td id="bh6ssn_1741"><p>split_path/1</p></td><td id="bh6ssn_1742"><p id="bh6ssn_1743">: Разделяет путь на папку и имя объекта.</p><p id="bh6ssn_1744"><span class="control" id="bh6ssn_1750">Параметры</span>:</p><p id="bh6ssn_1745">- Bin (binary): Полный путь к объекту.</p><p id="bh6ssn_1746"><span class="control" id="bh6ssn_1751">Возвращает</span>: Кортеж {Folder, Name}.</p><p id="bh6ssn_1747"><span class="control" id="bh6ssn_1752">Пример использования</span>:</p><p id="bh6ssn_1748">calculation:split_path(&lt;&lt;&quot;/root/FP/PROJECT/example&quot;&gt;&gt;).</p><p id="bh6ssn_1749"></p></td></tr><tr id="bh6ssn_1666"><td id="bh6ssn_1753"><p>strings_to_binaries/1</p></td><td id="bh6ssn_1754"><p id="bh6ssn_1755">: Преобразует список строк в список бинарных строк.</p><p id="bh6ssn_1756"><span class="control" id="bh6ssn_1761">Параметры</span>:</p><p id="bh6ssn_1757">- Strings (list): Список строк.</p><p id="bh6ssn_1758"><span class="control" id="bh6ssn_1762">Возвращает</span>: Список бинарных строк.</p><p id="bh6ssn_1759"><span class="control" id="bh6ssn_1763">Пример использования</span>:</p><p id="bh6ssn_1760">calculation:strings_to_binaries([&quot;10&quot;, &quot;+&quot;, &quot;20&quot;, &quot;-&quot;, &quot;5&quot;]).</p></td></tr><tr id="bh6ssn_1667"><td id="bh6ssn_1764"><p>token_is_docker/1</p></td><td id="bh6ssn_1765"><p id="bh6ssn_1766">: Проверяет, является ли токен идентификатором объекта в системе Docker.</p><p id="bh6ssn_1767"><span class="control" id="bh6ssn_1772">Параметры</span>:</p><p id="bh6ssn_1768">- Token (binary): Токен для проверки.</p><p id="bh6ssn_1769"><span class="control" id="bh6ssn_1773">Возвращает</span>: true или false.</p><p id="bh6ssn_1770"><span class="control" id="bh6ssn_1774">Пример использования</span>:</p><p id="bh6ssn_1771">calculation:token_is_docker(&lt;&lt;&quot;/docker/object&quot;&gt;&gt;).</p></td></tr><tr id="bh6ssn_1668"><td id="bh6ssn_1775"><p>token_type/1</p></td><td id="bh6ssn_1776"><p id="bh6ssn_1777">: Определяет тип токена (целое число, число с плавающей точкой или неизвестный тип).</p><p id="bh6ssn_1778"><span class="control" id="bh6ssn_1784">Параметры</span>:</p><p id="bh6ssn_1779">- Token (binary): Токен для анализа.</p><p id="bh6ssn_1780"><span class="control" id="bh6ssn_1785">Возвращает</span>: int, float или false.</p><p id="bh6ssn_1781"><span class="control" id="bh6ssn_1786">Пример использования</span>:</p><p id="bh6ssn_1782">calculation:token_type(&lt;&lt;&quot;10.5&quot;&gt;&gt;).</p><p id="bh6ssn_1783"></p></td></tr></tbody></table></div><p id="bh6ssn_1366"><span class="control" id="bh6ssn_1787">Примечания</span></p><ul class="list _bullet" id="bh6ssn_1367"><li class="list__item" id="bh6ssn_1788"><p id="bh6ssn_1791">Убедитесь, что входная строка корректно сформирована и содержит только поддерживаемые операторы и числа.</p></li><li class="list__item" id="bh6ssn_1789"><p id="bh6ssn_1792">В случае ошибок вызовите логирование для диагностики причин.</p></li><li class="list__item" id="bh6ssn_1790"><p id="bh6ssn_1793">Функции работают с бинарными строками, поэтому при вводе данных убедитесь, что строки находятся в правильном формате.</p><section class="chapter"><h3 id="7-docker-client-v0-1" data-toc="7-docker-client-v0-1"><a name=""></a><span class="control" id="bh6ssn_1800">А.7 Модуль docker_client (v0.1)</span></h3><p id="bh6ssn_1796">Клиент для взаимодействия с Docker. Используется для управления контейнерами Docker из среды Faceplate Studio, что удобно для разворачивания и мониторинга приложений в контейнерах.</p><p id="bh6ssn_1797"><span class="control" id="bh6ssn_1801">Общая информация</span></p><p id="bh6ssn_1798">Модуль docker_client предоставляет интерфейс для взаимодействия с Docker Engine через API. Функции модуля позволяют получать список контейнеров, создавать и запускать контейнеры. Код написан на языке Erlang.</p></section></li></ul><div class="table-wrapper"><table class="wide" id="bh6ssn_1368"><thead><tr class="ijRowHead" id="bh6ssn_1802"><th id="bh6ssn_1806"><p><span class="control" id="bh6ssn_1808">Функция</span></p></th><th id="bh6ssn_1807"><p><span class="control" id="bh6ssn_1809">Описание</span></p></th></tr></thead><tbody><tr id="bh6ssn_1803"><td id="bh6ssn_1810"><p>list_containers/0</p></td><td id="bh6ssn_1811"><p id="bh6ssn_1812">: Возвращает список контейнеров, запущенных в Docker Engine.</p><p id="bh6ssn_1813"><span class="control" id="bh6ssn_1824">Параметры</span>: Нет.</p><p id="bh6ssn_1814"><span class="control" id="bh6ssn_1825">Возвращает</span>:</p><p id="bh6ssn_1815">- {ok, Containers}: Список контейнеров в формате JSON.</p><p id="bh6ssn_1816">- {error, {unexpected_status, StatusCode}}: Неожиданный HTTP-код ответа.</p><p id="bh6ssn_1817">- {error, Reason}: Причина ошибки при выполнении запроса.</p><p id="bh6ssn_1818"><span class="control" id="bh6ssn_1826">Пример использования</span>:</p><p id="bh6ssn_1819">docker_client:list_containers().</p><p id="bh6ssn_1820"><span class="control" id="bh6ssn_1827">Детали реализации</span>:</p><p id="bh6ssn_1821">- Формирует URL для запроса /containers/json.</p><p id="bh6ssn_1822">- Выполняет HTTP GET-запрос.</p><p id="bh6ssn_1823">- Декодирует ответ JSON или возвращает ошибку при некорректном статусе.</p></td></tr><tr id="bh6ssn_1804"><td id="bh6ssn_1828"><p>create_container/1</p></td><td id="bh6ssn_1829"><p id="bh6ssn_1830">: Создаёт новый контейнер на основе указанного образа.</p><p id="bh6ssn_1831"><span class="control" id="bh6ssn_1844">Параметры</span>:</p><p id="bh6ssn_1832">- Image (binary): Имя образа Docker.</p><p id="bh6ssn_1833"><span class="control" id="bh6ssn_1845">Возвращает</span>:</p><p id="bh6ssn_1834">- {ok, ContainerInfo}: Информация о созданном контейнере.</p><p id="bh6ssn_1835">- {error, {unexpected_status, StatusCode}}: Неожиданный HTTP-код ответа.</p><p id="bh6ssn_1836">- {error, Reason}: Причина ошибки при выполнении запроса.</p><p id="bh6ssn_1837"><span class="control" id="bh6ssn_1846">Пример использования</span>:</p><p id="bh6ssn_1838">docker_client:create_container(&lt;&lt;&quot;nginx&quot;&gt;&gt;).</p><p id="bh6ssn_1839"><span class="control" id="bh6ssn_1847">Детали реализации</span>:</p><p id="bh6ssn_1840">- Формирует URL для запроса /containers/create.</p><p id="bh6ssn_1841">- Кодирует тело запроса в формате JSON, включая имя образа и команду.</p><p id="bh6ssn_1842">- Выполняет HTTP POST-запрос.</p><p id="bh6ssn_1843">- Декодирует ответ JSON или возвращает ошибку при некорректном статусе.</p></td></tr><tr id="bh6ssn_1805"><td id="bh6ssn_1848"><p>start_container/1</p></td><td id="bh6ssn_1849"><p id="bh6ssn_1850">: Запускает контейнер с указанным идентификатором.</p><p id="bh6ssn_1851"><span class="control" id="bh6ssn_1863">Параметры</span>:</p><p id="bh6ssn_1852">- ContainerId (binary): Идентификатор контейнера.</p><p id="bh6ssn_1853"><span class="control" id="bh6ssn_1864">Возвращает</span>:</p><p id="bh6ssn_1854">- {ok, &lt;&lt;&quot;Container started successfully&quot;&gt;&gt;}: Контейнер успешно запущен.</p><p id="bh6ssn_1855">- {error, {unexpected_status, StatusCode}}: Неожиданный HTTP-код ответа.</p><p id="bh6ssn_1856">- {error, Reason}: Причина ошибки при выполнении запроса.</p><p id="bh6ssn_1857"><span class="control" id="bh6ssn_1865">Пример использования</span>:</p><p id="bh6ssn_1858">docker_client:start_container(&lt;&lt;&quot;e90e34656806&quot;&gt;&gt;).</p><p id="bh6ssn_1859"><span class="control" id="bh6ssn_1866">Детали реализации</span>:</p><p id="bh6ssn_1860">- Формирует URL для запроса /containers//start.</p><p id="bh6ssn_1861">- Выполняет HTTP POST-запрос.</p><p id="bh6ssn_1862">- Возвращает сообщение об успешном запуске или ошибку при некорректном статусе.</p></td></tr></tbody></table></div><p id="bh6ssn_1369"><span class="control" id="bh6ssn_1867">Конфигурация</span></p><p id="bh6ssn_1370"><span class="control" id="bh6ssn_1868">Базовый URL</span>: Определён через макрос ?DOCKER_URL и по умолчанию равен http://localhost:2375.</p><p id="bh6ssn_1371"><span class="control" id="bh6ssn_1869">Примечания</span></p><ul class="list _bullet" id="bh6ssn_1372"><li class="list__item" id="bh6ssn_1870"><p id="bh6ssn_1873">Для работы функций требуется, чтобы Docker API был доступен по указанному адресу.</p></li><li class="list__item" id="bh6ssn_1871"><p id="bh6ssn_1874">Функции используют библиотеку HTTP клиента httpc и JSON-парсер jsx.</p></li><li class="list__item" id="bh6ssn_1872"><p id="bh6ssn_1875">В случае ошибок рекомендуется использовать логирование с помощью макросов ?LOGINFO, ?LOGWARNING, ?LOGERROR.</p><section class="chapter"><h3 id="8-fp-powerfactory-service" data-toc="8-fp-powerfactory-service"><a name=""></a><span class="control" id="bh6ssn_1882">А.8 Модуль fp_powerfactory_service</span></h3><p id="bh6ssn_1878">Модуль для интеграции с PowerFactory (PF).</p><p id="bh6ssn_1879"><span class="control" id="bh6ssn_1883">Общая информация</span></p><p id="bh6ssn_1880">Модуль fp_powerfactory_service предназначен для интеграции SCADA-системы Faceplate с расчетным ПО PowerFactory. Он обеспечивает обмен данными между этими системами посредством формирования, отправки и обработки JSON-запросов через промежуточный сервер server.py.</p></section></li></ul><div class="table-wrapper"><table class="wide" id="bh6ssn_1373"><thead><tr class="ijRowHead" id="bh6ssn_1884"><th id="bh6ssn_1888"><p><span class="control" id="bh6ssn_1890">Функция</span></p></th><th id="bh6ssn_1889"><p><span class="control" id="bh6ssn_1891">Описание</span></p></th></tr></thead><tbody><tr id="bh6ssn_1885"><td id="bh6ssn_1892"><p>pf_service_update(Params, [OID], Host, Port)</p></td><td id="bh6ssn_1893"><p id="bh6ssn_1894"><span class="control" id="bh6ssn_1919">Параметры:</span></p><p id="bh6ssn_1895">Params: Должен содержать структуру следующего вида:</p><p id="bh6ssn_1896">#{</p><p id="bh6ssn_1897"><code class="code" id="bh6ssn_1920"></code> &lt;&lt;&quot;study_case_name&quot;&gt;&gt; =&gt;</p><p id="bh6ssn_1898">&lt;&lt;&quot;Study Case&quot;&gt;&gt;,</p><p id="bh6ssn_1899"><code class="code" id="bh6ssn_1921"></code> &lt;&lt;&quot;session_type&quot;&gt;&gt;</p><p id="bh6ssn_1900">=&gt; &lt;&lt;&quot;calculation&quot;&gt;&gt;,</p><p id="bh6ssn_1901"><code class="code" id="bh6ssn_1922"></code> &lt;&lt;&quot;project_name&quot;&gt;&gt;</p><p id="bh6ssn_1902">=&gt; &lt;&lt;&quot;.MODEL_SCADA_V1107___DEMO(1)&quot;&gt;&gt;,</p><p id="bh6ssn_1903"><code class="code" id="bh6ssn_1923"></code> &lt;&lt;&quot;operation_scenario_name&quot;&gt;&gt;</p><p id="bh6ssn_1904">=&gt; &lt;&lt;&quot;dyn&quot;&gt;&gt;,</p><p id="bh6ssn_1905"><code class="code" id="bh6ssn_1924"></code> &lt;&lt;&quot;id&quot;&gt;&gt; =&gt; 1,</p><p id="bh6ssn_1906"><code class="code" id="bh6ssn_1925"></code> &lt;&lt;&quot;grid_name&quot;&gt;&gt;</p><p id="bh6ssn_1907">=&gt; &quot;Grid&quot;,</p><p id="bh6ssn_1908"><code class="code" id="bh6ssn_1926"></code> &lt;&lt;&quot;func_name&quot;&gt;&gt;</p><p id="bh6ssn_1909">=&gt; &quot;get&quot;</p><p id="bh6ssn_1910">},</p><p id="bh6ssn_1911">где &quot;func_name&quot; должно содержать имя функции, которая используется для формирования json, поле &quot;id&quot; должно содержать идентификатор текущего экземпляра faceplate, остальные поля должны содержать параметры проекта PowerFactory, который будет использоваться для расчетов.</p><p id="bh6ssn_1912">[OID]: Может содержать либо пустой erlang лист, либо OID передаваемого объекта.</p><p id="bh6ssn_1913">Host и Port: адрес и порт сервера, на котором должен быть запущен server.py.</p><p id="bh6ssn_1914"><span class="control" id="bh6ssn_1927">Возвращает</span>: Json-результат выполнения запроса.</p><p id="bh6ssn_1915"><span class="control" id="bh6ssn_1928">Пример использования:</span></p><p id="bh6ssn_1916">fp_powerfactory_service:pf_service_update(Params, [], &quot;127.0.0.1&quot;, 8080).</p><p id="bh6ssn_1917"><span class="control" id="bh6ssn_1929">Детали реализации</span>:</p><p id="bh6ssn_1918">Данная функция не создает новые объекты в хранилище данных Faceplate, если объекты в принятом от PowerFactory json не найдены в базе данных Faceplate.</p></td></tr><tr id="bh6ssn_1886"><td id="bh6ssn_1930"><p>pf_service_create_update(Params, [OID], Host, Port)</p></td><td id="bh6ssn_1931"><p id="bh6ssn_1932">: Создает новые объекты в хранилище данных Faceplate, если объекты в принятом от PowerFactory json не найдены в хранилище данных Faceplate.</p><p id="bh6ssn_1933"><span class="control" id="bh6ssn_1958">Параметры:</span></p><p id="bh6ssn_1934">Params: Должен содержать структуру следующего вида:</p><p id="bh6ssn_1935">#{</p><p id="bh6ssn_1936"><code class="code" id="bh6ssn_1959"></code> &lt;&lt;&quot;study_case_name&quot;&gt;&gt; =&gt;</p><p id="bh6ssn_1937">&lt;&lt;&quot;Study Case&quot;&gt;&gt;,</p><p id="bh6ssn_1938"><code class="code" id="bh6ssn_1960"></code> &lt;&lt;&quot;session_type&quot;&gt;&gt;</p><p id="bh6ssn_1939">=&gt; &lt;&lt;&quot;calculation&quot;&gt;&gt;,</p><p id="bh6ssn_1940"><code class="code" id="bh6ssn_1961"></code> &lt;&lt;&quot;project_name&quot;&gt;&gt;</p><p id="bh6ssn_1941">=&gt; &lt;&lt;&quot;.MODEL_SCADA_V1107___DEMO(1)&quot;&gt;&gt;,</p><p id="bh6ssn_1942"><code class="code" id="bh6ssn_1962"></code> &lt;&lt;&quot;operation_scenario_name&quot;&gt;&gt;</p><p id="bh6ssn_1943">=&gt; &lt;&lt;&quot;dyn&quot;&gt;&gt;,</p><p id="bh6ssn_1944"><code class="code" id="bh6ssn_1963"></code> &lt;&lt;&quot;id&quot;&gt;&gt; =&gt; 1,</p><p id="bh6ssn_1945"><code class="code" id="bh6ssn_1964"></code> &lt;&lt;&quot;grid_name&quot;&gt;&gt;</p><p id="bh6ssn_1946">=&gt; &quot;Grid&quot;,</p><p id="bh6ssn_1947"><code class="code" id="bh6ssn_1965"></code> &lt;&lt;&quot;func_name&quot;&gt;&gt;</p><p id="bh6ssn_1948">=&gt; &quot;get&quot;</p><p id="bh6ssn_1949">},</p><p id="bh6ssn_1950">где &quot;func_name&quot; должно содержать имя функции, которая используется для формирования json, поле &quot;id&quot; должно содержать идентификатор текущего экземпляра faceplate, остальные поля должны содержать параметры проекта PowerFactory, который будет использоваться для расчетов.</p><p id="bh6ssn_1951">[OID]: Может содержать либо пустой erlang лист, либо OID передаваемого объекта.</p><p id="bh6ssn_1952">Host и Port: адрес и порт сервера, на котором должен быть запущен server.py.</p><p id="bh6ssn_1953"><span class="control" id="bh6ssn_1966">Возвращает</span>: Json-результат выполнения запроса.</p><p id="bh6ssn_1954"><span class="control" id="bh6ssn_1967">Пример использования:</span></p><p id="bh6ssn_1955">fp_powerfactory_service:pf_service_create_update(Params, [], &quot;127.0.0.1&quot;, 8080).</p><p id="bh6ssn_1956"><span class="control" id="bh6ssn_1968">Детали реализации</span>:</p><p id="bh6ssn_1957">Может использоваться для создания объектов в каталогах (например, для загрузки библиотеки базовых типов из PowerFactory).</p></td></tr><tr id="bh6ssn_1887"><td id="bh6ssn_1969"><p>pf_service_get_section(ts, funct)</p></td><td id="bh6ssn_1970"><p id="bh6ssn_1971">: предназначена для формирования так называемого &quot;среза&quot; данных. Срез данных представляет собой json, сформированный по принципам, описанным в п.6.1.</p><p id="bh6ssn_1972">Отличия заключается в том, что данные для формирования json извлекаются не из полей объектов Faceplate, а из соответствующих этим полям архивов.</p><p id="bh6ssn_1973"><span class="control" id="bh6ssn_1980">Параметры:</span></p><p id="bh6ssn_1974">ts: Определяет момент времени, для которого нужно получить данные.</p><p id="bh6ssn_1975">funct: Содержит название функции, которая используется для формирования json (см. п 6.1).</p><p id="bh6ssn_1976"><span class="control" id="bh6ssn_1981">Возвращает:</span><br> Json-объект с данными за указанный момент времени.</p><p id="bh6ssn_1977"><span class="control" id="bh6ssn_1983">Пример использования:</span></p><p id="bh6ssn_1978">fp_powerfactory_service:pf_service_get_section(1669387200, &quot;get_section&quot;).</p><p id="bh6ssn_1979"><span class="control" id="bh6ssn_1984">Детали реализации:</span><br> Принципы формирования Json соответствуют описанию в п. 6.1, с той разницей, что данные извлекаются не из полей объектов Faceplate, а из архивов.</p></td></tr></tbody></table></div></section><section class="chapter"><h2 id="9-fp-powerfactory-service-old" data-toc="9-fp-powerfactory-service-old"><a name=""></a><span class="control" id="bh6ssn_2070">А.9 Модуль fp_powerfactory_service_old</span></h2><p id="bh6ssn_1987">Модуль для интеграции с PowerFactory (PF). Версия предназначена для работы с более старым функционалом PF.</p><p id="bh6ssn_1988"><span class="control" id="bh6ssn_2071">Общая информация</span></p><p id="bh6ssn_1989">Модуль fp_powerfactory_service_old предоставляет API для интеграции с PowerFactory. Его функциональность включает управление каталогами оборудования, вызов функций PowerFactory и обработку связанных данных. Код написан на языке Erlang и включает механизмы логирования и обработки ошибок.</p><div class="table-wrapper"><table class="wide" id="bh6ssn_1990"><thead><tr class="ijRowHead" id="bh6ssn_2072"><th id="bh6ssn_2082"><p><span class="control" id="bh6ssn_2084">Функция</span></p></th><th id="bh6ssn_2083"><p><span class="control" id="bh6ssn_2085">Описание</span></p></th></tr></thead><tbody><tr id="bh6ssn_2073"><td id="bh6ssn_2086"><p>on_init/0</p></td><td id="bh6ssn_2087"><p id="bh6ssn_2088">: Инициализирует модуль, добавляя JSON-API для взаимодействия с PowerFactory.</p><p id="bh6ssn_2089"><span class="control" id="bh6ssn_2093">Параметры</span>: Нет.</p><p id="bh6ssn_2090"><span class="control" id="bh6ssn_2094">Возвращает</span>: Атом ok при успешной инициализации.</p><p id="bh6ssn_2091"><span class="control" id="bh6ssn_2095">Пример использования</span>:</p><p id="bh6ssn_2092">fp_powerfactory_service_old:on_init().</p></td></tr><tr id="bh6ssn_2074"><td id="bh6ssn_2096"><p>power_factory_import_equipment_library/1</p></td><td id="bh6ssn_2097"><p id="bh6ssn_2098">: Импортирует библиотеку оборудования в PowerFactory.</p><p id="bh6ssn_2099"><span class="control" id="bh6ssn_2104">Параметры</span>:</p><p id="bh6ssn_2100">- {CatalogName, PFProjectParamsPath}: Кортеж, содержащий имя каталога и путь к параметрам проекта PowerFactory.</p><p id="bh6ssn_2101"><span class="control" id="bh6ssn_2105">Возвращает</span>: Результат выполнения функции.</p><p id="bh6ssn_2102"><span class="control" id="bh6ssn_2106">Пример использования</span>:</p><p id="bh6ssn_2103">fp_powerfactory_service_old:power_factory_import_equipment_library({&lt;&lt;&quot;CatalogName&quot;&gt;&gt;, &lt;&lt;&quot;/path/to/project/params&quot;&gt;&gt;}).</p></td></tr><tr id="bh6ssn_2075"><td id="bh6ssn_2107"><p>get_equipment_library_catalog/1</p></td><td id="bh6ssn_2108"><p id="bh6ssn_2109">: Возвращает идентификаторы содержимого и полей каталога оборудования.</p><p id="bh6ssn_2110"><span class="control" id="bh6ssn_2117">Параметры</span>:</p><p id="bh6ssn_2111">- CatalogName (binary): Имя каталога.</p><p id="bh6ssn_2112"><span class="control" id="bh6ssn_2118">Возвращает</span>:</p><p id="bh6ssn_2113">- {ContentOID, FieldsOID}: Кортеж с идентификаторами содержимого и полей каталога.</p><p id="bh6ssn_2114">- Выбрасывает исключение, если каталог не найден.</p><p id="bh6ssn_2115"><span class="control" id="bh6ssn_2119">Пример использования</span>:</p><p id="bh6ssn_2116">fp_powerfactory_service_old:get_equipment_library_catalog(&lt;&lt;&quot;CatalogName&quot;&gt;&gt;).</p></td></tr><tr id="bh6ssn_2076"><td id="bh6ssn_2120"><p>power_factory_call_function/1</p></td><td id="bh6ssn_2121"><p id="bh6ssn_2122">: Выполняет вызов функции PowerFactory.</p><p id="bh6ssn_2123"><span class="control" id="bh6ssn_2128">Параметры</span>:</p><p id="bh6ssn_2124">- {Context, PFProjectParamsPath, FunctionName}: Кортеж, содержащий контекст, путь к параметрам проекта и имя функции.</p><p id="bh6ssn_2125"><span class="control" id="bh6ssn_2129">Возвращает</span>: Результат вызова функции в формате HTTP-ответа.</p><p id="bh6ssn_2126"><span class="control" id="bh6ssn_2130">Пример использования</span>:</p><p id="bh6ssn_2127">fp_powerfactory_service_old:power_factory_call_function({Context, &lt;&lt;&quot;/path/to/params&quot;&gt;&gt;, &lt;&lt;&quot;function_name&quot;&gt;&gt;}).</p></td></tr><tr id="bh6ssn_2077"><td id="bh6ssn_2131"><p>power_factory_call_function_old/1</p></td><td id="bh6ssn_2132"><p id="bh6ssn_2133">: Устаревший метод вызова функции PowerFactory с дополнительным логированием.</p><p id="bh6ssn_2134"><span class="control" id="bh6ssn_2139">Параметры</span>:</p><p id="bh6ssn_2135">- {Context, PFProjectParamsPath, FunctionName}: Кортеж, содержащий контекст, путь к параметрам проекта и имя функции.</p><p id="bh6ssn_2136"><span class="control" id="bh6ssn_2140">Возвращает</span>: Результат вызова функции в формате HTTP-ответа.</p><p id="bh6ssn_2137"><span class="control" id="bh6ssn_2141">Пример использования</span>:</p><p id="bh6ssn_2138">fp_powerfactory_service_old:power_factory_call_function_old({Context, &lt;&lt;&quot;/path/to/params&quot;&gt;&gt;, &lt;&lt;&quot;function_name&quot;&gt;&gt;}).</p></td></tr><tr id="bh6ssn_2078"><td id="bh6ssn_2142"><p>get_pf_project_params/1</p></td><td id="bh6ssn_2143"><p id="bh6ssn_2144">: Возвращает параметры проекта PowerFactory.</p><p id="bh6ssn_2145"><span class="control" id="bh6ssn_2150">Параметры</span>:</p><p id="bh6ssn_2146">- PFProjectParamsPath (binary): Путь к параметрам проекта.</p><p id="bh6ssn_2147"><span class="control" id="bh6ssn_2151">Возвращает</span>: Словарь с параметрами проекта.</p><p id="bh6ssn_2148"><span class="control" id="bh6ssn_2152">Пример использования</span>:</p><p id="bh6ssn_2149">fp_powerfactory_service_old:get_pf_project_params(&lt;&lt;&quot;/path/to/project/params&quot;&gt;&gt;).</p></td></tr><tr id="bh6ssn_2079"><td id="bh6ssn_2153"><p>load_config/0</p></td><td id="bh6ssn_2154"><p id="bh6ssn_2155">: Загружает конфигурацию модуля из файла.</p><p id="bh6ssn_2156"><span class="control" id="bh6ssn_2161">Параметры</span>: Нет.</p><p id="bh6ssn_2157"><span class="control" id="bh6ssn_2162">Возвращает</span>: Словарь с конфигурацией.</p><p id="bh6ssn_2158"><span class="control" id="bh6ssn_2163">Пример использования</span>:</p><p id="bh6ssn_2159">Config = fp_powerfactory_service_old:load_config().</p><p id="bh6ssn_2160"></p></td></tr><tr id="bh6ssn_2080"><td id="bh6ssn_2164"><p>get_json/4</p></td><td id="bh6ssn_2165"><p id="bh6ssn_2166">: Формирует JSON-объект для передачи в PowerFactory.</p><p id="bh6ssn_2167"><span class="control" id="bh6ssn_2175">Параметры</span>:</p><p id="bh6ssn_2168">- Config (map): Конфигурация.</p><p id="bh6ssn_2169">- OIDsByElement (map): Сопоставление элементов и их идентификаторов.</p><p id="bh6ssn_2170">- PFFunc (binary): Имя функции PowerFactory.</p><p id="bh6ssn_2171">- PFProjectParams (map): Параметры проекта.</p><p id="bh6ssn_2172"><span class="control" id="bh6ssn_2176">Возвращает</span>: JSON-объект.</p><p id="bh6ssn_2173"><span class="control" id="bh6ssn_2177">Пример использования</span>:</p><p id="bh6ssn_2174">JSON = fp_powerfactory_service_old:get_json(Config, OIDsByElement, &lt;&lt;&quot;function_name&quot;&gt;&gt;, PFProjectParams).</p></td></tr><tr id="bh6ssn_2081"><td id="bh6ssn_2178"><p>http_send/4</p></td><td id="bh6ssn_2179"><p id="bh6ssn_2180">: Отправляет HTTP-запрос на сервер PowerFactory.</p><p id="bh6ssn_2181"><span class="control" id="bh6ssn_2189">Параметры</span>:</p><p id="bh6ssn_2182">- RemoteServiceParams (map): Параметры удалённого сервиса.</p><p id="bh6ssn_2183">- Path (binary): Путь запроса.</p><p id="bh6ssn_2184">- Data (binary): Тело запроса в формате JSON.</p><p id="bh6ssn_2185">- ResponseFun (fun): Функция для обработки ответа.</p><p id="bh6ssn_2186"><span class="control" id="bh6ssn_2190">Возвращает</span>: Результат выполнения запроса.</p><p id="bh6ssn_2187"><span class="control" id="bh6ssn_2191">Пример использования</span>:</p><p id="bh6ssn_2188">fp_powerfactory_service_old:http_send(RemoteServiceParams, &lt;&lt;&quot;api/path&quot;&gt;&gt;, Data, fun(Response) -&gt; io:format(&quot;~p&quot;, [Response]) end).</p></td></tr></tbody></table></div><p id="bh6ssn_1991"><span class="control" id="bh6ssn_2192">Примечания</span></p><ul class="list _bullet" id="bh6ssn_1992"><li class="list__item" id="bh6ssn_2193"><p id="bh6ssn_2196">Для корректной работы модуля необходимо наличие конфигурационного файла fp2pf_mapping.json.</p></li><li class="list__item" id="bh6ssn_2194"><p id="bh6ssn_2197">Все функции обеспечивают обработку ошибок и логирование через макросы ?LOGINFO, ?LOGWARNING и ?LOGERROR.</p></li><li class="list__item" id="bh6ssn_2195"><p id="bh6ssn_2198">Методы HTTP-запросов используют библиотеку httpc для взаимодействия с удалёнными сервисами.</p><section class="chapter"><h3 id="10-fp-state-estimation-service" data-toc="10-fp-state-estimation-service"><a name=""></a><span class="control" id="bh6ssn_2206">А.10 Модуль fp_state_estimation_service</span></h3><p id="bh6ssn_2201">Сервис для оценки состояния (State Estimation, SE). Используется для вычисления текущего состояния системы, позволяя определять узкие места и потенциальные сбои в сети.</p><p id="bh6ssn_2202"><span class="control" id="bh6ssn_2207">Общая информация</span></p><p id="bh6ssn_2203">Модуль fp_state_estimation_service предназначен для управления процессом оценивания состояния (state estimation) в системе. Он реализует экспорт и импорт данных в формате JSON, настройку и запуск вспомогательных утилит, а также предоставляет функции взаимодействия с хранилищами данных.</p><p id="bh6ssn_2204">Этот модуль используется для интеграции системы управления с процессами анализа данных, включая передачу и обработку информации о параметрах узлов и линий, а также получение статистики работы системы.</p></section></li></ul><div class="table-wrapper"><table class="wide" id="bh6ssn_1993"><thead><tr class="ijRowHead" id="bh6ssn_2208"><th id="bh6ssn_2218"><p><span class="control" id="bh6ssn_2220">Функция</span></p></th><th id="bh6ssn_2219"><p><span class="control" id="bh6ssn_2221">Описание</span></p></th></tr></thead><tbody><tr id="bh6ssn_2209"><td id="bh6ssn_2222"><p><span class="control" id="bh6ssn_2224">on_init/0</span></p></td><td id="bh6ssn_2223"><p id="bh6ssn_2225">: Инициализирует API для вызова функций модуля через JSON-запросы. Функция должна быть вызвана при запуске системы.</p><p id="bh6ssn_2226"><span class="control" id="bh6ssn_2231">Параметры</span>: Нет.</p><p id="bh6ssn_2227"><span class="control" id="bh6ssn_2232">Возвращает</span>:</p><p id="bh6ssn_2228">- ok &mdash; если инициализация завершилась успешно.</p><p id="bh6ssn_2229"><span class="control" id="bh6ssn_2233">Пример использования</span>:</p><p id="bh6ssn_2230">fp_state_estimation_service:on_init().</p></td></tr><tr id="bh6ssn_2210"><td id="bh6ssn_2234"><p><span class="control" id="bh6ssn_2236">export_json/1</span></p></td><td id="bh6ssn_2235"><p id="bh6ssn_2237">: Экспортирует данные системы в формате JSON, создавая файл для последующего анализа или передачи в другие модули.</p><p id="bh6ssn_2238"><span class="control" id="bh6ssn_2254">Параметры</span>:</p><p id="bh6ssn_2239">- {StartParams, AParams, CommonSettingsPath, SSEStatPath}:</p><p id="bh6ssn_2240">- StartParams &mdash; карта начальных параметров (например, временные диапазоны).</p><p id="bh6ssn_2241">- AParams &mdash; дополнительные параметры (например, настройки фильтров).</p><p id="bh6ssn_2242">- CommonSettingsPath &mdash; путь к объекту общих настроек.</p><p id="bh6ssn_2243">- SSEStatPath &mdash; путь к объекту статистики.</p><p id="bh6ssn_2244"><span class="control" id="bh6ssn_2255">Возвращает</span>:</p><p id="bh6ssn_2245">- ok &mdash; если экспорт выполнен успешно.</p><p id="bh6ssn_2246">- Логирует ошибку в случае сбоя при записи файла или при некорректных параметрах.</p><p id="bh6ssn_2247"><span class="control" id="bh6ssn_2256">Пример использования</span>:</p><p id="bh6ssn_2248">StartParams = #{&lt;&lt;&quot;start_time&quot;&gt;&gt; =&gt; &lt;&lt;&quot;2024-01-01T00:00:00&quot;&gt;&gt;, &lt;&lt;&quot;end_time&quot;&gt;&gt; =&gt; &lt;&lt;&quot;2024-01-01T12:00:00&quot;&gt;&gt;},</p><p id="bh6ssn_2249">AParams = #{&lt;&lt;&quot;region&quot;&gt;&gt; =&gt; &lt;&lt;&quot;North&quot;&gt;&gt;},</p><p id="bh6ssn_2250">CommonSettingsPath = &lt;&lt;&quot;/root/FP/PROJECT/settings/common&quot;&gt;&gt;,</p><p id="bh6ssn_2251">SSEStatPath = &lt;&lt;&quot;/root/FP/PROJECT/statistics/se_stats&quot;&gt;&gt;,</p><p id="bh6ssn_2252"></p><p id="bh6ssn_2253">fp_state_estimation_service:export_json({StartParams, AParams, CommonSettingsPath, SSEStatPath}).</p></td></tr><tr id="bh6ssn_2211"><td id="bh6ssn_2257"><p><span class="control" id="bh6ssn_2259">import_json/1</span></p></td><td id="bh6ssn_2258"><p id="bh6ssn_2260">: Импортирует данные из JSON-файла в храниище данных системы. Используется для обновления информации о параметрах узлов, линий и статистики.</p><p id="bh6ssn_2261"><span class="control" id="bh6ssn_2269">Параметры</span>:</p><p id="bh6ssn_2262">- SSEStatPath &mdash; путь к объекту статистики.</p><p id="bh6ssn_2263"><span class="control" id="bh6ssn_2270">Возвращает</span>:</p><p id="bh6ssn_2264">- ok &mdash; если импорт завершен успешно.</p><p id="bh6ssn_2265">- Логирует ошибки при сбоях.</p><p id="bh6ssn_2266"><span class="control" id="bh6ssn_2271">Пример использования</span>:</p><p id="bh6ssn_2267">SSEStatPath = &lt;&lt;&quot;/root/FP/PROJECT/statistics/se_stats&quot;&gt;&gt;,</p><p id="bh6ssn_2268">fp_state_estimation_service:import_json(SSEStatPath).</p></td></tr><tr id="bh6ssn_2212"><td id="bh6ssn_2272"><p><span class="control" id="bh6ssn_2274">import_json_for_demo/1</span></p></td><td id="bh6ssn_2273"><p id="bh6ssn_2275">: Импортирует данные для демонстрации. Отличается от обычного импорта выбором файла в зависимости от текущего состояния системы.</p><p id="bh6ssn_2276"><span class="control" id="bh6ssn_2283">Параметры</span>:</p><p id="bh6ssn_2277">- SourceFiles &mdash; список путей к JSON-файлам.</p><p id="bh6ssn_2278"><span class="control" id="bh6ssn_2284">Возвращает</span>:</p><p id="bh6ssn_2279">- ok &mdash; если данные успешно импортированы.</p><p id="bh6ssn_2280"><span class="control" id="bh6ssn_2285">Пример использования</span>:</p><p id="bh6ssn_2281">SourceFiles = [&lt;&lt;&quot;/path/to/demo1.json&quot;&gt;&gt;, &lt;&lt;&quot;/path/to/demo2.json&quot;&gt;&gt;],</p><p id="bh6ssn_2282">fp_state_estimation_service:import_json_for_demo(SourceFiles).</p></td></tr><tr id="bh6ssn_2213"><td id="bh6ssn_2286"><p><span class="control" id="bh6ssn_2288">run_se_util/1</span></p></td><td id="bh6ssn_2287"><p id="bh6ssn_2289">: Запускает утилиту для выполнения процессов state estimation.</p><p id="bh6ssn_2290"><span class="control" id="bh6ssn_2297">Параметры</span>:</p><p id="bh6ssn_2291">- _Arg &mdash; аргумент, зарезервированный для будущих реализаций (на текущий момент игнорируется).</p><p id="bh6ssn_2292"><span class="control" id="bh6ssn_2298">Возвращает</span>:</p><p id="bh6ssn_2293">- ok &mdash; если утилита выполнена успешно.</p><p id="bh6ssn_2294">- Логирует предупреждение, если путь к утилите не указан.</p><p id="bh6ssn_2295"><span class="control" id="bh6ssn_2299">Пример использования</span>:</p><p id="bh6ssn_2296">fp_state_estimation_service:run_se_util({}).</p></td></tr><tr id="bh6ssn_2214"><td id="bh6ssn_2300"><p><span class="control" id="bh6ssn_2302">run_se/1</span></p></td><td id="bh6ssn_2301"><p id="bh6ssn_2303">: Оркестрирует полный процесс запуска state estimation. Включает экспорт данных, запуск утилиты и последующий импорт результатов.</p><p id="bh6ssn_2304"><span class="control" id="bh6ssn_2322">Параметры</span>:</p><p id="bh6ssn_2305">- {Path, StartParams, AParams, CommonSettingsPath, SSEStatPath}:</p><p id="bh6ssn_2306">- Path &mdash; путь к рабочему каталогу.</p><p id="bh6ssn_2307">- StartParams &mdash; начальные параметры.</p><p id="bh6ssn_2308">- AParams &mdash; дополнительные параметры.</p><p id="bh6ssn_2309">- CommonSettingsPath &mdash; путь к объекту настроек.</p><p id="bh6ssn_2310">- SSEStatPath &mdash; путь к статистике.</p><p id="bh6ssn_2311"><span class="control" id="bh6ssn_2323">Возвращает</span>:</p><p id="bh6ssn_2312">- ok &mdash; если весь процесс завершен успешно.</p><p id="bh6ssn_2313">- Логирует ошибки при сбоях.</p><p id="bh6ssn_2314"><span class="control" id="bh6ssn_2324">Пример использования</span>:</p><p id="bh6ssn_2315">Path = &lt;&lt;&quot;/home/master/forSE&quot;&gt;&gt;,</p><p id="bh6ssn_2316">StartParams = #{&lt;&lt;&quot;start_time&quot;&gt;&gt; =&gt; &lt;&lt;&quot;2024-01-01T00:00:00&quot;&gt;&gt;},</p><p id="bh6ssn_2317">AParams = #{&lt;&lt;&quot;region&quot;&gt;&gt; =&gt; &lt;&lt;&quot;East&quot;&gt;&gt;},</p><p id="bh6ssn_2318">CommonSettingsPath = &lt;&lt;&quot;/root/FP/PROJECT/settings/common&quot;&gt;&gt;,</p><p id="bh6ssn_2319">SSEStatPath = &lt;&lt;&quot;/root/FP/PROJECT/statistics/se_stats&quot;&gt;&gt;,</p><p id="bh6ssn_2320"></p><p id="bh6ssn_2321">fp_state_estimation_service:run_se({Path, StartParams, AParams, CommonSettingsPath, SSEStatPath}).</p></td></tr><tr id="bh6ssn_2215"><td id="bh6ssn_2325"><p><span class="control" id="bh6ssn_2327">load_config/0</span></p></td><td id="bh6ssn_2326"><p id="bh6ssn_2328">: Загружает конфигурацию из JSON-файла state_estimation_settings.jsonc.</p><p id="bh6ssn_2329"><span class="control" id="bh6ssn_2331">Пример использования</span>:</p><p id="bh6ssn_2330">Config = fp_state_estimation_service:load_config().</p></td></tr><tr id="bh6ssn_2216"><td id="bh6ssn_2332"><p><span class="control" id="bh6ssn_2334">get_absolute_path/1</span></p></td><td id="bh6ssn_2333"><p id="bh6ssn_2335">: Возвращает абсолютный путь к указанному файлу.</p><p id="bh6ssn_2336"><span class="control" id="bh6ssn_2338">Пример использования</span>:</p><p id="bh6ssn_2337">AbsPath = fp_state_estimation_service:get_absolute_path(&lt;&lt;&quot;settings.jsonc&quot;&gt;&gt;).</p></td></tr><tr id="bh6ssn_2217"><td id="bh6ssn_2339"><p><span class="control" id="bh6ssn_2341">load_mapping/1</span></p></td><td id="bh6ssn_2340"><p id="bh6ssn_2342">: Загружает настройки маппинга из файла.</p><p id="bh6ssn_2343"><span class="control" id="bh6ssn_2346">Пример использования</span>:</p><p id="bh6ssn_2344">Mapping = fp_state_estimation_service:load_mapping(&lt;&lt;&quot;mapping.jsonc&quot;&gt;&gt;).</p><p id="bh6ssn_2345"></p></td></tr></tbody></table></div><p id="bh6ssn_1994"><span class="control" id="bh6ssn_2347">Примечания</span></p><ul class="list _bullet" id="bh6ssn_1995"><li class="list__item" id="bh6ssn_2348"><p id="bh6ssn_2352">Модуль интегрируется с внутренним хранилищем данных через протоколы, реализованные в платформе Faceplate.</p></li><li class="list__item" id="bh6ssn_2349"><p id="bh6ssn_2353">Все операции, связанные с чтением и записью, происходят транзакционно. В случае ошибки или сбоя транзакция откатывается.</p></li><li class="list__item" id="bh6ssn_2350"><p id="bh6ssn_2354">Для экспорта и импорта данных используются маппинг-файлы, описывающие соответствие структур данных системы и JSON.</p></li><li class="list__item" id="bh6ssn_2351"><p id="bh6ssn_2355">Перед использованием функций run_se или run_se_util необходимо убедиться, что конфигурационные файлы и утилиты доступны.</p><section class="chapter"><h3 id="11-string-replace" data-toc="11-string-replace"><a name=""></a><span class="control" id="bh6ssn_2362">А.11 Модуль string_replace</span></h3><p id="bh6ssn_2358">Модуль для работы с текстовыми данными. Включает функции поиска и замены текста, что полезно для обработки текстовой информации в системе.</p><p id="bh6ssn_2359"><span class="control" id="bh6ssn_2363">Общая информация</span></p><p id="bh6ssn_2360">Модуль string_replace предназначен для выполнения замены подстрок в строках объектов хранилища данных. Замена производится рекурсивно по заданным шаблонам и паттернам. Основная цель модуля &mdash; автоматизация обновления строк с использованием хранилища данных fp_db.</p></section></li></ul><div class="table-wrapper"><table class="wide" id="bh6ssn_1996"><thead><tr class="ijRowHead" id="bh6ssn_2364"><th id="bh6ssn_2368"><p><span class="control" id="bh6ssn_2370">Функция</span></p></th><th id="bh6ssn_2369"><p><span class="control" id="bh6ssn_2371">Описание</span></p></th></tr></thead><tbody><tr id="bh6ssn_2365"><td id="bh6ssn_2372"><p><span class="control" id="bh6ssn_2374">replace_in_strings/2</span></p></td><td id="bh6ssn_2373"><p id="bh6ssn_2375">: Производит замену всех вхождений строки ?SEARCH_STR на ?REPLACE_STR для объектов, соответствующих заданным корню и паттерну.</p><p id="bh6ssn_2376"><span class="control" id="bh6ssn_2391">Параметры</span>:</p><p id="bh6ssn_2377">- Root (binary) &mdash; корневая папка, в пределах которой ищутся объекты для обработки.</p><p id="bh6ssn_2378">- Pattern (binary) &mdash; паттерн объектов, указывающий на их прототип.</p><p id="bh6ssn_2379"><span class="control" id="bh6ssn_2392">Возвращает</span>:</p><p id="bh6ssn_2380">- NewContent (list) &mdash; список объектов с обновленными строками.</p><p id="bh6ssn_2381"><span class="control" id="bh6ssn_2393">Детали реализации</span>:</p><p id="bh6ssn_2382">- Из хранилища данных fp_db выбираются объекты, соответствующие указанным Root и Pattern.</p><p id="bh6ssn_2383">- Для каждого объекта производится проверка наличия строки ?SEARCH_STR в поле screen.</p><p id="bh6ssn_2384">- Если строка найдена, она заменяется на ?REPLACE_STR. Изменение сохраняется в хранилище данных.</p><p id="bh6ssn_2385">- Если строка не содержит ?SEARCH_STR, объект остается неизменным.</p><p id="bh6ssn_2386"><span class="control" id="bh6ssn_2394">Пример использования</span>:</p><p id="bh6ssn_2387">% Выполнение замены строк в объектах с прототипом &quot;/root/FP/prototypes/substation/fields&quot; в папке &quot;KAZ/UZHNIY&quot;.</p><p id="bh6ssn_2388">Root = &lt;&lt;&quot;KAZ/UZHNIY&quot;&gt;&gt;,</p><p id="bh6ssn_2389">Pattern = &lt;&lt;&quot;/root/FP/prototypes/substation/fields&quot;&gt;&gt;,</p><p id="bh6ssn_2390">string_replace:replace_in_strings(Root, Pattern).</p></td></tr><tr id="bh6ssn_2366"><td id="bh6ssn_2395"><p><span class="control" id="bh6ssn_2397">replace/2</span></p></td><td id="bh6ssn_2396"><p id="bh6ssn_2398">: Выполняет замену строки ?SEARCH_STR на ?REPLACE_STR в заданном объекте.</p><p id="bh6ssn_2399"><span class="control" id="bh6ssn_2415">Параметры</span>:</p><p id="bh6ssn_2400">- OID &mdash; идентификатор объекта.</p><p id="bh6ssn_2401">- String &mdash; строка, в которой выполняется поиск и замена.</p><p id="bh6ssn_2402"><span class="control" id="bh6ssn_2416">Возвращает</span>:</p><p id="bh6ssn_2403">- Если замена произведена, функция возвращает новую строку с замененными подстроками.</p><p id="bh6ssn_2404">- Если строка не содержит ?SEARCH_STR, возвращается исходная строка.</p><p id="bh6ssn_2405"><span class="control" id="bh6ssn_2417">Детали реализации</span>:</p><p id="bh6ssn_2406">- Проверяется, содержит ли строка ?SEARCH_STR с помощью binary:matches.</p><p id="bh6ssn_2407">- Если вхождение найдено:</p><p id="bh6ssn_2408">1) Производится замена всех вхождений на ?REPLACE_STR с помощью binary:replace\.</p><p id="bh6ssn_2409">2) Обновленная строка записывается обратно в объект через fp_db:edit_object\.</p><p id="bh6ssn_2410">- Если вхождений нет, строка остается без изменений.</p><p id="bh6ssn_2411"><span class="control" id="bh6ssn_2418">Пример использования</span>:</p><p id="bh6ssn_2412">OID = fp_db:to_oid(&lt;&lt;&quot;example_oid&quot;&gt;&gt;),</p><p id="bh6ssn_2413">String = &lt;&lt;&quot;This is a lib.update_line example&quot;&gt;&gt;,</p><p id="bh6ssn_2414">string_replace:replace(OID, String).</p></td></tr><tr id="bh6ssn_2367"><td id="bh6ssn_2419"><p><span class="control" id="bh6ssn_2421">replace_in_string/1</span></p></td><td id="bh6ssn_2420"><p id="bh6ssn_2422">: Обрабатывает строки, проверяя их на наличие подстроки ?SEARCH_STR. В случае наличия выполняет замену, используя функцию replace/2.</p><p id="bh6ssn_2423"><span class="control" id="bh6ssn_2429">Параметры</span>:</p><p id="bh6ssn_2424">- [OID, String] &mdash; список, содержащий идентификатор объекта и строку для обработки.</p><p id="bh6ssn_2425"><span class="control" id="bh6ssn_2430">Возвращает</span>:</p><p id="bh6ssn_2426">- Обновленный список [OID, NewString], где NewString &mdash; результат замены.</p><p id="bh6ssn_2427"><span class="control" id="bh6ssn_2431">Пример использования</span>:</p><p id="bh6ssn_2428">replace_in_string([OID, &lt;&lt;&quot;lib.update_line example&quot;&gt;&gt;]).</p></td></tr></tbody></table></div><p id="bh6ssn_1997"><span class="control" id="bh6ssn_2432">Пример использования модуля:</span></p><p id="bh6ssn_1998">% Устанавливаем константы для поиска и замены</p><p id="bh6ssn_1999">-define(SEARCH_STR, &quot;lib.update_line&quot;).</p><p id="bh6ssn_2000">-define(REPLACE_STR, &quot;lib.updateNode&quot;).</p><p id="bh6ssn_2001">% Задаем корень и паттерн</p><p id="bh6ssn_2002">Root = &lt;&lt;&quot;KAZ/UZHNIY&quot;&gt;&gt;,</p><p id="bh6ssn_2003">Pattern = &lt;&lt;&quot;/root/FP/prototypes/substation/fields&quot;&gt;&gt;,</p><p id="bh6ssn_2004">% Запускаем процесс замены</p><p id="bh6ssn_2005">string_replace:replace_in_strings(Root, Pattern).</p><p id="bh6ssn_2006"><span class="control" id="bh6ssn_2433">Вывод:</span></p><ul class="list _bullet" id="bh6ssn_2007"><li class="list__item" id="bh6ssn_2434"><p id="bh6ssn_2442">Если совпадение найдено:</p><p id="bh6ssn_2443">Замена произведена: /path/to/object</p></li><li class="list__item" id="bh6ssn_2435"><p id="bh6ssn_2444">Если совпадений не найдено:</p><p id="bh6ssn_2445">Совпадение не найдено в строке объекта /path/to/object</p><p id="bh6ssn_2446"><span class="control" id="bh6ssn_2447">Примечания</span></p></li><li class="list__item" id="bh6ssn_2436"><p id="bh6ssn_2448">Константы:</p><ol class="list _decimal" id="bh6ssn_2449" type="1"><li class="list__item" id="bh6ssn_2450"><p id="bh6ssn_2452">?SEARCH_STR &mdash; строка, которую необходимо заменить\.</p></li><li class="list__item" id="bh6ssn_2451"><p id="bh6ssn_2453">?REPLACE_STR &mdash; строка, на которую выполняется замена\.</p></li></ol></li><li class="list__item" id="bh6ssn_2437"><p id="bh6ssn_2454">Поддерживается обработка строк, заданных в бинарном формате.</p></li><li class="list__item" id="bh6ssn_2438"><p id="bh6ssn_2455">Логирование результатов замены осуществляется через io:format.</p><section class="chapter"><h3 id="12-model-service-v2" data-toc="12-model-service-v2"><a name=""></a><span class="control" id="bh6ssn_2462">А.12 Модуль model_service_v2</span></h3><p id="bh6ssn_2458">Новая версия сервиса для работы с моделями. Поддерживает управление несколькими архивами, а также интеграцию данных о погоде, предоставляя более широкие аналитические возможности.</p><p id="bh6ssn_2459"><span class="control" id="bh6ssn_2463">Общая информация</span></p><p id="bh6ssn_2460">Модуль model_service_v2 предназначен для выполнения заданий, связанных с обработкой данных моделей. Он предоставляет функционал для:</p></section></li><li class="list__item" id="bh6ssn_2439"><p id="bh6ssn_2464">Чтения данных из хранилища.</p></li><li class="list__item" id="bh6ssn_2440"><p id="bh6ssn_2465">Обработки данных с использованием внешних сервисов.</p></li><li class="list__item" id="bh6ssn_2441"><p id="bh6ssn_2466">Записи обработанных данных обратно в хранилище.</p><p id="bh6ssn_2467">Основной поток выполнения состоит из:</p></li></ul><ol class="list _decimal" id="bh6ssn_2008" type="1"><li class="list__item" id="bh6ssn_2468"><p>Подготовки данных для задачи.</p></li><li class="list__item" id="bh6ssn_2469"><p>Отправки данных на удалённый сервис.</p></li><li class="list__item" id="bh6ssn_2470"><p>Обработки ответа от сервиса.</p></li><li class="list__item" id="bh6ssn_2471"><p>Записи результата в хранилище данных.</p></li></ol><div class="table-wrapper"><table class="wide" id="bh6ssn_2009"><thead><tr class="ijRowHead" id="bh6ssn_2472"><th id="bh6ssn_2478"><p><span class="control" id="bh6ssn_2480">Функция</span></p></th><th id="bh6ssn_2479"><p><span class="control" id="bh6ssn_2481">Описание</span></p></th></tr></thead><tbody><tr id="bh6ssn_2473"><td id="bh6ssn_2482"><p><span class="control" id="bh6ssn_2484">run_task/1</span></p></td><td id="bh6ssn_2483"><p id="bh6ssn_2485">: Основная функция, запускающая выполнение задачи для указанного объекта. Производит полный цикл обработки: чтение, вызов внешнего сервиса и запись результата.</p><p id="bh6ssn_2486"><span class="control" id="bh6ssn_2501">Параметры</span>:</p><p id="bh6ssn_2487">- Obj (OID объекта) &mdash; объект, для которого выполняется задача.</p><p id="bh6ssn_2488"><span class="control" id="bh6ssn_2502">Возвращает</span>:</p><p id="bh6ssn_2489">- ok &mdash; при успешном выполнении.</p><p id="bh6ssn_2490">- {error, Reason} &mdash; при возникновении ошибки.</p><p id="bh6ssn_2491"><span class="control" id="bh6ssn_2503">Детали реализации</span>:</p><p id="bh6ssn_2492">- Считываются поля объекта, необходимые для выполнения задачи.</p><p id="bh6ssn_2493">- Формируется набор временных меток для чтения данных из архива.</p><p id="bh6ssn_2494">- Собирается JSON-запрос для внешнего сервиса.</p><p id="bh6ssn_2495">- Выполняется HTTP-запрос на внешний сервис с заданными данными.</p><p id="bh6ssn_2496">- Обрабатывается ответ от сервиса и записывается результат в хранилище данных.</p><p id="bh6ssn_2497"><span class="control" id="bh6ssn_2504">Пример использования</span>:</p><p id="bh6ssn_2498">Obj = fp_db:to_oid(&lt;&lt;&quot;object_path&quot;&gt;&gt;),</p><p id="bh6ssn_2499">model_service_v2:run_task(Obj).</p><p id="bh6ssn_2500"></p></td></tr><tr id="bh6ssn_2474"><td id="bh6ssn_2505"><p><span class="control" id="bh6ssn_2507">call/2</span></p></td><td id="bh6ssn_2506"><p id="bh6ssn_2508">: Функция для выполнения HTTP-запроса на внешний сервис.</p><p id="bh6ssn_2509"><span class="control" id="bh6ssn_2519">Параметры</span>:</p><p id="bh6ssn_2510">- Url (binary) &mdash; URL сервиса.</p><p id="bh6ssn_2511">- DataMap (map) &mdash; данные, отправляемые в теле запроса.</p><p id="bh6ssn_2512"><span class="control" id="bh6ssn_2520">Возвращает</span>:</p><p id="bh6ssn_2513">- {ok, Response} &mdash; успешный ответ от сервиса.</p><p id="bh6ssn_2514">- {error, Reason} &mdash; ошибка при выполнении запроса.</p><p id="bh6ssn_2515"><span class="control" id="bh6ssn_2521">Пример использования</span>:</p><p id="bh6ssn_2516">Url = &lt;&lt;&quot;http://127.0.0.1:8000/predict&quot;&gt;&gt;,</p><p id="bh6ssn_2517">Data = #{&lt;&lt;&quot;task_id&quot;&gt;&gt; =&gt; &lt;&lt;&quot;123&quot;&gt;&gt;, &lt;&lt;&quot;task_input&quot;&gt;&gt; =&gt; Dataset},</p><p id="bh6ssn_2518">model_service_v2:call(Url, Data).</p></td></tr><tr id="bh6ssn_2475"><td id="bh6ssn_2522"><p><span class="control" id="bh6ssn_2524">read_from_db/3</span></p></td><td id="bh6ssn_2523"><p id="bh6ssn_2525">: Считывает данные из архива за указанный временной диапазон.</p><p id="bh6ssn_2526"><span class="control" id="bh6ssn_2538">Параметры</span>:</p><p id="bh6ssn_2527">- InputWindow (integer) &mdash; количество временных меток для чтения.</p><p id="bh6ssn_2528">- Step (integer) &mdash; шаг между временными метками (в миллисекундах).</p><p id="bh6ssn_2529">- Archive (OID) &mdash; архив, из которого считываются данные.</p><p id="bh6ssn_2530"><span class="control" id="bh6ssn_2539">Возвращает</span>:</p><p id="bh6ssn_2531">- Data (list) &mdash; список считанных данных.</p><p id="bh6ssn_2532">- {error, Reason} &mdash; в случае ошибки.</p><p id="bh6ssn_2533"><span class="control" id="bh6ssn_2540">Пример использования</span>:</p><p id="bh6ssn_2534">InputWindow = 24,</p><p id="bh6ssn_2535">Step = 3600000, % 1 час</p><p id="bh6ssn_2536">Archive = fp_db:to_oid(&lt;&lt;&quot;archive_path&quot;&gt;&gt;),</p><p id="bh6ssn_2537">model_service_v2:read_from_db(InputWindow, Step, Archive).</p></td></tr><tr id="bh6ssn_2476"><td id="bh6ssn_2541"><p><span class="control" id="bh6ssn_2543">write_to_db/2</span></p></td><td id="bh6ssn_2542"><p id="bh6ssn_2544">: Записывает данные в архив.</p><p id="bh6ssn_2545"><span class="control" id="bh6ssn_2555">Параметры</span>:</p><p id="bh6ssn_2546">- Data (list) &mdash; данные для записи.</p><p id="bh6ssn_2547">- Archive (OID) &mdash; архив для записи данных.</p><p id="bh6ssn_2548"><span class="control" id="bh6ssn_2556">Возвращает</span>:</p><p id="bh6ssn_2549">- {ok, From, To} &mdash; диапазон временных меток записанных данных.</p><p id="bh6ssn_2550">- {error, Reason} &mdash; ошибка при записи данных.</p><p id="bh6ssn_2551"><span class="control" id="bh6ssn_2557">Пример использования</span>:</p><p id="bh6ssn_2552">Data = [{1669905600000, 1.23}, {1669909200000, 1.45}],</p><p id="bh6ssn_2553">Archive = fp_db:to_oid(&lt;&lt;&quot;archive_path&quot;&gt;&gt;),</p><p id="bh6ssn_2554">model_service_v2:write_to_db(Data, Archive).</p></td></tr><tr id="bh6ssn_2477"><td id="bh6ssn_2558"><p><span class="control" id="bh6ssn_2560">transform/1</span></p></td><td id="bh6ssn_2559"><p id="bh6ssn_2561">: Трансформирует данные в формат, подходящий для записи.</p><p id="bh6ssn_2562"><span class="control" id="bh6ssn_2570">Параметры</span>:</p><p id="bh6ssn_2563">- Data (list) &mdash; входные данные.</p><p id="bh6ssn_2564"><span class="control" id="bh6ssn_2571">Возвращает</span>:</p><p id="bh6ssn_2565">- {ok, TransformedData} &mdash; успешная трансформация.</p><p id="bh6ssn_2566">- {error, Reason} &mdash; ошибка трансформации.</p><p id="bh6ssn_2567"><span class="control" id="bh6ssn_2572">Пример использования</span>:</p><p id="bh6ssn_2568">Data = [[1669905600, 1.23], [1669909200, 1.45]],</p><p id="bh6ssn_2569">model_service_v2:transform(Data).</p></td></tr></tbody></table></div><p id="bh6ssn_2010"><span class="control" id="bh6ssn_2573">Пример использования модуля:</span></p><p id="bh6ssn_2011">% Устанавливаем объект</p><p id="bh6ssn_2012">Obj = fp_db:to_oid(&lt;&lt;&quot;object_path&quot;&gt;&gt;),</p><p id="bh6ssn_2013">% Запускаем выполнение задачи</p><p id="bh6ssn_2014">model_service_v2:run_task(Obj).</p><p id="bh6ssn_2015"><span class="control" id="bh6ssn_2574">Ожидаемый вывод в логах:</span></p><ol class="list _decimal" id="bh6ssn_2016" type="1"><li class="list__item" id="bh6ssn_2575"><p id="bh6ssn_2579">Информация о начале задачи:</p><p id="bh6ssn_2580">model_service: Run the task...</p></li><li class="list__item" id="bh6ssn_2576"><p id="bh6ssn_2581">Успешное чтение данных:</p><p id="bh6ssn_2582">model_service: read the object: #{&lt;&lt;&quot;model_state&quot;&gt;&gt; =&gt; &lt;&lt;&quot;active&quot;&gt;&gt;, ...}</p></li><li class="list__item" id="bh6ssn_2577"><p id="bh6ssn_2583">Успешный вызов внешнего сервиса:</p><p id="bh6ssn_2584">Response #{&lt;&lt;&quot;task_output&quot;&gt;&gt; =&gt; [[1669905600, 1.23], [1669909200, 1.45]]}</p></li><li class="list__item" id="bh6ssn_2578"><p id="bh6ssn_2585">Успешная запись данных:</p><p id="bh6ssn_2586">Data successfully written to archive: &lt;&lt;&quot;archive_path&quot;&gt;&gt;</p><p id="bh6ssn_2587"><span class="control" id="bh6ssn_2588">Примечания</span></p></li></ol><ul class="list _bullet" id="bh6ssn_2017"><li class="list__item" id="bh6ssn_2589"><p id="bh6ssn_2592">Взаимодействие с внешним сервисом:</p><ol class="list _decimal" id="bh6ssn_2593" type="1"><li class="list__item" id="bh6ssn_2594"><p id="bh6ssn_2596">URL сервиса формируется на основе хоста и порта\.</p></li><li class="list__item" id="bh6ssn_2595"><p id="bh6ssn_2597">Отправка данных осуществляется через HTTP POST запрос с JSON-телом\.</p></li></ol></li><li class="list__item" id="bh6ssn_2590"><p id="bh6ssn_2598">Логирование:</p><ol class="list _decimal" id="bh6ssn_2599" type="1"><li class="list__item" id="bh6ssn_2600"><p>Все ключевые шаги процесса логируются с использованием макросов ?LOGINFO, ?LOGWARNING и ?LOGERROR\.</p></li></ol></li><li class="list__item" id="bh6ssn_2591"><p id="bh6ssn_2601">Обработка ошибок:</p><p id="bh6ssn_2602">1)Если выполнение задачи прерывается на любом этапе, функция возвращает описание ошибки.</p><section class="chapter"><h3 id="13-rest-api-client-v1-0" data-toc="13-rest-api-client-v1-0"><a name=""></a><span class="control" id="bh6ssn_2609">А.13 Модуль rest_api_client (v1.0)</span></h3><p id="bh6ssn_2605">Клиент REST API для обмена данными с системой рынка баланса. Поддерживает запросы на сервер по протоколу REST и позволяет интегрировать данные с внешними REST API.</p><p id="bh6ssn_2606"><span class="control" id="bh6ssn_2610">Общая информация</span></p><p id="bh6ssn_2607">Модуль rest_api_client предназначен для выполнения HTTP-запросов к REST API, включая:</p></section></li></ul><ol class="list _decimal" id="bh6ssn_2018" type="1"><li class="list__item" id="bh6ssn_2611"><p>Получение токена для авторизации.</p></li><li class="list__item" id="bh6ssn_2612"><p>Выполнение запросов с использованием токена.</p></li></ol><div class="table-wrapper"><table class="wide" id="bh6ssn_2019"><thead><tr class="ijRowHead" id="bh6ssn_2613"><th id="bh6ssn_2617"><p><span class="control" id="bh6ssn_2619">Функция</span></p></th><th id="bh6ssn_2618"><p><span class="control" id="bh6ssn_2620">Описание</span></p></th></tr></thead><tbody><tr id="bh6ssn_2614"><td id="bh6ssn_2621"><p><span class="control" id="bh6ssn_2623">get_token/2</span></p></td><td id="bh6ssn_2622"><p id="bh6ssn_2624">: Получает токен для авторизации по указанному URL и телу запроса.</p><p id="bh6ssn_2625"><span class="control" id="bh6ssn_2640">Параметры</span>:</p><p id="bh6ssn_2626">- TokenUrl (binary) &mdash; URL для получения токена.</p><p id="bh6ssn_2627">- RequestBody (map) &mdash; тело запроса с данными для авторизации.</p><p id="bh6ssn_2628"><span class="control" id="bh6ssn_2641">Возвращает</span>:</p><p id="bh6ssn_2629">- {ok, Token} &mdash; если токен успешно получен.</p><p id="bh6ssn_2630">- {error, no_token_in_response} &mdash; если токен отсутствует в ответе.</p><p id="bh6ssn_2631">- {error, Reason} &mdash; если произошла ошибка во время выполнения запроса.</p><p id="bh6ssn_2632"><span class="control" id="bh6ssn_2642">Детали реализации</span>:</p><p id="bh6ssn_2633">- Формирует тело запроса в формате JSON.</p><p id="bh6ssn_2634">- Выполняет POST-запрос на указанный URL.</p><p id="bh6ssn_2635">- Декодирует ответ и извлекает токен.</p><p id="bh6ssn_2636"><span class="control" id="bh6ssn_2643">Пример использования</span>:</p><p id="bh6ssn_2637">TokenUrl = &lt;&lt;&quot;http://api.example.com/auth/token&quot;&gt;&gt;,</p><p id="bh6ssn_2638">RequestBody = #{&lt;&lt;&quot;username&quot;&gt;&gt; =&gt; &lt;&lt;&quot;user&quot;&gt;&gt;, &lt;&lt;&quot;password&quot;&gt;&gt; =&gt; &lt;&lt;&quot;pass&quot;&gt;&gt;},</p><p id="bh6ssn_2639">rest_api_client:get_token(TokenUrl, RequestBody).</p></td></tr><tr id="bh6ssn_2615"><td id="bh6ssn_2644"><p><span class="control" id="bh6ssn_2646">make_request/4</span></p></td><td id="bh6ssn_2645"><p id="bh6ssn_2647">: Выполняет HTTP-запрос с использованием токена авторизации.</p><p id="bh6ssn_2648"><span class="control" id="bh6ssn_2667">Параметры</span>:</p><p id="bh6ssn_2649">- Token (binary) &mdash; токен для авторизации.</p><p id="bh6ssn_2650">- Method (atom) &mdash; HTTP-метод (get, post, put, delete).</p><p id="bh6ssn_2651">- Url (binary) &mdash; URL для выполнения запроса.</p><p id="bh6ssn_2652">- Body (map) &mdash; тело запроса.</p><p id="bh6ssn_2653"><span class="control" id="bh6ssn_2668">Возвращает</span>:</p><p id="bh6ssn_2654">- {ok, Response} &mdash; успешный ответ с декодированными данными.</p><p id="bh6ssn_2655">- {error, {unexpected_status, Code}} &mdash; неожиданный статус-код.</p><p id="bh6ssn_2656">- {error, Reason} &mdash; ошибка при выполнении запроса.</p><p id="bh6ssn_2657"><span class="control" id="bh6ssn_2669">Детали реализации</span>:</p><p id="bh6ssn_2658">- Кодирует тело запроса в формат JSON.</p><p id="bh6ssn_2659">- Формирует HTTP-запрос с заголовками, включая Authorization.</p><p id="bh6ssn_2660">- Выполняет запрос и обрабатывает результат.</p><p id="bh6ssn_2661"><span class="control" id="bh6ssn_2670">Пример использования</span>:</p><p id="bh6ssn_2662">Token = &lt;&lt;&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9&quot;&gt;&gt;,</p><p id="bh6ssn_2663">Method = post,</p><p id="bh6ssn_2664">Url = &lt;&lt;&quot;http://api.example.com/data&quot;&gt;&gt;,</p><p id="bh6ssn_2665">Body = #{&lt;&lt;&quot;key&quot;&gt;&gt; =&gt; &lt;&lt;&quot;value&quot;&gt;&gt;},</p><p id="bh6ssn_2666">rest_api_client:make_request(Token, Method, Url, Body).</p></td></tr><tr id="bh6ssn_2616"><td id="bh6ssn_2671"><p><span class="control" id="bh6ssn_2673">get_url/3</span></p></td><td id="bh6ssn_2672"><p id="bh6ssn_2674">: Формирует URL для выполнения запросов.</p><p id="bh6ssn_2675"><span class="control" id="bh6ssn_2686">Параметры</span>:</p><p id="bh6ssn_2676">- Host (binary) &mdash; адрес хоста.</p><p id="bh6ssn_2677">- Port (binary) &mdash; порт хоста.</p><p id="bh6ssn_2678">- URL (binary) &mdash; конечная точка.</p><p id="bh6ssn_2679"><span class="control" id="bh6ssn_2687">Возвращает</span>:</p><p id="bh6ssn_2680">- Сформированный URL (binary).</p><p id="bh6ssn_2681"><span class="control" id="bh6ssn_2688">Пример использования</span>:</p><p id="bh6ssn_2682">Host = &lt;&lt;&quot;127.0.0.1&quot;&gt;&gt;,</p><p id="bh6ssn_2683">Port = &lt;&lt;&quot;8080&quot;&gt;&gt;,</p><p id="bh6ssn_2684">Path = &lt;&lt;&quot;api/resource&quot;&gt;&gt;,</p><p id="bh6ssn_2685">rest_api_client:get_url(Host, Port, Path).</p></td></tr></tbody></table></div><p id="bh6ssn_2020"><span class="control" id="bh6ssn_2689">Примеры использования модуля.</span></p><p id="bh6ssn_2021"><span class="control" id="bh6ssn_2690">Пример 1: Получение токена</span></p><p id="bh6ssn_2022">TokenUrl = &lt;&lt;&quot;http://auth.example.com/token&quot;&gt;&gt;,</p><p id="bh6ssn_2023">RequestBody = #{&lt;&lt;&quot;username&quot;&gt;&gt; =&gt; &lt;&lt;&quot;admin&quot;&gt;&gt;, &lt;&lt;&quot;password&quot;&gt;&gt; =&gt; &lt;&lt;&quot;secret&quot;&gt;&gt;},</p><p id="bh6ssn_2024">case rest_api_client:get_token(TokenUrl, RequestBody) of</p><p id="bh6ssn_2025"><code class="code" id="bh6ssn_2691"></code> {ok, Token} -&gt; io:format(&quot;Token received: <span id="bh6ssn_2692"><sub class="subscript">p</sub></span>n&quot;, [Token]);</p><p id="bh6ssn_2026"><code class="code" id="bh6ssn_2693"></code> {error, Reason} -&gt; io:format(&quot;Failed to get token: <span id="bh6ssn_2694"><sub class="subscript">p</sub></span>n&quot;, [Reason])</p><p id="bh6ssn_2027">end.</p><p id="bh6ssn_2028"><span class="control" id="bh6ssn_2695">Пример 2: Выполнение запроса с токеном</span></p><p id="bh6ssn_2029">Token = &lt;&lt;&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9&quot;&gt;&gt;,</p><p id="bh6ssn_2030">Method = post,</p><p id="bh6ssn_2031">Url = &lt;&lt;&quot;http://api.example.com/resource&quot;&gt;&gt;,</p><p id="bh6ssn_2032">Body = #{&lt;&lt;&quot;param1&quot;&gt;&gt; =&gt; &lt;&lt;&quot;value1&quot;&gt;&gt;, &lt;&lt;&quot;param2&quot;&gt;&gt; =&gt; &lt;&lt;&quot;value2&quot;&gt;&gt;},</p><p id="bh6ssn_2033">case rest_api_client:make_request(Token, Method, Url, Body) of</p><p id="bh6ssn_2034"><code class="code" id="bh6ssn_2696"></code> {ok, Response} -&gt; io:format(&quot;Response: <span id="bh6ssn_2697"><sub class="subscript">p</sub></span>n&quot;, [Response]);</p><p id="bh6ssn_2035"><code class="code" id="bh6ssn_2698"></code> {error, Reason} -&gt; io:format(&quot;Request failed: <span id="bh6ssn_2699"><sub class="subscript">p</sub></span>n&quot;, [Reason])</p><p id="bh6ssn_2036">end.</p><p id="bh6ssn_2037"><span class="control" id="bh6ssn_2700">Пример 3: Формирование URL</span></p><p id="bh6ssn_2038">Host = &lt;&lt;&quot;127.0.0.1&quot;&gt;&gt;,</p><p id="bh6ssn_2039">Port = &lt;&lt;&quot;8080&quot;&gt;&gt;,</p><p id="bh6ssn_2040">Path = &lt;&lt;&quot;api/v1/resource&quot;&gt;&gt;,</p><p id="bh6ssn_2041">Url = rest_api_client:get_url(Host, Port, Path),</p><p id="bh6ssn_2042">io:format(&quot;Generated URL: <span id="bh6ssn_2701"><sub class="subscript">p</sub></span>n&quot;, [Url]).</p><p id="bh6ssn_2043"><span class="control" id="bh6ssn_2702">Ожидаемые сценарии работы</span></p><ul class="list _bullet" id="bh6ssn_2044"><li class="list__item" id="bh6ssn_2703"><p id="bh6ssn_2709">Успешный запрос:</p><ol class="list _decimal" id="bh6ssn_2710" type="1"><li class="list__item" id="bh6ssn_2711"><p id="bh6ssn_2713">Токен получен и запрос выполнен без ошибок\.</p></li><li class="list__item" id="bh6ssn_2712"><p id="bh6ssn_2714">Ответ: {ok, Response}\.</p></li></ol></li><li class="list__item" id="bh6ssn_2704"><p id="bh6ssn_2715">Ошибка токена:</p><ol class="list _decimal" id="bh6ssn_2716" type="1"><li class="list__item" id="bh6ssn_2717"><p id="bh6ssn_2719">Сервер не вернул токен\.</p></li><li class="list__item" id="bh6ssn_2718"><p id="bh6ssn_2720">Ответ: {error, no_token_in_response}\.</p></li></ol></li><li class="list__item" id="bh6ssn_2705"><p id="bh6ssn_2721">Ошибка запроса:</p><ol class="list _decimal" id="bh6ssn_2722" type="1"><li class="list__item" id="bh6ssn_2724"><p id="bh6ssn_2726">Сервер вернул неожиданный статус-код или произошла ошибка подключения\.</p></li><li class="list__item" id="bh6ssn_2725"><p id="bh6ssn_2727">Ответ: {error, Reason}\.</p></li></ol><p id="bh6ssn_2723"><span class="control" id="bh6ssn_2728">Примечания</span></p></li><li class="list__item" id="bh6ssn_2706"><p id="bh6ssn_2729">Формат данных:</p><ol class="list _decimal" id="bh6ssn_2730" type="1"><li class="list__item" id="bh6ssn_2731"><p>Данные запросов и ответов кодируются/декодируются в формате JSON с помощью библиотеки jsx\.</p></li></ol></li><li class="list__item" id="bh6ssn_2707"><p id="bh6ssn_2732">Авторизация:</p><ol class="list _decimal" id="bh6ssn_2733" type="1"><li class="list__item" id="bh6ssn_2734"><p>Используется авторизация с токеном, передаваемым в заголовке Authorization\.</p></li></ol></li><li class="list__item" id="bh6ssn_2708"><p id="bh6ssn_2735">Обработка ошибок:</p><ol class="list _decimal" id="bh6ssn_2736" type="1"><li class="list__item" id="bh6ssn_2738"><p>Ошибки логируются, и в случае неудачного запроса возвращаются соответствующие коды и описания\.</p></li></ol><section class="chapter"><h3 id="14-state-graph-v1" data-toc="14-state-graph-v1"><a name=""></a><span class="control" id="bh6ssn_2744">А.14 Модуль state_graph (v1)</span></h3><p id="bh6ssn_2740">Модуль для работы с графическим отображением состояний. Поддерживает функцию голосования (vote), позволяя принимать решения на основе текущих данных о состоянии объектов.</p><p id="bh6ssn_2741"><span class="control" id="bh6ssn_2745">Общая информация</span></p><p id="bh6ssn_2742">Модуль state_graph предоставляет функционал для работы с цветами, связанными с состояниями и классами напряжения, извлечения класса напряжения из строки, а также вычисления среднего значения параметров из списка с учетом отклонений.</p></section></li></ul><div class="table-wrapper"><table class="wide" id="bh6ssn_2045"><thead><tr class="ijRowHead" id="bh6ssn_2746"><th id="bh6ssn_2750"><p><span class="control" id="bh6ssn_2752">Функция</span></p></th><th id="bh6ssn_2751"><p><span class="control" id="bh6ssn_2753">Описание</span></p></th></tr></thead><tbody><tr id="bh6ssn_2747"><td id="bh6ssn_2754"><p><span class="control" id="bh6ssn_2756">color/2</span></p></td><td id="bh6ssn_2755"><p id="bh6ssn_2757">: Возвращает цвет в зависимости от класса напряжения и состояния.</p><p id="bh6ssn_2758"><span class="control" id="bh6ssn_2771">Параметры</span>:</p><p id="bh6ssn_2759">- Vclass (integer) &mdash; класс напряжения.</p><p id="bh6ssn_2760">- State (integer) &mdash; состояние.</p><p id="bh6ssn_2761"><span class="control" id="bh6ssn_2772">Возвращает</span>:</p><p id="bh6ssn_2762">- Цвет в виде строки (binary), например: &lt;&lt;&quot;#959595&quot;&gt;&gt;.</p><p id="bh6ssn_2763"><span class="control" id="bh6ssn_2773">Детали реализации</span>:</p><p id="bh6ssn_2764">- Приводит State к числу, если это не так.</p><p id="bh6ssn_2765">- Определяет цвет для заданного класса напряжения (Vclass) из предопределенной карты цветов.</p><p id="bh6ssn_2766">- Возвращает цвет в зависимости от значения State.</p><p id="bh6ssn_2767"><span class="control" id="bh6ssn_2774">Пример использования</span>:</p><p id="bh6ssn_2768">Vclass = 65,</p><p id="bh6ssn_2769">State = 2,</p><p id="bh6ssn_2770">state_graph:color(Vclass, State).</p></td></tr><tr id="bh6ssn_2748"><td id="bh6ssn_2775"><p><span class="control" id="bh6ssn_2777">get_vclass_from_string/1</span></p></td><td id="bh6ssn_2776"><p id="bh6ssn_2778">: Извлекает класс напряжения из строки.</p><p id="bh6ssn_2779"><span class="control" id="bh6ssn_2790">Параметры</span>:</p><p id="bh6ssn_2780">- String (binary) &mdash; строка, содержащая класс напряжения.</p><p id="bh6ssn_2781"><span class="control" id="bh6ssn_2791">Возвращает</span>:</p><p id="bh6ssn_2782">- Класс напряжения (integer).</p><p id="bh6ssn_2783">- 0, если класс напряжения не найден.</p><p id="bh6ssn_2784"><span class="control" id="bh6ssn_2792">Детали реализации</span>:</p><p id="bh6ssn_2785">1. Использует регулярное выражение для поиска чисел в строке.</p><p id="bh6ssn_2786">2. Если совпадение найдено, преобразует его в число, иначе возвращает 0.</p><p id="bh6ssn_2787"><span class="control" id="bh6ssn_2793">Пример использования</span>:</p><p id="bh6ssn_2788">String = &lt;&lt;&quot;Voltage class: 110 kV&quot;&gt;&gt;,</p><p id="bh6ssn_2789">state_graph:get_vclass_from_string(String).</p></td></tr><tr id="bh6ssn_2749"><td id="bh6ssn_2794"><p><span class="control" id="bh6ssn_2796">vote/3</span></p></td><td id="bh6ssn_2795"><p id="bh6ssn_2797">: Вычисляет среднее значение параметров из списка, удовлетворяющих условию минимального отклонения от целевого значения.</p><p id="bh6ssn_2798"><span class="control" id="bh6ssn_2815">Параметры</span>:</p><p id="bh6ssn_2799">- Values (list) &mdash; список чисел.</p><p id="bh6ssn_2800">- Deviation (integer) &mdash; допустимое отклонение.</p><p id="bh6ssn_2801">- TargetValue (integer) &mdash; целевое значение.</p><p id="bh6ssn_2802"><span class="control" id="bh6ssn_2816">Возвращает</span>:</p><p id="bh6ssn_2803">- Среднее значение (float) из фильтрованных значений.</p><p id="bh6ssn_2804">- none, если подходящие значения отсутствуют.</p><p id="bh6ssn_2805"><span class="control" id="bh6ssn_2817">Детали реализации</span>:</p><p id="bh6ssn_2806">- Фильтрует значения, которые находятся в пределах Deviation от TargetValue.</p><p id="bh6ssn_2807">- Если подходящих значений нет, возвращает none.</p><p id="bh6ssn_2808">- Если одно значение удовлетворяет условию, возвращает его.</p><p id="bh6ssn_2809">- Если несколько значений удовлетворяют условию, возвращает их среднее.</p><p id="bh6ssn_2810"><span class="control" id="bh6ssn_2818">Пример использования</span>:</p><p id="bh6ssn_2811">Values = [110, 115, 120, 130],</p><p id="bh6ssn_2812">Deviation = 10,</p><p id="bh6ssn_2813">TargetValue = 115,</p><p id="bh6ssn_2814">state_graph:vote(Values, Deviation, TargetValue).</p></td></tr></tbody></table></div><p id="bh6ssn_2046"><span class="control" id="bh6ssn_2819">Примеры использования модуля</span></p><p id="bh6ssn_2047"><span class="control" id="bh6ssn_2820">Пример 1: Определение цвета</span></p><p id="bh6ssn_2048">Vclass = 110,</p><p id="bh6ssn_2049">State = 1,</p><p id="bh6ssn_2050">Color = state_graph:color(Vclass, State),</p><p id="bh6ssn_2051">io:format(&quot;Цвет для класса напряжения ~p в состоянии ~p: <span id="bh6ssn_2821"><sub class="subscript">p</sub></span>n&quot;, [Vclass, State, Color]).</p><p id="bh6ssn_2052"><span class="control" id="bh6ssn_2822">Пример 2: Извлечение класса напряжения из строки</span></p><p id="bh6ssn_2053">String = &lt;&lt;&quot;This is a voltage class: 220&quot;&gt;&gt;,</p><p id="bh6ssn_2054">Vclass = state_graph:get_vclass_from_string(String),</p><p id="bh6ssn_2055">io:format(&quot;Извлеченный класс напряжения: <span id="bh6ssn_2823"><sub class="subscript">p</sub></span>n&quot;, [Vclass]).</p><p id="bh6ssn_2056"><span class="control" id="bh6ssn_2824">Пример 3: Расчет среднего значения с учетом отклонений</span></p><p id="bh6ssn_2057">Values = [100, 105, 115, 130],</p><p id="bh6ssn_2058">Deviation = 10,</p><p id="bh6ssn_2059">TargetValue = 110,</p><p id="bh6ssn_2060">Result = state_graph:vote(Values, Deviation, TargetValue),</p><p id="bh6ssn_2061">io:format(&quot;Среднее значение: <span id="bh6ssn_2825"><sub class="subscript">p</sub></span>n&quot;, [Result]).</p><p id="bh6ssn_2062"><span class="control" id="bh6ssn_2826">Ожидаемые сценарии работы</span></p><ul class="list _bullet" id="bh6ssn_2063"><li class="list__item" id="bh6ssn_2827"><p id="bh6ssn_2833"><span class="control" id="bh6ssn_2834">Обработка цветов</span>: Если класс напряжения не найден в предопределенных значениях, возвращается цвет &lt;&lt;&quot;#000000&quot;&gt;&gt; (черный). При некорректном состоянии (State) по умолчанию используется 0.</p></li><li class="list__item" id="bh6ssn_2828"><p id="bh6ssn_2835"><span class="control" id="bh6ssn_2836">Извлечение данных из строки</span>: Если строка не содержит числовых данных, возвращается 0.</p></li><li class="list__item" id="bh6ssn_2829"><p id="bh6ssn_2837"><span class="control" id="bh6ssn_2839">Фильтрация значений</span>: Если список значений пуст или не содержит подходящих элементов, возвращается none. При одном подходящем значении оно возвращается без изменений.</p><p id="bh6ssn_2838"><span class="control" id="bh6ssn_2840">Примечания</span></p></li><li class="list__item" id="bh6ssn_2830"><p id="bh6ssn_2841"><span class="control" id="bh6ssn_2842">Обработка цветов</span>: Цвета ассоциируются с классами напряжения и состояниями, а если значения отсутствуют, используются цвета по умолчанию.</p></li><li class="list__item" id="bh6ssn_2831"><p id="bh6ssn_2843"><span class="control" id="bh6ssn_2844">Работа со строками</span>: Класс напряжения извлекается из строки с помощью регулярных выражений.</p></li><li class="list__item" id="bh6ssn_2832"><p id="bh6ssn_2845"><span class="control" id="bh6ssn_2848">Расчет среднего</span>: Фильтрация значений осуществляется на основе заданного допустимого отклонения.</p><section class="chapter"><h3 id="faceplate-api" data-toc="faceplate-api"><a name=""></a><span class="control" id="bh6ssn_2852">Приложение Б. Faceplate API</span></h3><p id="bh6ssn_2850">Эта документация поможет эффективно использовать API для работы с объектами, архивами и хранилищем данных в SCADA/EMS.</p></section><section class="chapter"><h3 id="1-fp-fp-db-fp-api-erlang-md" data-toc="1-fp-fp-db-fp-api-erlang-md"><a name=""></a><span class="control" id="bh6ssn_2858">Б.1 Модули fp и fp_db (fp_api_erlang.md)</span></h3><p id="bh6ssn_2854"><span class="control" id="bh6ssn_2859">Общая информация</span></p><p id="bh6ssn_2855">Модули fp и fp_db предназначены для работы с объектами, архивами и хранилищем данных в среде SCADA/EMS. API предоставляет методы для преобразования данных, работы с объектами, чтения и изменения полей, а также выполнения запросов.</p><p id="bh6ssn_2856">Функции модуля оптимизированы для использования в RunTime и могут работать быстрее за счет кеширования данных.</p></section></li></ul><div class="table-wrapper"><table class="wide" id="bh6ssn_2064"><thead><tr class="ijRowHead" id="bh6ssn_2860"><th id="bh6ssn_2878"><p><span class="control" id="bh6ssn_2880">Функция</span></p></th><th id="bh6ssn_2879"><p><span class="control" id="bh6ssn_2881">Описание</span></p></th></tr></thead><tbody><tr id="bh6ssn_2861"><td id="bh6ssn_2882"><p>fp:to_json/1</p></td><td id="bh6ssn_2883"><p id="bh6ssn_2884"><span class="control" id="bh6ssn_2888">:</span> Преобразует Erlang-терм (список, map, числа) в JSON.</p><p id="bh6ssn_2885"><span class="control" id="bh6ssn_2889">Возвращает:</span> binary в формате JSON.</p><p id="bh6ssn_2886"><span class="control" id="bh6ssn_2890">Пример использования:</span></p><p id="bh6ssn_2887">JSON = fp:to_json(#{key =&gt; &quot;value&quot;}).</p></td></tr><tr id="bh6ssn_2862"><td id="bh6ssn_2891"><p>fp:from_json/1</p></td><td id="bh6ssn_2892"><p id="bh6ssn_2893"><span class="control" id="bh6ssn_2896">:</span> Конвертирует JSON (в формате binary) обратно в Erlang-терм. <br><span class="control" id="bh6ssn_2898">Возвращает:</span> Термин (например, список, map, числа).</p><p id="bh6ssn_2894"><span class="control" id="bh6ssn_2899">Пример использования:</span></p><p id="bh6ssn_2895">Term = fp:from_json(&lt;&lt;&quot;{\&quot;key\&quot;:\&quot;value\&quot;}&quot;&gt;&gt;).</p></td></tr><tr id="bh6ssn_2863"><td id="bh6ssn_2900"><p>fp:open_tag/1</p></td><td id="bh6ssn_2901"><p id="bh6ssn_2902"><span class="control" id="bh6ssn_2907">:</span> Открывает объект тега по указанному пути. Работает быстрее fp_db:open/1, благодаря кешированию.</p><p id="bh6ssn_2903"><span class="control" id="bh6ssn_2908">Требование:</span> Работает только в режиме RunTime.</p><p id="bh6ssn_2904"><span class="control" id="bh6ssn_2909">Возвращает:</span> {ok, Object}.</p><p id="bh6ssn_2905"><span class="control" id="bh6ssn_2910">Пример использования:</span></p><p id="bh6ssn_2906">{ok, Tag} = fp:open_tag(&quot;/path/to/tag&quot;).</p></td></tr><tr id="bh6ssn_2864"><td id="bh6ssn_2911"><p>fp:get_value/2</p></td><td id="bh6ssn_2912"><p id="bh6ssn_2913"><span class="control" id="bh6ssn_2918">:</span> Получает значение поля объекта по пути к тегу. Работает быстрее, чем fp_db:read_field.</p><p id="bh6ssn_2914"><span class="control" id="bh6ssn_2919">Требование:</span> Работает только в режиме RunTime.</p><p id="bh6ssn_2915"><span class="control" id="bh6ssn_2920">Возвращает:</span> {ok, Value}.</p><p id="bh6ssn_2916"><span class="control" id="bh6ssn_2921">Пример использования:</span></p><p id="bh6ssn_2917">{ok, Value} = fp:get_value(Tag, Field).</p></td></tr><tr id="bh6ssn_2865"><td id="bh6ssn_2922"><p>fp:get_value/3</p></td><td id="bh6ssn_2923"><p id="bh6ssn_2924"><span class="control" id="bh6ssn_2928">:</span> Аналог fp:get_value/2, но возвращает значение Default, если поле не задано.</p><p id="bh6ssn_2925"><span class="control" id="bh6ssn_2929">Возвращает:</span> {ok, Value}.</p><p id="bh6ssn_2926"><span class="control" id="bh6ssn_2930">Пример использования:</span></p><p id="bh6ssn_2927">{ok, Value} = fp:get_value(Tag, Field, DefaultValue).</p></td></tr><tr id="bh6ssn_2866"><td id="bh6ssn_2931"><p>fp:set_value/2</p></td><td id="bh6ssn_2932"><p id="bh6ssn_2933"><span class="control" id="bh6ssn_2941">:</span> Изменяет значения полей тега.</p><p id="bh6ssn_2934"><span class="control" id="bh6ssn_2942">Требование:</span> Работает только в режиме RunTime.</p><p id="bh6ssn_2935"><span class="control" id="bh6ssn_2943">Принимает:</span></p><p id="bh6ssn_2936">- TagPath &mdash; путь к тегу.</p><p id="bh6ssn_2937">- Changes &mdash; список пар {Field, Value}.</p><p id="bh6ssn_2938"><span class="control" id="bh6ssn_2944">Возвращает:</span> ok.</p><p id="bh6ssn_2939"><span class="control" id="bh6ssn_2945">Пример использования:</span></p><p id="bh6ssn_2940">ok = fp:set_value(&quot;/path/to/tag&quot;, [{field1, value1}, {field2, value2}]).</p></td></tr><tr id="bh6ssn_2867"><td id="bh6ssn_2946"><p>fp:set_value/3</p></td><td id="bh6ssn_2947"><p id="bh6ssn_2948"><span class="control" id="bh6ssn_2953">:</span> Присваивает конкретное значение полю объекта.</p><p id="bh6ssn_2949"><span class="control" id="bh6ssn_2954">Требование:</span> Работает только в режиме RunTime.</p><p id="bh6ssn_2950"><span class="control" id="bh6ssn_2955">Возвращает:</span> ok.</p><p id="bh6ssn_2951"><span class="control" id="bh6ssn_2956">Пример использования:</span></p><p id="bh6ssn_2952">ok = fp:set_value(&quot;/path/to/tag&quot;, field, value).</p></td></tr><tr id="bh6ssn_2868"><td id="bh6ssn_2957"><p>fp:archives_get/2</p></td><td id="bh6ssn_2958"><p id="bh6ssn_2959"><span class="control" id="bh6ssn_2964">:</span> Возвращает значения архивов для указанных точек в заданных моментах времени.</p><p id="bh6ssn_2960"><span class="control" id="bh6ssn_2965">Возвращает:</span> Список списков формата:</p><p id="bh6ssn_2961"><code class="code" id="bh6ssn_2966"></code> [[TS1, A1_value, A2_value, ...], ...].</p><p id="bh6ssn_2962"><span class="control" id="bh6ssn_2967">Пример использования:</span></p><p id="bh6ssn_2963">Data = fp:archives_get(Points, Archives).</p></td></tr><tr id="bh6ssn_2869"><td id="bh6ssn_2968"><p>fp:archive_get_point/2</p></td><td id="bh6ssn_2969"><p id="bh6ssn_2970"><span class="control" id="bh6ssn_2974">:</span> Получает значение из архива в заданный момент времени.</p><p id="bh6ssn_2971"><span class="control" id="bh6ssn_2975">Возвращает:</span> {TS, Value}.</p><p id="bh6ssn_2972"><span class="control" id="bh6ssn_2976">Пример использования:</span></p><p id="bh6ssn_2973">{Timestamp, Value} = fp:archive_get_point(Archive, Timestamp).</p></td></tr><tr id="bh6ssn_2870"><td id="bh6ssn_2977"><p>fp:archives_get_periods/2</p></td><td id="bh6ssn_2978"><p id="bh6ssn_2979"><span class="control" id="bh6ssn_2984">:</span> Возвращает значения архивов за периоды, настроенные через Params.</p><p id="bh6ssn_2980"><span class="control" id="bh6ssn_2985">Возвращает:</span> Список списков формата:</p><p id="bh6ssn_2981"><code class="code" id="bh6ssn_2986"></code> [[TS1, A1_value, A2_value, ...], ...].</p><p id="bh6ssn_2982"><span class="control" id="bh6ssn_2987">Пример использования:</span></p><p id="bh6ssn_2983">Data = fp:archives_get_periods(Params, Archives).</p></td></tr><tr id="bh6ssn_2871"><td id="bh6ssn_2988"><p>fp:version/0</p></td><td id="bh6ssn_2989"><p id="bh6ssn_2990"><span class="control" id="bh6ssn_2994">:</span> Возвращает текущую версию API.</p><p id="bh6ssn_2991"><span class="control" id="bh6ssn_2995">Возвращает:</span> Версию в формате Version.</p><p id="bh6ssn_2992"><span class="control" id="bh6ssn_2996">Пример использования:</span></p><p id="bh6ssn_2993">Version = fp:version().</p></td></tr><tr id="bh6ssn_2872"><td id="bh6ssn_2997"><p>fp_db:create_object/1</p></td><td id="bh6ssn_2998"><p id="bh6ssn_2999"><span class="control" id="bh6ssn_3003">:</span> Создаёт объект с заданными полями.</p><p id="bh6ssn_3000"><span class="control" id="bh6ssn_3004">Возвращает:</span> Объект.</p><p id="bh6ssn_3001"><span class="control" id="bh6ssn_3005">Пример использования:</span></p><p id="bh6ssn_3002">Object = fp_db:create_object(#{field1 =&gt; value1, field2 =&gt; value2}).</p></td></tr><tr id="bh6ssn_2873"><td id="bh6ssn_3006"><p>fp_db:read_field/2</p></td><td id="bh6ssn_3007"><p id="bh6ssn_3008"><span class="control" id="bh6ssn_3012">:</span> Читает значение поля объекта.</p><p id="bh6ssn_3009"><span class="control" id="bh6ssn_3013">Возвращает:</span> {ok, Value}.</p><p id="bh6ssn_3010"><span class="control" id="bh6ssn_3014">Пример использования:</span></p><p id="bh6ssn_3011">{ok, Value} = fp_db:read_field(Object, Field).</p></td></tr><tr id="bh6ssn_2874"><td id="bh6ssn_3015"><p>fp_db:read_field/3</p></td><td id="bh6ssn_3016"><p id="bh6ssn_3017"><span class="control" id="bh6ssn_3021">:</span> Читает значение поля объекта с дополнительными параметрами.</p><p id="bh6ssn_3018"><span class="control" id="bh6ssn_3022">Возвращает:</span> {ok, Value}.</p><p id="bh6ssn_3019"><span class="control" id="bh6ssn_3023">Пример использования:</span></p><p id="bh6ssn_3020">{ok, Value} = fp_db:read_field(Object, Field, Params).</p></td></tr><tr id="bh6ssn_2875"><td id="bh6ssn_3024"><p>fp_db:read_fields/2</p></td><td id="bh6ssn_3025"><p id="bh6ssn_3026"><span class="control" id="bh6ssn_3030">:</span> Читает сразу несколько полей объекта.</p><p id="bh6ssn_3027"><span class="control" id="bh6ssn_3031">Возвращает:</span> Map с парами #{Field =&gt; Value}.</p><p id="bh6ssn_3028"><span class="control" id="bh6ssn_3032">Пример использования:</span></p><p id="bh6ssn_3029">Fields = fp_db:read_fields(Object, [field1, field2]).</p></td></tr><tr id="bh6ssn_2876"><td id="bh6ssn_3033"><p>fp_db:edit_object/2</p></td><td id="bh6ssn_3034"><p id="bh6ssn_3035"><span class="control" id="bh6ssn_3039">:</span> Изменяет значения полей объекта.</p><p id="bh6ssn_3036"><span class="control" id="bh6ssn_3040">Возвращает:</span> ok.</p><p id="bh6ssn_3037"><span class="control" id="bh6ssn_3041">Пример использования:</span></p><p id="bh6ssn_3038">ok = fp_db:edit_object(Object, #{field =&gt; value}).</p></td></tr><tr id="bh6ssn_2877"><td id="bh6ssn_3042"><p>fp_db:query/1</p></td><td id="bh6ssn_3043"><p id="bh6ssn_3044"><span class="control" id="bh6ssn_3048">:</span> Выполняет запрос к хранилищу данных (Ecomet).</p><p id="bh6ssn_3045"><span class="control" id="bh6ssn_3049">Возвращает:</span> Результат запроса.</p><p id="bh6ssn_3046"><span class="control" id="bh6ssn_3050">Пример использования:</span></p><p id="bh6ssn_3047">Result = fp_db:query(Query).</p></td></tr></tbody></table></div><p id="bh6ssn_2065"><span class="control" id="bh6ssn_3051">Примечания</span></p><ul class="list _bullet" id="bh6ssn_2066"><li class="list__item" id="bh6ssn_3052"><p id="bh6ssn_3057"><span class="control" id="bh6ssn_3058">RunTime:</span> Некоторые функции (fp:open_tag, fp:get_value, fp:set_value) работают только в режиме RunTime.</p></li><li class="list__item" id="bh6ssn_3053"><p id="bh6ssn_3059"><span class="control" id="bh6ssn_3060">Кеширование:</span> Функции fp оптимизированы за счёт использования кеша, что делает их быстрее аналогов из fp_db.</p></li><li class="list__item" id="bh6ssn_3054"><p id="bh6ssn_3061"><span class="control" id="bh6ssn_3063">Совместимость:</span> Архивные функции (fp:archives_get, fp:archive_get_point) совместимы с функциями из fp_archive.</p><section class="chapter"><h3 id="2-javascript-fp-api-js-md" data-toc="2-javascript-fp-api-js-md"><a name=""></a><span class="control" id="bh6ssn_3069">Б.2 Модуль функций JavaScript (fp_api_js.md)</span></h3><p id="bh6ssn_3065"><span class="control" id="bh6ssn_3070">Общая информация</span></p><p id="bh6ssn_3066">fp_api_js предоставляет функции для взаимодействия с объектами SCADA-системы на базе JavaScript. Используйте функции для работы с тегами, хранилищем данных и архивами.</p><p id="bh6ssn_3067"><span class="control" id="bh6ssn_3071">Общие рекомендации</span></p></section></li><li class="list__item" id="bh6ssn_3055"><p id="bh6ssn_3072"><span class="control" id="bh6ssn_3073">Асинхронность:</span> Все функции API возвращают промисы. Для получения результата используйте await.</p></li><li class="list__item" id="bh6ssn_3056"><p id="bh6ssn_3074"><span class="control" id="bh6ssn_3075">Идентификаторы объектов:</span> Вместо путей к тегам можно использовать идентификаторы объектов, полученные при создании.</p></li></ul><div class="table-wrapper"><table class="wide" id="bh6ssn_2067"><thead><tr class="ijRowHead" id="bh6ssn_3076"><th id="bh6ssn_3084"><p><span class="control" id="bh6ssn_3086">Функция</span></p></th><th id="bh6ssn_3085"><p><span class="control" id="bh6ssn_3087">Описание</span></p></th></tr></thead><tbody><tr id="bh6ssn_3077"><td id="bh6ssn_3088" colspan="2"><p><span class="control" id="bh6ssn_3089">Работа с тегами</span></p></td></tr><tr id="bh6ssn_3078"><td id="bh6ssn_3090"><p>fp.api.get_value(path, field)</p></td><td id="bh6ssn_3091"><p id="bh6ssn_3092">: Получает значение заданного поля тега.</p><p id="bh6ssn_3093"><span class="control" id="bh6ssn_3100">Параметры:</span></p><p id="bh6ssn_3094">- path (string): Путь к тегу.</p><p id="bh6ssn_3095">- field (string): Поле тега, значение которого необходимо получить.</p><p id="bh6ssn_3096"><span class="control" id="bh6ssn_3101">Возвращает:</span></p><p id="bh6ssn_3097">- Значение поля.</p><p id="bh6ssn_3098"><span class="control" id="bh6ssn_3102">Пример использования:</span></p><p id="bh6ssn_3099">let value = await fp.api.get_value('/root/PROJECT/TAGS/AI', 'value');</p></td></tr><tr id="bh6ssn_3079"><td id="bh6ssn_3103"><p>fp.api.set_value(path, field, value)</p></td><td id="bh6ssn_3104"><p id="bh6ssn_3105">: Устанавливает значение поля тега.</p><p id="bh6ssn_3106"><span class="control" id="bh6ssn_3113">Параметры:</span></p><p id="bh6ssn_3107">- path (string): Путь к тегу.</p><p id="bh6ssn_3108">- field (string): Поле тега.</p><p id="bh6ssn_3109">- value (any): Значение, которое нужно записать.</p><p id="bh6ssn_3110"><span class="control" id="bh6ssn_3114">Возвращает:</span> undefined.</p><p id="bh6ssn_3111"><span class="control" id="bh6ssn_3115">Пример использования:</span></p><p id="bh6ssn_3112">fp.api.set_value('/root/PROJECT/TAGS/AI', 'value', 10.5);</p></td></tr><tr id="bh6ssn_3080"><td id="bh6ssn_3116"><p>fp.api.archives_get(timestamps, archives)</p></td><td id="bh6ssn_3117"><p id="bh6ssn_3118">: Получает данные из архива для указанных временных точек.</p><p id="bh6ssn_3119"><span class="control" id="bh6ssn_3129">Параметры:</span></p><p id="bh6ssn_3120">- timestamps (array): Массив временных точек.</p><p id="bh6ssn_3121">- archives (array): Массив массивов, где каждый элемент: [путь к архиву, агрегирующая функция].</p><p id="bh6ssn_3122"><span class="control" id="bh6ssn_3130">Возвращает:</span></p><p id="bh6ssn_3123">- Массив массивов, содержащих временные метки и значения.</p><p id="bh6ssn_3124"><span class="control" id="bh6ssn_3131">Пример использования:</span></p><p id="bh6ssn_3125">let data = await fp.api.archives_get(</p><p id="bh6ssn_3126"><code class="code" id="bh6ssn_3132"></code> [TS1, TS2, TS3],</p><p id="bh6ssn_3127"><code class="code" id="bh6ssn_3133"></code> [[&quot;/root/PROJECT/TAGS/archive_1&quot;, &quot;avg&quot;]]</p><p id="bh6ssn_3128">);</p></td></tr><tr id="bh6ssn_3081"><td id="bh6ssn_3134" colspan="2"><p><span class="control" id="bh6ssn_3135">Работа с хранилищем данных</span></p></td></tr><tr id="bh6ssn_3082"><td id="bh6ssn_3136"><p>fp.db.create_object(params)</p></td><td id="bh6ssn_3137"><p id="bh6ssn_3138">: Создает новый объект.</p><p id="bh6ssn_3139"><span class="control" id="bh6ssn_3150">Параметры:</span></p><p id="bh6ssn_3140">- params (object): Параметры объекта, включая .name, .folder, .pattern и дополнительные поля.</p><p id="bh6ssn_3141"><span class="control" id="bh6ssn_3151">Возвращает:</span></p><p id="bh6ssn_3142">- Идентификатор созданного объекта.</p><p id="bh6ssn_3143"><span class="control" id="bh6ssn_3152">Пример использования:</span></p><p id="bh6ssn_3144">let obj = await fp.db.create_object({</p><p id="bh6ssn_3145"><code class="code" id="bh6ssn_3153"></code> &quot;.name&quot;: &quot;mytag&quot;,</p><p id="bh6ssn_3146"><code class="code" id="bh6ssn_3154"></code> &quot;.folder&quot;: &quot;/root/PROJECT/TAGS/folder&quot;,</p><p id="bh6ssn_3147"><code class="code" id="bh6ssn_3155"></code> &quot;.pattern&quot;: &quot;/root/.patterns/AI&quot;,</p><p id="bh6ssn_3148"><code class="code" id="bh6ssn_3156"></code> &quot;value&quot;: 1.0</p><p id="bh6ssn_3149">});</p></td></tr><tr id="bh6ssn_3083"><td id="bh6ssn_3157"><p>fp.db.read_field(object, field)</p></td><td id="bh6ssn_3158"><p id="bh6ssn_3165">: Читает значение поля объекта.</p><p id="bh6ssn_3166"><span class="control" id="bh6ssn_3168">Параметры:</span></p><p id="bh6ssn_3167"></p><p> - object (string</p></td><td id="bh6ssn_3159"><p>ID): Путь или идентификатор объекта.</p></td><p id="bh6ssn_3160">- field (string): Название поля.</p><p id="bh6ssn_3161"><span class="control" id="bh6ssn_3169">Возвращает:</span></p><p id="bh6ssn_3162">- Значение поля.</p><p id="bh6ssn_3163"><span class="control" id="bh6ssn_3170">Пример использования:</span></p><p id="bh6ssn_3164">let value = await fp.db.read_field('/root/PROJECT/TAGS/AI', 'value');</p></tr></tbody></table></div><tr id="bh6ssn_2068"><td id="bh6ssn_3171"><p>fp.db.edit_object(object, changes)</p></td><td id="bh6ssn_3172"><p id="bh6ssn_3178">: Редактирует существующий объект.</p><p id="bh6ssn_3179"><span class="control" id="bh6ssn_3181">Параметры:</span></p><p id="bh6ssn_3180"></p><p> - object (string</p></td><td id="bh6ssn_3173"><p>ID): Путь или идентификатор объекта.</p></td><p id="bh6ssn_3174">- changes (object): Изменяемые поля и их новые значения.</p><p id="bh6ssn_3175"><span class="control" id="bh6ssn_3182">Возвращает:</span> undefined.</p><p id="bh6ssn_3176"><span class="control" id="bh6ssn_3183">Пример использования:</span></p><p id="bh6ssn_3177">fp.db.edit_object('/root/PROJECT/TAGS/AI', { value: 1.0, title: &quot;Updated&quot; });</p></tr></section><tr id="bh6ssn_11"><td id="bh6ssn_3184"><p>fp.db.delete_object(object)</p></td><td id="bh6ssn_3185"><p id="bh6ssn_3190">: Удаляет объект.</p><p id="bh6ssn_3191"><span class="control" id="bh6ssn_3193">Параметры:</span></p><p id="bh6ssn_3192"></p><p> - object (string</p></td><td id="bh6ssn_3186"><p>ID): Путь или идентификатор объекта.</p></td><p id="bh6ssn_3187"><span class="control" id="bh6ssn_3194">Возвращает:</span> undefined.</p><p id="bh6ssn_3188"><span class="control" id="bh6ssn_3195">Пример использования:</span></p><p id="bh6ssn_3189">fp.db.delete_object('/root/PROJECT/TAGS/AI');</p></tr><div class="last-modified">Last modified: 27 February 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="глоссарий.html" class="navigation-links__prev">Глоссарий</a><a href="справочник-reference.html" class="navigation-links__next">Справочник (Reference)</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b575/app.js"></script></body></html>