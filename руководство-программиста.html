<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-07-24T17:52:00.162845766"><title>Руководство программиста | Faceplate docs</title><script type="application/json" id="virtual-toc-data">[{"id":"pc5i3w_3","level":0,"title":"Введение","anchor":"#pc5i3w_3"},{"id":"6-1","level":0,"title":"6.1 Файл настроек","anchor":"#6-1"},{"id":"6-2","level":0,"title":"6.2 Использование в прикладном проекте","anchor":"#6-2"},{"id":"7","level":0,"title":"7. Заключение","anchor":"#7"},{"id":"pc5i3w_7","level":0,"title":"Приложение А. Библиотечные скрипты и их функции","anchor":"#pc5i3w_7"},{"id":"1-system-utils-v1","level":0,"title":"А.1 Модуль system_utils (v1)","anchor":"#1-system-utils-v1"},{"id":"2-weather-service","level":0,"title":"А.2 Модуль weather_service","anchor":"#2-weather-service"},{"id":"9-fp-powerfactory-service-old","level":0,"title":"А.9 Модуль fp_powerfactory_service_old","anchor":"#9-fp-powerfactory-service-old"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Руководство программиста | Faceplate docs"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Faceplate docs Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/руководство-программиста.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Руководство программиста | Faceplate docs"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/руководство-программиста.html#webpage",
    "url": "writerside-documentation/руководство-программиста.html",
    "name": "Руководство программиста | Faceplate docs",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Faceplate docs Help"
}</script><!-- End Schema.org --></head><body data-id="Руководство-программиста" data-main-title="Руководство программиста" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs=""><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Faceplate docs  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Руководство-программиста" id="Руководство-программиста.md">Руководство программиста</h1><section class="chapter"><h2 id="pc5i3w_3" data-toc="pc5i3w_3"><span class="control" id="pc5i3w_112">Введение</span></h2><p id="pc5i3w_13">Faceplate (FP) Studio предоставляет возможности для создания скриптов, которые позволяют добавлять новую функциональность и определять поведение различных компонентов системы, таких как прототипы, архивы, IoT-подключения и другие. Эти скрипты выполняют широкий спектр задач, включая обработку данных, взаимодействие с внешними API, выполнение вычислений, настройку параметров и автоматизацию процессов в SCADA-системе.</p><p id="pc5i3w_14">Для написания скриптов в Faceplate Studio поддерживаются два языка:</p><ul class="list _bullet" id="pc5i3w_15"><li class="list__item" id="pc5i3w_113"><p id="pc5i3w_124"><span class="control" id="pc5i3w_125">Erlang</span> &mdash; используется для выполнения задач на стороне сервера, таких как управление данными, взаимодействие с хранилищами данных и системами архивирования. Описание встроенных функций erlang можно посмотреть https://www.erlang.org/doc/system/reference_manual.html.</p></li><li class="list__item" id="pc5i3w_114"><p id="pc5i3w_126"><span class="control" id="pc5i3w_129">JavaScript</span> &mdash; применяется для выполнения клиентских операций, включая обработку данных и управление интерфейсными элементами. Описание поддерживаемых в FP функций JavaScript можно посмотреть <a href="https://ecma-international.org/publications-and-standards/standards/ecma-262/" id="pc5i3w_130" data-external="true" rel="noopener noreferrer" target="_blank">https://ecma-international.org/publications-and-standards/standards/ecma-262/</a>.</p><p id="pc5i3w_127">Данное руководство содержит основные принципы написания скриптов, объяснение структуры, примеры их применения, а также описание функций библиотечных модулей. Информация, изложенная здесь, поможет разработчикам легко создавать скрипты для решения задач в системе Faceplate, обеспечивая удобство и гибкость в работе с системой.</p><section class="chapter"><h3 id="1-1" data-toc="1-1"><a name=""></a><span class="control" id="pc5i3w_133">1.1 Общие рекомендации по написанию скриптов</span></h3></section></li><li class="list__item" id="pc5i3w_115"><p id="pc5i3w_134"><span class="control" id="pc5i3w_135">Логирование и обработка ошибок</span>: Используйте макросы ?LOGINFO, ?LOGWARNING и ?LOGERROR для логирования информации и обработки ошибок (файл console.log). Для логирования в самом журнале сообщений используйте макросы ? FP_LOGINFO, ? FP_LOGWARNING и ? FP_LOGERROR.</p></li><li class="list__item" id="pc5i3w_116"><p id="pc5i3w_136"><span class="control" id="pc5i3w_137">Отладка и тестирование</span>: После написания скрипта необходимо провести компиляцию. В случае успешного выполнения появится сообщение &ldquo;ok&rdquo;; в противном случае будут указаны ошибки.</p></li><li class="list__item" id="pc5i3w_117"><p id="pc5i3w_138"><span class="control" id="pc5i3w_140">Привязка скриптов</span>: Привязывайте скрипты к конкретным объектам или параметрам для автоматической обработки данных или выполнения операций на основе триггеров.</p><section class="chapter"><h3 id="1-2-faceplate-studio" data-toc="1-2-faceplate-studio"><a name=""></a><span class="control" id="pc5i3w_144">1.2 Основные возможности скриптов в Faceplate Studio</span></h3><p id="pc5i3w_142">Скрипты можно разделить на несколько типов в зависимости от их сложности и области применения:</p></section></li><li class="list__item" id="pc5i3w_118"><p id="pc5i3w_145">Простое поведение объектов (Прототипы)</p></li><li class="list__item" id="pc5i3w_119"><p id="pc5i3w_146">Обработка данных и JSON-шаблонов для IoT-соединений</p></li><li class="list__item" id="pc5i3w_120"><p id="pc5i3w_147">Настройка и работа с архивами</p><p id="pc5i3w_148">Каждая из этих областей требует уникального подхода, который будет рассмотрен далее, начиная с простых сценариев и переходя к более сложным.</p><section class="chapter"><h3 id="2" data-toc="2"><a name=""></a><span class="control" id="pc5i3w_154">2. Поведение прототипа: основные принципы и примеры скриптов</span></h3><p id="pc5i3w_152"><span class="control" id="pc5i3w_155">Behavior</span> &mdash; это скрипт, выполняемый при изменении экземпляра прототипа (например, при создании, редактировании или удалении объекта). Скрипты для прототипов задают поведение объекта в системе и позволяют реализовать базовые автоматические действия.</p></section><section class="chapter"><h3 id="2-1" data-toc="2-1"><a name=""></a><span class="control" id="pc5i3w_159">2.1 Базовая структура скрипта поведения</span></h3><p id="pc5i3w_157">Простейший скрипт для поведения прототипа экспортирует три функции:</p></section></li><li class="list__item" id="pc5i3w_121"><p id="pc5i3w_160"><span class="control" id="pc5i3w_161">on_create/1</span> &mdash; выполняется при создании экземпляра прототипа.</p></li><li class="list__item" id="pc5i3w_122"><p id="pc5i3w_162"><span class="control" id="pc5i3w_163">on_edit/1</span> &mdash; выполняется при редактировании полей экземпляра прототипа.</p></li><li class="list__item" id="pc5i3w_123"><p id="pc5i3w_164"><span class="control" id="pc5i3w_332">on_delete/1</span> &mdash; выполняется при удалении экземпляра прототипа.</p><p id="pc5i3w_165">Образец скрипта:</p><p id="pc5i3w_166">%%-------------------------------------------------------</p><p id="pc5i3w_167">%% This script is executed at the server side. The programming language</p><p id="pc5i3w_168">%% is Erlang.</p><p id="pc5i3w_169">%% The module MUST export next 3 methods:</p><p id="pc5i3w_170">%% * on_create/1 - this method is called when a new instance of the prototype is created.</p><p id="pc5i3w_171">%% * on_edit/1 - this method is called when own fields of an instance of the prototype are edited</p><p id="pc5i3w_172">%% * on_delete/1 - this method is called when an instance of the prototype is deleted</p><p id="pc5i3w_173">%% All this methods accept an Object of the instance and can edit or perform any other allowed code.</p><p id="pc5i3w_174">%% If any of the methods throw or crash the whole transaction will rollback.</p><p id="pc5i3w_175">%% If there are any warnings or not critical errors it is recommended to log them with available macros, examples:</p><p id="pc5i3w_176">%% ?LOGWARNING( &quot;my warning text: ~p&quot;, [Warning] )</p><p id="pc5i3w_177">%% ?LOGERROR( &quot;my error text: ~p&quot;, [Error] )</p><p id="pc5i3w_178">%% If the methods performs well it should return atom 'ok'.</p><p id="pc5i3w_179">%% For more info please refer to the documentation</p><p id="pc5i3w_180">%%-------------------------------------------------------</p><p id="pc5i3w_181">-module(fp_prototype_MyProto1).</p><p id="pc5i3w_182">-include(&quot;fp_struct.hrl&quot;).</p><p id="pc5i3w_183">-export([</p><p id="pc5i3w_184"><code class="code" id="pc5i3w_333"></code> on_create/1,</p><p id="pc5i3w_185"><code class="code" id="pc5i3w_334"></code> on_delete/1,</p><p id="pc5i3w_186"><code class="code" id="pc5i3w_335"></code> on_edit/1</p><p id="pc5i3w_187">]).</p><p id="pc5i3w_188">on_create(_Object)-&gt;</p><p id="pc5i3w_189"><code class="code" id="pc5i3w_336"></code> ok.</p><p id="pc5i3w_190">on_edit(_Object)-&gt;</p><p id="pc5i3w_191"><code class="code" id="pc5i3w_337"></code> ok.</p><p id="pc5i3w_192">on_delete( Object )-&gt;</p><p id="pc5i3w_193"><code class="code" id="pc5i3w_338"></code> ok.</p><p id="pc5i3w_194">Рассмотрим примеры создания скриптов, определяющих поведение прототипа на языке Erlang.</p><p id="pc5i3w_195"><span class="control" id="pc5i3w_339">Пример 1:</span></p><p id="pc5i3w_196">%%-------------------------------------------------------</p><p id="pc5i3w_197">%% This script is executed at the server side. The programming language</p><p id="pc5i3w_198">%% is Erlang.</p><p id="pc5i3w_199">%% The module MUST export next 3 methods:</p><p id="pc5i3w_200">%% * on_create/1 - this method is called when a new instance of the prototype is created.</p><p id="pc5i3w_201">%% * on_edit/1 - this method is called when own fields of an instance of the prototype are edited</p><p id="pc5i3w_202">%% * on_delete/1 - this method is called when an instance of the prototype is deleted</p><p id="pc5i3w_203">%% All these methods accept an Object of the instance and can edit or perform any other allowed code.</p><p id="pc5i3w_204">%% If any of the methods throw or crash, the whole transaction will rollback.</p><p id="pc5i3w_205">%% If there are any warnings or non-critical errors, it is recommended to log them with available macros, examples:</p><p id="pc5i3w_206">%% ?LOGWARNING( &quot;my warning text: ~p&quot;, [Warning] )</p><p id="pc5i3w_207">%% ?LOGERROR( &quot;my error text: ~p&quot;, [Error] )</p><p id="pc5i3w_208">%% If the methods perform well, they should return the atom 'ok'.</p><p id="pc5i3w_209">%% For more info, please refer to the documentation</p><p id="pc5i3w_210">%%-------------------------------------------------------</p><p id="pc5i3w_211">-module(fp_prototype_MyProto1).</p><p id="pc5i3w_212">-include(&quot;fp_struct.hrl&quot;).</p><p id="pc5i3w_213">-export([</p><p id="pc5i3w_214"><code class="code" id="pc5i3w_340"></code> on_create/1,</p><p id="pc5i3w_215"><code class="code" id="pc5i3w_341"></code> on_delete/1,</p><p id="pc5i3w_216"><code class="code" id="pc5i3w_342"></code> on_edit/1</p><p id="pc5i3w_217">]).</p><p id="pc5i3w_218">on_create(Object) -&gt;</p><p id="pc5i3w_219"><code class="code" id="pc5i3w_343"></code> io:format(&quot;Instance of MyProto1 created: <span id="pc5i3w_344"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="pc5i3w_220"><code class="code" id="pc5i3w_345"></code> ok.</p><p id="pc5i3w_221">on_edit(Object) -&gt;</p><p id="pc5i3w_222"><code class="code" id="pc5i3w_346"></code> io:format(&quot;Fields of MyProto1 instance edited: <span id="pc5i3w_347"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="pc5i3w_223"><code class="code" id="pc5i3w_348"></code> ok.</p><p id="pc5i3w_224">on_delete(Object) -&gt;</p><p id="pc5i3w_225"><code class="code" id="pc5i3w_349"></code> io:format(&quot;Instance of MyProto1 deleted: <span id="pc5i3w_350"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="pc5i3w_226"><code class="code" id="pc5i3w_351"></code> ok.</p><p id="pc5i3w_227">Этот скрипт реализует три метода: on_create, on_edit и on_delete, которые вызываются при создании, изменении и удалении экземпляра прототипа соответственно. В данном примере эти методы просто выводят сообщение в консоль, указывая на то, что произошло с экземпляром. Вы можете дополнить их логикой, соответствующей вашим требованиям.</p><p id="pc5i3w_228"><span class="control" id="pc5i3w_352">Пример 2:</span></p><p id="pc5i3w_229">Давайте расширим последний скрипт для работы с прототипом, представляющим конкретное устройство. Для примера давайте предположим, что у нас есть прототип устройства, представляющего насос, и мы хотим, чтобы наш скрипт выполнял определенные действия в зависимости от состояния этого насоса.</p><p id="pc5i3w_230">%%-------------------------------------------------------</p><p id="pc5i3w_231">%% This script is executed at the server side. The programming language</p><p id="pc5i3w_232">%% is Erlang.</p><p id="pc5i3w_233">%% The module MUST export next 3 methods:</p><p id="pc5i3w_234">%% * on_create/1 - this method is called when a new instance of the prototype is created.</p><p id="pc5i3w_235">%% * on_edit/1 - this method is called when own fields of an instance of the prototype are edited</p><p id="pc5i3w_236">%% * on_delete/1 - this method is called when an instance of the prototype is deleted</p><p id="pc5i3w_237">%% All these methods accept an Object of the instance and can edit or perform any other allowed code.</p><p id="pc5i3w_238">%% If any of the methods throw or crash, the whole transaction will rollback.</p><p id="pc5i3w_239">%% If there are any warnings or non-critical errors, it is recommended to log them with available macros, examples:</p><p id="pc5i3w_240">%% ?LOGWARNING( &quot;my warning text: ~p&quot;, [Warning] )</p><p id="pc5i3w_241">%% ?LOGERROR( &quot;my error text: ~p&quot;, [Error] )</p><p id="pc5i3w_242">%% If the methods perform well, they should return the atom 'ok'.</p><p id="pc5i3w_243">%% For more info, please refer to the documentation</p><p id="pc5i3w_244">%%-------------------------------------------------------</p><p id="pc5i3w_245">-module(fp_prototype_Pump).</p><p id="pc5i3w_246">-include(&quot;fp_struct.hrl&quot;).</p><p id="pc5i3w_247">-export([</p><p id="pc5i3w_248"><code class="code" id="pc5i3w_353"></code> on_create/1,</p><p id="pc5i3w_249"><code class="code" id="pc5i3w_354"></code> on_delete/1,</p><p id="pc5i3w_250"><code class="code" id="pc5i3w_355"></code> on_edit/1</p><p id="pc5i3w_251">]).</p><p id="pc5i3w_252">-define(PUMP_STATE_NORMAL, 0).</p><p id="pc5i3w_253">-define(PUMP_STATE_WARNING, 1).</p><p id="pc5i3w_254">-define(PUMP_STATE_ERROR, 2).</p><p id="pc5i3w_255">on_create(Object) -&gt;</p><p id="pc5i3w_256"><code class="code" id="pc5i3w_356"></code> io:format(&quot;Pump instance created: <span id="pc5i3w_357"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="pc5i3w_257"><code class="code" id="pc5i3w_358"></code> ok.</p><p id="pc5i3w_258">on_edit(Object) -&gt;</p><p id="pc5i3w_259">% Проверяем состояние насоса и выполняем соответствующие действия</p><p id="pc5i3w_260"><code class="code" id="pc5i3w_359"></code> case Object#pump.state of</p><p id="pc5i3w_261"><code class="code" id="pc5i3w_360"></code> ?PUMP_STATE_NORMAL -&gt;</p><p id="pc5i3w_262"><code class="code" id="pc5i3w_361"></code> io:format(&quot;Pump is in normal state: <span id="pc5i3w_362"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="pc5i3w_263"><code class="code" id="pc5i3w_363"></code> ok;</p><p id="pc5i3w_264"><code class="code" id="pc5i3w_364"></code> ?PUMP_STATE_WARNING -&gt;</p><p id="pc5i3w_265"><code class="code" id="pc5i3w_365"></code> io:format(&quot;Pump is in warning state: <span id="pc5i3w_366"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="pc5i3w_266"><code class="code" id="pc5i3w_367"></code> ok;</p><p id="pc5i3w_267"><code class="code" id="pc5i3w_368"></code> ?PUMP_STATE_ERROR -&gt;</p><p id="pc5i3w_268"><code class="code" id="pc5i3w_369"></code> io:format(&quot;Pump is in error state: <span id="pc5i3w_370"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="pc5i3w_269"><code class="code" id="pc5i3w_371"></code> ok</p><p id="pc5i3w_270">end.</p><p id="pc5i3w_271">on_delete(Object) -&gt;</p><p id="pc5i3w_272"><code class="code" id="pc5i3w_372"></code> io:format(&quot;Pump instance deleted: <span id="pc5i3w_373"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="pc5i3w_273"><code class="code" id="pc5i3w_374"></code> ok.</p><p id="pc5i3w_274">Этот скрипт добавляет обработку состояния насоса в методе on_edit. В зависимости от состояния насоса он выводит соответствующее сообщение в консоль. Вы можете дополнить скрипт логикой обработки состояний насоса, включая отправку уведомлений, запись в журнал или выполнение дополнительных действий.</p><p id="pc5i3w_275"><span class="control" id="pc5i3w_375">Пример 3:</span></p><p id="pc5i3w_276">Прототипы в SCADA-системах часто имеют набор полей, которые определяют их свойства и характеристики. Для дать определение прототипа на основании этого, мы можем добавить определение полей в Erlang-модуль прототипа. Вот пример определения прототипа на основании всего выше перечисленного:</p><p id="pc5i3w_277">%%--------------------------------------------------------</p><p id="pc5i3w_278">%% This script is executed at the server side. The programming language</p><p id="pc5i3w_279">%% is Erlang.</p><p id="pc5i3w_280">%% The module MUST export next 3 methods:</p><p id="pc5i3w_281">%% * on_create/1 - this method is called when a new instance of the prototype is created.</p><p id="pc5i3w_282">%% * on_edit/1 - this method is called when own fields of an instance of the prototype are edited</p><p id="pc5i3w_283">%% * on_delete/1 - this method is called when an instance of the prototype is deleted</p><p id="pc5i3w_284">%% All these methods accept an Object of the instance and can edit or perform any other allowed code.</p><p id="pc5i3w_285">%% If any of the methods throw or crash, the whole transaction will rollback.</p><p id="pc5i3w_286">%% If there are any warnings or non-critical errors, it is recommended to log them with available macros, examples:</p><p id="pc5i3w_287">%% ?LOGWARNING( &quot;my warning text: ~p&quot;, [Warning] )</p><p id="pc5i3w_288">%% ?LOGERROR( &quot;my error text: ~p&quot;, [Error] )</p><p id="pc5i3w_289">%% If the methods perform well, they should return the atom 'ok'.</p><p id="pc5i3w_290">%% For more info, please refer to the documentation</p><p id="pc5i3w_291">%%--------------------------------------------------------</p><p id="pc5i3w_292">-module(fp_prototype_Pump).</p><p id="pc5i3w_293">-include(&quot;fp_struct.hrl&quot;).</p><p id="pc5i3w_294">-export([</p><p id="pc5i3w_295"><code class="code" id="pc5i3w_376"></code> on_create/1,</p><p id="pc5i3w_296"><code class="code" id="pc5i3w_377"></code> on_delete/1,</p><p id="pc5i3w_297"><code class="code" id="pc5i3w_378"></code> on_edit/1</p><p id="pc5i3w_298">]).</p><p id="pc5i3w_299">-record(pump, {</p><p id="pc5i3w_300"><code class="code" id="pc5i3w_379"></code> id :: string(),</p><p id="pc5i3w_301"><code class="code" id="pc5i3w_380"></code> name :: string(),</p><p id="pc5i3w_302"><code class="code" id="pc5i3w_381"></code> type :: string(),</p><p id="pc5i3w_303"><code class="code" id="pc5i3w_382"></code> state :: integer()</p><p id="pc5i3w_304">}).</p><p id="pc5i3w_305">-define(PUMP_STATE_NORMAL, 0).</p><p id="pc5i3w_306">-define(PUMP_STATE_WARNING, 1).</p><p id="pc5i3w_307">-define(PUMP_STATE_ERROR, 2).</p><p id="pc5i3w_308">on_create(Object) -&gt;</p><p id="pc5i3w_309"><code class="code" id="pc5i3w_383"></code> io:format(&quot;Pump instance created: <span id="pc5i3w_384"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="pc5i3w_310"><code class="code" id="pc5i3w_385"></code> ok.</p><p id="pc5i3w_311">on_edit(Object) -&gt;</p><p id="pc5i3w_312">% Проверяем состояние насоса и выполняем соответствующие действия</p><p id="pc5i3w_313"><code class="code" id="pc5i3w_386"></code> case Object#pump.state of</p><p id="pc5i3w_314"><code class="code" id="pc5i3w_387"></code> ?PUMP_STATE_NORMAL -&gt;</p><p id="pc5i3w_315"><code class="code" id="pc5i3w_388"></code> io:format(&quot;Pump is in normal state: <span id="pc5i3w_389"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="pc5i3w_316"><code class="code" id="pc5i3w_390"></code> ok;</p><p id="pc5i3w_317"><code class="code" id="pc5i3w_391"></code> ?PUMP_STATE_WARNING -&gt;</p><p id="pc5i3w_318"><code class="code" id="pc5i3w_392"></code> io:format(&quot;Pump is in warning state: <span id="pc5i3w_393"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="pc5i3w_319"><code class="code" id="pc5i3w_394"></code> ok;</p><p id="pc5i3w_320"><code class="code" id="pc5i3w_395"></code> ?PUMP_STATE_ERROR -&gt;</p><p id="pc5i3w_321"><code class="code" id="pc5i3w_396"></code> io:format(&quot;Pump is in error state: <span id="pc5i3w_397"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="pc5i3w_322"><code class="code" id="pc5i3w_398"></code> ok</p><p id="pc5i3w_323">end.</p><p id="pc5i3w_324">on_delete(Object) -&gt;</p><p id="pc5i3w_325"><code class="code" id="pc5i3w_399"></code> io:format(&quot;Pump instance deleted: <span id="pc5i3w_400"><sub class="subscript">p</sub></span>n&quot;, [Object]),</p><p id="pc5i3w_326"><code class="code" id="pc5i3w_401"></code> ok.</p><p id="pc5i3w_327">В этом примере добавлено определение полей прототипа pump, включая id, name, type и state. Для каждого поля указан тип данных. Теперь прототип насоса имеет определенную структуру данных, которая позволяет представлять его свойства и характеристики.</p><section class="chapter"><h3 id="3-json-iot" data-toc="3-json-iot"><a name=""></a><span class="control" id="pc5i3w_405">3. Обработка валидных JSON-данных для IoT-соединений</span></h3><p id="pc5i3w_403">JSON-шаблоны играют ключевую роль в передаче данных между SCADA-системой и внешними системами в контексте IIoT. С помощью JSON-шаблонов можно получать данные с датчиков, отправлять команды управления и запросы на получение исторических данных.</p></section><section class="chapter"><h3 id="3-1-json" data-toc="3-1-json"><a name=""></a><span class="control" id="pc5i3w_532">3.1 Json-шаблоны</span></h3><p id="pc5i3w_407">JSON (JavaScript Object Notation) - это легкий формат обмена данными, который широко используется для передачи структурированной информации между приложениями. В контексте IIoT-платформы, JSON-шаблоны играют ключевую роль в обмене данными с внешними системами. Вот как их создавать, использовать и примеры их применения:</p><p id="pc5i3w_408"><span class="emphasis" id="pc5i3w_533">Создание JSON-шаблонов:</span></p><p id="pc5i3w_409">&bull; Определите структуру данных: Прежде всего, определите, какие данные вы хотите передавать или получать. Разбейте их на логические блоки или объекты.</p><p id="pc5i3w_410">&bull; Определите ключи и значения: Для каждого блока данных определите ключи и соответствующие значения. Ключи представляют собой названия атрибутов, а значения - сами данные.</p><p id="pc5i3w_411">&bull; Следуйте синтаксису JSON: Убедитесь, что ваш JSON-шаблон соответствует синтаксису JSON. Он должен состоять из пар &quot;ключ: значение&quot;, разделенных запятыми, и ограниченных фигурными скобками для объектов.</p><p id="pc5i3w_412"><span class="emphasis" id="pc5i3w_534">Использование JSON-шаблонов:</span></p><p id="pc5i3w_413">&bull; Прием данных: Для приема данных из внешних систем, IIoT-платформа считывает JSON-шаблон, а затем обрабатывает полученные данные в соответствии с вашей логикой (скриптом).</p><p id="pc5i3w_414">&bull; Отправка данных: Для отправки данных во внешние системы, сначала сформируйте JSON-шаблон в соответствии с требованиями внешней системы, затем отправьте его через соответствующий канал связи.</p><p id="pc5i3w_415"><span class="emphasis" id="pc5i3w_535">Использование различных структур данных в JSON-шаблонах.</span></p><p id="pc5i3w_416">Синтаксис JSON-шаблонов для IIoT-платформ может быть таким же, как и для обычных JSON-данных.</p><p id="pc5i3w_417">В качестве значений в JSON-шаблонах могут передаваться как простые типы данных (переменные), так и массивы, и другие более сложные типы.</p><p id="pc5i3w_418">Примеры типов данных, которые могут быть использованы в JSON-шаблонах IIoT-платформ:</p><p id="pc5i3w_419">a) Массивы (Arrays):</p><p id="pc5i3w_420">{</p><p id="pc5i3w_421"><code class="code" id="pc5i3w_536"></code> &quot;sensorData&quot;: {</p><p id="pc5i3w_422"><code class="code" id="pc5i3w_537"></code> &quot;temperatures&quot;: [25.5, 26.1, 24.8],</p><p id="pc5i3w_423"><code class="code" id="pc5i3w_538"></code> &quot;humidities&quot;: [60, 62, 58]</p><p id="pc5i3w_424"><code class="code" id="pc5i3w_539"></code>}</p><p id="pc5i3w_425">}</p><p id="pc5i3w_426">b) Объекты (Objects):</p><p id="pc5i3w_427">{</p><p id="pc5i3w_428"><code class="code" id="pc5i3w_540"></code> &quot;sensorData&quot;: {</p><p id="pc5i3w_429"><code class="code" id="pc5i3w_541"></code> &quot;location&quot;: {</p><p id="pc5i3w_430"><code class="code" id="pc5i3w_542"></code> &quot;latitude&quot;: 40.7128,</p><p id="pc5i3w_431"><code class="code" id="pc5i3w_543"></code> &quot;longitude&quot;: -74.0060</p><p id="pc5i3w_432"><code class="code" id="pc5i3w_544"></code>}</p><p id="pc5i3w_433"><code class="code" id="pc5i3w_545"></code>}</p><p id="pc5i3w_434">}</p><p id="pc5i3w_435">c) Строки (Strings), Числа (Numbers), Логические значения (Boolean):</p><p id="pc5i3w_436">{</p><p id="pc5i3w_437"><code class="code" id="pc5i3w_546"></code> &quot;equipmentStatus&quot;: {</p><p id="pc5i3w_438"><code class="code" id="pc5i3w_547"></code> &quot;pump1&quot;: true,</p><p id="pc5i3w_439"><code class="code" id="pc5i3w_548"></code> &quot;pump2&quot;: false,</p><p id="pc5i3w_440"><code class="code" id="pc5i3w_549"></code> &quot;errorCode&quot;: 123,</p><p id="pc5i3w_441"><code class="code" id="pc5i3w_550"></code> &quot;message&quot;: &quot;Pump overheating&quot;</p><p id="pc5i3w_442"><code class="code" id="pc5i3w_551"></code>}</p><p id="pc5i3w_443">}</p><p id="pc5i3w_444">d) Null-значения (Null):</p><p id="pc5i3w_445">{</p><p id="pc5i3w_446"><code class="code" id="pc5i3w_552"></code> &quot;configuration&quot;: {</p><p id="pc5i3w_447"><code class="code" id="pc5i3w_553"></code> &quot;timeout&quot;: null</p><p id="pc5i3w_448"><code class="code" id="pc5i3w_554"></code>}</p><p id="pc5i3w_449">}</p><p id="pc5i3w_450">e) Вложенные структуры (Nested Structures):</p><p id="pc5i3w_451">{</p><p id="pc5i3w_452"><code class="code" id="pc5i3w_555"></code> &quot;productionData&quot;: {</p><p id="pc5i3w_453"><code class="code" id="pc5i3w_556"></code> &quot;line1&quot;: {</p><p id="pc5i3w_454"><code class="code" id="pc5i3w_557"></code> &quot;output&quot;: 500,</p><p id="pc5i3w_455"><code class="code" id="pc5i3w_558"></code> &quot;defects&quot;: [&quot;Scratch&quot;, &quot;Crack&quot;]</p><p id="pc5i3w_456"><code class="code" id="pc5i3w_559"></code>},</p><p id="pc5i3w_457"><code class="code" id="pc5i3w_560"></code> &quot;line2&quot;: {</p><p id="pc5i3w_458"><code class="code" id="pc5i3w_561"></code> &quot;output&quot;: 600,</p><p id="pc5i3w_459"><code class="code" id="pc5i3w_562"></code> &quot;defects&quot;: [&quot;Chip&quot;]</p><p id="pc5i3w_460"><code class="code" id="pc5i3w_563"></code>}</p><p id="pc5i3w_461"><code class="code" id="pc5i3w_564"></code>}</p><p id="pc5i3w_462">}</p><p id="pc5i3w_463"><span class="emphasis" id="pc5i3w_565">Примеры использования JSON-шаблонов:</span></p><p id="pc5i3w_464">a) Пример JSON-данных для передачи данных о температуре и влажности с датчиков в IIoT-платформу:</p><p id="pc5i3w_465">{</p><p id="pc5i3w_466"><code class="code" id="pc5i3w_566"></code> &quot;sensorData&quot;: {</p><p id="pc5i3w_467"><code class="code" id="pc5i3w_567"></code> &quot;temperature&quot;: 25.5,</p><p id="pc5i3w_468"><code class="code" id="pc5i3w_568"></code> &quot;humidity&quot;: 60</p><p id="pc5i3w_469"><code class="code" id="pc5i3w_569"></code>}</p><p id="pc5i3w_470">}</p><p id="pc5i3w_471">b) Пример JSON-данных для управления устройством через IIoT-платформу:</p><p id="pc5i3w_472">{</p><p id="pc5i3w_473"><code class="code" id="pc5i3w_570"></code> &quot;deviceControl&quot;: {</p><p id="pc5i3w_474"><code class="code" id="pc5i3w_571"></code> &quot;deviceId&quot;: &quot;123456&quot;,</p><p id="pc5i3w_475"><code class="code" id="pc5i3w_572"></code> &quot;command&quot;: &quot;on&quot;</p><p id="pc5i3w_476"><code class="code" id="pc5i3w_573"></code>}</p><p id="pc5i3w_477">}</p><p id="pc5i3w_478">c) Пример JSON-данных для получения данных о состоянии оборудования из IIoT-платформы:</p><p id="pc5i3w_479">{</p><p id="pc5i3w_480"><code class="code" id="pc5i3w_574"></code> &quot;equipmentStatus&quot;: {</p><p id="pc5i3w_481"><code class="code" id="pc5i3w_575"></code> &quot;pump1&quot;: &quot;running&quot;,</p><p id="pc5i3w_482"><code class="code" id="pc5i3w_576"></code> &quot;pump2&quot;: &quot;stopped&quot;</p><p id="pc5i3w_483"><code class="code" id="pc5i3w_577"></code>}</p><p id="pc5i3w_484">}</p><p id="pc5i3w_485">d) Пример JSON-данных для передачи данных о производственных параметрах:</p><p id="pc5i3w_486">{</p><p id="pc5i3w_487"><code class="code" id="pc5i3w_578"></code> &quot;productionData&quot;: {</p><p id="pc5i3w_488"><code class="code" id="pc5i3w_579"></code> &quot;machineId&quot;: &quot;123&quot;,</p><p id="pc5i3w_489"><code class="code" id="pc5i3w_580"></code> &quot;temperature&quot;: 180,</p><p id="pc5i3w_490"><code class="code" id="pc5i3w_581"></code> &quot;pressure&quot;: 45,</p><p id="pc5i3w_491"><code class="code" id="pc5i3w_582"></code> &quot;output&quot;: 500</p><p id="pc5i3w_492"><code class="code" id="pc5i3w_583"></code>}</p><p id="pc5i3w_493">}</p><p id="pc5i3w_494">e) Пример JSON-данных для управления режимами работы оборудования:</p><p id="pc5i3w_495">{</p><p id="pc5i3w_496"><code class="code" id="pc5i3w_584"></code> &quot;equipmentControl&quot;: {</p><p id="pc5i3w_497"><code class="code" id="pc5i3w_585"></code> &quot;deviceId&quot;: &quot;789&quot;,</p><p id="pc5i3w_498"><code class="code" id="pc5i3w_586"></code> &quot;mode&quot;: &quot;manual&quot;,</p><p id="pc5i3w_499"><code class="code" id="pc5i3w_587"></code> &quot;settings&quot;: {</p><p id="pc5i3w_500"><code class="code" id="pc5i3w_588"></code> &quot;speed&quot;: 50,</p><p id="pc5i3w_501"><code class="code" id="pc5i3w_589"></code> &quot;temperatureSetpoint&quot;: 200</p><p id="pc5i3w_502"><code class="code" id="pc5i3w_590"></code>}</p><p id="pc5i3w_503"><code class="code" id="pc5i3w_591"></code>}</p><p id="pc5i3w_504">}</p><p id="pc5i3w_505">f) Пример JSON-данных для передачи событий и аварий:</p><p id="pc5i3w_506">{</p><p id="pc5i3w_507"><code class="code" id="pc5i3w_592"></code> &quot;alarmData&quot;: {</p><p id="pc5i3w_508"><code class="code" id="pc5i3w_593"></code> &quot;alarmId&quot;: &quot;ABC123&quot;,</p><p id="pc5i3w_509"><code class="code" id="pc5i3w_594"></code> &quot;severity&quot;: &quot;high&quot;,</p><p id="pc5i3w_510"><code class="code" id="pc5i3w_595"></code> &quot;description&quot;: &quot;Critical temperature threshold exceeded&quot;,</p><p id="pc5i3w_511"><code class="code" id="pc5i3w_596"></code> &quot;timestamp&quot;: &quot;2024-05-02T10:30:00&quot;</p><p id="pc5i3w_512"><code class="code" id="pc5i3w_597"></code>}</p><p id="pc5i3w_513">}</p><p id="pc5i3w_514">g) Пример JSON-данных для запроса исторических данных:</p><p id="pc5i3w_515">{</p><p id="pc5i3w_516"><code class="code" id="pc5i3w_598"></code> &quot;historicalDataRequest&quot;: {</p><p id="pc5i3w_517"><code class="code" id="pc5i3w_599"></code> &quot;startDate&quot;: &quot;2024-04-01&quot;,</p><p id="pc5i3w_518"><code class="code" id="pc5i3w_600"></code> &quot;endDate&quot;: &quot;2024-04-30&quot;,</p><p id="pc5i3w_519"><code class="code" id="pc5i3w_601"></code> &quot;parameters&quot;: [&quot;temperature&quot;, &quot;pressure&quot;, &quot;output&quot;]</p><p id="pc5i3w_520"><code class="code" id="pc5i3w_602"></code>}</p><p id="pc5i3w_521">}</p><p id="pc5i3w_522">h) Пример JSON-данных для передачи информации о системных настройках:</p><p id="pc5i3w_523">{</p><p id="pc5i3w_524"><code class="code" id="pc5i3w_603"></code> &quot;systemSettings&quot;: {</p><p id="pc5i3w_525"><code class="code" id="pc5i3w_604"></code> &quot;samplingRate&quot;: 1000,</p><p id="pc5i3w_526"><code class="code" id="pc5i3w_605"></code> &quot;language&quot;: &quot;en&quot;,</p><p id="pc5i3w_527"><code class="code" id="pc5i3w_606"></code> &quot;timezone&quot;: &quot;UTC+3&quot;</p><p id="pc5i3w_528"><code class="code" id="pc5i3w_607"></code>}</p><p id="pc5i3w_529">}</p><section class="chapter"><h4 id="pc5i3w_530" data-toc="pc5i3w_530"></h4></section></section><section class="chapter"><h3 id="4-json" data-toc="4-json"><a name=""></a><span class="control" id="pc5i3w_649">4. Использование скриптов для обработки поступивших Json-данных</span></h3><p id="pc5i3w_609"><span class="emphasis" id="pc5i3w_650">Скрипт Erlang для обработки JSON-данных:</span></p><p id="pc5i3w_610">-module(json_handler).</p><p id="pc5i3w_611">-export([process_json/1]).</p><p id="pc5i3w_612">% Функция для обработки JSON-данных</p><p id="pc5i3w_613">process_json(JsonData) -&gt;</p><p id="pc5i3w_614">% Парсим JSON</p><p id="pc5i3w_615">{ok, Json} = jsx:decode(JsonData),</p><p id="pc5i3w_616"><code class="code" id="pc5i3w_651"></code>% Выполняем операции в зависимости от типа данных</p><p id="pc5i3w_617"><code class="code" id="pc5i3w_652"></code> case proplists:get_value(&lt;&lt;&quot;sensorData&quot;&gt;&gt;, Json) of</p><p id="pc5i3w_618"><code class="code" id="pc5i3w_653"></code> undefined -&gt;</p><p id="pc5i3w_619"><code class="code" id="pc5i3w_654"></code> io:format(&quot;Unknown JSON data: <span id="pc5i3w_655"><sub class="subscript">p</sub></span>n&quot;, [Json]);</p><p id="pc5i3w_620"><code class="code" id="pc5i3w_656"></code> SensorData -&gt;</p><p id="pc5i3w_621"><code class="code" id="pc5i3w_657"></code>% Обрабатываем данные о датчиках</p><p id="pc5i3w_622"><code class="code" id="pc5i3w_658"></code> process_sensor_data(SensorData)</p><p id="pc5i3w_623"><code class="code" id="pc5i3w_659"></code> end.</p><p id="pc5i3w_624">% Функция для обработки данных о датчиках</p><p id="pc5i3w_625">process_sensor_data(SensorData) -&gt;</p><p id="pc5i3w_626">Temperature = proplists:get_value(&lt;&lt;&quot;temperature&quot;&gt;&gt;, SensorData),</p><p id="pc5i3w_627">Humidity = proplists:get_value(&lt;&lt;&quot;humidity&quot;&gt;&gt;, SensorData),</p><p id="pc5i3w_628">io:format(&quot;Received sensor data - Temperature: ~p, Humidity: <span id="pc5i3w_660"><sub class="subscript">p</sub></span>n&quot;, [Temperature, Humidity]).</p><p id="pc5i3w_629"><span class="emphasis" id="pc5i3w_661">Скрипт JavaScript для обработки JSON-данных:</span></p><p id="pc5i3w_630">// Функция для обработки JSON-данных</p><p id="pc5i3w_631">function processJson(jsonData) {</p><p id="pc5i3w_632"><code class="code" id="pc5i3w_662"></code>// Разбираем (&quot;парсим&quot;) JSON</p><p id="pc5i3w_633"><code class="code" id="pc5i3w_663"></code> const json = JSON.parse(jsonData);</p><p id="pc5i3w_634"><code class="code" id="pc5i3w_664"></code>// Выполняем операции в зависимости от типа данных</p><p id="pc5i3w_635"><code class="code" id="pc5i3w_665"></code> if (json.sensorData) {</p><p id="pc5i3w_636"><code class="code" id="pc5i3w_666"></code>// Обрабатываем данные о датчиках</p><p id="pc5i3w_637"><code class="code" id="pc5i3w_667"></code> processSensorData(json.sensorData);</p><p id="pc5i3w_638"><code class="code" id="pc5i3w_668"></code>} else {</p><p id="pc5i3w_639"><code class="code" id="pc5i3w_669"></code> console.log(&quot;Unknown JSON data:&quot;, json);</p><p id="pc5i3w_640"><code class="code" id="pc5i3w_670"></code>}</p><p id="pc5i3w_641">}</p><p id="pc5i3w_642">// Функция для обработки данных о датчиках</p><p id="pc5i3w_643">function processSensorData(sensorData) {</p><p id="pc5i3w_644"><code class="code" id="pc5i3w_671"></code> const temperature = sensorData.temperature;</p><p id="pc5i3w_645"><code class="code" id="pc5i3w_672"></code> const humidity = sensorData.humidity;</p><p id="pc5i3w_646"><code class="code" id="pc5i3w_673"></code> console.log(<code class="code" id="pc5i3w_674">Received sensor data - Temperature: ${temperature}, Humidity: ${humidity}</code>);</p><p id="pc5i3w_647">}</p></section><section class="chapter"><h3 id="5" data-toc="5"><a name=""></a><span class="control" id="pc5i3w_696">5. Создание и настройка архивов</span></h3><p id="pc5i3w_676">Архивы предназначены для долгосрочного хранения данных в SCADA-системе. В каждом архиве можно задавать параметры, такие как периодичность записи, источник данных и глубина хранения.</p><p id="pc5i3w_677">Одним из основных элементов для создания архива является привязка, которую можно определить с помощью скрипта, что позволяет выполнять дополнительную обработку архивируемого значения (например, вычисление среднего по нескольким точкам измерения) и вычислять значения архива по нескольким входным параметрам (например, сумма показаний нескольких расходомеров); возвращаемые из скрипта значения, сохраняются в базе архивов.</p><p id="pc5i3w_678"><span class="control" id="pc5i3w_697">Пример</span> скрипта для обработки данных в архиве:</p><p id="pc5i3w_679">Сначала следует выбрать один из двух языков программирования скрипта - Erlang или Javascript. Затем ввести переменную и выбрать источник значений показателя для скрипта.</p><figure id="pc5i3w_680"><img alt="Aspose words 7e55d7ce c0e4 4a18 9a16 39bde3184163 001" src="${primarySource}" title="Aspose words 7e55d7ce c0e4 4a18 9a16 39bde3184163 001"></figure><p id="pc5i3w_681"><span class="control" id="pc5i3w_698">Пример</span> скрипта для вычисления скользящего среднего по последним 10 значениям для Erlang:</p><p id="pc5i3w_682">%% Script must be an Erlang fun of arity 2.</p><p id="pc5i3w_683">%% - VARS argument is a map that contains</p><p id="pc5i3w_684">%% values for the defined variables.</p><p id="pc5i3w_685">%% Key - variable name, Value - variable value</p><p id="pc5i3w_686">%% - State is an argument that can be used as an accumulator.</p><p id="pc5i3w_687">%% It keeps the value of the accumulator that was returned</p><p id="pc5i3w_688">%% from the previous call</p><p id="pc5i3w_689">%% The function must return a tuple:</p><p id="pc5i3w_690">%% {, }</p><p id="pc5i3w_691">%%</p><p id="pc5i3w_692">fun(VARS,_State)-&gt;</p><p id="pc5i3w_693"><code class="code" id="pc5i3w_701"></code>% Extract the current value from VARS</p><p id="pc5i3w_694"><code class="code" id="pc5i3w_702"></code> CurrentValue = maps:get(&quot;var_1&quot;, VARS, 0),</p></section></li></ul><p id="pc5i3w_16"><code class="code" id="pc5i3w_703"></code>% Initialize or update the list of last 10 values</p><p id="pc5i3w_17"><code class="code" id="pc5i3w_704"></code> ValuesList = case State of</p><p id="pc5i3w_18"><code class="code" id="pc5i3w_705"></code> undefined -&gt;</p><p id="pc5i3w_19"><code class="code" id="pc5i3w_706"></code> [CurrentValue]; % Initialize the state if it is undefined</p><p id="pc5i3w_20"><code class="code" id="pc5i3w_707"></code>_ when is_list(State) -&gt;</p><p id="pc5i3w_21"><code class="code" id="pc5i3w_708"></code> [CurrentValue | State] % Add the new value to the list</p><p id="pc5i3w_22"><code class="code" id="pc5i3w_709"></code> end,</p><p id="pc5i3w_23"><code class="code" id="pc5i3w_710"></code>% Keep only the last 10 values</p><p id="pc5i3w_24"><code class="code" id="pc5i3w_711"></code> TrimmedList = lists:sublist(ValuesList, min(length(ValuesList), 10)),</p><p id="pc5i3w_25"><code class="code" id="pc5i3w_712"></code>% Calculate the moving average</p><p id="pc5i3w_26"><code class="code" id="pc5i3w_713"></code> Avg = case TrimmedList of</p><p id="pc5i3w_27"><code class="code" id="pc5i3w_714"></code> [] -&gt;</p><p id="pc5i3w_28"><code class="code" id="pc5i3w_715"></code> 0; % Avoid division by zero</p><p id="pc5i3w_29"><code class="code" id="pc5i3w_716"></code>_ -&gt;</p><p id="pc5i3w_30"><code class="code" id="pc5i3w_717"></code> lists:sum(TrimmedList) / length(TrimmedList)</p><p id="pc5i3w_31"><code class="code" id="pc5i3w_718"></code> end,</p><p id="pc5i3w_32"><code class="code" id="pc5i3w_719"></code>% Return the calculated average and updated state</p><p id="pc5i3w_33"><code class="code" id="pc5i3w_720"></code> {Avg, TrimmedList}</p><p id="pc5i3w_34">end.</p><p id="pc5i3w_35"><span class="control" id="pc5i3w_721">Пример</span> скрипта для вычисления скользящего среднего по последним 10 значениям для Javascript:</p><p id="pc5i3w_36">// Script must be an Javascript fun of arity 2.</p><p id="pc5i3w_37">// - VARS argument is a map that contains</p><p id="pc5i3w_38">// values for the defined variables.</p><p id="pc5i3w_39">// Key - variable name, Value - variable value</p><p id="pc5i3w_40">// - State is an argument that can be used as an accumulator.</p><p id="pc5i3w_41">// It keeps the value of the accumulator that was returned</p><p id="pc5i3w_42">// from the previous call</p><p id="pc5i3w_43">// The function must return an object:</p><p id="pc5i3w_44">// { value: , state: }</p><p id="pc5i3w_45">//</p><p id="pc5i3w_46">async function(VARS, State) {</p><p id="pc5i3w_47"><code class="code" id="pc5i3w_724"></code>// Extract the current value from VARS</p><p id="pc5i3w_48"><code class="code" id="pc5i3w_725"></code> let currentValue = VARS.var_1 || 0; // Default to 0 if var_1 is undefined</p><p id="pc5i3w_49"><code class="code" id="pc5i3w_726"></code>// Initialize or update the list of the last 10 values</p><p id="pc5i3w_50"><code class="code" id="pc5i3w_727"></code> let valuesList = Array.isArray(State) ? State : []; // Ensure State is an array</p><p id="pc5i3w_51"><code class="code" id="pc5i3w_728"></code> valuesList = [currentValue, ...valuesList]; // Add the current value to the beginning</p><p id="pc5i3w_52"><code class="code" id="pc5i3w_729"></code>// Keep only the last 10 values</p><p id="pc5i3w_53"><code class="code" id="pc5i3w_730"></code> if (valuesList.length &gt; 10) {</p><p id="pc5i3w_54"><code class="code" id="pc5i3w_731"></code> valuesList = valuesList.slice(0, 10);</p><p id="pc5i3w_55"><code class="code" id="pc5i3w_732"></code>}</p><p id="pc5i3w_56"><code class="code" id="pc5i3w_733"></code>// Calculate the moving average</p><p id="pc5i3w_57"><code class="code" id="pc5i3w_734"></code> let avg = valuesList.reduce((sum, val) =&gt; sum + val, 0) / valuesList.length;</p><p id="pc5i3w_58"><code class="code" id="pc5i3w_735"></code>// Return the calculated average and updated state</p><p id="pc5i3w_59"><code class="code" id="pc5i3w_736"></code> return { value: avg, state: valuesList };</p><p id="pc5i3w_60">}</p><p id="pc5i3w_61">Для компиляции скрипта необходимо нажать кнопку <img alt="Aspose words 7e55d7ce c0e4 4a18 9a16 39bde3184163 004" src="${primarySource}" class="inline-icon-" title="Aspose words 7e55d7ce c0e4 4a18 9a16 39bde3184163 004" id="pc5i3w_737"></p><p id="pc5i3w_62">Если компиляция выполнена без ошибок, то напротив кнопки компиляции появится надпись &ldquo;ok&rdquo;, иначе будет выведен список ошибок, например:</p><figure id="pc5i3w_63"><img alt="Aspose words 7e55d7ce c0e4 4a18 9a16 39bde3184163 005" src="${primarySource}" title="Aspose words 7e55d7ce c0e4 4a18 9a16 39bde3184163 005"></figure><p id="pc5i3w_64"><span class="control" id="pc5i3w_738">Общий принцип работы:</span></p><ul class="list _bullet" id="pc5i3w_65"><li class="list__item" id="pc5i3w_739"><p id="pc5i3w_745">Система архивирования считывает значения из полей тегов, к которым привязаны объявленные переменные.</p></li><li class="list__item" id="pc5i3w_740"><p id="pc5i3w_746">Выполняется вызов скрипта с передачей на вход map со значениями переменных.</p></li><li class="list__item" id="pc5i3w_741"><p id="pc5i3w_747">Сохранение в базу архивов значений переменных, возвращаемых из скрипта.</p><section class="chapter"><h3 id="6-power-factory-fp-powerfactory-service" data-toc="6-power-factory-fp-powerfactory-service"><a name=""></a><span class="control" id="pc5i3w_753">6. Интеграция с Power Factory (fp_powerfactory_service)</span></h3><p id="pc5i3w_750">Взаимодействие между Faceplate и PowerFactory организовано через промежуточный сервис <span class="control" id="pc5i3w_754">server.py</span>, который предоставляет необходимый Json API. Передача данных между Faceplate и <span class="control" id="pc5i3w_755">server.py</span> осуществляется с использованием протокола HTTP.</p><p id="pc5i3w_751">Модуль интеграции в Faceplate выполняет следующие задачи:</p></section></li><li class="list__item" id="pc5i3w_742"><p id="pc5i3w_756">формирование и отправка json-данных в сервис <span class="control" id="pc5i3w_757">server.py</span>;</p></li><li class="list__item" id="pc5i3w_743"><p id="pc5i3w_758">обработка результатов запросов;</p></li><li class="list__item" id="pc5i3w_744"><p id="pc5i3w_759">сохранение полученных данных в базу Faceplate.</p></li></ul><p id="pc5i3w_66">Сервис server.py определяет следующие api-функции:</p><p id="pc5i3w_67"><code class="code" id="pc5i3w_760"></code> create</p><p id="pc5i3w_68"><code class="code" id="pc5i3w_761"></code> check</p><p id="pc5i3w_69"><code class="code" id="pc5i3w_762"></code> execute</p><p id="pc5i3w_70"><code class="code" id="pc5i3w_763"></code> dynamics</p><p id="pc5i3w_71"><code class="code" id="pc5i3w_764"></code> get_links</p><p id="pc5i3w_72"><code class="code" id="pc5i3w_765"></code> get_type_library</p><p id="pc5i3w_73"><code class="code" id="pc5i3w_766"></code> get</p><p id="pc5i3w_74"><code class="code" id="pc5i3w_767"></code> update</p><p id="pc5i3w_75"><code class="code" id="pc5i3w_768"></code> weightings.</p><p id="pc5i3w_76">Для каждой из этих функций предусмотрен соответствующий Json-шаблон, обеспечивающий стандартизацию запросов и их обработки.</p><p id="pc5i3w_77">В общем виде, формат отправляемого json:</p><p id="pc5i3w_78">{</p><p id="pc5i3w_79"><code class="code" id="pc5i3w_769"></code> &quot;project_params&quot;: {</p><p id="pc5i3w_80"><code class="code" id="pc5i3w_770"></code> &quot;project_name&quot;: project_name,</p><p id="pc5i3w_81"><code class="code" id="pc5i3w_771"></code> &quot;study_case_name&quot;: study_case_name,</p><p id="pc5i3w_82"><code class="code" id="pc5i3w_772"></code> &quot;operation_scenario_name&quot;: operation_scenario_name,</p><p id="pc5i3w_83"><code class="code" id="pc5i3w_773"></code> &quot;grid_name&quot;: grid_name,</p><p id="pc5i3w_84"><code class="code" id="pc5i3w_774"></code> &quot;func_name&quot;: func_name,</p><p id="pc5i3w_85"><code class="code" id="pc5i3w_775"></code> &quot;id&quot;: user_id</p><p id="pc5i3w_86"><code class="code" id="pc5i3w_776"></code> &quot;session_type&quot;: session_type</p><p id="pc5i3w_87"><code class="code" id="pc5i3w_777"></code>},</p><p id="pc5i3w_88"><code class="code" id="pc5i3w_778"></code> pf_element_1_typename: pf_element_1_params</p><p id="pc5i3w_89"><code class="code" id="pc5i3w_779"></code> pf_element_2_typename: pf_element_2_params</p><p id="pc5i3w_90">...</p><p id="pc5i3w_91"><code class="code" id="pc5i3w_780"></code> pf_element_N_typename: pf_element_N_params</p><p id="pc5i3w_92">}</p><p id="pc5i3w_93">Объект project_params содержит параметры проекта PowerFactory, для которого выполняется запрос, а также название выполняемой функции.</p><p id="pc5i3w_94">Поля pf_element_1_typename, pf_element_2_typename, pf_element_N_typename соответствуют названиям типов элементов в PowerFactory, используемых для расчетов, либо для загрузки/выгрузки данных в PowerFactory.</p><p id="pc5i3w_95">В объектах pf_element_1_params, pf_element_2_params, pf_element_N_params находятся данные самих объектов соответствующих типов, необходимые для соответствующей функции.</p><p id="pc5i3w_96">Например:</p><p id="pc5i3w_97"><code class="code" id="pc5i3w_781"></code> &quot;ElmTr3&quot;: {</p><p id="pc5i3w_98"><code class="code" id="pc5i3w_782"></code> &quot;Grid\KAZ\ZAPAD\Kulsary/220/AT2&quot;: {</p><p id="pc5i3w_99"><code class="code" id="pc5i3w_783"></code> &quot;links&quot;: {</p><p id="pc5i3w_100"><code class="code" id="pc5i3w_784"></code> &quot;busmv&quot;: &quot;none&quot;,</p><p id="pc5i3w_101"><code class="code" id="pc5i3w_785"></code> &quot;buslv&quot;: &quot;Grid\KAZ\ZAPAD\Kulsary/110/AT2 term&quot;,</p><p id="pc5i3w_102"><code class="code" id="pc5i3w_786"></code> &quot;bushv&quot;: &quot;Grid\KAZ\ZAPAD\Kulsary/220/AT2/term&quot;</p><p id="pc5i3w_103"><code class="code" id="pc5i3w_787"></code>}</p><p id="pc5i3w_104"><code class="code" id="pc5i3w_788"></code>},</p><p id="pc5i3w_105"><code class="code" id="pc5i3w_789"></code> &quot;Grid\KAZ\ALMATY\SHU/220/AT1&quot;: {</p><p id="pc5i3w_106"><code class="code" id="pc5i3w_790"></code> &quot;links&quot;: {</p><p id="pc5i3w_107"><code class="code" id="pc5i3w_791"></code> &quot;busmv&quot;: &quot;none&quot;,</p><p id="pc5i3w_108"><code class="code" id="pc5i3w_792"></code> &quot;buslv&quot;: &quot;Grid\KAZ\ALMATY\SHU/110/AT1 term&quot;,</p><p id="pc5i3w_109"><code class="code" id="pc5i3w_793"></code> &quot;bushv&quot;: &quot;Grid\KAZ\ALMATY\SHU/220/AT1/term&quot;</p><p id="pc5i3w_110"><code class="code" id="pc5i3w_794"></code>}</p><p id="pc5i3w_111"><code class="code" id="pc5i3w_795"></code>},</p></section><section class="chapter"><h2 id="6-1" data-toc="6-1"><a name=""></a><span class="control" id="pc5i3w_927">6.1 Файл настроек</span></h2><p id="pc5i3w_797">Для формирования соответствующего json, на стороне fp_powerfactory_service (см. Приложение А.8) используется файл настроек, находящийся в приватной директории модуля:</p><p id="pc5i3w_798">../lib/fp_powerfactory_service/priv/fp2pf_mapping.json.</p><p id="pc5i3w_799">В данном файле определяются функции, типы объектов powerfactory, с которыми работают функции и маппинг полей прототипов faceplate на атрибуты соответствующих классов объектов в PowerFactory:</p><p id="pc5i3w_800">\1) Маппинг полей прототипов faceplate на атрибуты соответствующих классов объектов в PowerFactory определяется в разделе &quot;_elements&quot; настроечного файла\.</p><p id="pc5i3w_801">Пример:</p><p id="pc5i3w_802">&quot;ElmLne&quot;: {</p><p id="pc5i3w_803"><code class="code" id="pc5i3w_928"></code> &quot;_prototype&quot;: &quot;line&quot;,</p><p id="pc5i3w_804"><code class="code" id="pc5i3w_929"></code> &quot;$path&quot;: {</p><p id="pc5i3w_805"><code class="code" id="pc5i3w_930"></code> &quot;pf_attr&quot;: {</p><p id="pc5i3w_806"><code class="code" id="pc5i3w_931"></code> &quot;_field&quot;: &quot;pf_attr&quot;</p><p id="pc5i3w_807"><code class="code" id="pc5i3w_932"></code>},</p><p id="pc5i3w_808"><code class="code" id="pc5i3w_933"></code> &quot;params&quot;: {</p><p id="pc5i3w_809"><code class="code" id="pc5i3w_934"></code> &quot;outserv&quot;: {</p><p id="pc5i3w_810"><code class="code" id="pc5i3w_935"></code> &quot;_field&quot;: &quot;pf_outserv&quot;</p><p id="pc5i3w_811"><code class="code" id="pc5i3w_936"></code>}</p><p id="pc5i3w_812"><code class="code" id="pc5i3w_937"></code>},</p><p id="pc5i3w_813"><code class="code" id="pc5i3w_938"></code> &quot;links&quot;: {</p><p id="pc5i3w_814"><code class="code" id="pc5i3w_939"></code> &quot;bus1&quot;: {</p><p id="pc5i3w_815"><code class="code" id="pc5i3w_940"></code> &quot;_field&quot;: &quot;pole_i&quot;</p><p id="pc5i3w_816"><code class="code" id="pc5i3w_941"></code>},</p><p id="pc5i3w_817"><code class="code" id="pc5i3w_942"></code> &quot;bus2&quot;: {</p><p id="pc5i3w_818"><code class="code" id="pc5i3w_943"></code> &quot;_field&quot;: &quot;pole_j&quot;</p><p id="pc5i3w_819"><code class="code" id="pc5i3w_944"></code>}</p><p id="pc5i3w_820"><code class="code" id="pc5i3w_945"></code>},</p><p id="pc5i3w_821"><code class="code" id="pc5i3w_946"></code> &quot;results&quot;: {</p><p id="pc5i3w_822"><code class="code" id="pc5i3w_947"></code> &quot;m:P:bus1&quot;: {</p><p id="pc5i3w_823"><code class="code" id="pc5i3w_948"></code> &quot;_field&quot;: &quot;pf_m_P_bus1&quot;</p><p id="pc5i3w_824"><code class="code" id="pc5i3w_949"></code>},</p><p id="pc5i3w_825"><code class="code" id="pc5i3w_950"></code> &quot;m:P:bus2&quot;: {</p><p id="pc5i3w_826"><code class="code" id="pc5i3w_951"></code> &quot;_field&quot;: &quot;pf_m_P_bus2&quot;</p><p id="pc5i3w_827"><code class="code" id="pc5i3w_952"></code>},</p><p id="pc5i3w_828"><code class="code" id="pc5i3w_953"></code> &quot;m:Q:bus1&quot;: {</p><p id="pc5i3w_829"><code class="code" id="pc5i3w_954"></code> &quot;_field&quot;: &quot;pf_m_Q_bus1&quot;</p><p id="pc5i3w_830"><code class="code" id="pc5i3w_955"></code>},</p><p id="pc5i3w_831"><code class="code" id="pc5i3w_956"></code> &quot;m:Q:bus2&quot;: {</p><p id="pc5i3w_832"><code class="code" id="pc5i3w_957"></code> &quot;_field&quot;: &quot;pf_m_Q_bus2&quot;</p><p id="pc5i3w_833"><code class="code" id="pc5i3w_958"></code>},</p><p id="pc5i3w_834"><code class="code" id="pc5i3w_959"></code> &quot;c:loading&quot;: {</p><p id="pc5i3w_835"><code class="code" id="pc5i3w_960"></code> &quot;_field&quot;: &quot;pf_c_loading&quot;</p><p id="pc5i3w_836"><code class="code" id="pc5i3w_961"></code>}</p><p id="pc5i3w_837"><code class="code" id="pc5i3w_962"></code>}</p><p id="pc5i3w_838"><code class="code" id="pc5i3w_963"></code>}</p><p id="pc5i3w_839">}</p><p id="pc5i3w_840">....</p><p id="pc5i3w_841">Представленный выше фрагмент настроечного json-файла определяет структуру json и позволяет получить json вида:</p><p id="pc5i3w_842">&quot;ElmLne&quot;: {</p><p id="pc5i3w_843"><code class="code" id="pc5i3w_964"></code> &quot;Grid\KAZ\CENTER\@lines/L2378/lineB&quot;: {</p><p id="pc5i3w_844"><code class="code" id="pc5i3w_965"></code> &quot;pf_attr&quot;: null</p><p id="pc5i3w_845"><code class="code" id="pc5i3w_966"></code> &quot;params&quot;: {</p><p id="pc5i3w_846"><code class="code" id="pc5i3w_967"></code> &quot;outserv&quot;: null</p><p id="pc5i3w_847"><code class="code" id="pc5i3w_968"></code>},</p><p id="pc5i3w_848"><code class="code" id="pc5i3w_969"></code> &quot;links&quot;: {</p><p id="pc5i3w_849"><code class="code" id="pc5i3w_970"></code> &quot;bus1&quot;: &quot;Grid\KAZ\CENTER\Karajal\220/L2378&quot;,</p><p id="pc5i3w_850"><code class="code" id="pc5i3w_971"></code> &quot;bus2&quot;: &quot;Grid\KAZ\CENTER\Jezkaz_TEC\220/L2378&quot;</p><p id="pc5i3w_851"><code class="code" id="pc5i3w_972"></code>},</p><p id="pc5i3w_852"><code class="code" id="pc5i3w_973"></code> &quot;results&quot;: {</p><p id="pc5i3w_853"><code class="code" id="pc5i3w_974"></code> &quot;m:P:bus1&quot;: null,</p><p id="pc5i3w_854"><code class="code" id="pc5i3w_975"></code> &quot;m:P:bus2&quot;: null,</p><p id="pc5i3w_855"><code class="code" id="pc5i3w_976"></code> &quot;m:Q:bus1&quot;: null</p><p id="pc5i3w_856"><code class="code" id="pc5i3w_977"></code> &quot;m:Q:bus2&quot;: null</p><p id="pc5i3w_857"><code class="code" id="pc5i3w_978"></code> &quot;c:loading&quot;: null</p><p id="pc5i3w_858"><code class="code" id="pc5i3w_979"></code>}</p><p id="pc5i3w_859"><code class="code" id="pc5i3w_980"></code>}</p><p id="pc5i3w_860">}</p><p id="pc5i3w_861">Поля с префиксом _ в файле настроек являются служебными и не включаются в результирующую структуру json.</p><p id="pc5i3w_862">Поле &quot;_prototype&quot; в файле настроек определяет прототип faceplate, соответствующий вышестоящему элементу.</p><p id="pc5i3w_863">Поле &quot;_field&quot; в файле настроек, определяет поле прототипа faceplate, значение которого для соответствующего объекта будет записано в результирующий json.</p><p id="pc5i3w_864">Если значение необходимо получить не из самого объекта прототипа, а из вложенного объекта - на одном уровне с служебным полем &quot;_field&quot; следует добавить служебное поле &quot;_path&quot;, значение которого должно содержать относительный путь до вложенного объекта.</p><p id="pc5i3w_865">Поле &quot;$path&quot; в файле настроек, в результирующей структуре заменяется на путь к соответствующему объекту.</p><p id="pc5i3w_866">Для некоторых типов объектов PowerFactory в настроечном файле может быть не указано поле &quot;$path&quot;, например:</p><p id="pc5i3w_867">&quot;ComLdf&quot;: {</p><p id="pc5i3w_868"><code class="code" id="pc5i3w_981"></code> &quot;_prototype&quot;: &quot;PowerFactory_ComLdf&quot;,</p><p id="pc5i3w_869"><code class="code" id="pc5i3w_982"></code> &quot;params&quot;: {</p><p id="pc5i3w_870"><code class="code" id="pc5i3w_983"></code> &quot;_field&quot;: &quot;params&quot;</p><p id="pc5i3w_871"><code class="code" id="pc5i3w_984"></code>},</p><p id="pc5i3w_872"><code class="code" id="pc5i3w_985"></code> &quot;status&quot;: {</p><p id="pc5i3w_873"><code class="code" id="pc5i3w_986"></code> &quot;_field&quot;: &quot;status&quot;</p><p id="pc5i3w_874"><code class="code" id="pc5i3w_987"></code>}</p><p id="pc5i3w_875">},</p><p id="pc5i3w_876">В таком случае, при вызове функции запроса в PowerFactory необходимо указывать OID объекта прототипа (в данном случае, PowerFactory_ComLdf), данные которого нужно передать (см. Приложение А.8).</p><p id="pc5i3w_877">Если требуется сформировать json из данных каталога faceplate, то в файле настроек вместо служебного поля &quot;_prototype&quot;, нужно использовать поле &quot;_catalog&quot;, указав имя каталога, например:</p><p id="pc5i3w_878">&quot;TypLne&quot;: {</p><p id="pc5i3w_879"><code class="code" id="pc5i3w_988"></code> &quot;_catalog&quot;: &quot;equipment_types\TypLne&quot;,</p><p id="pc5i3w_880"><code class="code" id="pc5i3w_989"></code> &quot;$path&quot;: {</p><p id="pc5i3w_881"><code class="code" id="pc5i3w_990"></code> &quot;params&quot;: {</p><p id="pc5i3w_882"><code class="code" id="pc5i3w_991"></code> &quot;name&quot;: {</p><p id="pc5i3w_883"><code class="code" id="pc5i3w_992"></code> &quot;_field&quot;: &quot;.name&quot;</p><p id="pc5i3w_884"><code class="code" id="pc5i3w_993"></code>},</p><p id="pc5i3w_885"><code class="code" id="pc5i3w_994"></code> &quot;json&quot;: {</p><p id="pc5i3w_886"><code class="code" id="pc5i3w_995"></code> &quot;_field&quot;: &quot;json&quot;</p><p id="pc5i3w_887"><code class="code" id="pc5i3w_996"></code>}</p><p id="pc5i3w_888"><code class="code" id="pc5i3w_997"></code>}</p><p id="pc5i3w_889"><code class="code" id="pc5i3w_998"></code>}</p><p id="pc5i3w_890">}</p><p id="pc5i3w_891">\2) Определение функций</p><p id="pc5i3w_892">Функции определяются в разделе &quot;_functions&quot; настроечного файла.</p><p id="pc5i3w_893">Пример:</p><p id="pc5i3w_894"><code class="code" id="pc5i3w_999"></code> &quot;get_in&quot;: {</p><p id="pc5i3w_895"><code class="code" id="pc5i3w_1000"></code> &quot;elements&quot;: [&quot;ElmSite&quot;, &quot;ElmSubstat&quot;, &quot;ElmTerm&quot;, &quot;ElmCoup&quot;, &quot;ElmTr2&quot;, &quot;ElmTr3&quot;, &quot;ElmGenstat&quot;, &quot;ElmSym&quot;, &quot;ElmLod&quot;, &quot;ElmShnt&quot;, &quot;ElmBranch&quot;, &quot;ElmLne&quot;, &quot;ElmLnesec&quot;, &quot;ElmXnet&quot;],</p><p id="pc5i3w_896"><code class="code" id="pc5i3w_1001"></code> &quot;json_fields&quot;: {&quot;$path&quot;: [&quot;parms&quot;]}</p><p id="pc5i3w_897">},</p><p id="pc5i3w_898">&quot;get_out&quot;: {</p><p id="pc5i3w_899"><code class="code" id="pc5i3w_1002"></code> &quot;elements&quot;: [&quot;ElmSite&quot;, &quot;ElmSubstat&quot;, &quot;ElmTerm&quot;, &quot;ElmCoup&quot;, &quot;ElmTr2&quot;, &quot;ElmTr3&quot;, &quot;ElmGenstat&quot;, &quot;ElmSym&quot;, &quot;ElmLod&quot;, &quot;ElmShnt&quot;, &quot;ElmBranch&quot;, &quot;ElmLne&quot;, &quot;ElmLnesec&quot;, &quot;ElmXnet&quot;],</p><p id="pc5i3w_900"><code class="code" id="pc5i3w_1003"></code> &quot;json_fields&quot;: {&quot;$path&quot;: [&quot;results&quot;]}</p><p id="pc5i3w_901"><code class="code" id="pc5i3w_1004"></code>}</p><p id="pc5i3w_902">В данном примере определяется функция get.</p><p id="pc5i3w_903">&quot;get_in&quot; определяет элементы и поля (заданные в разделе маппинга), которые будут использоваться при формировании json, отправляемого в PowerFactory. В данном случае, json отправляемый в PowerFactory, будет содержать в элементах только поле &quot;params&quot;, и не будет включать другие поля (&quot;pf_attr&quot;, &quot;links&quot;, &quot;results&quot;), определенные в разделе маппинга.</p><p id="pc5i3w_904">&quot;get_out&quot; определяет элементы и поля (заданные в разделе маппинга), которые будут загружаться из полученного от PowerFactory json в базу данных faceplate. В данном случае, загружаться будут только данные из раздела &quot;results&quot;.</p><p id="pc5i3w_905">\3) Преобразование путей Faceplate и PowerFactory</p><p id="pc5i3w_906">Путь к объекту Faceplate, как и путь к объекту в PowerFactory, однозначно определяет объект.</p><p id="pc5i3w_907">В faceplate и PowerFactory пути к объектам отличаются. Например путь к объекту трансформатора c именем AT2 в faceplate может быть таким:</p><p id="pc5i3w_908">'/root/FP/PROJECT/KAZ/ZAPAD/Kulsary/220/AT2'. Данному объекту соответствует объект в PowerFactory, у которого путь: 'Grid\KAZ\ZAPAD\Kulsary\220/AT2'.</p><p id="pc5i3w_909">Причем имя объекта в PowerFactory '220/AT2', а часть пути 'Grid\KAZ\ZAPAD\Kulsary' определяет иерархию директорий (папок) для этого объекта. В данном случае, часть пути '/root/FP/PROJECT' соответствует 'Grid' в PowerFactory.</p><p id="pc5i3w_910">Соответствие между путем faceplate и путем PowerFactory определяется в разделе &quot;pf_path_mapping&quot;. Данное соответствие используется при выгрузке данных из faceplate в PowerFactory/</p><p id="pc5i3w_911">Пример:</p><p id="pc5i3w_912">&quot;pf_path_mapping&quot;: {</p><p id="pc5i3w_913"><code class="code" id="pc5i3w_1005"></code> &quot;^/root/FP/PROJECT&quot;: [&quot;Grid&quot;, 4],</p><p id="pc5i3w_914"><code class="code" id="pc5i3w_1006"></code> &quot;^/root/FP/catalogs/equipment_types([\w\W]*)/content&quot;: [&quot;Equipment Type Library&quot;, 1]</p><p id="pc5i3w_915"><code class="code" id="pc5i3w_1007"></code>},</p><p id="pc5i3w_916">В левой части определено регулярное выражение (&quot;^/root/FP/PROJECT&quot;), которое соответствует части пути в faceplate, которое будет заменено на значение первого элемента списка, находящегося в правой части. Второй элемент данного списка является целым числом, которое определяет глубину пути к объекту в PowerFactory. Т.е. 'Grid\KAZ\ZAPAD\Kulsary' имеет глубину 4. Оставшаяся часть пути будет преобразована в имя объекта '220/AT2'.</p><p id="pc5i3w_917">В приведенном примере аналогичным образом определено соответствие между путем к элементу каталога 'equipment_types' в базе faceplate и путем к объекту в библиотеке типов оборудования в PowerFactory.</p><p id="pc5i3w_918"><code class="code" id="pc5i3w_1008"></code> Обратное преобразование путей используется для загрузки данных из PowerFactory в faceplate. Оно определено в разделе &quot;fp_path_mapping&quot;.</p><p id="pc5i3w_919">Пример:</p><p id="pc5i3w_920">&quot;fp_path_mapping&quot;: {</p><p id="pc5i3w_921"><code class="code" id="pc5i3w_1009"></code> &quot;^Grid&quot;: &quot;/root/FP/PROJECT&quot;,</p><p id="pc5i3w_922"><code class="code" id="pc5i3w_1010"></code> &quot;^Equipment Type Library&quot;: &quot;/root/FP/catalogs/equipment_types\\${element_type}/content&quot;,</p><p id="pc5i3w_923">}</p><p id="pc5i3w_924">В левой части определено регулярное выражение, которое соответствует части пути в faceplate, которое будет заменено на значение в правой части.</p><p id="pc5i3w_925">В правой части может использоваться переменная ${element_type}. В этой переменной передается PowerFactory класс обрабатываемого объекта (например, 'TypLne'). В приведенном примере эта переменная используется определения имени каталога. В приведенном примере, результирующее имя каталога будет 'equipment_types\TypLne' (в случае если обрабатываемый PowerFactory объект имеет тип 'TypLne').</p></section><section class="chapter"><h2 id="6-2" data-toc="6-2"><a name=""></a><span class="control" id="pc5i3w_1105">6.2 Использование в прикладном проекте</span></h2><p id="pc5i3w_1012">Несколько последовательных вызовов функции pf_service_update или pf_service_create_update в прикладном проекте выполняются последовательно, т.е. пока не выполнится цикл отправки/получения данных для первого вызова функции, для второго вызова цикла отправки/получения данных не начнется.</p><p id="pc5i3w_1013">В прикладном проекте создана пользовательская библиотека fp_pf_utils, облегчающая использование модуля в прикладных скриптах.</p><p id="pc5i3w_1014">-module(fp_pf_utils).</p><p id="pc5i3w_1015">%%---------------------------------------</p><p id="pc5i3w_1016">-include(&quot;fp.hrl&quot;).</p><p id="pc5i3w_1017">-export([</p><p id="pc5i3w_1018"><code class="code" id="pc5i3w_1106"></code> pf_get/0,</p><p id="pc5i3w_1019"><code class="code" id="pc5i3w_1107"></code> pf_execute/0,</p><p id="pc5i3w_1020"><code class="code" id="pc5i3w_1108"></code> pf_dynamics/0,</p><p id="pc5i3w_1021"><code class="code" id="pc5i3w_1109"></code> pf_update/0,</p><p id="pc5i3w_1022"><code class="code" id="pc5i3w_1110"></code> pf_reset_calc/0</p><p id="pc5i3w_1023"><code class="code" id="pc5i3w_1111"></code>]).</p><p id="pc5i3w_1024">-define(HOST, &quot;10.210.1.25&quot;).</p><p id="pc5i3w_1025">-define(PORT, 80).</p><p id="pc5i3w_1026">-define(PROJECTNAME, &lt;&lt;&quot;.MODEL_SCADA_V1115&quot;&gt;&gt;).</p><p id="pc5i3w_1027">-define(SCENARIO, &lt;&lt;&quot;scenario_dynamics&quot;&gt;&gt;).</p><p id="pc5i3w_1028">pf_get() -&gt;</p><p id="pc5i3w_1029"><code class="code" id="pc5i3w_1112"></code> ProjectParams = #{</p><p id="pc5i3w_1030"><code class="code" id="pc5i3w_1113"></code> &lt;&lt;&quot;func_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;get&quot;&gt;&gt;,</p><p id="pc5i3w_1031"><code class="code" id="pc5i3w_1114"></code> &lt;&lt;&quot;grid_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;Grid&quot;&gt;&gt;,</p><p id="pc5i3w_1032"><code class="code" id="pc5i3w_1115"></code> &lt;&lt;&quot;project_name&quot;&gt;&gt; =&gt; ?PROJECTNAME,</p><p id="pc5i3w_1033"><code class="code" id="pc5i3w_1116"></code> &lt;&lt;&quot;study_case_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;Study Case&quot;&gt;&gt;,</p><p id="pc5i3w_1034"><code class="code" id="pc5i3w_1117"></code> &lt;&lt;&quot;operation_scenario_name&quot;&gt;&gt; =&gt; ?SCENARIO,</p><p id="pc5i3w_1035"><code class="code" id="pc5i3w_1118"></code> &lt;&lt;&quot;session_type&quot;&gt;&gt; =&gt; &lt;&lt;&quot;calculation&quot;&gt;&gt;,</p><p id="pc5i3w_1036"><code class="code" id="pc5i3w_1119"></code> &lt;&lt;&quot;id&quot;&gt;&gt; =&gt; &lt;&lt;&quot;abcd-1234&quot;&gt;&gt;</p><p id="pc5i3w_1037"><code class="code" id="pc5i3w_1120"></code>},</p><p id="pc5i3w_1038"><code class="code" id="pc5i3w_1121"></code> fp_powerfactory_service:pf_service_update(ProjectParams, none, ?HOST, ?PORT).</p><p id="pc5i3w_1039">pf_update() -&gt;</p><p id="pc5i3w_1040"><code class="code" id="pc5i3w_1122"></code> ProjectParams = #{</p><p id="pc5i3w_1041"><code class="code" id="pc5i3w_1123"></code> &lt;&lt;&quot;func_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;update&quot;&gt;&gt;,</p><p id="pc5i3w_1042"><code class="code" id="pc5i3w_1124"></code> &lt;&lt;&quot;grid_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;Grid&quot;&gt;&gt;,</p><p id="pc5i3w_1043"><code class="code" id="pc5i3w_1125"></code> &lt;&lt;&quot;project_name&quot;&gt;&gt; =&gt; ?PROJECTNAME,</p><p id="pc5i3w_1044"><code class="code" id="pc5i3w_1126"></code> &lt;&lt;&quot;study_case_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;Study Case&quot;&gt;&gt;,</p><p id="pc5i3w_1045"><code class="code" id="pc5i3w_1127"></code> &lt;&lt;&quot;operation_scenario_name&quot;&gt;&gt; =&gt; ?SCENARIO,</p><p id="pc5i3w_1046"><code class="code" id="pc5i3w_1128"></code> &lt;&lt;&quot;session_type&quot;&gt;&gt; =&gt; &lt;&lt;&quot;calculation&quot;&gt;&gt;,</p><p id="pc5i3w_1047"><code class="code" id="pc5i3w_1129"></code> &lt;&lt;&quot;id&quot;&gt;&gt; =&gt; &lt;&lt;&quot;abcd-1234&quot;&gt;&gt;</p><p id="pc5i3w_1048"><code class="code" id="pc5i3w_1130"></code>},</p><p id="pc5i3w_1049"><code class="code" id="pc5i3w_1131"></code> fp_powerfactory_service:pf_service_update(ProjectParams, none, ?HOST, ?PORT).</p><p id="pc5i3w_1050">pf_execute() -&gt;</p><p id="pc5i3w_1051"><code class="code" id="pc5i3w_1132"></code> ProjectParams = #{</p><p id="pc5i3w_1052"><code class="code" id="pc5i3w_1133"></code> &lt;&lt;&quot;func_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;execute&quot;&gt;&gt;,</p><p id="pc5i3w_1053"><code class="code" id="pc5i3w_1134"></code> &lt;&lt;&quot;grid_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;Grid&quot;&gt;&gt;,</p><p id="pc5i3w_1054"><code class="code" id="pc5i3w_1135"></code> &lt;&lt;&quot;project_name&quot;&gt;&gt; =&gt; ?PROJECTNAME,</p><p id="pc5i3w_1055"><code class="code" id="pc5i3w_1136"></code> &lt;&lt;&quot;study_case_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;Study Case&quot;&gt;&gt;,</p><p id="pc5i3w_1056"><code class="code" id="pc5i3w_1137"></code> &lt;&lt;&quot;operation_scenario_name&quot;&gt;&gt; =&gt; ?SCENARIO,</p><p id="pc5i3w_1057"><code class="code" id="pc5i3w_1138"></code> &lt;&lt;&quot;session_type&quot;&gt;&gt; =&gt; &lt;&lt;&quot;calculation&quot;&gt;&gt;,</p><p id="pc5i3w_1058"><code class="code" id="pc5i3w_1139"></code> &lt;&lt;&quot;id&quot;&gt;&gt; =&gt; &lt;&lt;&quot;abcd-1234&quot;&gt;&gt;</p><p id="pc5i3w_1059"><code class="code" id="pc5i3w_1140"></code>},</p><p id="pc5i3w_1060"><code class="code" id="pc5i3w_1141"></code> ComLdfOID = ?OID(&lt;&lt;&quot;/root/FP/PROJECT/_GRIDS/forPF/PF_ComLDF&quot;&gt;&gt;),</p><p id="pc5i3w_1061"><code class="code" id="pc5i3w_1142"></code> fp_powerfactory_service:pf_service_update(ProjectParams, [ComLdfOID], ?HOST, ?PORT).</p><p id="pc5i3w_1062">pf_dynamics() -&gt;</p><p id="pc5i3w_1063"><code class="code" id="pc5i3w_1143"></code> ProjectParams = #{</p><p id="pc5i3w_1064"><code class="code" id="pc5i3w_1144"></code> &lt;&lt;&quot;func_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;dynamics&quot;&gt;&gt;,</p><p id="pc5i3w_1065"><code class="code" id="pc5i3w_1145"></code> &lt;&lt;&quot;grid_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;Grid&quot;&gt;&gt;,</p><p id="pc5i3w_1066"><code class="code" id="pc5i3w_1146"></code> &lt;&lt;&quot;project_name&quot;&gt;&gt; =&gt; ?PROJECTNAME,</p><p id="pc5i3w_1067"><code class="code" id="pc5i3w_1147"></code> &lt;&lt;&quot;study_case_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;Study Case&quot;&gt;&gt;,</p><p id="pc5i3w_1068"><code class="code" id="pc5i3w_1148"></code> &lt;&lt;&quot;operation_scenario_name&quot;&gt;&gt; =&gt; ?SCENARIO,</p><p id="pc5i3w_1069"><code class="code" id="pc5i3w_1149"></code> &lt;&lt;&quot;session_type&quot;&gt;&gt; =&gt; &lt;&lt;&quot;calculation&quot;&gt;&gt;,</p><p id="pc5i3w_1070"><code class="code" id="pc5i3w_1150"></code> &lt;&lt;&quot;id&quot;&gt;&gt; =&gt; &lt;&lt;&quot;abcd-1234&quot;&gt;&gt;</p><p id="pc5i3w_1071"><code class="code" id="pc5i3w_1151"></code>},</p><p id="pc5i3w_1072"><code class="code" id="pc5i3w_1152"></code> ComSimOID = ?OID(&lt;&lt;&quot;/root/FP/PROJECT/_GRIDS/forPF/PF_ComSim&quot;&gt;&gt;),</p><p id="pc5i3w_1073"><code class="code" id="pc5i3w_1153"></code> fp_powerfactory_service:pf_service_update(ProjectParams, [ComSimOID], ?HOST, ?PORT).</p><p id="pc5i3w_1074">pf_reset_calc() -&gt;</p><p id="pc5i3w_1075"><code class="code" id="pc5i3w_1154"></code> ProjectParams = #{</p><p id="pc5i3w_1076"><code class="code" id="pc5i3w_1155"></code> &lt;&lt;&quot;func_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;reset_calc&quot;&gt;&gt;,</p><p id="pc5i3w_1077"><code class="code" id="pc5i3w_1156"></code> &lt;&lt;&quot;grid_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;Grid&quot;&gt;&gt;,</p><p id="pc5i3w_1078"><code class="code" id="pc5i3w_1157"></code> &lt;&lt;&quot;project_name&quot;&gt;&gt; =&gt; ?PROJECTNAME,</p><p id="pc5i3w_1079"><code class="code" id="pc5i3w_1158"></code> &lt;&lt;&quot;study_case_name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;Study Case&quot;&gt;&gt;,</p><p id="pc5i3w_1080"><code class="code" id="pc5i3w_1159"></code> &lt;&lt;&quot;operation_scenario_name&quot;&gt;&gt; =&gt; ?SCENARIO,</p><p id="pc5i3w_1081"><code class="code" id="pc5i3w_1160"></code> &lt;&lt;&quot;session_type&quot;&gt;&gt; =&gt; &lt;&lt;&quot;calculation&quot;&gt;&gt;,</p><p id="pc5i3w_1082"><code class="code" id="pc5i3w_1161"></code> &lt;&lt;&quot;id&quot;&gt;&gt; =&gt; &lt;&lt;&quot;abcd-1234&quot;&gt;&gt;</p><p id="pc5i3w_1083"><code class="code" id="pc5i3w_1162"></code>},</p><p id="pc5i3w_1084"><code class="code" id="pc5i3w_1163"></code> fp_powerfactory_service:pf_service_update(ProjectParams, none, ?HOST, ?PORT).</p><p id="pc5i3w_1085">Пример использования пользовательской библиотеки fp_pf_utils в пользовательском скрипте, для организации циклического взаимодействия между Faceplate и PowerFactory:</p><p id="pc5i3w_1086"><code class="code" id="pc5i3w_1164"></code> fun(VARS,_State)-&gt;</p><p id="pc5i3w_1087"><code class="code" id="pc5i3w_1165"></code> StatusObject = fp_db:open(fp_db:to_oid(list_to_binary(&quot;/root/FP/PROJECT/@DTS/scripts/status&quot;))),</p><p id="pc5i3w_1088"><code class="code" id="pc5i3w_1166"></code> fp_db:edit_object(StatusObject, #{&lt;&lt;&quot;value_int&quot;&gt;&gt; =&gt; 2}),</p><p id="pc5i3w_1089"><code class="code" id="pc5i3w_1167"></code> While = fun Loop(Status) -&gt;</p><p id="pc5i3w_1090"><code class="code" id="pc5i3w_1168"></code> if</p><p id="pc5i3w_1091"><code class="code" id="pc5i3w_1169"></code> Status == 2 -&gt;</p><p id="pc5i3w_1092"><code class="code" id="pc5i3w_1170"></code> fp_pf_utils:pf_dynamics(),</p><p id="pc5i3w_1093"><code class="code" id="pc5i3w_1171"></code> fp_pf_utils:pf_get(),</p><p id="pc5i3w_1094"><code class="code" id="pc5i3w_1172"></code> {_, StatusNew} = fp_db:read_field(StatusObject, &lt;&lt;&quot;value_int&quot;&gt;&gt;),</p><p id="pc5i3w_1095"><code class="code" id="pc5i3w_1173"></code> Loop(StatusNew);</p><p id="pc5i3w_1096"><code class="code" id="pc5i3w_1174"></code> true -&gt;</p><p id="pc5i3w_1097"><code class="code" id="pc5i3w_1175"></code> fp:log(info, &quot;Dynamics stopped, status ~p&quot;, [Status])</p><p id="pc5i3w_1098"><code class="code" id="pc5i3w_1176"></code> end</p><p id="pc5i3w_1099"><code class="code" id="pc5i3w_1177"></code> end,</p><p id="pc5i3w_1100"><code class="code" id="pc5i3w_1178"></code> While(2),</p><p id="pc5i3w_1101"><code class="code" id="pc5i3w_1179"></code> { none, none }</p><p id="pc5i3w_1102">end.</p><p id="pc5i3w_1103">В данном скрипте циклично вызываются функции fp_pf_utils:pf_dynamics() и fp_pf_utils:pf_get(), пока значение поля &quot;value_int&quot;, объекта &quot;/root/FP/PROJECT/@DTS/scripts/status&quot; равно 2. Для остановки цикла передачи, внешний скрипт должен изменить значение этого поля на другое.</p></section><section class="chapter"><h2 id="7" data-toc="7"><a name=""></a><span class="control" id="pc5i3w_1194">7. Заключение</span></h2><p id="pc5i3w_1181">Настоящее руководство описывает основные скрипты и функции в библиотеке Faceplate, которые позволяют программистам управлять данными, взаимодействовать с API, выполнять вычисления и автоматизировать процессы в SCADA-системе. <span class="emphasis" id="pc5i3w_1195">Изм</span></p><p id="pc5i3w_1182"><span class="emphasis" id="pc5i3w_1196">Лист</span></p><p id="pc5i3w_1183"><span class="emphasis" id="pc5i3w_1197">№ докум</span></p><p id="pc5i3w_1184"><span class="emphasis" id="pc5i3w_1198">Подп.</span></p><p id="pc5i3w_1185"><span class="emphasis" id="pc5i3w_1199">Дата</span></p><p id="pc5i3w_1186"><span class="emphasis" id="pc5i3w_1200">Лист</span></p><p id="pc5i3w_1187"><code class="code" id="pc5i3w_1201"></code><span class="emphasis" id="pc5i3w_1202">PAGE 2</span></p><p id="pc5i3w_1188"><span class="emphasis" id="pc5i3w_1203">Инв. №подл.</span></p><p id="pc5i3w_1189"><span class="emphasis" id="pc5i3w_1204">Подп. и дата</span></p><p id="pc5i3w_1190"><span class="emphasis" id="pc5i3w_1205">Взам. инв. №</span></p><p id="pc5i3w_1191"><span class="emphasis" id="pc5i3w_1206">Инв. № дубл.</span></p><p id="pc5i3w_1192"><span class="emphasis" id="pc5i3w_1207">Подп. и дата</span> <img alt="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 006" src="${primarySource}" class="inline-icon-" title="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 006" id="pc5i3w_1208"><img alt="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 007" src="${primarySource}" class="inline-icon-" title="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 007" id="pc5i3w_1209"><img alt="ref2" src="${primarySource}" class="inline-icon-" title="ref2" id="pc5i3w_1210"><img alt="ref2" src="${primarySource}" class="inline-icon-" title="ref2" id="pc5i3w_1211"><img alt="ref2" src="${primarySource}" class="inline-icon-" title="ref2" id="pc5i3w_1212"><img alt="ref2" src="${primarySource}" class="inline-icon-" title="ref2" id="pc5i3w_1213"><img alt="ref2" src="${primarySource}" class="inline-icon-" title="ref2" id="pc5i3w_1214"><img alt="ref2" src="${primarySource}" class="inline-icon-" title="ref2" id="pc5i3w_1215"><img alt="ref3" src="${primarySource}" class="inline-icon-" title="ref3" id="pc5i3w_1216"><img alt="ref3" src="${primarySource}" class="inline-icon-" title="ref3" id="pc5i3w_1217"><img alt="ref3" src="${primarySource}" class="inline-icon-" title="ref3" id="pc5i3w_1218"><img alt="ref4" src="${primarySource}" class="inline-icon-" title="ref4" id="pc5i3w_1219"><img alt="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 011" src="${primarySource}" class="inline-icon-" title="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 011" id="pc5i3w_1220"><img alt="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 012" src="${primarySource}" class="inline-icon-" title="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 012" id="pc5i3w_1221"><img alt="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 013" src="${primarySource}" class="inline-icon-" title="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 013" id="pc5i3w_1222"><img alt="ref4" src="${primarySource}" class="inline-icon-" title="ref4" id="pc5i3w_1223"><img alt="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 014" src="${primarySource}" class="inline-icon-" title="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 014" id="pc5i3w_1224"><img alt="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 015" src="${primarySource}" class="inline-icon-" title="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 015" id="pc5i3w_1225"><img alt="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 016" src="${primarySource}" class="inline-icon-" title="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 016" id="pc5i3w_1226"><img alt="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 017" src="${primarySource}" class="inline-icon-" title="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 017" id="pc5i3w_1227"><img alt="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 018" src="${primarySource}" class="inline-icon-" title="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 018" id="pc5i3w_1228"><img alt="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 019" src="${primarySource}" class="inline-icon-" title="Aspose words 9ae2a643 68c3 4dd2 91ef 5048a0c23abe 019" id="pc5i3w_1229"></p></section><section class="chapter"><h2 id="pc5i3w_7" data-toc="pc5i3w_7"><a name=""></a><span class="control" id="pc5i3w_1234">Приложение А. Библиотечные скрипты и их функции</span></h2><p id="pc5i3w_1231">В разделе &quot;Библиотечные модули&quot; представлено множество скриптов, каждый из которых реализует определенную функциональность для работы SCADA-системы Faceplate. Эти модули предоставляют программистам гибкие инструменты для автоматизации, анализа данных и интеграции с внешними сервисами.</p><p id="pc5i3w_1232">Ниже приведен перечень доступных библиотечных модулей с пояснениями:</p></section><section class="chapter"><h2 id="1-system-utils-v1" data-toc="1-system-utils-v1"><a name=""></a><span class="control" id="pc5i3w_1242">А.1 Модуль system_utils (v1)</span></h2><p id="pc5i3w_1236">Модуль с набором вспомогательных функций, предназначенных для поиска и обработки системных объектов. Применяется для оптимизации работы с объектами в системе.</p><p id="pc5i3w_1237"><span class="control" id="pc5i3w_1243">Общая информация</span></p><p id="pc5i3w_1238">Модуль system_utils предоставляет функции для управления объектами системы и обработки данных. Код написан на языке программирования Erlang. Если функция выбрасывает исключение или происходит сбой, транзакция будет отменена. При успешном выполнении функции возвращают атом ok. Для логирования рекомендуется использовать макросы:</p><ul class="list _bullet" id="pc5i3w_1239"><li class="list__item" id="pc5i3w_1244"><p id="pc5i3w_1247">?LOGINFO( &quot;my info text: ~p&quot;, [Info] )</p></li><li class="list__item" id="pc5i3w_1245"><p id="pc5i3w_1248">?LOGWARNING( &quot;my warning text: ~p&quot;, [Warning] )</p></li><li class="list__item" id="pc5i3w_1246"><p id="pc5i3w_1249">?LOGERROR( &quot;my error text: ~p&quot;, [Error] )</p></li></ul><div class="table-wrapper"><table class="wide" id="pc5i3w_1240"><thead><tr class="ijRowHead" id="pc5i3w_1250"><th id="pc5i3w_1258"><p><span class="control" id="pc5i3w_1260">Функция</span></p></th><th id="pc5i3w_1259"><p><span class="control" id="pc5i3w_1261">Описание</span></p></th></tr></thead><tbody><tr id="pc5i3w_1251"><td id="pc5i3w_1262"><p>find_by_pattern/2</p></td><td id="pc5i3w_1263"><p id="pc5i3w_1264">: Ищет объекты в хранилище данных, соответствующие заданному шаблону.</p><p id="pc5i3w_1265"><span class="control" id="pc5i3w_1272">Параметры</span>:</p><p id="pc5i3w_1266">- Root (binary): Корневой путь проекта.</p><p id="pc5i3w_1267">- Pattern (binary): Шаблон для поиска.</p><p id="pc5i3w_1268"><span class="control" id="pc5i3w_1273">Возвращает</span>: Список путей к объектам.</p><p id="pc5i3w_1269"><span class="control" id="pc5i3w_1274">Пример использования</span>:</p><p id="pc5i3w_1270">system_utils:find_by_pattern(&lt;&lt;&quot;KAZ/UZHNIY&quot;&gt;&gt;, &lt;&lt;&quot;/root/FP/prototypes/telemetry/fields&quot;&gt;&gt;).</p><p id="pc5i3w_1271"></p></td></tr><tr id="pc5i3w_1252"><td id="pc5i3w_1275"><p>csv_to_archive/2</p></td><td id="pc5i3w_1276"><p id="pc5i3w_1277">: Загружает данные из CSV-файла и сохраняет их в архив.</p><p id="pc5i3w_1278"><span class="control" id="pc5i3w_1284">Параметры</span>:</p><p id="pc5i3w_1279">- Archive (binary): Архив для сохранения данных.</p><p id="pc5i3w_1280">- CSVFile (binary): Путь к CSV-файлу.</p><p id="pc5i3w_1281"><span class="control" id="pc5i3w_1285">Возвращает</span>: Атом ok в случае успеха или {error, Reason} в случае ошибки.</p><p id="pc5i3w_1282"><span class="control" id="pc5i3w_1286">Пример использования</span>:</p><p id="pc5i3w_1283">system_utils:csv_to_archive(&lt;&lt;&quot;my_archive&quot;&gt;&gt;, &lt;&lt;&quot;/path/to/file.csv&quot;&gt;&gt;).</p></td></tr><tr id="pc5i3w_1253"><td id="pc5i3w_1287"><p>vclass_from_object/1</p></td><td id="pc5i3w_1288"><p id="pc5i3w_1289">: Определяет класс объекта по его пути.</p><p id="pc5i3w_1290"><span class="control" id="pc5i3w_1296">Параметры</span>:</p><p id="pc5i3w_1291">- Object (binary): Объект, для которого необходимо определить класс.</p><p id="pc5i3w_1292"><span class="control" id="pc5i3w_1297">Возвращает</span>: Целое число, представляющее класс объекта, или 0, если совпадение не найдено.</p><p id="pc5i3w_1293"><span class="control" id="pc5i3w_1298">Пример использования</span>:</p><p id="pc5i3w_1294">system_utils:vclass_from_object(Object).</p><p id="pc5i3w_1295"></p></td></tr><tr id="pc5i3w_1254"><td id="pc5i3w_1299"><p>utc_time/0</p></td><td id="pc5i3w_1300"><p id="pc5i3w_1301">: Возвращает текущие дату и время в формате UTC.</p><p id="pc5i3w_1302"><span class="control" id="pc5i3w_1307">Параметры</span>: Нет.</p><p id="pc5i3w_1303"><span class="control" id="pc5i3w_1308">Возвращает</span>: Строку с отформатированной датой и временем.</p><p id="pc5i3w_1304"><span class="control" id="pc5i3w_1309">Пример использования</span>:</p><p id="pc5i3w_1305">system_utils:utc_time().</p><p id="pc5i3w_1306"></p></td></tr><tr id="pc5i3w_1255"><td id="pc5i3w_1310"><p>create_csv/2</p></td><td id="pc5i3w_1311"><p id="pc5i3w_1312">: Создает CSV-файл с данными, извлеченными из хранилища данных.</p><p id="pc5i3w_1313"><span class="control" id="pc5i3w_1319">Параметры</span>:</p><p id="pc5i3w_1314">- Path (binary): Путь для выборки данных.</p><p id="pc5i3w_1315">- File (binary): Имя файла для сохранения.</p><p id="pc5i3w_1316"><span class="control" id="pc5i3w_1320">Возвращает</span>: Атом ok в случае успеха.</p><p id="pc5i3w_1317"><span class="control" id="pc5i3w_1321">Пример использования</span>:</p><p id="pc5i3w_1318">system_utils:create_csv(&lt;&lt;&quot;/data/path&quot;&gt;&gt;, &lt;&lt;&quot;output.csv&quot;&gt;&gt;).</p></td></tr><tr id="pc5i3w_1256"><td id="pc5i3w_1322"><p>delete_elements/4</p></td><td id="pc5i3w_1323"><p id="pc5i3w_1324">: Удаляет элементы из хранилища данных, соответствующие заданным критериям.</p><p id="pc5i3w_1325"><span class="control" id="pc5i3w_1334">Параметры</span>:</p><p id="pc5i3w_1326">- Root (binary): Корневой путь проекта.</p><p id="pc5i3w_1327">- Folder (binary): Папка для выборки.</p><p id="pc5i3w_1328">- Pattern (binary): Шаблон для поиска.</p><p id="pc5i3w_1329">- Name (binary): Имя элемента для удаления.</p><p id="pc5i3w_1330"><span class="control" id="pc5i3w_1335">Возвращает</span>: Атом ok в случае успеха.</p><p id="pc5i3w_1331"><span class="control" id="pc5i3w_1336">Пример использования</span>:</p><p id="pc5i3w_1332">system_utils:delete_elements(&lt;&lt;&quot;UZHNIY&quot;&gt;&gt;, &lt;&lt;&quot;@models&quot;&gt;&gt;, &lt;&lt;&quot;/root/FP/prototypes/telemetry/fields&quot;&gt;&gt;, &lt;&lt;&quot;Uac&quot;&gt;&gt;).</p><p id="pc5i3w_1333"></p></td></tr><tr id="pc5i3w_1257"><td id="pc5i3w_1337"><p>set_state_value/4</p></td><td id="pc5i3w_1338"><p id="pc5i3w_1339">: Устанавливает значение полей объектов state, вложенных в объекты, соответствующие заданным прототипам и находящиеся в заданном контексте.</p><p id="pc5i3w_1340"><span class="control" id="pc5i3w_1349">Параметры</span>:</p><p id="pc5i3w_1341">- Context (binary): Контекст, в котором будет установлено значение.</p><p id="pc5i3w_1342">- EdgePrototypes (list): Список прототипов.</p><p id="pc5i3w_1343">- Path (binary): Относительный путь к объекту состояния</p><p id="pc5i3w_1344">- FieldMap (map): Карта полей для обновления.</p><p id="pc5i3w_1345"><span class="control" id="pc5i3w_1350">Возвращает</span>: Атом ok в случае успеха.</p><p id="pc5i3w_1346"><span class="control" id="pc5i3w_1351">Пример использования</span>:</p><p id="pc5i3w_1347">system_utils:set_state_value(&lt;&lt;&quot;/root/FP/PROJECT/KAZ/UZHNIY/Kyzylorda&quot;&gt;&gt;, [&lt;&lt;&quot;isolator&quot;&gt;&gt;, &lt;&lt;&quot;earth_isolator&quot;&gt;&gt;], &lt;&lt;&quot;/state&quot;&gt;&gt;, #{&lt;&lt;&quot;in_value&quot;&gt;&gt; =&gt; 1}).</p><p id="pc5i3w_1348"></p></td></tr></tbody></table></div></section><section class="chapter"><h2 id="2-weather-service" data-toc="2-weather-service"><a name=""></a><span class="control" id="pc5i3w_1378">А.2 Модуль weather_service</span></h2><p id="pc5i3w_1353">Служба интеграции прогноза погоды. Этот модуль взаимодействует с внешним API для получения данных о погоде, которые могут использоваться для анализа и прогноза производительности системы, учитывая метеоусловия.</p><p id="pc5i3w_1354"><span class="control" id="pc5i3w_1379">Общая информация</span></p><p id="pc5i3w_1355">Модуль weather_service предназначен для получения информации о текущей погоде и прогноза на 24 часа. Модуль разработан на языке Erlang. Для логирования сообщений предлагается использовать макросы: ?LOGINFO, ?LOGWARNING, ?LOGERROR и обеспечивать откат транзакций при ошибках. При успешном оформлении возвращается атом ok.</p><div class="table-wrapper"><table class="wide" id="pc5i3w_1356"><thead><tr class="ijRowHead" id="pc5i3w_1380"><th id="pc5i3w_1383"><p><span class="control" id="pc5i3w_1385">Функция</span></p></th><th id="pc5i3w_1384"><p><span class="control" id="pc5i3w_1386">Описание</span></p></th></tr></thead><tbody><tr id="pc5i3w_1381"><td id="pc5i3w_1387"><p>forecast24/1</p></td><td id="pc5i3w_1388"><p id="pc5i3w_1389">: Получает прогноз погоды на 24 часа через API OpenWeatherMap.</p><p id="pc5i3w_1390"><span class="control" id="pc5i3w_1401">Параметры</span>:</p><p id="pc5i3w_1391">- Obj (map): Объект, содержащий координаты (широта lat и долгота lon).</p><p id="pc5i3w_1392"><span class="control" id="pc5i3w_1402">Возвращает</span>: Обработанные данные о прогнозе, включая массивы температуры, давления, влажности, скорости и направления ветра.</p><p id="pc5i3w_1393"><span class="control" id="pc5i3w_1403">Пример использования</span>:</p><p id="pc5i3w_1394">weather_service:forecast24(Object).</p><p id="pc5i3w_1395"><span class="control" id="pc5i3w_1404">Детали реализации</span>:</p><p id="pc5i3w_1396">- Чтение координат из объекта с использованием fp_db:read_fields.</p><p id="pc5i3w_1397">- Формирование URL для запроса к API.</p><p id="pc5i3w_1398">- Выполнение HTTP-запроса с использованием модуля httpc.</p><p id="pc5i3w_1399">- Парсинг ответа JSON с помощью библиотеки jsx.</p><p id="pc5i3w_1400">- Обработка данных прогноза для температуры, давления, влажности, скорости и направления ветра.</p></td></tr><tr id="pc5i3w_1382"><td id="pc5i3w_1405"><p>current/1</p></td><td id="pc5i3w_1406"><p id="pc5i3w_1407">: Получает текущую погоду через API OpenWeatherMap.</p><p id="pc5i3w_1408"><span class="control" id="pc5i3w_1426">Параметры</span>:</p><p id="pc5i3w_1409">- Obj (map): Объект, содержащий координаты (широта lat и долгота lon).</p><p id="pc5i3w_1410"><span class="control" id="pc5i3w_1427">Возвращает</span>: Карта значений с текущими погодными данными:</p><p id="pc5i3w_1411">- ts: Временная метка.</p><p id="pc5i3w_1412">- pressure: Давление (гПа).</p><p id="pc5i3w_1413">- temperature: Температура (&deg;C).</p><p id="pc5i3w_1414">- humidity: Влажность (%).</p><p id="pc5i3w_1415">- wind_speed: Скорость ветра (м/с).</p><p id="pc5i3w_1416">- wind_direction: Направление ветра (градусы).</p><p id="pc5i3w_1417"><span class="control" id="pc5i3w_1428">Пример использования</span>:</p><p id="pc5i3w_1418">weather_service:current(Object).</p><p id="pc5i3w_1419"><span class="control" id="pc5i3w_1429">Детали реализации</span>:</p><p id="pc5i3w_1420">- Чтение координат из объекта с использованием fp_db:read_fields.</p><p id="pc5i3w_1421">- Формирование URL для запроса к API.</p><p id="pc5i3w_1422">- Выполнение HTTP-запроса с использованием модуля httpc.</p><p id="pc5i3w_1423">- Парсинг ответа JSON с помощью библиотеки jsx.</p><p id="pc5i3w_1424">- Извлечение значений давления, температуры, влажности, скорости и направления ветра.</p><p id="pc5i3w_1425"></p></td></tr></tbody></table></div><p id="pc5i3w_1357"><span class="control" id="pc5i3w_1430">Примечания</span></p><ul class="list _bullet" id="pc5i3w_1358"><li class="list__item" id="pc5i3w_1431"><p id="pc5i3w_1436">Убедитесь, что у вас есть действительный ключ API OpenWeatherMap.</p></li><li class="list__item" id="pc5i3w_1432"><p id="pc5i3w_1437">Для повышения производительности рекомендуется кешировать результаты запросов.</p><section class="chapter"><h3 id="3-fp-userlib-archive" data-toc="3-fp-userlib-archive"><a name=""></a><span class="control" id="pc5i3w_1444">А.3 Модуль fp_userlib_archive</span></h3><p id="pc5i3w_1440">Модуль для работы с архивами. Предназначен для управления архивированием данных и взаимодействия с базой архивов, включая создание, удаление и обновление записей.</p><p id="pc5i3w_1441"><span class="control" id="pc5i3w_1445">Общая информация</span></p><p id="pc5i3w_1442">Модуль fp_userlib_archive предоставляет функцию для сохранения данных из CSV-файла в архив. Код написан на языке программирования Erlang. При возникновении ошибок транзакция будет отменена. Рекомендуется логировать информацию о процессе выполнения с использованием макросов:</p></section></li><li class="list__item" id="pc5i3w_1433"><p id="pc5i3w_1446">?LOGINFO</p></li><li class="list__item" id="pc5i3w_1434"><p id="pc5i3w_1447">?LOGWARNING</p></li><li class="list__item" id="pc5i3w_1435"><p id="pc5i3w_1448">?LOGERROR</p></li></ul><div class="table-wrapper"><table class="wide" id="pc5i3w_1359"><thead><tr class="ijRowHead" id="pc5i3w_1449"><th id="pc5i3w_1452"><p><span class="control" id="pc5i3w_1454">Функция</span></p></th><th id="pc5i3w_1453"><p><span class="control" id="pc5i3w_1455">Описание</span></p></th></tr></thead><tbody><tr id="pc5i3w_1450"><td id="pc5i3w_1456"><p>csv_to_archive/1</p></td><td id="pc5i3w_1457"><p id="pc5i3w_1458">: Сохраняет данные из CSV-файла, переданного в виде строки в формате Base64, в архив.</p><p id="pc5i3w_1459"><span class="control" id="pc5i3w_1477">Параметры</span>:</p><p id="pc5i3w_1460">- Args (map): Словарь с ключами:</p><p id="pc5i3w_1461">- archive_path (binary): Путь к архиву, куда будут записаны данные.</p><p id="pc5i3w_1462">- content (binary): Содержимое CSV-файла в формате Base64.</p><p id="pc5i3w_1463"><span class="control" id="pc5i3w_1478">Возвращает</span>: Атом ok в случае успешного выполнения или выбрасывает исключение в случае ошибки.</p><p id="pc5i3w_1464"><span class="control" id="pc5i3w_1479">Пример использования</span>:</p><p id="pc5i3w_1465">Args = #{</p><p id="pc5i3w_1466"><code class="code" id="pc5i3w_1480"></code> &lt;&lt;&quot;archive_path&quot;&gt;&gt; =&gt; &lt;&lt;&quot;/path/to/archive&quot;&gt;&gt;,</p><p id="pc5i3w_1467"><code class="code" id="pc5i3w_1481"></code> &lt;&lt;&quot;content&quot;&gt;&gt; =&gt; &lt;&lt;&quot;VGltZXN0YW1wLFZhbHVlCjE2NzMwMjUwMDAsMTIzLjQ1Cg==&quot;&gt;&gt; %% Base64-encoded CSV</p><p id="pc5i3w_1468">}.</p><p id="pc5i3w_1469">fp_userlib_archive:csv_to_archive(Args).</p><p id="pc5i3w_1470"><span class="control" id="pc5i3w_1482">Детали реализации</span>:</p><p id="pc5i3w_1471">- Декодирует содержимое CSV-файла из Base64 в бинарный формат.</p><p id="pc5i3w_1472">- Разделяет данные на строки и колонки.</p><p id="pc5i3w_1473">- Конвертирует данные времени (timestamp) и значений (value) в подходящие типы.</p><p id="pc5i3w_1474">- Пытается записать обработанные данные в указанный архив с помощью функции fp_archive:insert_values.</p><p id="pc5i3w_1475">- В случае ошибки записывает информацию в лог.</p><p id="pc5i3w_1476"></p></td></tr><tr id="pc5i3w_1451"><td id="pc5i3w_1483" colspan="2"></td></tr></tbody></table></div><p id="pc5i3w_1360"><span class="control" id="pc5i3w_1484">Примечания</span></p><ul class="list _bullet" id="pc5i3w_1361"><li class="list__item" id="pc5i3w_1485"><p id="pc5i3w_1491">Данные CSV-файла должны быть корректно закодированы в Base64.</p></li><li class="list__item" id="pc5i3w_1486"><p id="pc5i3w_1492">Архив, указанный в archive_path, должен существовать и быть доступным для записи.</p></li><li class="list__item" id="pc5i3w_1487"><p id="pc5i3w_1493">В случае возникновения исключений данные не будут записаны.</p><section class="chapter"><h3 id="4-fp-pf-utils" data-toc="4-fp-pf-utils"><a name=""></a><span class="control" id="pc5i3w_1501">А.4 Модуль fp_pf_utils</span></h3><p id="pc5i3w_1496">Вспомогательные функции для интеграции с PowerFactory (PF). Этот модуль помогает в управлении и мониторинге сетевых моделей, позволяя обмениваться данными между SCADA-системой и PF.</p><p id="pc5i3w_1497"><span class="control" id="pc5i3w_1502">Общая информация</span></p><p id="pc5i3w_1498">Модуль fp_pf_utils предоставляет функции для взаимодействия с PowerFactory Service. Основные функции включают операции для получения данных, выполнения расчётов и запуска динамических сценариев. Код написан на языке программирования Erlang. Все транзакции откатываются в случае ошибок, а успешное выполнение возвращает атом ok.</p><p id="pc5i3w_1499">Рекомендуется использовать следующие макросы для логирования:</p></section></li><li class="list__item" id="pc5i3w_1488"><p id="pc5i3w_1503">?LOGINFO</p></li><li class="list__item" id="pc5i3w_1489"><p id="pc5i3w_1504">?LOGWARNING</p></li><li class="list__item" id="pc5i3w_1490"><p id="pc5i3w_1505">?LOGERROR</p></li></ul><div class="table-wrapper"><table class="wide" id="pc5i3w_1362"><thead><tr class="ijRowHead" id="pc5i3w_1506"><th id="pc5i3w_1510"><p><span class="control" id="pc5i3w_1512">Функция</span></p></th><th id="pc5i3w_1511"><p><span class="control" id="pc5i3w_1513">Описание</span></p></th></tr></thead><tbody><tr id="pc5i3w_1507"><td id="pc5i3w_1514"><p>pf_get/0</p></td><td id="pc5i3w_1515"><p id="pc5i3w_1516">: Получает данные из PowerFactory на основе заданных параметров проекта.</p><p id="pc5i3w_1517"><span class="control" id="pc5i3w_1524">Параметры</span>: Нет.</p><p id="pc5i3w_1518"><span class="control" id="pc5i3w_1525">Возвращает</span>: Результат выполнения запроса к PowerFactory Service.</p><p id="pc5i3w_1519"><span class="control" id="pc5i3w_1526">Пример использования</span>:</p><p id="pc5i3w_1520">fp_pf_utils:pf_get().</p><p id="pc5i3w_1521"><span class="control" id="pc5i3w_1527">Детали реализации</span>:</p><p id="pc5i3w_1522">- Формирует параметры проекта, включая имя сетки, имя проекта, имя сценария и тип сессии.</p><p id="pc5i3w_1523">- Выполняет запрос через fp_powerfactory_service:pf_service_update с использованием хоста и порта.</p></td></tr><tr id="pc5i3w_1508"><td id="pc5i3w_1528"><p>pf_execute/0</p></td><td id="pc5i3w_1529"><p id="pc5i3w_1530">: Выполняет расчёт на основе заданных параметров проекта и указания идентификатора LDF.</p><p id="pc5i3w_1531"><span class="control" id="pc5i3w_1540">Параметры</span>: Нет.</p><p id="pc5i3w_1532"><span class="control" id="pc5i3w_1541">Возвращает</span>: Результат выполнения запроса к PowerFactory Service.</p><p id="pc5i3w_1533"><span class="control" id="pc5i3w_1542">Пример использования</span>:</p><p id="pc5i3w_1534">fp_pf_utils:pf_execute().</p><p id="pc5i3w_1535"><span class="control" id="pc5i3w_1543">Детали реализации</span>:</p><p id="pc5i3w_1536">- Формирует параметры проекта, включая имя сетки, имя проекта, имя сценария и тип сессии.</p><p id="pc5i3w_1537">- Определяет идентификатор объекта ComLdfOID для выполнения расчёта.</p><p id="pc5i3w_1538">- Выполняет запрос через fp_powerfactory_service:pf_service_update с использованием хоста и порта.</p><p id="pc5i3w_1539"></p></td></tr><tr id="pc5i3w_1509"><td id="pc5i3w_1544"><p>pf_dynamics/0</p></td><td id="pc5i3w_1545"><p id="pc5i3w_1546">: Запускает динамический сценарий расчёта на основе заданных параметров проекта.</p><p id="pc5i3w_1547"><span class="control" id="pc5i3w_1554">Параметры</span>: Нет.</p><p id="pc5i3w_1548"><span class="control" id="pc5i3w_1555">Возвращает</span>: Результат выполнения запроса к PowerFactory Service.</p><p id="pc5i3w_1549"><span class="control" id="pc5i3w_1556">Пример использования</span>:</p><p id="pc5i3w_1550">fp_pf_utils:pf_dynamics().</p><p id="pc5i3w_1551"><span class="control" id="pc5i3w_1557">Детали реализации</span>:</p><p id="pc5i3w_1552">- Формирует параметры проекта, включая имя сетки, имя проекта, имя сценария и тип сессии.</p><p id="pc5i3w_1553">- Выполняет запрос через fp_powerfactory_service:pf_service_update с использованием хоста и порта.</p></td></tr></tbody></table></div><p id="pc5i3w_1363"><span class="control" id="pc5i3w_1558">Примечания</span></p><ul class="list _bullet" id="pc5i3w_1364"><li class="list__item" id="pc5i3w_1559"><p id="pc5i3w_1561">Хост и порт для запросов определены через макросы ?HOST и ?PORT.</p></li><li class="list__item" id="pc5i3w_1560"><p id="pc5i3w_1562">Перед использованием функций убедитесь, что PowerFactory Service доступен по указанным параметрам.</p><section class="chapter"><h3 id="5-bms-service" data-toc="5-bms-service"><a name=""></a><span class="control" id="pc5i3w_1569">А.5 Модуль bms_service</span></h3><p id="pc5i3w_1565">Логика сервиса для системы рынка баланса. Этот модуль управляет обменом данными с балансирующим рынком, обрабатывая данные о спросе и предложении.</p><p id="pc5i3w_1566"><span class="control" id="pc5i3w_1570">Общая информация</span></p><p id="pc5i3w_1567">Модуль bms_service предоставляет функции для интеграции с REST API и обработки данных из внешних систем. Код написан на языке Erlang. Все методы модуля работают с объектами, позволяют редактировать их и обеспечивают откат транзакций в случае ошибок. Логирование рекомендуется выполнять с использованием макросов ?LOGINFO, ?LOGWARNING и ?LOGERROR.</p></section></li></ul><div class="table-wrapper"><table class="wide" id="pc5i3w_1365"><thead><tr class="ijRowHead" id="pc5i3w_1571"><th id="pc5i3w_1576"><p><span class="control" id="pc5i3w_1578">Функция</span></p></th><th id="pc5i3w_1577"><p><span class="control" id="pc5i3w_1579">Описание</span></p></th></tr></thead><tbody><tr id="pc5i3w_1572"><td id="pc5i3w_1580"><p>find_objects/1</p></td><td id="pc5i3w_1581"><p id="pc5i3w_1582">: Ищет объекты в хранилище данных на основе переданных фильтров.</p><p id="pc5i3w_1583"><span class="control" id="pc5i3w_1597">Параметры</span>:</p><p id="pc5i3w_1584">- Filter (map): Словарь, содержащий ключи:</p><p id="pc5i3w_1585">- &lt;&lt;&quot;.path&quot;&gt;&gt;: Корневой путь объекта.</p><p id="pc5i3w_1586">- &lt;&lt;&quot;.name&quot;&gt;&gt;: Имя объекта.</p><p id="pc5i3w_1587">- &lt;&lt;&quot;.prototype&quot;&gt;&gt;: Прототип объекта.</p><p id="pc5i3w_1588"><span class="control" id="pc5i3w_1598">Возвращает</span>: Список объектов, соответствующих заданным фильтрам, либо {error, [[], []]} в случае ошибки.</p><p id="pc5i3w_1589"><span class="control" id="pc5i3w_1599">Пример использования</span>:</p><p id="pc5i3w_1590">Filter = #{</p><p id="pc5i3w_1591"><code class="code" id="pc5i3w_1600"></code> &lt;&lt;&quot;.path&quot;&gt;&gt; =&gt; &lt;&lt;&quot;/root/PROJECT/&quot;&gt;&gt;,</p><p id="pc5i3w_1592"><code class="code" id="pc5i3w_1601"></code> &lt;&lt;&quot;.name&quot;&gt;&gt; =&gt; &lt;&lt;&quot;subject&quot;&gt;&gt;,</p><p id="pc5i3w_1593"><code class="code" id="pc5i3w_1602"></code> &lt;&lt;&quot;.prototype&quot;&gt;&gt; =&gt; &lt;&lt;&quot;/root/FP/prototypes/subject/fields&quot;&gt;&gt;</p><p id="pc5i3w_1594">}.</p><p id="pc5i3w_1595">bms_service:find_objects(Filter).</p><p id="pc5i3w_1596"></p></td></tr><tr id="pc5i3w_1573"><td id="pc5i3w_1603"><p>run/0</p></td><td id="pc5i3w_1604"><p id="pc5i3w_1605">: Основная функция для выполнения задачи. Осуществляет получение объектов, авторизацию через REST API, запрос данных и запись их в архивы.</p><p id="pc5i3w_1606"><span class="control" id="pc5i3w_1616">Параметры</span>: Нет.</p><p id="pc5i3w_1607"><span class="control" id="pc5i3w_1617">Возвращает</span>: Атом ok при успешном выполнении, либо описание ошибки.</p><p id="pc5i3w_1608"><span class="control" id="pc5i3w_1618">Пример использования</span>:</p><p id="pc5i3w_1609">bms_service:run().</p><p id="pc5i3w_1610"><span class="control" id="pc5i3w_1619">Детали реализации</span>:</p><p id="pc5i3w_1611">- Формирует фильтры для поиска объектов.</p><p id="pc5i3w_1612">- Выполняет запрос для получения токена авторизации через REST API.</p><p id="pc5i3w_1613">- Осуществляет запрос данных по объектам с использованием токена.</p><p id="pc5i3w_1614">- Преобразует полученные данные и записывает их в архивы.</p><p id="pc5i3w_1615"></p></td></tr><tr id="pc5i3w_1574"><td id="pc5i3w_1620"><p>write_to_db/2</p></td><td id="pc5i3w_1621"><p id="pc5i3w_1622">: Записывает данные в хранилище данных, удаляя старые записи в указанном диапазоне.</p><p id="pc5i3w_1623"><span class="control" id="pc5i3w_1630">Параметры</span>:</p><p id="pc5i3w_1624">- Data (list): Список данных для записи.</p><p id="pc5i3w_1625">- Archive (binary): Путь к архиву.</p><p id="pc5i3w_1626"><span class="control" id="pc5i3w_1631">Возвращает</span>: {ok, written_to_db} при успешной записи либо {error, {write_failure, Reason}} при ошибке.</p><p id="pc5i3w_1627"><span class="control" id="pc5i3w_1632">Пример использования</span>:</p><p id="pc5i3w_1628">bms_service:write_to_db(Data, Archive).</p><p id="pc5i3w_1629"></p></td></tr><tr id="pc5i3w_1575"><td id="pc5i3w_1633"><p>extract_data/2</p></td><td id="pc5i3w_1634"><p id="pc5i3w_1635">: Извлекает и преобразует данные из ответа API для последующей обработки.</p><p id="pc5i3w_1636"><span class="control" id="pc5i3w_1642">Параметры</span>:</p><p id="pc5i3w_1637">- Objects (list): Список объектов для обработки.</p><p id="pc5i3w_1638">- Response (map): Ответ от REST API.</p><p id="pc5i3w_1639"><span class="control" id="pc5i3w_1643">Возвращает</span>: Преобразованные данные или ok, если дата не соответствует требованиям.</p><p id="pc5i3w_1640"><span class="control" id="pc5i3w_1644">Пример использования</span>:</p><p id="pc5i3w_1641">bms_service:extract_data(Objects, Response).</p></td></tr></tbody></table></div><p id="pc5i3w_1366"><span class="control" id="pc5i3w_1645">Примечания</span></p><ul class="list _bullet" id="pc5i3w_1367"><li class="list__item" id="pc5i3w_1646"><p id="pc5i3w_1650">Функции transform_purchases/2 и transform_sales/2 используются для преобразования данных покупок и продаж в формате {Timestamp, Value}.</p></li><li class="list__item" id="pc5i3w_1647"><p id="pc5i3w_1651">Убедитесь, что REST API доступен и корректно настроен для выполнения запросов.</p></li><li class="list__item" id="pc5i3w_1648"><p id="pc5i3w_1652">Все временные метки преобразуются в миллисекунды для использования в архивах.</p></li><li class="list__item" id="pc5i3w_1649"><p id="pc5i3w_1653">При работе с датами используются вспомогательные функции is_today/1 и is_tomorrow/1 для определения актуальности данных.</p><section class="chapter"><h3 id="6-calculation-v2" data-toc="6-calculation-v2"><a name=""></a><span class="control" id="pc5i3w_1660">А.6 Модуль calculation (v2)</span></h3><p id="pc5i3w_1656">Модуль для выполнения различных вычислений. Поддерживает более сложные операции, включая обработку данных в режиме реального времени.</p><p id="pc5i3w_1657"><span class="control" id="pc5i3w_1661">Общая информация</span></p><p id="pc5i3w_1658">Модуль calculation предоставляет функцию для вычисления значений на основе строки, содержащей арифметические операции, такие как сложение и вычитание. Код написан на языке Erlang и включает обработку ошибок и логирование. Основная цель &mdash; обработка строк с числами и получение вычисленного результата.</p></section></li></ul><div class="table-wrapper"><table class="wide" id="pc5i3w_1368"><thead><tr class="ijRowHead" id="pc5i3w_1662"><th id="pc5i3w_1672"><p><span class="control" id="pc5i3w_1674">Функция</span></p></th><th id="pc5i3w_1673"><p><span class="control" id="pc5i3w_1675">Описание</span></p></th></tr></thead><tbody><tr id="pc5i3w_1663"><td id="pc5i3w_1676"><p>evaluate/2</p></td><td id="pc5i3w_1677"><p id="pc5i3w_1678">: Выполняет вычисление на основе переданной строки с арифметическими операциями.</p><p id="pc5i3w_1679"><span class="control" id="pc5i3w_1690">Параметры</span>:</p><p id="pc5i3w_1680">- Name (binary): Имя объекта, которое используется для получения дополнительных значений.</p><p id="pc5i3w_1681">- String (binary): Строка с числами и арифметическими операциями (+ и -).</p><p id="pc5i3w_1682"><span class="control" id="pc5i3w_1691">Возвращает</span>: Вычисленное числовое значение или {error, Reason} в случае ошибки.</p><p id="pc5i3w_1683"><span class="control" id="pc5i3w_1692">Пример использования</span>:</p><p id="pc5i3w_1684">calculation:evaluate(&lt;&lt;&quot;example&quot;&gt;&gt;, &lt;&lt;&quot;10+20-5&quot;&gt;&gt;).</p><p id="pc5i3w_1685"><span class="control" id="pc5i3w_1693">Детали реализации</span>:</p><p id="pc5i3w_1686">- Проверяет, является ли String бинарной строкой.</p><p id="pc5i3w_1687">- Разбивает строку на токены с помощью функции tokenize/1.</p><p id="pc5i3w_1688">- Передаёт токены в функцию evaluate_tokens/2 для выполнения вычислений.</p><p id="pc5i3w_1689">- Логирует ошибки, если они возникают.</p></td></tr><tr id="pc5i3w_1664"><td id="pc5i3w_1694"><p>tokenize/1</p></td><td id="pc5i3w_1695"><p id="pc5i3w_1696">: Разбивает строку на токены по операторам + и -.</p><p id="pc5i3w_1697"><span class="control" id="pc5i3w_1703">Параметры</span>:</p><p id="pc5i3w_1698">- String (binary): Входная строка.</p><p id="pc5i3w_1699"><span class="control" id="pc5i3w_1704">Возвращает</span>: Список токенов в виде бинарных строк.</p><p id="pc5i3w_1700"><span class="control" id="pc5i3w_1705">Пример использования</span>:</p><p id="pc5i3w_1701">calculation:tokenize(&lt;&lt;&quot;10+20-5&quot;&gt;&gt;).</p><p id="pc5i3w_1702"></p></td></tr><tr id="pc5i3w_1665"><td id="pc5i3w_1706"><p>evaluate_tokens/2</p></td><td id="pc5i3w_1707"><p id="pc5i3w_1708">: Выполняет вычисление на основе списка токенов.</p><p id="pc5i3w_1709"><span class="control" id="pc5i3w_1716">Параметры</span>:</p><p id="pc5i3w_1710">- Name (binary): Имя объекта.</p><p id="pc5i3w_1711">- Tokens (list): Список токенов (числа, операторы + и -).</p><p id="pc5i3w_1712"><span class="control" id="pc5i3w_1717">Возвращает</span>: Результат вычисления.</p><p id="pc5i3w_1713"><span class="control" id="pc5i3w_1718">Пример использования</span>:</p><p id="pc5i3w_1714">calculation:evaluate_tokens(&lt;&lt;&quot;example&quot;&gt;&gt;, [&lt;&lt;&quot;10&quot;&gt;&gt;, &lt;&lt;&quot;+&quot;&gt;&gt;, &lt;&lt;&quot;20&quot;&gt;&gt;, &lt;&lt;&quot;-&quot;&gt;&gt;, &lt;&lt;&quot;5&quot;&gt;&gt;]).</p><p id="pc5i3w_1715"></p></td></tr><tr id="pc5i3w_1666"><td id="pc5i3w_1719"><p>get_value/1</p></td><td id="pc5i3w_1720"><p id="pc5i3w_1721">: Получает значение поля out_value из объекта в хранилище данных.</p><p id="pc5i3w_1722"><span class="control" id="pc5i3w_1728">Параметры</span>:</p><p id="pc5i3w_1723">Token (binary): Путь к объекту в виде строки.</p><p id="pc5i3w_1724"><span class="control" id="pc5i3w_1729">Возвращает</span>: Значение поля out_value или вызывает исключение в случае ошибки.</p><p id="pc5i3w_1725"><span class="control" id="pc5i3w_1730">Пример использования</span>:</p><p id="pc5i3w_1726">calculation:get_value(&lt;&lt;&quot;/root/FP/PROJECT/example&quot;&gt;&gt;).</p><p id="pc5i3w_1727"></p></td></tr><tr id="pc5i3w_1667"><td id="pc5i3w_1731"><p>get_catalog/2</p></td><td id="pc5i3w_1732"><p id="pc5i3w_1733">: Получает значение из каталога формул и вычисляет его, если оно содержит арифметическое выражение.</p><p id="pc5i3w_1734"><span class="control" id="pc5i3w_1741">Параметры</span>:</p><p id="pc5i3w_1735">- Name (binary): Имя объекта.</p><p id="pc5i3w_1736">- Token (binary): Идентификатор формулы.</p><p id="pc5i3w_1737"><span class="control" id="pc5i3w_1742">Возвращает</span>: Числовое значение или результат вычисления.</p><p id="pc5i3w_1738"><span class="control" id="pc5i3w_1743">Пример использования</span>:</p><p id="pc5i3w_1739">calculation:get_catalog(&lt;&lt;&quot;example&quot;&gt;&gt;, &lt;&lt;&quot;formula_1&quot;&gt;&gt;).</p><p id="pc5i3w_1740"></p></td></tr><tr id="pc5i3w_1668"><td id="pc5i3w_1744"><p>split_path/1</p></td><td id="pc5i3w_1745"><p id="pc5i3w_1746">: Разделяет путь на папку и имя объекта.</p><p id="pc5i3w_1747"><span class="control" id="pc5i3w_1753">Параметры</span>:</p><p id="pc5i3w_1748">- Bin (binary): Полный путь к объекту.</p><p id="pc5i3w_1749"><span class="control" id="pc5i3w_1754">Возвращает</span>: Кортеж {Folder, Name}.</p><p id="pc5i3w_1750"><span class="control" id="pc5i3w_1755">Пример использования</span>:</p><p id="pc5i3w_1751">calculation:split_path(&lt;&lt;&quot;/root/FP/PROJECT/example&quot;&gt;&gt;).</p><p id="pc5i3w_1752"></p></td></tr><tr id="pc5i3w_1669"><td id="pc5i3w_1756"><p>strings_to_binaries/1</p></td><td id="pc5i3w_1757"><p id="pc5i3w_1758">: Преобразует список строк в список бинарных строк.</p><p id="pc5i3w_1759"><span class="control" id="pc5i3w_1764">Параметры</span>:</p><p id="pc5i3w_1760">- Strings (list): Список строк.</p><p id="pc5i3w_1761"><span class="control" id="pc5i3w_1765">Возвращает</span>: Список бинарных строк.</p><p id="pc5i3w_1762"><span class="control" id="pc5i3w_1766">Пример использования</span>:</p><p id="pc5i3w_1763">calculation:strings_to_binaries([&quot;10&quot;, &quot;+&quot;, &quot;20&quot;, &quot;-&quot;, &quot;5&quot;]).</p></td></tr><tr id="pc5i3w_1670"><td id="pc5i3w_1767"><p>token_is_docker/1</p></td><td id="pc5i3w_1768"><p id="pc5i3w_1769">: Проверяет, является ли токен идентификатором объекта в системе Docker.</p><p id="pc5i3w_1770"><span class="control" id="pc5i3w_1775">Параметры</span>:</p><p id="pc5i3w_1771">- Token (binary): Токен для проверки.</p><p id="pc5i3w_1772"><span class="control" id="pc5i3w_1776">Возвращает</span>: true или false.</p><p id="pc5i3w_1773"><span class="control" id="pc5i3w_1777">Пример использования</span>:</p><p id="pc5i3w_1774">calculation:token_is_docker(&lt;&lt;&quot;/docker/object&quot;&gt;&gt;).</p></td></tr><tr id="pc5i3w_1671"><td id="pc5i3w_1778"><p>token_type/1</p></td><td id="pc5i3w_1779"><p id="pc5i3w_1780">: Определяет тип токена (целое число, число с плавающей точкой или неизвестный тип).</p><p id="pc5i3w_1781"><span class="control" id="pc5i3w_1787">Параметры</span>:</p><p id="pc5i3w_1782">- Token (binary): Токен для анализа.</p><p id="pc5i3w_1783"><span class="control" id="pc5i3w_1788">Возвращает</span>: int, float или false.</p><p id="pc5i3w_1784"><span class="control" id="pc5i3w_1789">Пример использования</span>:</p><p id="pc5i3w_1785">calculation:token_type(&lt;&lt;&quot;10.5&quot;&gt;&gt;).</p><p id="pc5i3w_1786"></p></td></tr></tbody></table></div><p id="pc5i3w_1369"><span class="control" id="pc5i3w_1790">Примечания</span></p><ul class="list _bullet" id="pc5i3w_1370"><li class="list__item" id="pc5i3w_1791"><p id="pc5i3w_1794">Убедитесь, что входная строка корректно сформирована и содержит только поддерживаемые операторы и числа.</p></li><li class="list__item" id="pc5i3w_1792"><p id="pc5i3w_1795">В случае ошибок вызовите логирование для диагностики причин.</p></li><li class="list__item" id="pc5i3w_1793"><p id="pc5i3w_1796">Функции работают с бинарными строками, поэтому при вводе данных убедитесь, что строки находятся в правильном формате.</p><section class="chapter"><h3 id="7-docker-client-v0-1" data-toc="7-docker-client-v0-1"><a name=""></a><span class="control" id="pc5i3w_1803">А.7 Модуль docker_client (v0.1)</span></h3><p id="pc5i3w_1799">Клиент для взаимодействия с Docker. Используется для управления контейнерами Docker из среды Faceplate Studio, что удобно для разворачивания и мониторинга приложений в контейнерах.</p><p id="pc5i3w_1800"><span class="control" id="pc5i3w_1804">Общая информация</span></p><p id="pc5i3w_1801">Модуль docker_client предоставляет интерфейс для взаимодействия с Docker Engine через API. Функции модуля позволяют получать список контейнеров, создавать и запускать контейнеры. Код написан на языке Erlang.</p></section></li></ul><div class="table-wrapper"><table class="wide" id="pc5i3w_1371"><thead><tr class="ijRowHead" id="pc5i3w_1805"><th id="pc5i3w_1809"><p><span class="control" id="pc5i3w_1811">Функция</span></p></th><th id="pc5i3w_1810"><p><span class="control" id="pc5i3w_1812">Описание</span></p></th></tr></thead><tbody><tr id="pc5i3w_1806"><td id="pc5i3w_1813"><p>list_containers/0</p></td><td id="pc5i3w_1814"><p id="pc5i3w_1815">: Возвращает список контейнеров, запущенных в Docker Engine.</p><p id="pc5i3w_1816"><span class="control" id="pc5i3w_1827">Параметры</span>: Нет.</p><p id="pc5i3w_1817"><span class="control" id="pc5i3w_1828">Возвращает</span>:</p><p id="pc5i3w_1818">- {ok, Containers}: Список контейнеров в формате JSON.</p><p id="pc5i3w_1819">- {error, {unexpected_status, StatusCode}}: Неожиданный HTTP-код ответа.</p><p id="pc5i3w_1820">- {error, Reason}: Причина ошибки при выполнении запроса.</p><p id="pc5i3w_1821"><span class="control" id="pc5i3w_1829">Пример использования</span>:</p><p id="pc5i3w_1822">docker_client:list_containers().</p><p id="pc5i3w_1823"><span class="control" id="pc5i3w_1830">Детали реализации</span>:</p><p id="pc5i3w_1824">- Формирует URL для запроса /containers/json.</p><p id="pc5i3w_1825">- Выполняет HTTP GET-запрос.</p><p id="pc5i3w_1826">- Декодирует ответ JSON или возвращает ошибку при некорректном статусе.</p></td></tr><tr id="pc5i3w_1807"><td id="pc5i3w_1831"><p>create_container/1</p></td><td id="pc5i3w_1832"><p id="pc5i3w_1833">: Создаёт новый контейнер на основе указанного образа.</p><p id="pc5i3w_1834"><span class="control" id="pc5i3w_1847">Параметры</span>:</p><p id="pc5i3w_1835">- Image (binary): Имя образа Docker.</p><p id="pc5i3w_1836"><span class="control" id="pc5i3w_1848">Возвращает</span>:</p><p id="pc5i3w_1837">- {ok, ContainerInfo}: Информация о созданном контейнере.</p><p id="pc5i3w_1838">- {error, {unexpected_status, StatusCode}}: Неожиданный HTTP-код ответа.</p><p id="pc5i3w_1839">- {error, Reason}: Причина ошибки при выполнении запроса.</p><p id="pc5i3w_1840"><span class="control" id="pc5i3w_1849">Пример использования</span>:</p><p id="pc5i3w_1841">docker_client:create_container(&lt;&lt;&quot;nginx&quot;&gt;&gt;).</p><p id="pc5i3w_1842"><span class="control" id="pc5i3w_1850">Детали реализации</span>:</p><p id="pc5i3w_1843">- Формирует URL для запроса /containers/create.</p><p id="pc5i3w_1844">- Кодирует тело запроса в формате JSON, включая имя образа и команду.</p><p id="pc5i3w_1845">- Выполняет HTTP POST-запрос.</p><p id="pc5i3w_1846">- Декодирует ответ JSON или возвращает ошибку при некорректном статусе.</p></td></tr><tr id="pc5i3w_1808"><td id="pc5i3w_1851"><p>start_container/1</p></td><td id="pc5i3w_1852"><p id="pc5i3w_1853">: Запускает контейнер с указанным идентификатором.</p><p id="pc5i3w_1854"><span class="control" id="pc5i3w_1866">Параметры</span>:</p><p id="pc5i3w_1855">- ContainerId (binary): Идентификатор контейнера.</p><p id="pc5i3w_1856"><span class="control" id="pc5i3w_1867">Возвращает</span>:</p><p id="pc5i3w_1857">- {ok, &lt;&lt;&quot;Container started successfully&quot;&gt;&gt;}: Контейнер успешно запущен.</p><p id="pc5i3w_1858">- {error, {unexpected_status, StatusCode}}: Неожиданный HTTP-код ответа.</p><p id="pc5i3w_1859">- {error, Reason}: Причина ошибки при выполнении запроса.</p><p id="pc5i3w_1860"><span class="control" id="pc5i3w_1868">Пример использования</span>:</p><p id="pc5i3w_1861">docker_client:start_container(&lt;&lt;&quot;e90e34656806&quot;&gt;&gt;).</p><p id="pc5i3w_1862"><span class="control" id="pc5i3w_1869">Детали реализации</span>:</p><p id="pc5i3w_1863">- Формирует URL для запроса /containers//start.</p><p id="pc5i3w_1864">- Выполняет HTTP POST-запрос.</p><p id="pc5i3w_1865">- Возвращает сообщение об успешном запуске или ошибку при некорректном статусе.</p></td></tr></tbody></table></div><p id="pc5i3w_1372"><span class="control" id="pc5i3w_1870">Конфигурация</span></p><p id="pc5i3w_1373"><span class="control" id="pc5i3w_1871">Базовый URL</span>: Определён через макрос ?DOCKER_URL и по умолчанию равен http://localhost:2375.</p><p id="pc5i3w_1374"><span class="control" id="pc5i3w_1872">Примечания</span></p><ul class="list _bullet" id="pc5i3w_1375"><li class="list__item" id="pc5i3w_1873"><p id="pc5i3w_1876">Для работы функций требуется, чтобы Docker API был доступен по указанному адресу.</p></li><li class="list__item" id="pc5i3w_1874"><p id="pc5i3w_1877">Функции используют библиотеку HTTP клиента httpc и JSON-парсер jsx.</p></li><li class="list__item" id="pc5i3w_1875"><p id="pc5i3w_1878">В случае ошибок рекомендуется использовать логирование с помощью макросов ?LOGINFO, ?LOGWARNING, ?LOGERROR.</p><section class="chapter"><h3 id="8-fp-powerfactory-service" data-toc="8-fp-powerfactory-service"><a name=""></a><span class="control" id="pc5i3w_1885">А.8 Модуль fp_powerfactory_service</span></h3><p id="pc5i3w_1881">Модуль для интеграции с PowerFactory (PF).</p><p id="pc5i3w_1882"><span class="control" id="pc5i3w_1886">Общая информация</span></p><p id="pc5i3w_1883">Модуль fp_powerfactory_service предназначен для интеграции SCADA-системы Faceplate с расчетным ПО PowerFactory. Он обеспечивает обмен данными между этими системами посредством формирования, отправки и обработки JSON-запросов через промежуточный сервер server.py.</p></section></li></ul><div class="table-wrapper"><table class="wide" id="pc5i3w_1376"><thead><tr class="ijRowHead" id="pc5i3w_1887"><th id="pc5i3w_1891"><p><span class="control" id="pc5i3w_1893">Функция</span></p></th><th id="pc5i3w_1892"><p><span class="control" id="pc5i3w_1894">Описание</span></p></th></tr></thead><tbody><tr id="pc5i3w_1888"><td id="pc5i3w_1895"><p>pf_service_update(Params, [OID], Host, Port)</p></td><td id="pc5i3w_1896"><p id="pc5i3w_1897"><span class="control" id="pc5i3w_1922">Параметры:</span></p><p id="pc5i3w_1898">Params: Должен содержать структуру следующего вида:</p><p id="pc5i3w_1899">#{</p><p id="pc5i3w_1900"><code class="code" id="pc5i3w_1923"></code> &lt;&lt;&quot;study_case_name&quot;&gt;&gt; =&gt;</p><p id="pc5i3w_1901">&lt;&lt;&quot;Study Case&quot;&gt;&gt;,</p><p id="pc5i3w_1902"><code class="code" id="pc5i3w_1924"></code> &lt;&lt;&quot;session_type&quot;&gt;&gt;</p><p id="pc5i3w_1903">=&gt; &lt;&lt;&quot;calculation&quot;&gt;&gt;,</p><p id="pc5i3w_1904"><code class="code" id="pc5i3w_1925"></code> &lt;&lt;&quot;project_name&quot;&gt;&gt;</p><p id="pc5i3w_1905">=&gt; &lt;&lt;&quot;.MODEL_SCADA_V1107___DEMO(1)&quot;&gt;&gt;,</p><p id="pc5i3w_1906"><code class="code" id="pc5i3w_1926"></code> &lt;&lt;&quot;operation_scenario_name&quot;&gt;&gt;</p><p id="pc5i3w_1907">=&gt; &lt;&lt;&quot;dyn&quot;&gt;&gt;,</p><p id="pc5i3w_1908"><code class="code" id="pc5i3w_1927"></code> &lt;&lt;&quot;id&quot;&gt;&gt; =&gt; 1,</p><p id="pc5i3w_1909"><code class="code" id="pc5i3w_1928"></code> &lt;&lt;&quot;grid_name&quot;&gt;&gt;</p><p id="pc5i3w_1910">=&gt; &quot;Grid&quot;,</p><p id="pc5i3w_1911"><code class="code" id="pc5i3w_1929"></code> &lt;&lt;&quot;func_name&quot;&gt;&gt;</p><p id="pc5i3w_1912">=&gt; &quot;get&quot;</p><p id="pc5i3w_1913">},</p><p id="pc5i3w_1914">где &quot;func_name&quot; должно содержать имя функции, которая используется для формирования json, поле &quot;id&quot; должно содержать идентификатор текущего экземпляра faceplate, остальные поля должны содержать параметры проекта PowerFactory, который будет использоваться для расчетов.</p><p id="pc5i3w_1915">[OID]: Может содержать либо пустой erlang лист, либо OID передаваемого объекта.</p><p id="pc5i3w_1916">Host и Port: адрес и порт сервера, на котором должен быть запущен server.py.</p><p id="pc5i3w_1917"><span class="control" id="pc5i3w_1930">Возвращает</span>: Json-результат выполнения запроса.</p><p id="pc5i3w_1918"><span class="control" id="pc5i3w_1931">Пример использования:</span></p><p id="pc5i3w_1919">fp_powerfactory_service:pf_service_update(Params, [], &quot;127.0.0.1&quot;, 8080).</p><p id="pc5i3w_1920"><span class="control" id="pc5i3w_1932">Детали реализации</span>:</p><p id="pc5i3w_1921">Данная функция не создает новые объекты в хранилище данных Faceplate, если объекты в принятом от PowerFactory json не найдены в базе данных Faceplate.</p></td></tr><tr id="pc5i3w_1889"><td id="pc5i3w_1933"><p>pf_service_create_update(Params, [OID], Host, Port)</p></td><td id="pc5i3w_1934"><p id="pc5i3w_1935">: Создает новые объекты в хранилище данных Faceplate, если объекты в принятом от PowerFactory json не найдены в хранилище данных Faceplate.</p><p id="pc5i3w_1936"><span class="control" id="pc5i3w_1961">Параметры:</span></p><p id="pc5i3w_1937">Params: Должен содержать структуру следующего вида:</p><p id="pc5i3w_1938">#{</p><p id="pc5i3w_1939"><code class="code" id="pc5i3w_1962"></code> &lt;&lt;&quot;study_case_name&quot;&gt;&gt; =&gt;</p><p id="pc5i3w_1940">&lt;&lt;&quot;Study Case&quot;&gt;&gt;,</p><p id="pc5i3w_1941"><code class="code" id="pc5i3w_1963"></code> &lt;&lt;&quot;session_type&quot;&gt;&gt;</p><p id="pc5i3w_1942">=&gt; &lt;&lt;&quot;calculation&quot;&gt;&gt;,</p><p id="pc5i3w_1943"><code class="code" id="pc5i3w_1964"></code> &lt;&lt;&quot;project_name&quot;&gt;&gt;</p><p id="pc5i3w_1944">=&gt; &lt;&lt;&quot;.MODEL_SCADA_V1107___DEMO(1)&quot;&gt;&gt;,</p><p id="pc5i3w_1945"><code class="code" id="pc5i3w_1965"></code> &lt;&lt;&quot;operation_scenario_name&quot;&gt;&gt;</p><p id="pc5i3w_1946">=&gt; &lt;&lt;&quot;dyn&quot;&gt;&gt;,</p><p id="pc5i3w_1947"><code class="code" id="pc5i3w_1966"></code> &lt;&lt;&quot;id&quot;&gt;&gt; =&gt; 1,</p><p id="pc5i3w_1948"><code class="code" id="pc5i3w_1967"></code> &lt;&lt;&quot;grid_name&quot;&gt;&gt;</p><p id="pc5i3w_1949">=&gt; &quot;Grid&quot;,</p><p id="pc5i3w_1950"><code class="code" id="pc5i3w_1968"></code> &lt;&lt;&quot;func_name&quot;&gt;&gt;</p><p id="pc5i3w_1951">=&gt; &quot;get&quot;</p><p id="pc5i3w_1952">},</p><p id="pc5i3w_1953">где &quot;func_name&quot; должно содержать имя функции, которая используется для формирования json, поле &quot;id&quot; должно содержать идентификатор текущего экземпляра faceplate, остальные поля должны содержать параметры проекта PowerFactory, который будет использоваться для расчетов.</p><p id="pc5i3w_1954">[OID]: Может содержать либо пустой erlang лист, либо OID передаваемого объекта.</p><p id="pc5i3w_1955">Host и Port: адрес и порт сервера, на котором должен быть запущен server.py.</p><p id="pc5i3w_1956"><span class="control" id="pc5i3w_1969">Возвращает</span>: Json-результат выполнения запроса.</p><p id="pc5i3w_1957"><span class="control" id="pc5i3w_1970">Пример использования:</span></p><p id="pc5i3w_1958">fp_powerfactory_service:pf_service_create_update(Params, [], &quot;127.0.0.1&quot;, 8080).</p><p id="pc5i3w_1959"><span class="control" id="pc5i3w_1971">Детали реализации</span>:</p><p id="pc5i3w_1960">Может использоваться для создания объектов в каталогах (например, для загрузки библиотеки базовых типов из PowerFactory).</p></td></tr><tr id="pc5i3w_1890"><td id="pc5i3w_1972"><p>pf_service_get_section(ts, funct)</p></td><td id="pc5i3w_1973"><p id="pc5i3w_1974">: предназначена для формирования так называемого &quot;среза&quot; данных. Срез данных представляет собой json, сформированный по принципам, описанным в п.6.1.</p><p id="pc5i3w_1975">Отличия заключается в том, что данные для формирования json извлекаются не из полей объектов Faceplate, а из соответствующих этим полям архивов.</p><p id="pc5i3w_1976"><span class="control" id="pc5i3w_1983">Параметры:</span></p><p id="pc5i3w_1977">ts: Определяет момент времени, для которого нужно получить данные.</p><p id="pc5i3w_1978">funct: Содержит название функции, которая используется для формирования json (см. п 6.1).</p><p id="pc5i3w_1979"><span class="control" id="pc5i3w_1984">Возвращает:</span><br> Json-объект с данными за указанный момент времени.</p><p id="pc5i3w_1980"><span class="control" id="pc5i3w_1986">Пример использования:</span></p><p id="pc5i3w_1981">fp_powerfactory_service:pf_service_get_section(1669387200, &quot;get_section&quot;).</p><p id="pc5i3w_1982"><span class="control" id="pc5i3w_1987">Детали реализации:</span><br> Принципы формирования Json соответствуют описанию в п. 6.1, с той разницей, что данные извлекаются не из полей объектов Faceplate, а из архивов.</p></td></tr></tbody></table></div></section><section class="chapter"><h2 id="9-fp-powerfactory-service-old" data-toc="9-fp-powerfactory-service-old"><a name=""></a><span class="control" id="pc5i3w_2073">А.9 Модуль fp_powerfactory_service_old</span></h2><p id="pc5i3w_1990">Модуль для интеграции с PowerFactory (PF). Версия предназначена для работы с более старым функционалом PF.</p><p id="pc5i3w_1991"><span class="control" id="pc5i3w_2074">Общая информация</span></p><p id="pc5i3w_1992">Модуль fp_powerfactory_service_old предоставляет API для интеграции с PowerFactory. Его функциональность включает управление каталогами оборудования, вызов функций PowerFactory и обработку связанных данных. Код написан на языке Erlang и включает механизмы логирования и обработки ошибок.</p><div class="table-wrapper"><table class="wide" id="pc5i3w_1993"><thead><tr class="ijRowHead" id="pc5i3w_2075"><th id="pc5i3w_2085"><p><span class="control" id="pc5i3w_2087">Функция</span></p></th><th id="pc5i3w_2086"><p><span class="control" id="pc5i3w_2088">Описание</span></p></th></tr></thead><tbody><tr id="pc5i3w_2076"><td id="pc5i3w_2089"><p>on_init/0</p></td><td id="pc5i3w_2090"><p id="pc5i3w_2091">: Инициализирует модуль, добавляя JSON-API для взаимодействия с PowerFactory.</p><p id="pc5i3w_2092"><span class="control" id="pc5i3w_2096">Параметры</span>: Нет.</p><p id="pc5i3w_2093"><span class="control" id="pc5i3w_2097">Возвращает</span>: Атом ok при успешной инициализации.</p><p id="pc5i3w_2094"><span class="control" id="pc5i3w_2098">Пример использования</span>:</p><p id="pc5i3w_2095">fp_powerfactory_service_old:on_init().</p></td></tr><tr id="pc5i3w_2077"><td id="pc5i3w_2099"><p>power_factory_import_equipment_library/1</p></td><td id="pc5i3w_2100"><p id="pc5i3w_2101">: Импортирует библиотеку оборудования в PowerFactory.</p><p id="pc5i3w_2102"><span class="control" id="pc5i3w_2107">Параметры</span>:</p><p id="pc5i3w_2103">- {CatalogName, PFProjectParamsPath}: Кортеж, содержащий имя каталога и путь к параметрам проекта PowerFactory.</p><p id="pc5i3w_2104"><span class="control" id="pc5i3w_2108">Возвращает</span>: Результат выполнения функции.</p><p id="pc5i3w_2105"><span class="control" id="pc5i3w_2109">Пример использования</span>:</p><p id="pc5i3w_2106">fp_powerfactory_service_old:power_factory_import_equipment_library({&lt;&lt;&quot;CatalogName&quot;&gt;&gt;, &lt;&lt;&quot;/path/to/project/params&quot;&gt;&gt;}).</p></td></tr><tr id="pc5i3w_2078"><td id="pc5i3w_2110"><p>get_equipment_library_catalog/1</p></td><td id="pc5i3w_2111"><p id="pc5i3w_2112">: Возвращает идентификаторы содержимого и полей каталога оборудования.</p><p id="pc5i3w_2113"><span class="control" id="pc5i3w_2120">Параметры</span>:</p><p id="pc5i3w_2114">- CatalogName (binary): Имя каталога.</p><p id="pc5i3w_2115"><span class="control" id="pc5i3w_2121">Возвращает</span>:</p><p id="pc5i3w_2116">- {ContentOID, FieldsOID}: Кортеж с идентификаторами содержимого и полей каталога.</p><p id="pc5i3w_2117">- Выбрасывает исключение, если каталог не найден.</p><p id="pc5i3w_2118"><span class="control" id="pc5i3w_2122">Пример использования</span>:</p><p id="pc5i3w_2119">fp_powerfactory_service_old:get_equipment_library_catalog(&lt;&lt;&quot;CatalogName&quot;&gt;&gt;).</p></td></tr><tr id="pc5i3w_2079"><td id="pc5i3w_2123"><p>power_factory_call_function/1</p></td><td id="pc5i3w_2124"><p id="pc5i3w_2125">: Выполняет вызов функции PowerFactory.</p><p id="pc5i3w_2126"><span class="control" id="pc5i3w_2131">Параметры</span>:</p><p id="pc5i3w_2127">- {Context, PFProjectParamsPath, FunctionName}: Кортеж, содержащий контекст, путь к параметрам проекта и имя функции.</p><p id="pc5i3w_2128"><span class="control" id="pc5i3w_2132">Возвращает</span>: Результат вызова функции в формате HTTP-ответа.</p><p id="pc5i3w_2129"><span class="control" id="pc5i3w_2133">Пример использования</span>:</p><p id="pc5i3w_2130">fp_powerfactory_service_old:power_factory_call_function({Context, &lt;&lt;&quot;/path/to/params&quot;&gt;&gt;, &lt;&lt;&quot;function_name&quot;&gt;&gt;}).</p></td></tr><tr id="pc5i3w_2080"><td id="pc5i3w_2134"><p>power_factory_call_function_old/1</p></td><td id="pc5i3w_2135"><p id="pc5i3w_2136">: Устаревший метод вызова функции PowerFactory с дополнительным логированием.</p><p id="pc5i3w_2137"><span class="control" id="pc5i3w_2142">Параметры</span>:</p><p id="pc5i3w_2138">- {Context, PFProjectParamsPath, FunctionName}: Кортеж, содержащий контекст, путь к параметрам проекта и имя функции.</p><p id="pc5i3w_2139"><span class="control" id="pc5i3w_2143">Возвращает</span>: Результат вызова функции в формате HTTP-ответа.</p><p id="pc5i3w_2140"><span class="control" id="pc5i3w_2144">Пример использования</span>:</p><p id="pc5i3w_2141">fp_powerfactory_service_old:power_factory_call_function_old({Context, &lt;&lt;&quot;/path/to/params&quot;&gt;&gt;, &lt;&lt;&quot;function_name&quot;&gt;&gt;}).</p></td></tr><tr id="pc5i3w_2081"><td id="pc5i3w_2145"><p>get_pf_project_params/1</p></td><td id="pc5i3w_2146"><p id="pc5i3w_2147">: Возвращает параметры проекта PowerFactory.</p><p id="pc5i3w_2148"><span class="control" id="pc5i3w_2153">Параметры</span>:</p><p id="pc5i3w_2149">- PFProjectParamsPath (binary): Путь к параметрам проекта.</p><p id="pc5i3w_2150"><span class="control" id="pc5i3w_2154">Возвращает</span>: Словарь с параметрами проекта.</p><p id="pc5i3w_2151"><span class="control" id="pc5i3w_2155">Пример использования</span>:</p><p id="pc5i3w_2152">fp_powerfactory_service_old:get_pf_project_params(&lt;&lt;&quot;/path/to/project/params&quot;&gt;&gt;).</p></td></tr><tr id="pc5i3w_2082"><td id="pc5i3w_2156"><p>load_config/0</p></td><td id="pc5i3w_2157"><p id="pc5i3w_2158">: Загружает конфигурацию модуля из файла.</p><p id="pc5i3w_2159"><span class="control" id="pc5i3w_2164">Параметры</span>: Нет.</p><p id="pc5i3w_2160"><span class="control" id="pc5i3w_2165">Возвращает</span>: Словарь с конфигурацией.</p><p id="pc5i3w_2161"><span class="control" id="pc5i3w_2166">Пример использования</span>:</p><p id="pc5i3w_2162">Config = fp_powerfactory_service_old:load_config().</p><p id="pc5i3w_2163"></p></td></tr><tr id="pc5i3w_2083"><td id="pc5i3w_2167"><p>get_json/4</p></td><td id="pc5i3w_2168"><p id="pc5i3w_2169">: Формирует JSON-объект для передачи в PowerFactory.</p><p id="pc5i3w_2170"><span class="control" id="pc5i3w_2178">Параметры</span>:</p><p id="pc5i3w_2171">- Config (map): Конфигурация.</p><p id="pc5i3w_2172">- OIDsByElement (map): Сопоставление элементов и их идентификаторов.</p><p id="pc5i3w_2173">- PFFunc (binary): Имя функции PowerFactory.</p><p id="pc5i3w_2174">- PFProjectParams (map): Параметры проекта.</p><p id="pc5i3w_2175"><span class="control" id="pc5i3w_2179">Возвращает</span>: JSON-объект.</p><p id="pc5i3w_2176"><span class="control" id="pc5i3w_2180">Пример использования</span>:</p><p id="pc5i3w_2177">JSON = fp_powerfactory_service_old:get_json(Config, OIDsByElement, &lt;&lt;&quot;function_name&quot;&gt;&gt;, PFProjectParams).</p></td></tr><tr id="pc5i3w_2084"><td id="pc5i3w_2181"><p>http_send/4</p></td><td id="pc5i3w_2182"><p id="pc5i3w_2183">: Отправляет HTTP-запрос на сервер PowerFactory.</p><p id="pc5i3w_2184"><span class="control" id="pc5i3w_2192">Параметры</span>:</p><p id="pc5i3w_2185">- RemoteServiceParams (map): Параметры удалённого сервиса.</p><p id="pc5i3w_2186">- Path (binary): Путь запроса.</p><p id="pc5i3w_2187">- Data (binary): Тело запроса в формате JSON.</p><p id="pc5i3w_2188">- ResponseFun (fun): Функция для обработки ответа.</p><p id="pc5i3w_2189"><span class="control" id="pc5i3w_2193">Возвращает</span>: Результат выполнения запроса.</p><p id="pc5i3w_2190"><span class="control" id="pc5i3w_2194">Пример использования</span>:</p><p id="pc5i3w_2191">fp_powerfactory_service_old:http_send(RemoteServiceParams, &lt;&lt;&quot;api/path&quot;&gt;&gt;, Data, fun(Response) -&gt; io:format(&quot;~p&quot;, [Response]) end).</p></td></tr></tbody></table></div><p id="pc5i3w_1994"><span class="control" id="pc5i3w_2195">Примечания</span></p><ul class="list _bullet" id="pc5i3w_1995"><li class="list__item" id="pc5i3w_2196"><p id="pc5i3w_2199">Для корректной работы модуля необходимо наличие конфигурационного файла fp2pf_mapping.json.</p></li><li class="list__item" id="pc5i3w_2197"><p id="pc5i3w_2200">Все функции обеспечивают обработку ошибок и логирование через макросы ?LOGINFO, ?LOGWARNING и ?LOGERROR.</p></li><li class="list__item" id="pc5i3w_2198"><p id="pc5i3w_2201">Методы HTTP-запросов используют библиотеку httpc для взаимодействия с удалёнными сервисами.</p><section class="chapter"><h3 id="10-fp-state-estimation-service" data-toc="10-fp-state-estimation-service"><a name=""></a><span class="control" id="pc5i3w_2209">А.10 Модуль fp_state_estimation_service</span></h3><p id="pc5i3w_2204">Сервис для оценки состояния (State Estimation, SE). Используется для вычисления текущего состояния системы, позволяя определять узкие места и потенциальные сбои в сети.</p><p id="pc5i3w_2205"><span class="control" id="pc5i3w_2210">Общая информация</span></p><p id="pc5i3w_2206">Модуль fp_state_estimation_service предназначен для управления процессом оценивания состояния (state estimation) в системе. Он реализует экспорт и импорт данных в формате JSON, настройку и запуск вспомогательных утилит, а также предоставляет функции взаимодействия с хранилищами данных.</p><p id="pc5i3w_2207">Этот модуль используется для интеграции системы управления с процессами анализа данных, включая передачу и обработку информации о параметрах узлов и линий, а также получение статистики работы системы.</p></section></li></ul><div class="table-wrapper"><table class="wide" id="pc5i3w_1996"><thead><tr class="ijRowHead" id="pc5i3w_2211"><th id="pc5i3w_2221"><p><span class="control" id="pc5i3w_2223">Функция</span></p></th><th id="pc5i3w_2222"><p><span class="control" id="pc5i3w_2224">Описание</span></p></th></tr></thead><tbody><tr id="pc5i3w_2212"><td id="pc5i3w_2225"><p><span class="control" id="pc5i3w_2227">on_init/0</span></p></td><td id="pc5i3w_2226"><p id="pc5i3w_2228">: Инициализирует API для вызова функций модуля через JSON-запросы. Функция должна быть вызвана при запуске системы.</p><p id="pc5i3w_2229"><span class="control" id="pc5i3w_2234">Параметры</span>: Нет.</p><p id="pc5i3w_2230"><span class="control" id="pc5i3w_2235">Возвращает</span>:</p><p id="pc5i3w_2231">- ok &mdash; если инициализация завершилась успешно.</p><p id="pc5i3w_2232"><span class="control" id="pc5i3w_2236">Пример использования</span>:</p><p id="pc5i3w_2233">fp_state_estimation_service:on_init().</p></td></tr><tr id="pc5i3w_2213"><td id="pc5i3w_2237"><p><span class="control" id="pc5i3w_2239">export_json/1</span></p></td><td id="pc5i3w_2238"><p id="pc5i3w_2240">: Экспортирует данные системы в формате JSON, создавая файл для последующего анализа или передачи в другие модули.</p><p id="pc5i3w_2241"><span class="control" id="pc5i3w_2257">Параметры</span>:</p><p id="pc5i3w_2242">- {StartParams, AParams, CommonSettingsPath, SSEStatPath}:</p><p id="pc5i3w_2243">- StartParams &mdash; карта начальных параметров (например, временные диапазоны).</p><p id="pc5i3w_2244">- AParams &mdash; дополнительные параметры (например, настройки фильтров).</p><p id="pc5i3w_2245">- CommonSettingsPath &mdash; путь к объекту общих настроек.</p><p id="pc5i3w_2246">- SSEStatPath &mdash; путь к объекту статистики.</p><p id="pc5i3w_2247"><span class="control" id="pc5i3w_2258">Возвращает</span>:</p><p id="pc5i3w_2248">- ok &mdash; если экспорт выполнен успешно.</p><p id="pc5i3w_2249">- Логирует ошибку в случае сбоя при записи файла или при некорректных параметрах.</p><p id="pc5i3w_2250"><span class="control" id="pc5i3w_2259">Пример использования</span>:</p><p id="pc5i3w_2251">StartParams = #{&lt;&lt;&quot;start_time&quot;&gt;&gt; =&gt; &lt;&lt;&quot;2024-01-01T00:00:00&quot;&gt;&gt;, &lt;&lt;&quot;end_time&quot;&gt;&gt; =&gt; &lt;&lt;&quot;2024-01-01T12:00:00&quot;&gt;&gt;},</p><p id="pc5i3w_2252">AParams = #{&lt;&lt;&quot;region&quot;&gt;&gt; =&gt; &lt;&lt;&quot;North&quot;&gt;&gt;},</p><p id="pc5i3w_2253">CommonSettingsPath = &lt;&lt;&quot;/root/FP/PROJECT/settings/common&quot;&gt;&gt;,</p><p id="pc5i3w_2254">SSEStatPath = &lt;&lt;&quot;/root/FP/PROJECT/statistics/se_stats&quot;&gt;&gt;,</p><p id="pc5i3w_2255"></p><p id="pc5i3w_2256">fp_state_estimation_service:export_json({StartParams, AParams, CommonSettingsPath, SSEStatPath}).</p></td></tr><tr id="pc5i3w_2214"><td id="pc5i3w_2260"><p><span class="control" id="pc5i3w_2262">import_json/1</span></p></td><td id="pc5i3w_2261"><p id="pc5i3w_2263">: Импортирует данные из JSON-файла в храниище данных системы. Используется для обновления информации о параметрах узлов, линий и статистики.</p><p id="pc5i3w_2264"><span class="control" id="pc5i3w_2272">Параметры</span>:</p><p id="pc5i3w_2265">- SSEStatPath &mdash; путь к объекту статистики.</p><p id="pc5i3w_2266"><span class="control" id="pc5i3w_2273">Возвращает</span>:</p><p id="pc5i3w_2267">- ok &mdash; если импорт завершен успешно.</p><p id="pc5i3w_2268">- Логирует ошибки при сбоях.</p><p id="pc5i3w_2269"><span class="control" id="pc5i3w_2274">Пример использования</span>:</p><p id="pc5i3w_2270">SSEStatPath = &lt;&lt;&quot;/root/FP/PROJECT/statistics/se_stats&quot;&gt;&gt;,</p><p id="pc5i3w_2271">fp_state_estimation_service:import_json(SSEStatPath).</p></td></tr><tr id="pc5i3w_2215"><td id="pc5i3w_2275"><p><span class="control" id="pc5i3w_2277">import_json_for_demo/1</span></p></td><td id="pc5i3w_2276"><p id="pc5i3w_2278">: Импортирует данные для демонстрации. Отличается от обычного импорта выбором файла в зависимости от текущего состояния системы.</p><p id="pc5i3w_2279"><span class="control" id="pc5i3w_2286">Параметры</span>:</p><p id="pc5i3w_2280">- SourceFiles &mdash; список путей к JSON-файлам.</p><p id="pc5i3w_2281"><span class="control" id="pc5i3w_2287">Возвращает</span>:</p><p id="pc5i3w_2282">- ok &mdash; если данные успешно импортированы.</p><p id="pc5i3w_2283"><span class="control" id="pc5i3w_2288">Пример использования</span>:</p><p id="pc5i3w_2284">SourceFiles = [&lt;&lt;&quot;/path/to/demo1.json&quot;&gt;&gt;, &lt;&lt;&quot;/path/to/demo2.json&quot;&gt;&gt;],</p><p id="pc5i3w_2285">fp_state_estimation_service:import_json_for_demo(SourceFiles).</p></td></tr><tr id="pc5i3w_2216"><td id="pc5i3w_2289"><p><span class="control" id="pc5i3w_2291">run_se_util/1</span></p></td><td id="pc5i3w_2290"><p id="pc5i3w_2292">: Запускает утилиту для выполнения процессов state estimation.</p><p id="pc5i3w_2293"><span class="control" id="pc5i3w_2300">Параметры</span>:</p><p id="pc5i3w_2294">- _Arg &mdash; аргумент, зарезервированный для будущих реализаций (на текущий момент игнорируется).</p><p id="pc5i3w_2295"><span class="control" id="pc5i3w_2301">Возвращает</span>:</p><p id="pc5i3w_2296">- ok &mdash; если утилита выполнена успешно.</p><p id="pc5i3w_2297">- Логирует предупреждение, если путь к утилите не указан.</p><p id="pc5i3w_2298"><span class="control" id="pc5i3w_2302">Пример использования</span>:</p><p id="pc5i3w_2299">fp_state_estimation_service:run_se_util({}).</p></td></tr><tr id="pc5i3w_2217"><td id="pc5i3w_2303"><p><span class="control" id="pc5i3w_2305">run_se/1</span></p></td><td id="pc5i3w_2304"><p id="pc5i3w_2306">: Оркестрирует полный процесс запуска state estimation. Включает экспорт данных, запуск утилиты и последующий импорт результатов.</p><p id="pc5i3w_2307"><span class="control" id="pc5i3w_2325">Параметры</span>:</p><p id="pc5i3w_2308">- {Path, StartParams, AParams, CommonSettingsPath, SSEStatPath}:</p><p id="pc5i3w_2309">- Path &mdash; путь к рабочему каталогу.</p><p id="pc5i3w_2310">- StartParams &mdash; начальные параметры.</p><p id="pc5i3w_2311">- AParams &mdash; дополнительные параметры.</p><p id="pc5i3w_2312">- CommonSettingsPath &mdash; путь к объекту настроек.</p><p id="pc5i3w_2313">- SSEStatPath &mdash; путь к статистике.</p><p id="pc5i3w_2314"><span class="control" id="pc5i3w_2326">Возвращает</span>:</p><p id="pc5i3w_2315">- ok &mdash; если весь процесс завершен успешно.</p><p id="pc5i3w_2316">- Логирует ошибки при сбоях.</p><p id="pc5i3w_2317"><span class="control" id="pc5i3w_2327">Пример использования</span>:</p><p id="pc5i3w_2318">Path = &lt;&lt;&quot;/home/master/forSE&quot;&gt;&gt;,</p><p id="pc5i3w_2319">StartParams = #{&lt;&lt;&quot;start_time&quot;&gt;&gt; =&gt; &lt;&lt;&quot;2024-01-01T00:00:00&quot;&gt;&gt;},</p><p id="pc5i3w_2320">AParams = #{&lt;&lt;&quot;region&quot;&gt;&gt; =&gt; &lt;&lt;&quot;East&quot;&gt;&gt;},</p><p id="pc5i3w_2321">CommonSettingsPath = &lt;&lt;&quot;/root/FP/PROJECT/settings/common&quot;&gt;&gt;,</p><p id="pc5i3w_2322">SSEStatPath = &lt;&lt;&quot;/root/FP/PROJECT/statistics/se_stats&quot;&gt;&gt;,</p><p id="pc5i3w_2323"></p><p id="pc5i3w_2324">fp_state_estimation_service:run_se({Path, StartParams, AParams, CommonSettingsPath, SSEStatPath}).</p></td></tr><tr id="pc5i3w_2218"><td id="pc5i3w_2328"><p><span class="control" id="pc5i3w_2330">load_config/0</span></p></td><td id="pc5i3w_2329"><p id="pc5i3w_2331">: Загружает конфигурацию из JSON-файла state_estimation_settings.jsonc.</p><p id="pc5i3w_2332"><span class="control" id="pc5i3w_2334">Пример использования</span>:</p><p id="pc5i3w_2333">Config = fp_state_estimation_service:load_config().</p></td></tr><tr id="pc5i3w_2219"><td id="pc5i3w_2335"><p><span class="control" id="pc5i3w_2337">get_absolute_path/1</span></p></td><td id="pc5i3w_2336"><p id="pc5i3w_2338">: Возвращает абсолютный путь к указанному файлу.</p><p id="pc5i3w_2339"><span class="control" id="pc5i3w_2341">Пример использования</span>:</p><p id="pc5i3w_2340">AbsPath = fp_state_estimation_service:get_absolute_path(&lt;&lt;&quot;settings.jsonc&quot;&gt;&gt;).</p></td></tr><tr id="pc5i3w_2220"><td id="pc5i3w_2342"><p><span class="control" id="pc5i3w_2344">load_mapping/1</span></p></td><td id="pc5i3w_2343"><p id="pc5i3w_2345">: Загружает настройки маппинга из файла.</p><p id="pc5i3w_2346"><span class="control" id="pc5i3w_2349">Пример использования</span>:</p><p id="pc5i3w_2347">Mapping = fp_state_estimation_service:load_mapping(&lt;&lt;&quot;mapping.jsonc&quot;&gt;&gt;).</p><p id="pc5i3w_2348"></p></td></tr></tbody></table></div><p id="pc5i3w_1997"><span class="control" id="pc5i3w_2350">Примечания</span></p><ul class="list _bullet" id="pc5i3w_1998"><li class="list__item" id="pc5i3w_2351"><p id="pc5i3w_2355">Модуль интегрируется с внутренним хранилищем данных через протоколы, реализованные в платформе Faceplate.</p></li><li class="list__item" id="pc5i3w_2352"><p id="pc5i3w_2356">Все операции, связанные с чтением и записью, происходят транзакционно. В случае ошибки или сбоя транзакция откатывается.</p></li><li class="list__item" id="pc5i3w_2353"><p id="pc5i3w_2357">Для экспорта и импорта данных используются маппинг-файлы, описывающие соответствие структур данных системы и JSON.</p></li><li class="list__item" id="pc5i3w_2354"><p id="pc5i3w_2358">Перед использованием функций run_se или run_se_util необходимо убедиться, что конфигурационные файлы и утилиты доступны.</p><section class="chapter"><h3 id="11-string-replace" data-toc="11-string-replace"><a name=""></a><span class="control" id="pc5i3w_2365">А.11 Модуль string_replace</span></h3><p id="pc5i3w_2361">Модуль для работы с текстовыми данными. Включает функции поиска и замены текста, что полезно для обработки текстовой информации в системе.</p><p id="pc5i3w_2362"><span class="control" id="pc5i3w_2366">Общая информация</span></p><p id="pc5i3w_2363">Модуль string_replace предназначен для выполнения замены подстрок в строках объектов хранилища данных. Замена производится рекурсивно по заданным шаблонам и паттернам. Основная цель модуля &mdash; автоматизация обновления строк с использованием хранилища данных fp_db.</p></section></li></ul><div class="table-wrapper"><table class="wide" id="pc5i3w_1999"><thead><tr class="ijRowHead" id="pc5i3w_2367"><th id="pc5i3w_2371"><p><span class="control" id="pc5i3w_2373">Функция</span></p></th><th id="pc5i3w_2372"><p><span class="control" id="pc5i3w_2374">Описание</span></p></th></tr></thead><tbody><tr id="pc5i3w_2368"><td id="pc5i3w_2375"><p><span class="control" id="pc5i3w_2377">replace_in_strings/2</span></p></td><td id="pc5i3w_2376"><p id="pc5i3w_2378">: Производит замену всех вхождений строки ?SEARCH_STR на ?REPLACE_STR для объектов, соответствующих заданным корню и паттерну.</p><p id="pc5i3w_2379"><span class="control" id="pc5i3w_2394">Параметры</span>:</p><p id="pc5i3w_2380">- Root (binary) &mdash; корневая папка, в пределах которой ищутся объекты для обработки.</p><p id="pc5i3w_2381">- Pattern (binary) &mdash; паттерн объектов, указывающий на их прототип.</p><p id="pc5i3w_2382"><span class="control" id="pc5i3w_2395">Возвращает</span>:</p><p id="pc5i3w_2383">- NewContent (list) &mdash; список объектов с обновленными строками.</p><p id="pc5i3w_2384"><span class="control" id="pc5i3w_2396">Детали реализации</span>:</p><p id="pc5i3w_2385">- Из хранилища данных fp_db выбираются объекты, соответствующие указанным Root и Pattern.</p><p id="pc5i3w_2386">- Для каждого объекта производится проверка наличия строки ?SEARCH_STR в поле screen.</p><p id="pc5i3w_2387">- Если строка найдена, она заменяется на ?REPLACE_STR. Изменение сохраняется в хранилище данных.</p><p id="pc5i3w_2388">- Если строка не содержит ?SEARCH_STR, объект остается неизменным.</p><p id="pc5i3w_2389"><span class="control" id="pc5i3w_2397">Пример использования</span>:</p><p id="pc5i3w_2390">% Выполнение замены строк в объектах с прототипом &quot;/root/FP/prototypes/substation/fields&quot; в папке &quot;KAZ/UZHNIY&quot;.</p><p id="pc5i3w_2391">Root = &lt;&lt;&quot;KAZ/UZHNIY&quot;&gt;&gt;,</p><p id="pc5i3w_2392">Pattern = &lt;&lt;&quot;/root/FP/prototypes/substation/fields&quot;&gt;&gt;,</p><p id="pc5i3w_2393">string_replace:replace_in_strings(Root, Pattern).</p></td></tr><tr id="pc5i3w_2369"><td id="pc5i3w_2398"><p><span class="control" id="pc5i3w_2400">replace/2</span></p></td><td id="pc5i3w_2399"><p id="pc5i3w_2401">: Выполняет замену строки ?SEARCH_STR на ?REPLACE_STR в заданном объекте.</p><p id="pc5i3w_2402"><span class="control" id="pc5i3w_2418">Параметры</span>:</p><p id="pc5i3w_2403">- OID &mdash; идентификатор объекта.</p><p id="pc5i3w_2404">- String &mdash; строка, в которой выполняется поиск и замена.</p><p id="pc5i3w_2405"><span class="control" id="pc5i3w_2419">Возвращает</span>:</p><p id="pc5i3w_2406">- Если замена произведена, функция возвращает новую строку с замененными подстроками.</p><p id="pc5i3w_2407">- Если строка не содержит ?SEARCH_STR, возвращается исходная строка.</p><p id="pc5i3w_2408"><span class="control" id="pc5i3w_2420">Детали реализации</span>:</p><p id="pc5i3w_2409">- Проверяется, содержит ли строка ?SEARCH_STR с помощью binary:matches.</p><p id="pc5i3w_2410">- Если вхождение найдено:</p><p id="pc5i3w_2411">1) Производится замена всех вхождений на ?REPLACE_STR с помощью binary:replace\.</p><p id="pc5i3w_2412">2) Обновленная строка записывается обратно в объект через fp_db:edit_object\.</p><p id="pc5i3w_2413">- Если вхождений нет, строка остается без изменений.</p><p id="pc5i3w_2414"><span class="control" id="pc5i3w_2421">Пример использования</span>:</p><p id="pc5i3w_2415">OID = fp_db:to_oid(&lt;&lt;&quot;example_oid&quot;&gt;&gt;),</p><p id="pc5i3w_2416">String = &lt;&lt;&quot;This is a lib.update_line example&quot;&gt;&gt;,</p><p id="pc5i3w_2417">string_replace:replace(OID, String).</p></td></tr><tr id="pc5i3w_2370"><td id="pc5i3w_2422"><p><span class="control" id="pc5i3w_2424">replace_in_string/1</span></p></td><td id="pc5i3w_2423"><p id="pc5i3w_2425">: Обрабатывает строки, проверяя их на наличие подстроки ?SEARCH_STR. В случае наличия выполняет замену, используя функцию replace/2.</p><p id="pc5i3w_2426"><span class="control" id="pc5i3w_2432">Параметры</span>:</p><p id="pc5i3w_2427">- [OID, String] &mdash; список, содержащий идентификатор объекта и строку для обработки.</p><p id="pc5i3w_2428"><span class="control" id="pc5i3w_2433">Возвращает</span>:</p><p id="pc5i3w_2429">- Обновленный список [OID, NewString], где NewString &mdash; результат замены.</p><p id="pc5i3w_2430"><span class="control" id="pc5i3w_2434">Пример использования</span>:</p><p id="pc5i3w_2431">replace_in_string([OID, &lt;&lt;&quot;lib.update_line example&quot;&gt;&gt;]).</p></td></tr></tbody></table></div><p id="pc5i3w_2000"><span class="control" id="pc5i3w_2435">Пример использования модуля:</span></p><p id="pc5i3w_2001">% Устанавливаем константы для поиска и замены</p><p id="pc5i3w_2002">-define(SEARCH_STR, &quot;lib.update_line&quot;).</p><p id="pc5i3w_2003">-define(REPLACE_STR, &quot;lib.updateNode&quot;).</p><p id="pc5i3w_2004">% Задаем корень и паттерн</p><p id="pc5i3w_2005">Root = &lt;&lt;&quot;KAZ/UZHNIY&quot;&gt;&gt;,</p><p id="pc5i3w_2006">Pattern = &lt;&lt;&quot;/root/FP/prototypes/substation/fields&quot;&gt;&gt;,</p><p id="pc5i3w_2007">% Запускаем процесс замены</p><p id="pc5i3w_2008">string_replace:replace_in_strings(Root, Pattern).</p><p id="pc5i3w_2009"><span class="control" id="pc5i3w_2436">Вывод:</span></p><ul class="list _bullet" id="pc5i3w_2010"><li class="list__item" id="pc5i3w_2437"><p id="pc5i3w_2445">Если совпадение найдено:</p><p id="pc5i3w_2446">Замена произведена: /path/to/object</p></li><li class="list__item" id="pc5i3w_2438"><p id="pc5i3w_2447">Если совпадений не найдено:</p><p id="pc5i3w_2448">Совпадение не найдено в строке объекта /path/to/object</p><p id="pc5i3w_2449"><span class="control" id="pc5i3w_2450">Примечания</span></p></li><li class="list__item" id="pc5i3w_2439"><p id="pc5i3w_2451">Константы:</p><ol class="list _decimal" id="pc5i3w_2452" type="1"><li class="list__item" id="pc5i3w_2453"><p id="pc5i3w_2455">?SEARCH_STR &mdash; строка, которую необходимо заменить\.</p></li><li class="list__item" id="pc5i3w_2454"><p id="pc5i3w_2456">?REPLACE_STR &mdash; строка, на которую выполняется замена\.</p></li></ol></li><li class="list__item" id="pc5i3w_2440"><p id="pc5i3w_2457">Поддерживается обработка строк, заданных в бинарном формате.</p></li><li class="list__item" id="pc5i3w_2441"><p id="pc5i3w_2458">Логирование результатов замены осуществляется через io:format.</p><section class="chapter"><h3 id="12-model-service-v2" data-toc="12-model-service-v2"><a name=""></a><span class="control" id="pc5i3w_2465">А.12 Модуль model_service_v2</span></h3><p id="pc5i3w_2461">Новая версия сервиса для работы с моделями. Поддерживает управление несколькими архивами, а также интеграцию данных о погоде, предоставляя более широкие аналитические возможности.</p><p id="pc5i3w_2462"><span class="control" id="pc5i3w_2466">Общая информация</span></p><p id="pc5i3w_2463">Модуль model_service_v2 предназначен для выполнения заданий, связанных с обработкой данных моделей. Он предоставляет функционал для:</p></section></li><li class="list__item" id="pc5i3w_2442"><p id="pc5i3w_2467">Чтения данных из хранилища.</p></li><li class="list__item" id="pc5i3w_2443"><p id="pc5i3w_2468">Обработки данных с использованием внешних сервисов.</p></li><li class="list__item" id="pc5i3w_2444"><p id="pc5i3w_2469">Записи обработанных данных обратно в хранилище.</p><p id="pc5i3w_2470">Основной поток выполнения состоит из:</p></li></ul><ol class="list _decimal" id="pc5i3w_2011" type="1"><li class="list__item" id="pc5i3w_2471"><p id="pc5i3w_2475">Подготовки данных для задачи.</p></li><li class="list__item" id="pc5i3w_2472"><p id="pc5i3w_2476">Отправки данных на удалённый сервис.</p></li><li class="list__item" id="pc5i3w_2473"><p id="pc5i3w_2477">Обработки ответа от сервиса.</p></li><li class="list__item" id="pc5i3w_2474"><p id="pc5i3w_2478">Записи результата в хранилище данных.</p></li></ol><div class="table-wrapper"><table class="wide" id="pc5i3w_2012"><thead><tr class="ijRowHead" id="pc5i3w_2479"><th id="pc5i3w_2485"><p><span class="control" id="pc5i3w_2487">Функция</span></p></th><th id="pc5i3w_2486"><p><span class="control" id="pc5i3w_2488">Описание</span></p></th></tr></thead><tbody><tr id="pc5i3w_2480"><td id="pc5i3w_2489"><p><span class="control" id="pc5i3w_2491">run_task/1</span></p></td><td id="pc5i3w_2490"><p id="pc5i3w_2492">: Основная функция, запускающая выполнение задачи для указанного объекта. Производит полный цикл обработки: чтение, вызов внешнего сервиса и запись результата.</p><p id="pc5i3w_2493"><span class="control" id="pc5i3w_2508">Параметры</span>:</p><p id="pc5i3w_2494">- Obj (OID объекта) &mdash; объект, для которого выполняется задача.</p><p id="pc5i3w_2495"><span class="control" id="pc5i3w_2509">Возвращает</span>:</p><p id="pc5i3w_2496">- ok &mdash; при успешном выполнении.</p><p id="pc5i3w_2497">- {error, Reason} &mdash; при возникновении ошибки.</p><p id="pc5i3w_2498"><span class="control" id="pc5i3w_2510">Детали реализации</span>:</p><p id="pc5i3w_2499">- Считываются поля объекта, необходимые для выполнения задачи.</p><p id="pc5i3w_2500">- Формируется набор временных меток для чтения данных из архива.</p><p id="pc5i3w_2501">- Собирается JSON-запрос для внешнего сервиса.</p><p id="pc5i3w_2502">- Выполняется HTTP-запрос на внешний сервис с заданными данными.</p><p id="pc5i3w_2503">- Обрабатывается ответ от сервиса и записывается результат в хранилище данных.</p><p id="pc5i3w_2504"><span class="control" id="pc5i3w_2511">Пример использования</span>:</p><p id="pc5i3w_2505">Obj = fp_db:to_oid(&lt;&lt;&quot;object_path&quot;&gt;&gt;),</p><p id="pc5i3w_2506">model_service_v2:run_task(Obj).</p><p id="pc5i3w_2507"></p></td></tr><tr id="pc5i3w_2481"><td id="pc5i3w_2512"><p><span class="control" id="pc5i3w_2514">call/2</span></p></td><td id="pc5i3w_2513"><p id="pc5i3w_2515">: Функция для выполнения HTTP-запроса на внешний сервис.</p><p id="pc5i3w_2516"><span class="control" id="pc5i3w_2526">Параметры</span>:</p><p id="pc5i3w_2517">- Url (binary) &mdash; URL сервиса.</p><p id="pc5i3w_2518">- DataMap (map) &mdash; данные, отправляемые в теле запроса.</p><p id="pc5i3w_2519"><span class="control" id="pc5i3w_2527">Возвращает</span>:</p><p id="pc5i3w_2520">- {ok, Response} &mdash; успешный ответ от сервиса.</p><p id="pc5i3w_2521">- {error, Reason} &mdash; ошибка при выполнении запроса.</p><p id="pc5i3w_2522"><span class="control" id="pc5i3w_2528">Пример использования</span>:</p><p id="pc5i3w_2523">Url = &lt;&lt;&quot;http://127.0.0.1:8000/predict&quot;&gt;&gt;,</p><p id="pc5i3w_2524">Data = #{&lt;&lt;&quot;task_id&quot;&gt;&gt; =&gt; &lt;&lt;&quot;123&quot;&gt;&gt;, &lt;&lt;&quot;task_input&quot;&gt;&gt; =&gt; Dataset},</p><p id="pc5i3w_2525">model_service_v2:call(Url, Data).</p></td></tr><tr id="pc5i3w_2482"><td id="pc5i3w_2529"><p><span class="control" id="pc5i3w_2531">read_from_db/3</span></p></td><td id="pc5i3w_2530"><p id="pc5i3w_2532">: Считывает данные из архива за указанный временной диапазон.</p><p id="pc5i3w_2533"><span class="control" id="pc5i3w_2545">Параметры</span>:</p><p id="pc5i3w_2534">- InputWindow (integer) &mdash; количество временных меток для чтения.</p><p id="pc5i3w_2535">- Step (integer) &mdash; шаг между временными метками (в миллисекундах).</p><p id="pc5i3w_2536">- Archive (OID) &mdash; архив, из которого считываются данные.</p><p id="pc5i3w_2537"><span class="control" id="pc5i3w_2546">Возвращает</span>:</p><p id="pc5i3w_2538">- Data (list) &mdash; список считанных данных.</p><p id="pc5i3w_2539">- {error, Reason} &mdash; в случае ошибки.</p><p id="pc5i3w_2540"><span class="control" id="pc5i3w_2547">Пример использования</span>:</p><p id="pc5i3w_2541">InputWindow = 24,</p><p id="pc5i3w_2542">Step = 3600000, % 1 час</p><p id="pc5i3w_2543">Archive = fp_db:to_oid(&lt;&lt;&quot;archive_path&quot;&gt;&gt;),</p><p id="pc5i3w_2544">model_service_v2:read_from_db(InputWindow, Step, Archive).</p></td></tr><tr id="pc5i3w_2483"><td id="pc5i3w_2548"><p><span class="control" id="pc5i3w_2550">write_to_db/2</span></p></td><td id="pc5i3w_2549"><p id="pc5i3w_2551">: Записывает данные в архив.</p><p id="pc5i3w_2552"><span class="control" id="pc5i3w_2562">Параметры</span>:</p><p id="pc5i3w_2553">- Data (list) &mdash; данные для записи.</p><p id="pc5i3w_2554">- Archive (OID) &mdash; архив для записи данных.</p><p id="pc5i3w_2555"><span class="control" id="pc5i3w_2563">Возвращает</span>:</p><p id="pc5i3w_2556">- {ok, From, To} &mdash; диапазон временных меток записанных данных.</p><p id="pc5i3w_2557">- {error, Reason} &mdash; ошибка при записи данных.</p><p id="pc5i3w_2558"><span class="control" id="pc5i3w_2564">Пример использования</span>:</p><p id="pc5i3w_2559">Data = [{1669905600000, 1.23}, {1669909200000, 1.45}],</p><p id="pc5i3w_2560">Archive = fp_db:to_oid(&lt;&lt;&quot;archive_path&quot;&gt;&gt;),</p><p id="pc5i3w_2561">model_service_v2:write_to_db(Data, Archive).</p></td></tr><tr id="pc5i3w_2484"><td id="pc5i3w_2565"><p><span class="control" id="pc5i3w_2567">transform/1</span></p></td><td id="pc5i3w_2566"><p id="pc5i3w_2568">: Трансформирует данные в формат, подходящий для записи.</p><p id="pc5i3w_2569"><span class="control" id="pc5i3w_2577">Параметры</span>:</p><p id="pc5i3w_2570">- Data (list) &mdash; входные данные.</p><p id="pc5i3w_2571"><span class="control" id="pc5i3w_2578">Возвращает</span>:</p><p id="pc5i3w_2572">- {ok, TransformedData} &mdash; успешная трансформация.</p><p id="pc5i3w_2573">- {error, Reason} &mdash; ошибка трансформации.</p><p id="pc5i3w_2574"><span class="control" id="pc5i3w_2579">Пример использования</span>:</p><p id="pc5i3w_2575">Data = [[1669905600, 1.23], [1669909200, 1.45]],</p><p id="pc5i3w_2576">model_service_v2:transform(Data).</p></td></tr></tbody></table></div><p id="pc5i3w_2013"><span class="control" id="pc5i3w_2580">Пример использования модуля:</span></p><p id="pc5i3w_2014">% Устанавливаем объект</p><p id="pc5i3w_2015">Obj = fp_db:to_oid(&lt;&lt;&quot;object_path&quot;&gt;&gt;),</p><p id="pc5i3w_2016">% Запускаем выполнение задачи</p><p id="pc5i3w_2017">model_service_v2:run_task(Obj).</p><p id="pc5i3w_2018"><span class="control" id="pc5i3w_2581">Ожидаемый вывод в логах:</span></p><ol class="list _decimal" id="pc5i3w_2019" type="1"><li class="list__item" id="pc5i3w_2582"><p id="pc5i3w_2586">Информация о начале задачи:</p><p id="pc5i3w_2587">model_service: Run the task...</p></li><li class="list__item" id="pc5i3w_2583"><p id="pc5i3w_2588">Успешное чтение данных:</p><p id="pc5i3w_2589">model_service: read the object: #{&lt;&lt;&quot;model_state&quot;&gt;&gt; =&gt; &lt;&lt;&quot;active&quot;&gt;&gt;, ...}</p></li><li class="list__item" id="pc5i3w_2584"><p id="pc5i3w_2590">Успешный вызов внешнего сервиса:</p><p id="pc5i3w_2591">Response #{&lt;&lt;&quot;task_output&quot;&gt;&gt; =&gt; [[1669905600, 1.23], [1669909200, 1.45]]}</p></li><li class="list__item" id="pc5i3w_2585"><p id="pc5i3w_2592">Успешная запись данных:</p><p id="pc5i3w_2593">Data successfully written to archive: &lt;&lt;&quot;archive_path&quot;&gt;&gt;</p><p id="pc5i3w_2594"><span class="control" id="pc5i3w_2595">Примечания</span></p></li></ol><ul class="list _bullet" id="pc5i3w_2020"><li class="list__item" id="pc5i3w_2596"><p id="pc5i3w_2599">Взаимодействие с внешним сервисом:</p><ol class="list _decimal" id="pc5i3w_2600" type="1"><li class="list__item" id="pc5i3w_2601"><p id="pc5i3w_2603">URL сервиса формируется на основе хоста и порта\.</p></li><li class="list__item" id="pc5i3w_2602"><p id="pc5i3w_2604">Отправка данных осуществляется через HTTP POST запрос с JSON-телом\.</p></li></ol></li><li class="list__item" id="pc5i3w_2597"><p id="pc5i3w_2605">Логирование:</p><ol class="list _decimal" id="pc5i3w_2606" type="1"><li class="list__item" id="pc5i3w_2607"><p id="pc5i3w_2608">Все ключевые шаги процесса логируются с использованием макросов ?LOGINFO, ?LOGWARNING и ?LOGERROR\.</p></li></ol></li><li class="list__item" id="pc5i3w_2598"><p id="pc5i3w_2609">Обработка ошибок:</p><p id="pc5i3w_2610">1)Если выполнение задачи прерывается на любом этапе, функция возвращает описание ошибки.</p><section class="chapter"><h3 id="13-rest-api-client-v1-0" data-toc="13-rest-api-client-v1-0"><a name=""></a><span class="control" id="pc5i3w_2617">А.13 Модуль rest_api_client (v1.0)</span></h3><p id="pc5i3w_2613">Клиент REST API для обмена данными с системой рынка баланса. Поддерживает запросы на сервер по протоколу REST и позволяет интегрировать данные с внешними REST API.</p><p id="pc5i3w_2614"><span class="control" id="pc5i3w_2618">Общая информация</span></p><p id="pc5i3w_2615">Модуль rest_api_client предназначен для выполнения HTTP-запросов к REST API, включая:</p></section></li></ul><ol class="list _decimal" id="pc5i3w_2021" type="1"><li class="list__item" id="pc5i3w_2619"><p id="pc5i3w_2621">Получение токена для авторизации.</p></li><li class="list__item" id="pc5i3w_2620"><p id="pc5i3w_2622">Выполнение запросов с использованием токена.</p></li></ol><div class="table-wrapper"><table class="wide" id="pc5i3w_2022"><thead><tr class="ijRowHead" id="pc5i3w_2623"><th id="pc5i3w_2627"><p><span class="control" id="pc5i3w_2629">Функция</span></p></th><th id="pc5i3w_2628"><p><span class="control" id="pc5i3w_2630">Описание</span></p></th></tr></thead><tbody><tr id="pc5i3w_2624"><td id="pc5i3w_2631"><p><span class="control" id="pc5i3w_2633">get_token/2</span></p></td><td id="pc5i3w_2632"><p id="pc5i3w_2634">: Получает токен для авторизации по указанному URL и телу запроса.</p><p id="pc5i3w_2635"><span class="control" id="pc5i3w_2650">Параметры</span>:</p><p id="pc5i3w_2636">- TokenUrl (binary) &mdash; URL для получения токена.</p><p id="pc5i3w_2637">- RequestBody (map) &mdash; тело запроса с данными для авторизации.</p><p id="pc5i3w_2638"><span class="control" id="pc5i3w_2651">Возвращает</span>:</p><p id="pc5i3w_2639">- {ok, Token} &mdash; если токен успешно получен.</p><p id="pc5i3w_2640">- {error, no_token_in_response} &mdash; если токен отсутствует в ответе.</p><p id="pc5i3w_2641">- {error, Reason} &mdash; если произошла ошибка во время выполнения запроса.</p><p id="pc5i3w_2642"><span class="control" id="pc5i3w_2652">Детали реализации</span>:</p><p id="pc5i3w_2643">- Формирует тело запроса в формате JSON.</p><p id="pc5i3w_2644">- Выполняет POST-запрос на указанный URL.</p><p id="pc5i3w_2645">- Декодирует ответ и извлекает токен.</p><p id="pc5i3w_2646"><span class="control" id="pc5i3w_2653">Пример использования</span>:</p><p id="pc5i3w_2647">TokenUrl = &lt;&lt;&quot;http://api.example.com/auth/token&quot;&gt;&gt;,</p><p id="pc5i3w_2648">RequestBody = #{&lt;&lt;&quot;username&quot;&gt;&gt; =&gt; &lt;&lt;&quot;user&quot;&gt;&gt;, &lt;&lt;&quot;password&quot;&gt;&gt; =&gt; &lt;&lt;&quot;pass&quot;&gt;&gt;},</p><p id="pc5i3w_2649">rest_api_client:get_token(TokenUrl, RequestBody).</p></td></tr><tr id="pc5i3w_2625"><td id="pc5i3w_2654"><p><span class="control" id="pc5i3w_2656">make_request/4</span></p></td><td id="pc5i3w_2655"><p id="pc5i3w_2657">: Выполняет HTTP-запрос с использованием токена авторизации.</p><p id="pc5i3w_2658"><span class="control" id="pc5i3w_2677">Параметры</span>:</p><p id="pc5i3w_2659">- Token (binary) &mdash; токен для авторизации.</p><p id="pc5i3w_2660">- Method (atom) &mdash; HTTP-метод (get, post, put, delete).</p><p id="pc5i3w_2661">- Url (binary) &mdash; URL для выполнения запроса.</p><p id="pc5i3w_2662">- Body (map) &mdash; тело запроса.</p><p id="pc5i3w_2663"><span class="control" id="pc5i3w_2678">Возвращает</span>:</p><p id="pc5i3w_2664">- {ok, Response} &mdash; успешный ответ с декодированными данными.</p><p id="pc5i3w_2665">- {error, {unexpected_status, Code}} &mdash; неожиданный статус-код.</p><p id="pc5i3w_2666">- {error, Reason} &mdash; ошибка при выполнении запроса.</p><p id="pc5i3w_2667"><span class="control" id="pc5i3w_2679">Детали реализации</span>:</p><p id="pc5i3w_2668">- Кодирует тело запроса в формат JSON.</p><p id="pc5i3w_2669">- Формирует HTTP-запрос с заголовками, включая Authorization.</p><p id="pc5i3w_2670">- Выполняет запрос и обрабатывает результат.</p><p id="pc5i3w_2671"><span class="control" id="pc5i3w_2680">Пример использования</span>:</p><p id="pc5i3w_2672">Token = &lt;&lt;&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9&quot;&gt;&gt;,</p><p id="pc5i3w_2673">Method = post,</p><p id="pc5i3w_2674">Url = &lt;&lt;&quot;http://api.example.com/data&quot;&gt;&gt;,</p><p id="pc5i3w_2675">Body = #{&lt;&lt;&quot;key&quot;&gt;&gt; =&gt; &lt;&lt;&quot;value&quot;&gt;&gt;},</p><p id="pc5i3w_2676">rest_api_client:make_request(Token, Method, Url, Body).</p></td></tr><tr id="pc5i3w_2626"><td id="pc5i3w_2681"><p><span class="control" id="pc5i3w_2683">get_url/3</span></p></td><td id="pc5i3w_2682"><p id="pc5i3w_2684">: Формирует URL для выполнения запросов.</p><p id="pc5i3w_2685"><span class="control" id="pc5i3w_2696">Параметры</span>:</p><p id="pc5i3w_2686">- Host (binary) &mdash; адрес хоста.</p><p id="pc5i3w_2687">- Port (binary) &mdash; порт хоста.</p><p id="pc5i3w_2688">- URL (binary) &mdash; конечная точка.</p><p id="pc5i3w_2689"><span class="control" id="pc5i3w_2697">Возвращает</span>:</p><p id="pc5i3w_2690">- Сформированный URL (binary).</p><p id="pc5i3w_2691"><span class="control" id="pc5i3w_2698">Пример использования</span>:</p><p id="pc5i3w_2692">Host = &lt;&lt;&quot;127.0.0.1&quot;&gt;&gt;,</p><p id="pc5i3w_2693">Port = &lt;&lt;&quot;8080&quot;&gt;&gt;,</p><p id="pc5i3w_2694">Path = &lt;&lt;&quot;api/resource&quot;&gt;&gt;,</p><p id="pc5i3w_2695">rest_api_client:get_url(Host, Port, Path).</p></td></tr></tbody></table></div><p id="pc5i3w_2023"><span class="control" id="pc5i3w_2699">Примеры использования модуля.</span></p><p id="pc5i3w_2024"><span class="control" id="pc5i3w_2700">Пример 1: Получение токена</span></p><p id="pc5i3w_2025">TokenUrl = &lt;&lt;&quot;http://auth.example.com/token&quot;&gt;&gt;,</p><p id="pc5i3w_2026">RequestBody = #{&lt;&lt;&quot;username&quot;&gt;&gt; =&gt; &lt;&lt;&quot;admin&quot;&gt;&gt;, &lt;&lt;&quot;password&quot;&gt;&gt; =&gt; &lt;&lt;&quot;secret&quot;&gt;&gt;},</p><p id="pc5i3w_2027">case rest_api_client:get_token(TokenUrl, RequestBody) of</p><p id="pc5i3w_2028"><code class="code" id="pc5i3w_2701"></code> {ok, Token} -&gt; io:format(&quot;Token received: <span id="pc5i3w_2702"><sub class="subscript">p</sub></span>n&quot;, [Token]);</p><p id="pc5i3w_2029"><code class="code" id="pc5i3w_2703"></code> {error, Reason} -&gt; io:format(&quot;Failed to get token: <span id="pc5i3w_2704"><sub class="subscript">p</sub></span>n&quot;, [Reason])</p><p id="pc5i3w_2030">end.</p><p id="pc5i3w_2031"><span class="control" id="pc5i3w_2705">Пример 2: Выполнение запроса с токеном</span></p><p id="pc5i3w_2032">Token = &lt;&lt;&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9&quot;&gt;&gt;,</p><p id="pc5i3w_2033">Method = post,</p><p id="pc5i3w_2034">Url = &lt;&lt;&quot;http://api.example.com/resource&quot;&gt;&gt;,</p><p id="pc5i3w_2035">Body = #{&lt;&lt;&quot;param1&quot;&gt;&gt; =&gt; &lt;&lt;&quot;value1&quot;&gt;&gt;, &lt;&lt;&quot;param2&quot;&gt;&gt; =&gt; &lt;&lt;&quot;value2&quot;&gt;&gt;},</p><p id="pc5i3w_2036">case rest_api_client:make_request(Token, Method, Url, Body) of</p><p id="pc5i3w_2037"><code class="code" id="pc5i3w_2706"></code> {ok, Response} -&gt; io:format(&quot;Response: <span id="pc5i3w_2707"><sub class="subscript">p</sub></span>n&quot;, [Response]);</p><p id="pc5i3w_2038"><code class="code" id="pc5i3w_2708"></code> {error, Reason} -&gt; io:format(&quot;Request failed: <span id="pc5i3w_2709"><sub class="subscript">p</sub></span>n&quot;, [Reason])</p><p id="pc5i3w_2039">end.</p><p id="pc5i3w_2040"><span class="control" id="pc5i3w_2710">Пример 3: Формирование URL</span></p><p id="pc5i3w_2041">Host = &lt;&lt;&quot;127.0.0.1&quot;&gt;&gt;,</p><p id="pc5i3w_2042">Port = &lt;&lt;&quot;8080&quot;&gt;&gt;,</p><p id="pc5i3w_2043">Path = &lt;&lt;&quot;api/v1/resource&quot;&gt;&gt;,</p><p id="pc5i3w_2044">Url = rest_api_client:get_url(Host, Port, Path),</p><p id="pc5i3w_2045">io:format(&quot;Generated URL: <span id="pc5i3w_2711"><sub class="subscript">p</sub></span>n&quot;, [Url]).</p><p id="pc5i3w_2046"><span class="control" id="pc5i3w_2712">Ожидаемые сценарии работы</span></p><ul class="list _bullet" id="pc5i3w_2047"><li class="list__item" id="pc5i3w_2713"><p id="pc5i3w_2719">Успешный запрос:</p><ol class="list _decimal" id="pc5i3w_2720" type="1"><li class="list__item" id="pc5i3w_2721"><p id="pc5i3w_2723">Токен получен и запрос выполнен без ошибок\.</p></li><li class="list__item" id="pc5i3w_2722"><p id="pc5i3w_2724">Ответ: {ok, Response}\.</p></li></ol></li><li class="list__item" id="pc5i3w_2714"><p id="pc5i3w_2725">Ошибка токена:</p><ol class="list _decimal" id="pc5i3w_2726" type="1"><li class="list__item" id="pc5i3w_2727"><p id="pc5i3w_2729">Сервер не вернул токен\.</p></li><li class="list__item" id="pc5i3w_2728"><p id="pc5i3w_2730">Ответ: {error, no_token_in_response}\.</p></li></ol></li><li class="list__item" id="pc5i3w_2715"><p id="pc5i3w_2731">Ошибка запроса:</p><ol class="list _decimal" id="pc5i3w_2732" type="1"><li class="list__item" id="pc5i3w_2734"><p id="pc5i3w_2736">Сервер вернул неожиданный статус-код или произошла ошибка подключения\.</p></li><li class="list__item" id="pc5i3w_2735"><p id="pc5i3w_2737">Ответ: {error, Reason}\.</p></li></ol><p id="pc5i3w_2733"><span class="control" id="pc5i3w_2738">Примечания</span></p></li><li class="list__item" id="pc5i3w_2716"><p id="pc5i3w_2739">Формат данных:</p><ol class="list _decimal" id="pc5i3w_2740" type="1"><li class="list__item" id="pc5i3w_2741"><p id="pc5i3w_2742">Данные запросов и ответов кодируются/декодируются в формате JSON с помощью библиотеки jsx\.</p></li></ol></li><li class="list__item" id="pc5i3w_2717"><p id="pc5i3w_2743">Авторизация:</p><ol class="list _decimal" id="pc5i3w_2744" type="1"><li class="list__item" id="pc5i3w_2745"><p id="pc5i3w_2746">Используется авторизация с токеном, передаваемым в заголовке Authorization\.</p></li></ol></li><li class="list__item" id="pc5i3w_2718"><p id="pc5i3w_2747">Обработка ошибок:</p><ol class="list _decimal" id="pc5i3w_2748" type="1"><li class="list__item" id="pc5i3w_2750"><p id="pc5i3w_2751">Ошибки логируются, и в случае неудачного запроса возвращаются соответствующие коды и описания\.</p></li></ol><section class="chapter"><h3 id="14-state-graph-v1" data-toc="14-state-graph-v1"><a name=""></a><span class="control" id="pc5i3w_2757">А.14 Модуль state_graph (v1)</span></h3><p id="pc5i3w_2753">Модуль для работы с графическим отображением состояний. Поддерживает функцию голосования (vote), позволяя принимать решения на основе текущих данных о состоянии объектов.</p><p id="pc5i3w_2754"><span class="control" id="pc5i3w_2758">Общая информация</span></p><p id="pc5i3w_2755">Модуль state_graph предоставляет функционал для работы с цветами, связанными с состояниями и классами напряжения, извлечения класса напряжения из строки, а также вычисления среднего значения параметров из списка с учетом отклонений.</p></section></li></ul><div class="table-wrapper"><table class="wide" id="pc5i3w_2048"><thead><tr class="ijRowHead" id="pc5i3w_2759"><th id="pc5i3w_2763"><p><span class="control" id="pc5i3w_2765">Функция</span></p></th><th id="pc5i3w_2764"><p><span class="control" id="pc5i3w_2766">Описание</span></p></th></tr></thead><tbody><tr id="pc5i3w_2760"><td id="pc5i3w_2767"><p><span class="control" id="pc5i3w_2769">color/2</span></p></td><td id="pc5i3w_2768"><p id="pc5i3w_2770">: Возвращает цвет в зависимости от класса напряжения и состояния.</p><p id="pc5i3w_2771"><span class="control" id="pc5i3w_2784">Параметры</span>:</p><p id="pc5i3w_2772">- Vclass (integer) &mdash; класс напряжения.</p><p id="pc5i3w_2773">- State (integer) &mdash; состояние.</p><p id="pc5i3w_2774"><span class="control" id="pc5i3w_2785">Возвращает</span>:</p><p id="pc5i3w_2775">- Цвет в виде строки (binary), например: &lt;&lt;&quot;#959595&quot;&gt;&gt;.</p><p id="pc5i3w_2776"><span class="control" id="pc5i3w_2786">Детали реализации</span>:</p><p id="pc5i3w_2777">- Приводит State к числу, если это не так.</p><p id="pc5i3w_2778">- Определяет цвет для заданного класса напряжения (Vclass) из предопределенной карты цветов.</p><p id="pc5i3w_2779">- Возвращает цвет в зависимости от значения State.</p><p id="pc5i3w_2780"><span class="control" id="pc5i3w_2787">Пример использования</span>:</p><p id="pc5i3w_2781">Vclass = 65,</p><p id="pc5i3w_2782">State = 2,</p><p id="pc5i3w_2783">state_graph:color(Vclass, State).</p></td></tr><tr id="pc5i3w_2761"><td id="pc5i3w_2788"><p><span class="control" id="pc5i3w_2790">get_vclass_from_string/1</span></p></td><td id="pc5i3w_2789"><p id="pc5i3w_2791">: Извлекает класс напряжения из строки.</p><p id="pc5i3w_2792"><span class="control" id="pc5i3w_2803">Параметры</span>:</p><p id="pc5i3w_2793">- String (binary) &mdash; строка, содержащая класс напряжения.</p><p id="pc5i3w_2794"><span class="control" id="pc5i3w_2804">Возвращает</span>:</p><p id="pc5i3w_2795">- Класс напряжения (integer).</p><p id="pc5i3w_2796">- 0, если класс напряжения не найден.</p><p id="pc5i3w_2797"><span class="control" id="pc5i3w_2805">Детали реализации</span>:</p><p id="pc5i3w_2798">1. Использует регулярное выражение для поиска чисел в строке.</p><p id="pc5i3w_2799">2. Если совпадение найдено, преобразует его в число, иначе возвращает 0.</p><p id="pc5i3w_2800"><span class="control" id="pc5i3w_2806">Пример использования</span>:</p><p id="pc5i3w_2801">String = &lt;&lt;&quot;Voltage class: 110 kV&quot;&gt;&gt;,</p><p id="pc5i3w_2802">state_graph:get_vclass_from_string(String).</p></td></tr><tr id="pc5i3w_2762"><td id="pc5i3w_2807"><p><span class="control" id="pc5i3w_2809">vote/3</span></p></td><td id="pc5i3w_2808"><p id="pc5i3w_2810">: Вычисляет среднее значение параметров из списка, удовлетворяющих условию минимального отклонения от целевого значения.</p><p id="pc5i3w_2811"><span class="control" id="pc5i3w_2828">Параметры</span>:</p><p id="pc5i3w_2812">- Values (list) &mdash; список чисел.</p><p id="pc5i3w_2813">- Deviation (integer) &mdash; допустимое отклонение.</p><p id="pc5i3w_2814">- TargetValue (integer) &mdash; целевое значение.</p><p id="pc5i3w_2815"><span class="control" id="pc5i3w_2829">Возвращает</span>:</p><p id="pc5i3w_2816">- Среднее значение (float) из фильтрованных значений.</p><p id="pc5i3w_2817">- none, если подходящие значения отсутствуют.</p><p id="pc5i3w_2818"><span class="control" id="pc5i3w_2830">Детали реализации</span>:</p><p id="pc5i3w_2819">- Фильтрует значения, которые находятся в пределах Deviation от TargetValue.</p><p id="pc5i3w_2820">- Если подходящих значений нет, возвращает none.</p><p id="pc5i3w_2821">- Если одно значение удовлетворяет условию, возвращает его.</p><p id="pc5i3w_2822">- Если несколько значений удовлетворяют условию, возвращает их среднее.</p><p id="pc5i3w_2823"><span class="control" id="pc5i3w_2831">Пример использования</span>:</p><p id="pc5i3w_2824">Values = [110, 115, 120, 130],</p><p id="pc5i3w_2825">Deviation = 10,</p><p id="pc5i3w_2826">TargetValue = 115,</p><p id="pc5i3w_2827">state_graph:vote(Values, Deviation, TargetValue).</p></td></tr></tbody></table></div><p id="pc5i3w_2049"><span class="control" id="pc5i3w_2832">Примеры использования модуля</span></p><p id="pc5i3w_2050"><span class="control" id="pc5i3w_2833">Пример 1: Определение цвета</span></p><p id="pc5i3w_2051">Vclass = 110,</p><p id="pc5i3w_2052">State = 1,</p><p id="pc5i3w_2053">Color = state_graph:color(Vclass, State),</p><p id="pc5i3w_2054">io:format(&quot;Цвет для класса напряжения ~p в состоянии ~p: <span id="pc5i3w_2834"><sub class="subscript">p</sub></span>n&quot;, [Vclass, State, Color]).</p><p id="pc5i3w_2055"><span class="control" id="pc5i3w_2835">Пример 2: Извлечение класса напряжения из строки</span></p><p id="pc5i3w_2056">String = &lt;&lt;&quot;This is a voltage class: 220&quot;&gt;&gt;,</p><p id="pc5i3w_2057">Vclass = state_graph:get_vclass_from_string(String),</p><p id="pc5i3w_2058">io:format(&quot;Извлеченный класс напряжения: <span id="pc5i3w_2836"><sub class="subscript">p</sub></span>n&quot;, [Vclass]).</p><p id="pc5i3w_2059"><span class="control" id="pc5i3w_2837">Пример 3: Расчет среднего значения с учетом отклонений</span></p><p id="pc5i3w_2060">Values = [100, 105, 115, 130],</p><p id="pc5i3w_2061">Deviation = 10,</p><p id="pc5i3w_2062">TargetValue = 110,</p><p id="pc5i3w_2063">Result = state_graph:vote(Values, Deviation, TargetValue),</p><p id="pc5i3w_2064">io:format(&quot;Среднее значение: <span id="pc5i3w_2838"><sub class="subscript">p</sub></span>n&quot;, [Result]).</p><p id="pc5i3w_2065"><span class="control" id="pc5i3w_2839">Ожидаемые сценарии работы</span></p><ul class="list _bullet" id="pc5i3w_2066"><li class="list__item" id="pc5i3w_2840"><p id="pc5i3w_2846"><span class="control" id="pc5i3w_2847">Обработка цветов</span>: Если класс напряжения не найден в предопределенных значениях, возвращается цвет &lt;&lt;&quot;#000000&quot;&gt;&gt; (черный). При некорректном состоянии (State) по умолчанию используется 0.</p></li><li class="list__item" id="pc5i3w_2841"><p id="pc5i3w_2848"><span class="control" id="pc5i3w_2849">Извлечение данных из строки</span>: Если строка не содержит числовых данных, возвращается 0.</p></li><li class="list__item" id="pc5i3w_2842"><p id="pc5i3w_2850"><span class="control" id="pc5i3w_2852">Фильтрация значений</span>: Если список значений пуст или не содержит подходящих элементов, возвращается none. При одном подходящем значении оно возвращается без изменений.</p><p id="pc5i3w_2851"><span class="control" id="pc5i3w_2853">Примечания</span></p></li><li class="list__item" id="pc5i3w_2843"><p id="pc5i3w_2854"><span class="control" id="pc5i3w_2855">Обработка цветов</span>: Цвета ассоциируются с классами напряжения и состояниями, а если значения отсутствуют, используются цвета по умолчанию.</p></li><li class="list__item" id="pc5i3w_2844"><p id="pc5i3w_2856"><span class="control" id="pc5i3w_2857">Работа со строками</span>: Класс напряжения извлекается из строки с помощью регулярных выражений.</p></li><li class="list__item" id="pc5i3w_2845"><p id="pc5i3w_2858"><span class="control" id="pc5i3w_2861">Расчет среднего</span>: Фильтрация значений осуществляется на основе заданного допустимого отклонения.</p><section class="chapter"><h3 id="faceplate-api" data-toc="faceplate-api"><a name=""></a><span class="control" id="pc5i3w_2865">Приложение Б. Faceplate API</span></h3><p id="pc5i3w_2863">Эта документация поможет эффективно использовать API для работы с объектами, архивами и хранилищем данных в SCADA/EMS.</p></section><section class="chapter"><h3 id="1-fp-fp-db-fp-api-erlang-md" data-toc="1-fp-fp-db-fp-api-erlang-md"><a name=""></a><span class="control" id="pc5i3w_2871">Б.1 Модули fp и fp_db (fp_api_erlang.md)</span></h3><p id="pc5i3w_2867"><span class="control" id="pc5i3w_2872">Общая информация</span></p><p id="pc5i3w_2868">Модули fp и fp_db предназначены для работы с объектами, архивами и хранилищем данных в среде SCADA/EMS. API предоставляет методы для преобразования данных, работы с объектами, чтения и изменения полей, а также выполнения запросов.</p><p id="pc5i3w_2869">Функции модуля оптимизированы для использования в RunTime и могут работать быстрее за счет кеширования данных.</p></section></li></ul><div class="table-wrapper"><table class="wide" id="pc5i3w_2067"><thead><tr class="ijRowHead" id="pc5i3w_2873"><th id="pc5i3w_2891"><p><span class="control" id="pc5i3w_2893">Функция</span></p></th><th id="pc5i3w_2892"><p><span class="control" id="pc5i3w_2894">Описание</span></p></th></tr></thead><tbody><tr id="pc5i3w_2874"><td id="pc5i3w_2895"><p>fp:to_json/1</p></td><td id="pc5i3w_2896"><p id="pc5i3w_2897"><span class="control" id="pc5i3w_2901">:</span> Преобразует Erlang-терм (список, map, числа) в JSON.</p><p id="pc5i3w_2898"><span class="control" id="pc5i3w_2902">Возвращает:</span> binary в формате JSON.</p><p id="pc5i3w_2899"><span class="control" id="pc5i3w_2903">Пример использования:</span></p><p id="pc5i3w_2900">JSON = fp:to_json(#{key =&gt; &quot;value&quot;}).</p></td></tr><tr id="pc5i3w_2875"><td id="pc5i3w_2904"><p>fp:from_json/1</p></td><td id="pc5i3w_2905"><p id="pc5i3w_2906"><span class="control" id="pc5i3w_2909">:</span> Конвертирует JSON (в формате binary) обратно в Erlang-терм. <br><span class="control" id="pc5i3w_2911">Возвращает:</span> Термин (например, список, map, числа).</p><p id="pc5i3w_2907"><span class="control" id="pc5i3w_2912">Пример использования:</span></p><p id="pc5i3w_2908">Term = fp:from_json(&lt;&lt;&quot;{\&quot;key\&quot;:\&quot;value\&quot;}&quot;&gt;&gt;).</p></td></tr><tr id="pc5i3w_2876"><td id="pc5i3w_2913"><p>fp:open_tag/1</p></td><td id="pc5i3w_2914"><p id="pc5i3w_2915"><span class="control" id="pc5i3w_2920">:</span> Открывает объект тега по указанному пути. Работает быстрее fp_db:open/1, благодаря кешированию.</p><p id="pc5i3w_2916"><span class="control" id="pc5i3w_2921">Требование:</span> Работает только в режиме RunTime.</p><p id="pc5i3w_2917"><span class="control" id="pc5i3w_2922">Возвращает:</span> {ok, Object}.</p><p id="pc5i3w_2918"><span class="control" id="pc5i3w_2923">Пример использования:</span></p><p id="pc5i3w_2919">{ok, Tag} = fp:open_tag(&quot;/path/to/tag&quot;).</p></td></tr><tr id="pc5i3w_2877"><td id="pc5i3w_2924"><p>fp:get_value/2</p></td><td id="pc5i3w_2925"><p id="pc5i3w_2926"><span class="control" id="pc5i3w_2931">:</span> Получает значение поля объекта по пути к тегу. Работает быстрее, чем fp_db:read_field.</p><p id="pc5i3w_2927"><span class="control" id="pc5i3w_2932">Требование:</span> Работает только в режиме RunTime.</p><p id="pc5i3w_2928"><span class="control" id="pc5i3w_2933">Возвращает:</span> {ok, Value}.</p><p id="pc5i3w_2929"><span class="control" id="pc5i3w_2934">Пример использования:</span></p><p id="pc5i3w_2930">{ok, Value} = fp:get_value(Tag, Field).</p></td></tr><tr id="pc5i3w_2878"><td id="pc5i3w_2935"><p>fp:get_value/3</p></td><td id="pc5i3w_2936"><p id="pc5i3w_2937"><span class="control" id="pc5i3w_2941">:</span> Аналог fp:get_value/2, но возвращает значение Default, если поле не задано.</p><p id="pc5i3w_2938"><span class="control" id="pc5i3w_2942">Возвращает:</span> {ok, Value}.</p><p id="pc5i3w_2939"><span class="control" id="pc5i3w_2943">Пример использования:</span></p><p id="pc5i3w_2940">{ok, Value} = fp:get_value(Tag, Field, DefaultValue).</p></td></tr><tr id="pc5i3w_2879"><td id="pc5i3w_2944"><p>fp:set_value/2</p></td><td id="pc5i3w_2945"><p id="pc5i3w_2946"><span class="control" id="pc5i3w_2954">:</span> Изменяет значения полей тега.</p><p id="pc5i3w_2947"><span class="control" id="pc5i3w_2955">Требование:</span> Работает только в режиме RunTime.</p><p id="pc5i3w_2948"><span class="control" id="pc5i3w_2956">Принимает:</span></p><p id="pc5i3w_2949">- TagPath &mdash; путь к тегу.</p><p id="pc5i3w_2950">- Changes &mdash; список пар {Field, Value}.</p><p id="pc5i3w_2951"><span class="control" id="pc5i3w_2957">Возвращает:</span> ok.</p><p id="pc5i3w_2952"><span class="control" id="pc5i3w_2958">Пример использования:</span></p><p id="pc5i3w_2953">ok = fp:set_value(&quot;/path/to/tag&quot;, [{field1, value1}, {field2, value2}]).</p></td></tr><tr id="pc5i3w_2880"><td id="pc5i3w_2959"><p>fp:set_value/3</p></td><td id="pc5i3w_2960"><p id="pc5i3w_2961"><span class="control" id="pc5i3w_2966">:</span> Присваивает конкретное значение полю объекта.</p><p id="pc5i3w_2962"><span class="control" id="pc5i3w_2967">Требование:</span> Работает только в режиме RunTime.</p><p id="pc5i3w_2963"><span class="control" id="pc5i3w_2968">Возвращает:</span> ok.</p><p id="pc5i3w_2964"><span class="control" id="pc5i3w_2969">Пример использования:</span></p><p id="pc5i3w_2965">ok = fp:set_value(&quot;/path/to/tag&quot;, field, value).</p></td></tr><tr id="pc5i3w_2881"><td id="pc5i3w_2970"><p>fp:archives_get/2</p></td><td id="pc5i3w_2971"><p id="pc5i3w_2972"><span class="control" id="pc5i3w_2977">:</span> Возвращает значения архивов для указанных точек в заданных моментах времени.</p><p id="pc5i3w_2973"><span class="control" id="pc5i3w_2978">Возвращает:</span> Список списков формата:</p><p id="pc5i3w_2974"><code class="code" id="pc5i3w_2979"></code> [[TS1, A1_value, A2_value, ...], ...].</p><p id="pc5i3w_2975"><span class="control" id="pc5i3w_2980">Пример использования:</span></p><p id="pc5i3w_2976">Data = fp:archives_get(Points, Archives).</p></td></tr><tr id="pc5i3w_2882"><td id="pc5i3w_2981"><p>fp:archive_get_point/2</p></td><td id="pc5i3w_2982"><p id="pc5i3w_2983"><span class="control" id="pc5i3w_2987">:</span> Получает значение из архива в заданный момент времени.</p><p id="pc5i3w_2984"><span class="control" id="pc5i3w_2988">Возвращает:</span> {TS, Value}.</p><p id="pc5i3w_2985"><span class="control" id="pc5i3w_2989">Пример использования:</span></p><p id="pc5i3w_2986">{Timestamp, Value} = fp:archive_get_point(Archive, Timestamp).</p></td></tr><tr id="pc5i3w_2883"><td id="pc5i3w_2990"><p>fp:archives_get_periods/2</p></td><td id="pc5i3w_2991"><p id="pc5i3w_2992"><span class="control" id="pc5i3w_2997">:</span> Возвращает значения архивов за периоды, настроенные через Params.</p><p id="pc5i3w_2993"><span class="control" id="pc5i3w_2998">Возвращает:</span> Список списков формата:</p><p id="pc5i3w_2994"><code class="code" id="pc5i3w_2999"></code> [[TS1, A1_value, A2_value, ...], ...].</p><p id="pc5i3w_2995"><span class="control" id="pc5i3w_3000">Пример использования:</span></p><p id="pc5i3w_2996">Data = fp:archives_get_periods(Params, Archives).</p></td></tr><tr id="pc5i3w_2884"><td id="pc5i3w_3001"><p>fp:version/0</p></td><td id="pc5i3w_3002"><p id="pc5i3w_3003"><span class="control" id="pc5i3w_3007">:</span> Возвращает текущую версию API.</p><p id="pc5i3w_3004"><span class="control" id="pc5i3w_3008">Возвращает:</span> Версию в формате Version.</p><p id="pc5i3w_3005"><span class="control" id="pc5i3w_3009">Пример использования:</span></p><p id="pc5i3w_3006">Version = fp:version().</p></td></tr><tr id="pc5i3w_2885"><td id="pc5i3w_3010"><p>fp_db:create_object/1</p></td><td id="pc5i3w_3011"><p id="pc5i3w_3012"><span class="control" id="pc5i3w_3016">:</span> Создаёт объект с заданными полями.</p><p id="pc5i3w_3013"><span class="control" id="pc5i3w_3017">Возвращает:</span> Объект.</p><p id="pc5i3w_3014"><span class="control" id="pc5i3w_3018">Пример использования:</span></p><p id="pc5i3w_3015">Object = fp_db:create_object(#{field1 =&gt; value1, field2 =&gt; value2}).</p></td></tr><tr id="pc5i3w_2886"><td id="pc5i3w_3019"><p>fp_db:read_field/2</p></td><td id="pc5i3w_3020"><p id="pc5i3w_3021"><span class="control" id="pc5i3w_3025">:</span> Читает значение поля объекта.</p><p id="pc5i3w_3022"><span class="control" id="pc5i3w_3026">Возвращает:</span> {ok, Value}.</p><p id="pc5i3w_3023"><span class="control" id="pc5i3w_3027">Пример использования:</span></p><p id="pc5i3w_3024">{ok, Value} = fp_db:read_field(Object, Field).</p></td></tr><tr id="pc5i3w_2887"><td id="pc5i3w_3028"><p>fp_db:read_field/3</p></td><td id="pc5i3w_3029"><p id="pc5i3w_3030"><span class="control" id="pc5i3w_3034">:</span> Читает значение поля объекта с дополнительными параметрами.</p><p id="pc5i3w_3031"><span class="control" id="pc5i3w_3035">Возвращает:</span> {ok, Value}.</p><p id="pc5i3w_3032"><span class="control" id="pc5i3w_3036">Пример использования:</span></p><p id="pc5i3w_3033">{ok, Value} = fp_db:read_field(Object, Field, Params).</p></td></tr><tr id="pc5i3w_2888"><td id="pc5i3w_3037"><p>fp_db:read_fields/2</p></td><td id="pc5i3w_3038"><p id="pc5i3w_3039"><span class="control" id="pc5i3w_3043">:</span> Читает сразу несколько полей объекта.</p><p id="pc5i3w_3040"><span class="control" id="pc5i3w_3044">Возвращает:</span> Map с парами #{Field =&gt; Value}.</p><p id="pc5i3w_3041"><span class="control" id="pc5i3w_3045">Пример использования:</span></p><p id="pc5i3w_3042">Fields = fp_db:read_fields(Object, [field1, field2]).</p></td></tr><tr id="pc5i3w_2889"><td id="pc5i3w_3046"><p>fp_db:edit_object/2</p></td><td id="pc5i3w_3047"><p id="pc5i3w_3048"><span class="control" id="pc5i3w_3052">:</span> Изменяет значения полей объекта.</p><p id="pc5i3w_3049"><span class="control" id="pc5i3w_3053">Возвращает:</span> ok.</p><p id="pc5i3w_3050"><span class="control" id="pc5i3w_3054">Пример использования:</span></p><p id="pc5i3w_3051">ok = fp_db:edit_object(Object, #{field =&gt; value}).</p></td></tr><tr id="pc5i3w_2890"><td id="pc5i3w_3055"><p>fp_db:query/1</p></td><td id="pc5i3w_3056"><p id="pc5i3w_3057"><span class="control" id="pc5i3w_3061">:</span> Выполняет запрос к хранилищу данных (Ecomet).</p><p id="pc5i3w_3058"><span class="control" id="pc5i3w_3062">Возвращает:</span> Результат запроса.</p><p id="pc5i3w_3059"><span class="control" id="pc5i3w_3063">Пример использования:</span></p><p id="pc5i3w_3060">Result = fp_db:query(Query).</p></td></tr></tbody></table></div><p id="pc5i3w_2068"><span class="control" id="pc5i3w_3064">Примечания</span></p><ul class="list _bullet" id="pc5i3w_2069"><li class="list__item" id="pc5i3w_3065"><p id="pc5i3w_3070"><span class="control" id="pc5i3w_3071">RunTime:</span> Некоторые функции (fp:open_tag, fp:get_value, fp:set_value) работают только в режиме RunTime.</p></li><li class="list__item" id="pc5i3w_3066"><p id="pc5i3w_3072"><span class="control" id="pc5i3w_3073">Кеширование:</span> Функции fp оптимизированы за счёт использования кеша, что делает их быстрее аналогов из fp_db.</p></li><li class="list__item" id="pc5i3w_3067"><p id="pc5i3w_3074"><span class="control" id="pc5i3w_3076">Совместимость:</span> Архивные функции (fp:archives_get, fp:archive_get_point) совместимы с функциями из fp_archive.</p><section class="chapter"><h3 id="2-javascript-fp-api-js-md" data-toc="2-javascript-fp-api-js-md"><a name=""></a><span class="control" id="pc5i3w_3082">Б.2 Модуль функций JavaScript (fp_api_js.md)</span></h3><p id="pc5i3w_3078"><span class="control" id="pc5i3w_3083">Общая информация</span></p><p id="pc5i3w_3079">fp_api_js предоставляет функции для взаимодействия с объектами SCADA-системы на базе JavaScript. Используйте функции для работы с тегами, хранилищем данных и архивами.</p><p id="pc5i3w_3080"><span class="control" id="pc5i3w_3084">Общие рекомендации</span></p></section></li><li class="list__item" id="pc5i3w_3068"><p id="pc5i3w_3085"><span class="control" id="pc5i3w_3086">Асинхронность:</span> Все функции API возвращают промисы. Для получения результата используйте await.</p></li><li class="list__item" id="pc5i3w_3069"><p id="pc5i3w_3087"><span class="control" id="pc5i3w_3088">Идентификаторы объектов:</span> Вместо путей к тегам можно использовать идентификаторы объектов, полученные при создании.</p></li></ul><div class="table-wrapper"><table class="wide" id="pc5i3w_2070"><thead><tr class="ijRowHead" id="pc5i3w_3089"><th id="pc5i3w_3097"><p><span class="control" id="pc5i3w_3099">Функция</span></p></th><th id="pc5i3w_3098"><p><span class="control" id="pc5i3w_3100">Описание</span></p></th></tr></thead><tbody><tr id="pc5i3w_3090"><td id="pc5i3w_3101" colspan="2"><p><span class="control" id="pc5i3w_3102">Работа с тегами</span></p></td></tr><tr id="pc5i3w_3091"><td id="pc5i3w_3103"><p>fp.api.get_value(path, field)</p></td><td id="pc5i3w_3104"><p id="pc5i3w_3105">: Получает значение заданного поля тега.</p><p id="pc5i3w_3106"><span class="control" id="pc5i3w_3113">Параметры:</span></p><p id="pc5i3w_3107">- path (string): Путь к тегу.</p><p id="pc5i3w_3108">- field (string): Поле тега, значение которого необходимо получить.</p><p id="pc5i3w_3109"><span class="control" id="pc5i3w_3114">Возвращает:</span></p><p id="pc5i3w_3110">- Значение поля.</p><p id="pc5i3w_3111"><span class="control" id="pc5i3w_3115">Пример использования:</span></p><p id="pc5i3w_3112">let value = await fp.api.get_value('/root/PROJECT/TAGS/AI', 'value');</p></td></tr><tr id="pc5i3w_3092"><td id="pc5i3w_3116"><p>fp.api.set_value(path, field, value)</p></td><td id="pc5i3w_3117"><p id="pc5i3w_3118">: Устанавливает значение поля тега.</p><p id="pc5i3w_3119"><span class="control" id="pc5i3w_3126">Параметры:</span></p><p id="pc5i3w_3120">- path (string): Путь к тегу.</p><p id="pc5i3w_3121">- field (string): Поле тега.</p><p id="pc5i3w_3122">- value (any): Значение, которое нужно записать.</p><p id="pc5i3w_3123"><span class="control" id="pc5i3w_3127">Возвращает:</span> undefined.</p><p id="pc5i3w_3124"><span class="control" id="pc5i3w_3128">Пример использования:</span></p><p id="pc5i3w_3125">fp.api.set_value('/root/PROJECT/TAGS/AI', 'value', 10.5);</p></td></tr><tr id="pc5i3w_3093"><td id="pc5i3w_3129"><p>fp.api.archives_get(timestamps, archives)</p></td><td id="pc5i3w_3130"><p id="pc5i3w_3131">: Получает данные из архива для указанных временных точек.</p><p id="pc5i3w_3132"><span class="control" id="pc5i3w_3142">Параметры:</span></p><p id="pc5i3w_3133">- timestamps (array): Массив временных точек.</p><p id="pc5i3w_3134">- archives (array): Массив массивов, где каждый элемент: [путь к архиву, агрегирующая функция].</p><p id="pc5i3w_3135"><span class="control" id="pc5i3w_3143">Возвращает:</span></p><p id="pc5i3w_3136">- Массив массивов, содержащих временные метки и значения.</p><p id="pc5i3w_3137"><span class="control" id="pc5i3w_3144">Пример использования:</span></p><p id="pc5i3w_3138">let data = await fp.api.archives_get(</p><p id="pc5i3w_3139"><code class="code" id="pc5i3w_3145"></code> [TS1, TS2, TS3],</p><p id="pc5i3w_3140"><code class="code" id="pc5i3w_3146"></code> [[&quot;/root/PROJECT/TAGS/archive_1&quot;, &quot;avg&quot;]]</p><p id="pc5i3w_3141">);</p></td></tr><tr id="pc5i3w_3094"><td id="pc5i3w_3147" colspan="2"><p><span class="control" id="pc5i3w_3148">Работа с хранилищем данных</span></p></td></tr><tr id="pc5i3w_3095"><td id="pc5i3w_3149"><p>fp.db.create_object(params)</p></td><td id="pc5i3w_3150"><p id="pc5i3w_3151">: Создает новый объект.</p><p id="pc5i3w_3152"><span class="control" id="pc5i3w_3163">Параметры:</span></p><p id="pc5i3w_3153">- params (object): Параметры объекта, включая .name, .folder, .pattern и дополнительные поля.</p><p id="pc5i3w_3154"><span class="control" id="pc5i3w_3164">Возвращает:</span></p><p id="pc5i3w_3155">- Идентификатор созданного объекта.</p><p id="pc5i3w_3156"><span class="control" id="pc5i3w_3165">Пример использования:</span></p><p id="pc5i3w_3157">let obj = await fp.db.create_object({</p><p id="pc5i3w_3158"><code class="code" id="pc5i3w_3166"></code> &quot;.name&quot;: &quot;mytag&quot;,</p><p id="pc5i3w_3159"><code class="code" id="pc5i3w_3167"></code> &quot;.folder&quot;: &quot;/root/PROJECT/TAGS/folder&quot;,</p><p id="pc5i3w_3160"><code class="code" id="pc5i3w_3168"></code> &quot;.pattern&quot;: &quot;/root/.patterns/AI&quot;,</p><p id="pc5i3w_3161"><code class="code" id="pc5i3w_3169"></code> &quot;value&quot;: 1.0</p><p id="pc5i3w_3162">});</p></td></tr><tr id="pc5i3w_3096"><td id="pc5i3w_3170"><p>fp.db.read_field(object, field)</p></td><td id="pc5i3w_3171"><p id="pc5i3w_3178">: Читает значение поля объекта.</p><p id="pc5i3w_3179"><span class="control" id="pc5i3w_3181">Параметры:</span></p><p id="pc5i3w_3180"></p><p> - object (string</p></td><td id="pc5i3w_3172"><p>ID): Путь или идентификатор объекта.</p></td><p id="pc5i3w_3173">- field (string): Название поля.</p><p id="pc5i3w_3174"><span class="control" id="pc5i3w_3182">Возвращает:</span></p><p id="pc5i3w_3175">- Значение поля.</p><p id="pc5i3w_3176"><span class="control" id="pc5i3w_3183">Пример использования:</span></p><p id="pc5i3w_3177">let value = await fp.db.read_field('/root/PROJECT/TAGS/AI', 'value');</p></tr></tbody></table></div><tr id="pc5i3w_2071"><td id="pc5i3w_3184"><p>fp.db.edit_object(object, changes)</p></td><td id="pc5i3w_3185"><p id="pc5i3w_3191">: Редактирует существующий объект.</p><p id="pc5i3w_3192"><span class="control" id="pc5i3w_3194">Параметры:</span></p><p id="pc5i3w_3193"></p><p> - object (string</p></td><td id="pc5i3w_3186"><p>ID): Путь или идентификатор объекта.</p></td><p id="pc5i3w_3187">- changes (object): Изменяемые поля и их новые значения.</p><p id="pc5i3w_3188"><span class="control" id="pc5i3w_3195">Возвращает:</span> undefined.</p><p id="pc5i3w_3189"><span class="control" id="pc5i3w_3196">Пример использования:</span></p><p id="pc5i3w_3190">fp.db.edit_object('/root/PROJECT/TAGS/AI', { value: 1.0, title: &quot;Updated&quot; });</p></tr></section><tr id="pc5i3w_11"><td id="pc5i3w_3197"><p>fp.db.delete_object(object)</p></td><td id="pc5i3w_3198"><p id="pc5i3w_3203">: Удаляет объект.</p><p id="pc5i3w_3204"><span class="control" id="pc5i3w_3206">Параметры:</span></p><p id="pc5i3w_3205"></p><p> - object (string</p></td><td id="pc5i3w_3199"><p>ID): Путь или идентификатор объекта.</p></td><p id="pc5i3w_3200"><span class="control" id="pc5i3w_3207">Возвращает:</span> undefined.</p><p id="pc5i3w_3201"><span class="control" id="pc5i3w_3208">Пример использования:</span></p><p id="pc5i3w_3202">fp.db.delete_object('/root/PROJECT/TAGS/AI');</p></tr><div class="last-modified">27 February 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="глоссарий.html" class="navigation-links__prev">Глоссарий</a><a href="справочник-reference.html" class="navigation-links__next">Справочник (Reference)</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>